import{c as e,a as t,o as l,b as a,d as s,e as r,f as o,t as n,n as u,g as i,w as d,F as c,h as v,u as m,T as p,r as f,i as g,j as y,k as b,l as x,m as h,p as k,v as w,q as S,s as C,x as V,y as $,z as j,A as M,B as K,C as _,D as T,E as A,G as D}from"./vendor.BnZastaP.js";import{u as z,m as E,f as B}from"./utils.DDQJZnh8.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const O={class:"flex items-start space-x-3"},q={key:0,class:"flex-shrink-0 mt-0.5"},U={class:"flex-1"},L={key:0,class:"font-semibold text-sm"},I={key:1,class:"text-sm mt-1 opacity-90"},N={__name:"Toast",props:{toast:{type:Object,required:!0}},emits:["dismiss"],setup(i){const d=i,c=e(()=>{const e={default:"bg-card border-border text-card-foreground",success:"bg-green-950 border-green-900 text-green-100",destructive:"bg-red-950 border-red-900 text-red-100"};return e[d.toast.variant]||e.default}),v=e(()=>"success"===d.toast.variant?{template:'\n        <svg class="text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />\n        </svg>\n      '}:"destructive"===d.toast.variant?{template:'\n        <svg class="text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n        </svg>\n      '}:null);return(e,d)=>(l(),t("div",{class:u(["pointer-events-auto relative flex w-full items-center justify-between rounded-lg border p-4 shadow-lg transition-all",c.value])},[a("div",O,[v.value?(l(),t("div",q,[(l(),r(o(v.value),{class:"h-5 w-5"}))])):s("",!0),a("div",U,[i.toast.title?(l(),t("div",L,n(i.toast.title),1)):s("",!0),i.toast.description?(l(),t("div",I,n(i.toast.description),1)):s("",!0)])]),a("button",{onClick:d[0]||(d[0]=t=>e.$emit("dismiss",i.toast.id)),class:"flex-shrink-0 ml-4 inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors hover:bg-accent"},[...d[1]||(d[1]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])],2))}},F={class:"fixed bottom-0 right-0 z-50 p-4 space-y-4 max-w-md w-full pointer-events-none"},R=((e,t)=>{const l=e.__vccOpts||e;for(const[a,s]of t)l[a]=s;return l})({__name:"ToastContainer",setup(e){const{toasts:a,dismiss:s}=z();return(e,o)=>(l(),t("div",F,[i(p,{name:"toast",tag:"div"},{default:d(()=>[(l(!0),t(c,null,v(m(a),e=>(l(),r(N,{key:e.id,toast:e,onDismiss:m(s)},null,8,["toast","onDismiss"]))),128))]),_:1})]))}},[["__scopeId","data-v-ac8f77a9"]]),P={class:"min-h-screen bg-background text-foreground"},H={class:"border-b border-border"},J={class:"max-w-full px-4 sm:px-6 lg:px-8"},W={class:"flex items-center justify-between h-16"},Y={class:"flex items-center w-1/3"},G={class:"text-xl font-semibold opacity-75"},X={class:"flex items-center space-x-2 bg-muted rounded-full p-1"},Q=["onClick"],Z={class:"w-1/3 text-right"},ee={href:"https://github.com/stechstudio/keep",target:"_blank",class:"text-white/50 hover:text-white"},te={class:"max-w-full px-4 sm:px-6 lg:px-8 py-6"},le={__name:"App",setup(e){const s=[{id:"secrets",label:"Secrets",path:"/secrets"},{id:"diff",label:"Compare",path:"/diff"},{id:"settings",label:"Settings",path:"/settings"}],r=f("Keep"),o=f("");return g(async()=>{await async function(){try{const e=await window.$api.getSettings();r.value=e.app_name||"Keep",o.value=e.keep_version||""}catch(e){}}()}),(e,m)=>{const p=y("router-link"),f=y("router-view");return l(),t("div",P,[i(R),a("nav",H,[a("div",J,[a("div",W,[a("div",Y,[m[0]||(m[0]=a("div",{class:"size-9 pl-3 pr-2 rounded bg-muted mr-3 flex items-center justify-center text-primary"},[a("svg",{fill:"none",height:"100%",viewBox:"0 0 59 70",width:"59",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"m58.4476 69.14c-10.35 0-23.67-12.33-31.41-22.05-5.13-6.39-7.11-8.91-9.45-11.7l-4.32 4.32v25.29h-12.599982v-64.620005h12.599982v32.580005l31.5-32.580005h7.2l-24.21 24.570005z",fill:"currentColor"})])],-1)),a("span",G,n(r.value)+" Secrets",1)]),a("div",X,[(l(),t(c,null,v(s,t=>i(p,{key:t.id,to:t.path,custom:""},{default:d(({isActive:l})=>[a("button",{onClick:l=>e.$router.push(t.path),class:u(["px-4 py-1.5 rounded-full text-sm font-medium transition-colors",l?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"])},n(t.label),11,Q)]),_:2},1032,["to"])),64))]),a("div",Z,[a("a",ee,"Keep v"+n(o.value),1)])])])]),a("main",te,[i(f)])])}}},ae={class:"flex items-center space-x-3"},se={class:"relative"},re={key:0,class:"absolute top-full mt-1 bg-popover border border-border rounded-md shadow-lg z-10"},oe={class:"py-1"},ne=["onClick"],ue={class:"relative"},ie={key:0,class:"absolute top-full mt-1 w-48 bg-popover border border-border rounded-md shadow-lg z-10"},de={class:"py-1"},ce=["onClick"],ve={__name:"VaultStageSelector",props:{vault:String,stage:String,vaults:Array,stages:Array},emits:["update:vault","update:stage"],setup(r,{emit:o}){const i=r,d=o,m=f(!1),p=f(!1),g=e(()=>{var e;if(!i.vault)return"";const t=null==(e=i.vaults)?void 0:e.find(e=>("object"==typeof e?e.slug||e.name:e)===i.vault);return(null==t?void 0:t.display)||i.vault});return document.addEventListener("click",e=>{e.target.closest(".relative")||(m.value=!1,p.value=!1)}),(e,o)=>(l(),t("div",ae,[a("div",se,[a("button",{onClick:o[0]||(o[0]=e=>m.value=!m.value),class:"flex items-center space-x-2 px-3 pl-0 py-1.5 transition-colors"},[a("span",null,n(g.value||"Select Vault"),1),o[2]||(o[2]=a("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),m.value?(l(),t("div",re,[a("div",oe,[(l(!0),t(c,null,v(r.vaults,e=>(l(),t("button",{key:e.slug||e.name||e,onClick:t=>function(e){d("update:vault",e),m.value=!1}(e.slug||e.name||e),class:u(["w-full text-left px-3 py-2 text-sm hover:bg-accent transition-colors whitespace-nowrap",r.vault===(e.slug||e.name||e)?"bg-white/10":""])},n(e.display||e),11,ne))),128))])])):s("",!0)]),o[4]||(o[4]=a("div",{class:"text-lg text-white/30 font-bold pr-3"},"/",-1)),a("div",ue,[a("button",{onClick:o[1]||(o[1]=e=>p.value=!p.value),class:"flex items-center space-x-2 px-3 pl-0 py-1.5 transition-colors"},[a("span",null,n(r.stage||"Select Stage"),1),o[3]||(o[3]=a("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),p.value?(l(),t("div",ie,[a("div",de,[(l(!0),t(c,null,v(r.stages,e=>(l(),t("button",{key:e,onClick:t=>function(e){d("update:stage",e),p.value=!1}(e),class:u(["w-full text-left px-3 py-2 text-sm hover:bg-accent transition-colors",r.stage===e?"bg-white/10":""])},n(e),11,ce))),128))])])):s("",!0)])]))}},me={class:"flex items-center space-x-2"},pe={class:"font-mono text-sm"},fe=["title"],ge={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ye={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},be={__name:"SecretValue",props:{value:String,masked:{type:Boolean,default:!0}},emits:["toggle"],setup(s){const r=s,o=e(()=>{if(!r.masked)return r.value;const e=r.value||"",t=e.length;if(t<=8)return"••••";const l=e.substring(0,4)+"•".repeat(t-4);return t<=24?l:l.substring(0,24)+` (${t} chars)`});return(e,r)=>(l(),t("div",me,[a("span",pe,n(o.value),1),a("button",{onClick:r[0]||(r[0]=t=>e.$emit("toggle")),class:"p-1 rounded hover:bg-muted transition-colors",title:s.masked?"Show value":"Hide value"},[s.masked?(l(),t("svg",ge,[...r[1]||(r[1]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])])):(l(),t("svg",ye,[...r[2]||(r[2]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])]))],8,fe)]))}},xe={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},he={class:"text-lg font-semibold mb-4"},ke={class:"space-y-4"},we=["disabled"],Se={class:"text-xs text-muted-foreground"},Ce={class:"font-medium"},Ve={class:"font-medium"},$e={class:"flex justify-end space-x-3 mt-6"},je={type:"submit",class:"px-4 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors"},Me={__name:"SecretDialog",props:{secret:Object,vault:String,stage:String,initialKey:String},emits:["save","close"],setup(e,{emit:s}){const r=e,o=s,u=b({key:"",value:""});function i(){o("save",{key:u.key,value:u.value})}return x(()=>r.secret,e=>{e?(u.key=e.key,u.value=e.value):(u.key=r.initialKey||"",u.value="")},{immediate:!0}),x(()=>r.initialKey,e=>{!r.secret&&e&&(u.key=e)},{immediate:!0}),(s,r)=>(l(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:r[3]||(r[3]=h(e=>s.$emit("close"),["self"]))},[a("div",xe,[a("h2",he,n(e.secret?"Edit Secret":"Add Secret"),1),a("form",{onSubmit:h(i,["prevent"])},[a("div",ke,[a("div",null,[r[4]||(r[4]=a("label",{class:"block text-sm font-medium mb-1"},"Key",-1)),k(a("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>u.key=e),type:"text",disabled:!!e.secret,class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"SECRET_KEY",required:""},null,8,we),[[w,u.key]])]),a("div",null,[r[5]||(r[5]=a("label",{class:"block text-sm font-medium mb-1"},"Value",-1)),k(a("textarea",{"onUpdate:modelValue":r[1]||(r[1]=e=>u.value=e),rows:"4",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring font-mono",placeholder:"Secret value...",required:""},null,512),[[w,u.value]])]),a("div",Se,[r[6]||(r[6]=S(" Vault: ",-1)),a("span",Ce,n(e.vault),1),r[7]||(r[7]=S(" • Stage: ",-1)),a("span",Ve,n(e.stage),1)])]),a("div",$e,[a("button",{type:"button",onClick:r[2]||(r[2]=e=>s.$emit("close")),class:"px-4 py-2 text-sm font-medium border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),a("button",je,n(e.secret?"Save":"Add"),1)])],32)])]))}},Ke={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},_e={class:"bg-card border border-border rounded-lg p-6 w-96 max-w-full"},Te={class:"mb-4"},Ae=["value"],De={class:"mb-6"},ze={class:"flex justify-end space-x-3"},Ee=["disabled"],Be={__name:"RenameDialog",props:{currentKey:{type:String,required:!0}},emits:["close","rename"],setup(s,{emit:r}){const o=s,n=r,u=f(o.currentKey),i=e(()=>u.value.trim()&&u.value!==o.currentKey);function d(){i.value&&n("rename",u.value.trim())}return(e,r)=>(l(),t("div",Ke,[a("div",_e,[r[4]||(r[4]=a("h2",{class:"text-lg font-semibold mb-4"},"Rename Secret",-1)),a("div",Te,[r[2]||(r[2]=a("label",{class:"block text-sm font-medium mb-2"},"Current Key",-1)),a("input",{value:s.currentKey,disabled:"",class:"w-full px-3 py-2 bg-muted border border-border rounded-md text-sm opacity-60"},null,8,Ae)]),a("div",De,[r[3]||(r[3]=a("label",{class:"block text-sm font-medium mb-2"},"New Key",-1)),k(a("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>u.value=e),onKeyup:C(d,["enter"]),type:"text",placeholder:"Enter new key name",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},null,544),[[w,u.value]])]),a("div",ze,[a("button",{onClick:r[1]||(r[1]=t=>e.$emit("close")),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-accent transition-colors"}," Cancel "),a("button",{onClick:d,disabled:!i.value,class:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Rename ",8,Ee)])])]))}},Oe={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},qe={class:"bg-card border border-border rounded-lg p-6 w-96 max-w-full"},Ue={class:"mb-4"},Le=["value"],Ie={class:"mb-4"},Ne=["value"],Fe={class:"mb-6"},Re=["value","disabled"],Pe={class:"flex justify-end space-x-3"},He=["disabled"],Je={__name:"CopyToStageDialog",props:{secretKey:{type:String,required:!0},currentVault:{type:String,required:!0},currentStage:{type:String,required:!0},vaults:{type:Array,required:!0},stages:{type:Array,required:!0}},emits:["close","copy"],setup(s,{emit:r}){const o=s,u=r,i=f(""),d=e(()=>{const e=[];for(const t of o.vaults)for(const l of o.stages)e.push({key:`${t.name}:${l}`,vault:t.name,display:t.display,stage:l});return e});function m(){if(i.value){const[e,t]=i.value.split(":");u("copy",{targetVault:e,targetStage:t})}}return(e,r)=>(l(),t("div",Oe,[a("div",qe,[r[6]||(r[6]=a("h2",{class:"text-lg font-semibold mb-4"},"Copy Secret",-1)),a("div",Ue,[r[2]||(r[2]=a("label",{class:"block text-sm font-medium mb-2"},"Secret Key",-1)),a("input",{value:s.secretKey,disabled:"",class:"w-full px-3 py-2 bg-muted border border-border rounded-md text-sm opacity-60"},null,8,Le)]),a("div",Ie,[r[3]||(r[3]=a("label",{class:"block text-sm font-medium mb-2"},"From",-1)),a("input",{value:`${s.currentVault} / ${s.currentStage}`,disabled:"",class:"w-full px-3 py-2 bg-muted border border-border rounded-md text-sm opacity-60"},null,8,Ne)]),a("div",Fe,[r[5]||(r[5]=a("label",{class:"block text-sm font-medium mb-2"},"Copy To",-1)),k(a("select",{"onUpdate:modelValue":r[0]||(r[0]=e=>i.value=e),class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},[r[4]||(r[4]=a("option",{value:""},"Select destination...",-1)),(l(!0),t(c,null,v(d.value,e=>(l(),t("option",{key:e.key,value:e.key,disabled:e.key===`${s.currentVault}:${s.currentStage}`},n(e.display)+" / "+n(e.stage),9,Re))),128))],512),[[V,i.value]])]),a("div",Pe,[a("button",{onClick:r[1]||(r[1]=t=>e.$emit("close")),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-accent transition-colors"}," Cancel "),a("button",{onClick:m,disabled:!i.value,class:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Copy Secret ",8,He)])])]))}};const We=new class{constructor(){this.baseUrl="",this.token=window.KEEP_AUTH_TOKEN}async request(e,t={}){const l=await fetch(`${this.baseUrl}/api${e}`,{...t,headers:{"X-Auth-Token":this.token,"Content-Type":"application/json",...t.headers}});if(!l.ok){const e=await l.json().catch(()=>({error:"Request failed"}));throw new Error(e.error||`HTTP ${l.status}`)}return l.json()}async listSecrets(e,t,l=!1){return this.request(`/secrets?vault=${e}&stage=${t}&unmask=${l}`)}async getSecret(e,t,l,a=!1){return this.request(`/secrets/${encodeURIComponent(e)}?vault=${t}&stage=${l}&unmask=${a}`)}async createSecret(e,t,l,a){return this.request("/secrets",{method:"POST",body:JSON.stringify({key:e,value:t,vault:l,stage:a})})}async updateSecret(e,t,l,a){return this.request(`/secrets/${encodeURIComponent(e)}`,{method:"PUT",body:JSON.stringify({value:t,vault:l,stage:a})})}async deleteSecret(e,t,l){return this.request(`/secrets/${encodeURIComponent(e)}`,{method:"DELETE",body:JSON.stringify({vault:t,stage:l})})}async renameSecret(e,t,l,a){return this.request(`/secrets/${encodeURIComponent(e)}/rename`,{method:"POST",body:JSON.stringify({newKey:t,vault:l,stage:a})})}async copySecretToStage(e,t,l,a,s){return this.request(`/secrets/${encodeURIComponent(e)}/copy-to-stage?vault=${s}&stage=${a}`,{method:"POST",body:JSON.stringify({targetStage:t,targetVault:l})})}async searchSecrets(e,t,l,a=!1){return this.request(`/search?q=${encodeURIComponent(e)}&vault=${t}&stage=${l}&unmask=${a}`)}async getSecretHistory(e,t,l,a=10,s=!1){return this.request(`/secrets/${encodeURIComponent(e)}/history?vault=${t}&stage=${l}&limit=${a}&unmask=${s}`)}async getSettings(){return this.request("/settings")}async updateSettings(e){return this.request("/settings",{method:"PUT",body:JSON.stringify(e)})}async listVaults(){return this.request("/vaults")}async addVault(e){return this.request("/vaults",{method:"POST",body:JSON.stringify(e)})}async updateVault(e,t){return this.request(`/vaults/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteVault(e){return this.request(`/vaults/${e}`,{method:"DELETE"})}async listStages(){return this.request("/stages")}async addStage(e){return this.request("/stages",{method:"POST",body:JSON.stringify({stage:e})})}async removeStage(e){return this.request("/stages",{method:"DELETE",body:JSON.stringify({stage:e})})}async verifyVaults(){return this.request("/verify",{method:"POST"})}async getDiff(e=null,t=null){let l="/diff?";return e&&(l+=`stages=${e.join(",")}&`),t&&(l+=`vaults=${t.join(",")}`),this.request(l)}async exportSecrets(e,t,l="env"){return this.request("/export",{method:"POST",body:JSON.stringify({vault:e,stage:t,format:l})})}async analyzeImport({content:e,vault:t,stage:l,only:a=null,except:s=null}){return this.request("/import/analyze",{method:"POST",body:JSON.stringify({content:e,vault:t,stage:l,only:a,except:s})})}async executeImport({content:e,vault:t,stage:l,strategy:a,only:s=null,except:r=null,dry_run:o=!1}){return this.request("/import/execute",{method:"POST",body:JSON.stringify({content:e,vault:t,stage:l,strategy:a,only:s,except:r,dry_run:o})})}};function Ye(){const e=f([]),t=f(!1),l=f(null);async function a(a,s,r=!1){t.value=!0,l.value=null;try{const t=await We.listSecrets(a,s,r);return e.value=t.secrets,e.value}catch(o){throw l.value=o.message,e.value=[],o}finally{t.value=!1}}return{secrets:e,loading:t,error:l,loadSecrets:a,createSecret:async function(e,s,r,o){t.value=!0,l.value=null;try{const t=await We.createSecret(e,s,r,o);return await a(r,o),t}catch(n){throw l.value=n.message,n}finally{t.value=!1}},updateSecret:async function(e,s,r,o){t.value=!0,l.value=null;try{const t=await We.updateSecret(e,s,r,o);return await a(r,o),t}catch(n){throw l.value=n.message,n}finally{t.value=!1}},deleteSecret:async function(e,s,r){t.value=!0,l.value=null;try{const t=await We.deleteSecret(e,s,r);return await a(s,r),t}catch(o){throw l.value=o.message,o}finally{t.value=!1}},renameSecret:async function(e,s,r,o){t.value=!0,l.value=null;try{const t=await We.renameSecret(e,s,r,o);return await a(r,o),t}catch(n){throw l.value=n.message,n}finally{t.value=!1}},copySecretToStage:async function(e,a,s,r,o){t.value=!0,l.value=null;try{return await We.copySecretToStage(e,a,s,r,o)}catch(n){throw l.value=n.message,n}finally{t.value=!1}},searchSecrets:async function(a,s,r,o=!1){t.value=!0,l.value=null;try{const t=await We.searchSecrets(a,s,r,o);return e.value=t.secrets,e.value}catch(n){throw l.value=n.message,e.value=[],n}finally{t.value=!1}},getSecretHistory:async function(e,a,s,r=10,o=!1){t.value=!0,l.value=null;try{return await We.getSecretHistory(e,a,s,r,o)}catch(n){throw l.value=n.message,n}finally{t.value=!1}},clearError:function(){l.value=null}}}const Ge={class:"bg-card border border-border rounded-lg p-6 w-full max-w-4xl max-h-[80vh] flex flex-col"},Xe={class:"flex items-center justify-between mb-4"},Qe={class:"text-sm text-muted-foreground mt-1"},Ze={key:0,class:"flex-1 flex items-center justify-center"},et={key:1,class:"flex-1 flex items-center justify-center"},tt={class:"text-destructive"},lt={key:2,class:"flex-1 flex items-center justify-center"},at={key:3,class:"flex-1 overflow-y-auto"},st={class:"w-full"},rt={class:"sticky top-0 bg-card border-b border-border"},ot={class:"text-left px-4 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wider"},nt={class:"flex items-center space-x-2"},ut=["title"],it={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},dt={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ct={class:"divide-y divide-border"},vt={class:"px-4 py-3 text-sm"},mt={class:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-accent"},pt={key:0,class:"ml-2 inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-primary/10 text-primary"},ft={class:"px-4 py-3 text-sm"},gt={class:"font-mono"},yt={class:"px-4 py-3 text-sm text-muted-foreground"},bt={class:"px-4 py-3"},xt={class:"text-sm"},ht={class:"text-xs text-muted-foreground/70"},kt={class:"flex justify-between items-center mt-4 pt-4 border-t border-border"},wt={class:"text-sm text-muted-foreground"},St={__name:"HistoryDialog",props:{secretKey:{type:String,required:!0},vault:{type:String,required:!0},stage:{type:String,required:!0}},emits:["close","refresh"],setup(e,{emit:r}){const o=e,{getSecretHistory:u}=Ye(),i=f([]),d=f(!0),m=f(null),p=f(!1);function y(){p.value=!p.value}return g(()=>{!async function(){d.value=!0,m.value=null;try{const e=await u(o.secretKey,o.vault,o.stage,20,!0);i.value=e.history||[]}catch(e){m.value=e.message||"Failed to load history"}finally{d.value=!1}}()}),(r,o)=>(l(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:o[2]||(o[2]=h(e=>r.$emit("close"),["self"]))},[a("div",Ge,[a("div",Xe,[a("div",null,[o[3]||(o[3]=a("h2",{class:"text-lg font-semibold"},"Secret History",-1)),a("p",Qe,n(e.secretKey)+" • "+n(e.vault)+" / "+n(e.stage),1)]),a("button",{onClick:o[0]||(o[0]=e=>r.$emit("close")),class:"p-1 rounded-md hover:bg-muted transition-colors"},[...o[4]||(o[4]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),d.value?(l(),t("div",Ze,[...o[5]||(o[5]=[a("div",{class:"text-muted-foreground"},"Loading history...",-1)])])):m.value?(l(),t("div",et,[a("div",tt,n(m.value),1)])):0===i.value.length?(l(),t("div",lt,[...o[6]||(o[6]=[a("div",{class:"text-muted-foreground"},"No history found for this secret",-1)])])):(l(),t("div",at,[a("table",st,[a("thead",rt,[a("tr",null,[o[10]||(o[10]=a("th",{class:"text-left px-4 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Version",-1)),a("th",ot,[a("div",nt,[o[9]||(o[9]=a("span",null,"Value",-1)),a("button",{onClick:y,class:"p-1 rounded hover:bg-accent transition-colors",title:p.value?"Hide values":"Show values"},[p.value?(l(),t("svg",dt,[...o[8]||(o[8]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(l(),t("svg",it,[...o[7]||(o[7]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))],8,ut)])]),o[11]||(o[11]=a("th",{class:"text-left px-4 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Type",-1)),o[12]||(o[12]=a("th",{class:"text-left px-4 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Modified",-1))])]),a("tbody",ct,[(l(!0),t(c,null,v(i.value,(e,r)=>{return l(),t("tr",{key:`${e.version}-${r}`,class:"hover:bg-muted/50 transition-colors"},[a("td",vt,[a("span",mt," v"+n(e.version),1),0===r?(l(),t("span",pt," Current ")):s("",!0)]),a("td",ft,[a("span",gt,n((o=e.value,o?p.value?o:E(o,"••••"):"(null)")),1)]),a("td",yt,n(e.dataType),1),a("td",bt,[a("div",xt,n(e.modifiedDate),1),a("div",ht,n(e.modifiedBy),1)])]);var o}),128))])])])),a("div",kt,[a("div",wt," Showing "+n(i.value.length)+" revision"+n(1===i.value.length?"":"s"),1),a("button",{onClick:o[1]||(o[1]=e=>r.$emit("close")),class:"px-4 py-2 text-sm font-medium border border-border rounded-md hover:bg-muted transition-colors"}," Close ")])])]))}},Ct={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Vt={class:"flex items-start space-x-3"},$t={class:"flex-1"},jt={class:"mt-3 p-3 bg-muted/50 rounded-md"},Mt={class:"text-sm"},Kt={class:"font-medium"},_t={class:"text-xs text-muted-foreground mt-1"},Tt={class:"flex justify-end space-x-3 mt-6"},At={__name:"DeleteConfirmDialog",props:{secretKey:{type:String,required:!0},vault:{type:String,required:!0},stage:{type:String,required:!0}},emits:["close","confirm"],setup:e=>(s,r)=>(l(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:r[2]||(r[2]=h(e=>s.$emit("close"),["self"]))},[a("div",Ct,[a("div",Vt,[r[6]||(r[6]=a("div",{class:"flex-shrink-0"},[a("div",{class:"h-10 w-10 rounded-full bg-destructive/10 flex items-center justify-center"},[a("svg",{class:"h-6 w-6 text-destructive",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])])],-1)),a("div",$t,[r[3]||(r[3]=a("h3",{class:"text-lg font-semibold"},"Delete Secret",-1)),r[4]||(r[4]=a("p",{class:"mt-2 text-sm text-muted-foreground"}," Are you sure you want to delete this secret? ",-1)),a("div",jt,[a("div",Mt,[a("div",Kt,n(e.secretKey),1),a("div",_t,n(e.vault)+" / "+n(e.stage),1)])]),r[5]||(r[5]=a("p",{class:"mt-3 text-sm text-muted-foreground"}," This action cannot be undone. ",-1))])]),a("div",Tt,[a("button",{onClick:r[0]||(r[0]=e=>s.$emit("close")),class:"px-4 py-2 text-sm font-medium border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),a("button",{onClick:r[1]||(r[1]=e=>s.$emit("confirm")),class:"px-4 py-2 text-sm font-medium bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors"}," Delete Secret ")])])]))},Dt={class:"relative inline-block text-left"},zt={class:"py-1 flex flex-col"},Et={__name:"SecretActionsMenu",props:{secretKey:{type:String,required:!0},secretValue:{type:String,default:null},vault:{type:String,required:!0},stage:{type:String,required:!0},showEdit:{type:Boolean,default:!0},showRename:{type:Boolean,default:!0},showCreate:{type:Boolean,default:!1},showCopyValue:{type:Boolean,default:!0},showCopyTo:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},showHistory:{type:Boolean,default:!0},buttonClass:{type:String,default:""}},emits:["edit","rename","create","copyValue","copyTo","delete","history","refresh"],setup(e,{emit:o}){const n=e,i=o,d=f(!1),c=f({}),v=f(null);function m(e){if(e.stopPropagation(),d.value)d.value=!1;else{document.dispatchEvent(new CustomEvent("close-all-menus"));const t=e.currentTarget.getBoundingClientRect(),l=t.right-192,a=t.bottom+4;c.value={left:`${l}px`,top:`${a}px`},setTimeout(()=>{d.value=!0},0)}}function p(){i("edit",{key:n.secretKey,value:n.secretValue,vault:n.vault,stage:n.stage}),d.value=!1}function y(){i("rename",{key:n.secretKey,value:n.secretValue,vault:n.vault,stage:n.stage}),d.value=!1}function b(){i("create",{key:n.secretKey}),d.value=!1}function x(){n.secretValue&&navigator.clipboard.writeText(n.secretValue),i("copyValue",{key:n.secretKey}),d.value=!1}function h(){i("copyTo",{key:n.secretKey,value:n.secretValue,vault:n.vault,stage:n.stage}),d.value=!1}function k(){i("history",{key:n.secretKey,vault:n.vault,stage:n.stage}),d.value=!1}function w(){i("delete",{key:n.secretKey,vault:n.vault,stage:n.stage}),d.value=!1}function S(e){d.value&&v.value&&!v.value.contains(e.target)&&(d.value=!1)}function C(){d.value=!1}return g(()=>{document.addEventListener("click",S),document.addEventListener("close-all-menus",C)}),$(()=>{document.removeEventListener("click",S),document.removeEventListener("close-all-menus",C)}),(o,n)=>(l(),t("div",Dt,[a("button",{ref_key:"buttonRef",ref:v,onClick:m,class:u(["p-1 rounded hover:bg-muted transition-colors",e.buttonClass])},[...n[0]||(n[0]=[a("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})],-1)])],2),d.value?(l(),r(M,{key:0,to:"body"},[a("div",{style:j(c.value),class:"fixed w-48 bg-popover border border-border rounded-md shadow-lg z-50"},[a("div",zt,[e.showEdit?(l(),t("button",{key:0,onClick:p,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Edit ")):s("",!0),e.showRename?(l(),t("button",{key:1,onClick:y,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Rename ")):s("",!0),e.showCreate?(l(),t("button",{key:2,onClick:b,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Create ")):s("",!0),e.showCopyValue?(l(),t("button",{key:3,onClick:x,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Copy Value ")):s("",!0),e.showCopyTo?(l(),t("button",{key:4,onClick:h,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Copy To... ")):s("",!0),e.showHistory?(l(),t("button",{key:5,onClick:k,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," History ")):s("",!0),e.showDelete?(l(),t("button",{key:6,onClick:w,class:"w-full text-left px-4 py-2 text-sm text-destructive hover:bg-accent transition-colors"}," Delete ")):s("",!0)])],4)])):s("",!0)]))}},Bt={class:"bg-card border border-border rounded-lg w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col"},Ot={class:"flex-1 overflow-y-auto px-6 py-4"},qt={key:0,class:"space-y-4"},Ut={class:"text-sm font-medium mb-2"},Lt={class:"text-sm text-muted-foreground mt-3"},It={class:"space-y-3 pt-4 border-t border-border"},Nt={class:"grid grid-cols-2 gap-4"},Ft={key:1,class:"space-y-4"},Rt={class:"flex items-center space-x-6 text-sm"},Pt={class:"font-medium text-green-500"},Ht={class:"font-medium text-yellow-500"},Jt={class:"font-medium text-red-500"},Wt={class:"font-medium text-gray-500"},Yt={key:0,class:"border border-yellow-500/20 bg-yellow-500/5 rounded-lg p-4"},Gt={class:"space-y-2"},Xt={class:"flex items-center space-x-2"},Qt={class:"flex items-center space-x-2"},Zt={class:"border border-border rounded-lg overflow-hidden"},el={class:"w-full text-sm"},tl={class:"divide-y divide-border"},ll={class:"px-4 py-2 font-mono"},al={class:"px-4 py-2 font-mono text-xs"},sl={class:"px-4 py-2"},rl={key:0,class:"block text-xs text-red-500 mt-1"},ol={class:"flex items-center space-x-2"},nl={key:2,class:"space-y-4"},ul={class:"font-medium mb-2"},il={class:"flex items-center space-x-6 text-sm"},dl={class:"font-medium text-green-500"},cl={class:"font-medium text-yellow-500"},vl={class:"font-medium text-red-500"},ml={key:0,class:"border border-blue-500/20 bg-blue-500/5 rounded-lg p-4"},pl={key:1,class:"border border-red-500/20 bg-red-500/5 rounded-lg p-4"},fl={class:"list-disc list-inside space-y-1"},gl={class:"border border-border rounded-lg overflow-hidden"},yl={class:"w-full text-sm"},bl={class:"divide-y divide-border"},xl={class:"px-4 py-2 font-mono"},hl={class:"px-4 py-2"},kl={class:"px-4 py-2 text-muted-foreground"},wl={class:"flex justify-between items-center px-6 py-4 border-t border-border"},Sl={class:"flex space-x-2"},Cl=["disabled"],Vl=["disabled"],$l={__name:"ImportWizard",props:{vault:String,stage:String},emits:["imported","close"],setup(r,{emit:o}){const i=r,d=o,m=z(),p=f(1),g=f(""),y=f(""),b=f(!1),x=f({only:"",except:""}),C=f(!1),V=f({total:0,new:0,existing:0,invalid:0,empty:0,secrets:[]}),$=f("skip"),j=f(!1),M=f(!1),T=f({imported:0,skipped:0,failed:0,results:{},errors:[]}),A=e(()=>V.value.secrets||[]);function D(e){const t=e.target.files[0];t&&B(t)}function E(e){e.preventDefault(),b.value=!1;const t=e.dataTransfer.files;if(0===t.length)return;const l=t[0];l.name.match(/\.env(\.|$)/)?B(l):m.error("Invalid file","Please upload a .env file")}function B(e){g.value=e.name;const t=new FileReader;t.onload=e=>{y.value=e.target.result},t.onerror=()=>{m.error("Failed to read file","Could not read the selected file")},t.readAsText(e)}async function O(){if(y.value){C.value=!0;try{const e=await window.$api.analyzeImport({content:y.value,vault:i.vault,stage:i.stage,only:x.value.only||null,except:x.value.except||null});V.value=e.analysis,p.value=2,0===V.value.existing&&($.value="skip")}catch(e){m.error("Failed to analyze import",e.message)}finally{C.value=!1}}else m.error("No content to import","Please upload a file or paste content")}async function q(){M.value=!0;try{const e=await window.$api.executeImport({content:y.value,vault:i.vault,stage:i.stage,strategy:$.value,only:x.value.only||null,except:x.value.except||null,dry_run:j.value});T.value=e,p.value=3,!j.value&&e.imported>0&&(m.success("Import successful",`Imported ${e.imported} secrets`),d("imported"))}catch(e){m.error("Failed to import",e.message)}finally{M.value=!1}}function U(){p.value=1,g.value="",y.value="",b.value=!1,d("close"),x.value={only:"",except:""},V.value={total:0,new:0,existing:0,invalid:0,empty:0,secrets:[]},$.value="skip",j.value=!1,T.value={imported:0,skipped:0,failed:0,results:{},errors:[]}}function L(e){switch(e){case"new":return"bg-green-500/10 text-green-500";case"existing":return"bg-yellow-500/10 text-yellow-500";case"invalid":return"bg-red-500/10 text-red-500";case"empty":return"bg-gray-500/10 text-gray-500";default:return"bg-muted text-muted-foreground"}}function I(e){switch(e){case"new":return"New";case"existing":return"Exists";case"invalid":return"Invalid";case"empty":return"Empty";default:return e}}function N(e){switch(e){case"imported":case"would_import":return"bg-green-500/10 text-green-500";case"skipped":return"bg-yellow-500/10 text-yellow-500";case"failed":return"bg-red-500/10 text-red-500";default:return"bg-muted text-muted-foreground"}}function F(e){switch(e.status){case"imported":return"Imported";case"would_import":return"Would Import";case"skipped":switch(e.reason){case"empty_value":return"Skipped (empty)";case"exists":return"Skipped (exists)";default:return"Skipped"}case"failed":switch(e.reason){case"invalid_key":return"Failed (invalid)";case"exists":return"Failed (exists)";case"vault_error":return"Failed (error)";default:return"Failed"}default:return e.status}}return(e,r)=>(l(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:h(U,["self"])},[a("div",Bt,[a("div",{class:"flex items-center justify-between px-6 py-4 border-b border-border"},[r[13]||(r[13]=a("h2",{class:"text-lg font-semibold"},"Import .env File",-1)),a("button",{onClick:U,class:"p-1 rounded-md hover:bg-muted transition-colors"},[...r[12]||(r[12]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),a("div",Ot,[1===p.value?(l(),t("div",qt,[r[20]||(r[20]=a("div",null,[a("h3",{class:"font-medium mb-2"},"Upload or Paste .env Content"),a("p",{class:"text-sm text-muted-foreground mb-4"}," Select a .env file from your computer or paste the content directly. ")],-1)),a("div",{onDrop:E,onDragover:r[1]||(r[1]=h(()=>{},["prevent"])),onDragenter:[r[2]||(r[2]=h(()=>{},["prevent"])),r[4]||(r[4]=e=>b.value=!0)],onDragleave:r[3]||(r[3]=e=>b.value=!1),class:u(["border-2 border-dashed rounded-lg p-6 text-center transition-colors",b.value?"border-primary bg-primary/5":"border-border"])},[a("input",{type:"file",ref:"fileInput",onChange:D,accept:".env,.env.*",class:"hidden"},null,544),r[14]||(r[14]=a("svg",{class:"w-12 h-12 mx-auto mb-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),a("p",Ut,n(b.value?"Drop file here...":"Drag & drop your .env file here"),1),r[15]||(r[15]=a("p",{class:"text-xs text-muted-foreground mb-4"},"or",-1)),a("button",{onClick:r[0]||(r[0]=t=>e.$refs.fileInput.click()),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"}," Browse Files "),a("p",Lt,n(g.value||"Supports .env and .env.* files"),1)],34),r[21]||(r[21]=a("div",{class:"text-center text-muted-foreground text-sm"},"— OR —",-1)),a("div",null,[r[16]||(r[16]=a("label",{class:"block text-sm font-medium mb-2"},"Paste .env Content",-1)),k(a("textarea",{"onUpdate:modelValue":r[5]||(r[5]=e=>y.value=e),class:"w-full h-48 px-3 py-2 bg-input border border-border rounded-md text-sm font-mono focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"KEY1=value1\nKEY2=value2\nKEY3=value3"},null,512),[[w,y.value]])]),a("div",It,[r[19]||(r[19]=a("h4",{class:"text-sm font-medium"},"Filter Options (Optional)",-1)),a("div",Nt,[a("div",null,[r[17]||(r[17]=a("label",{class:"block text-xs text-muted-foreground mb-1"},"Only include keys matching",-1)),k(a("input",{"onUpdate:modelValue":r[6]||(r[6]=e=>x.value.only=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"e.g., DB_* or APP_*"},null,512),[[w,x.value.only]])]),a("div",null,[r[18]||(r[18]=a("label",{class:"block text-xs text-muted-foreground mb-1"},"Exclude keys matching",-1)),k(a("input",{"onUpdate:modelValue":r[7]||(r[7]=e=>x.value.except=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"e.g., MAIL_* or TEST_*"},null,512),[[w,x.value.except]])])])])])):2===p.value?(l(),t("div",Ft,[a("div",null,[r[26]||(r[26]=a("h3",{class:"font-medium mb-2"},"Review Import",-1)),a("div",Rt,[a("span",null,[a("span",Pt,n(V.value.new),1),r[22]||(r[22]=S(" new ",-1))]),a("span",null,[a("span",Ht,n(V.value.existing),1),r[23]||(r[23]=S(" existing ",-1))]),a("span",null,[a("span",Jt,n(V.value.invalid),1),r[24]||(r[24]=S(" invalid ",-1))]),a("span",null,[a("span",Wt,n(V.value.empty),1),r[25]||(r[25]=S(" empty ",-1))])])]),V.value.existing>0?(l(),t("div",Yt,[r[29]||(r[29]=a("h4",{class:"font-medium text-yellow-500 mb-3"},"Conflict Resolution",-1)),a("div",Gt,[a("label",Xt,[k(a("input",{type:"radio","onUpdate:modelValue":r[8]||(r[8]=e=>$.value=e),value:"skip",class:"text-primary focus:ring-primary"},null,512),[[K,$.value]]),r[27]||(r[27]=a("span",{class:"text-sm"},"Skip existing secrets (keep current values)",-1))]),a("label",Qt,[k(a("input",{type:"radio","onUpdate:modelValue":r[9]||(r[9]=e=>$.value=e),value:"overwrite",class:"text-primary focus:ring-primary"},null,512),[[K,$.value]]),r[28]||(r[28]=a("span",{class:"text-sm"},"Overwrite existing secrets (replace with new values)",-1))])])])):s("",!0),a("div",Zt,[a("table",el,[r[30]||(r[30]=a("thead",{class:"bg-muted"},[a("tr",null,[a("th",{class:"text-left px-4 py-2 font-medium"},"Key"),a("th",{class:"text-left px-4 py-2 font-medium"},"Value"),a("th",{class:"text-left px-4 py-2 font-medium"},"Status")])],-1)),a("tbody",tl,[(l(!0),t(c,null,v(A.value,e=>(l(),t("tr",{key:e.key,class:u({"opacity-50":"empty"===e.status||"invalid"===e.status})},[a("td",ll,n(e.key),1),a("td",al,n(e.value||"(empty)"),1),a("td",sl,[a("span",{class:u(["px-2 py-1 rounded text-xs font-medium",L(e.status)])},n(I(e.status)),3),e.error?(l(),t("span",rl,n(e.error),1)):s("",!0)])],2))),128))])])]),a("div",ol,[k(a("input",{type:"checkbox","onUpdate:modelValue":r[10]||(r[10]=e=>j.value=e),id:"dry-run",class:"rounded border-border"},null,512),[[_,j.value]]),r[31]||(r[31]=a("label",{for:"dry-run",class:"text-sm"}," Dry run (preview what would be imported without making changes) ",-1))])])):3===p.value?(l(),t("div",nl,[a("div",null,[a("h3",ul,"Import "+n(j.value?"Preview":"Complete"),1),a("div",il,[a("span",null,[a("span",dl,n(T.value.imported),1),r[32]||(r[32]=S(" imported ",-1))]),a("span",null,[a("span",cl,n(T.value.skipped),1),r[33]||(r[33]=S(" skipped ",-1))]),a("span",null,[a("span",vl,n(T.value.failed),1),r[34]||(r[34]=S(" failed ",-1))])])]),j.value?(l(),t("div",ml,[...r[35]||(r[35]=[a("p",{class:"text-sm text-blue-500"}," This was a dry run. No secrets were actually imported. ",-1)])])):s("",!0),T.value.errors&&T.value.errors.length>0?(l(),t("div",pl,[r[36]||(r[36]=a("h4",{class:"font-medium text-red-500 mb-2"},"Errors",-1)),a("ul",fl,[(l(!0),t(c,null,v(T.value.errors,(e,a)=>(l(),t("li",{key:a,class:"text-sm text-red-500"},n(e),1))),128))])])):s("",!0),a("div",gl,[a("table",yl,[r[37]||(r[37]=a("thead",{class:"bg-muted"},[a("tr",null,[a("th",{class:"text-left px-4 py-2 font-medium"},"Key"),a("th",{class:"text-left px-4 py-2 font-medium"},"Status"),a("th",{class:"text-left px-4 py-2 font-medium"},"Revision")])],-1)),a("tbody",bl,[(l(!0),t(c,null,v(T.value.results,(e,s)=>(l(),t("tr",{key:s},[a("td",xl,n(s),1),a("td",hl,[a("span",{class:u(["px-2 py-1 rounded text-xs font-medium",N(e.status)])},n(F(e)),3)]),a("td",kl,n(e.revision||"-"),1)]))),128))])])])])):s("",!0)]),a("div",wl,[a("div",null,[2===p.value?(l(),t("button",{key:0,onClick:r[11]||(r[11]=e=>p.value--),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Back ")):s("",!0)]),a("div",Sl,[a("button",{onClick:U,class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"},n(3===p.value?"Close":"Cancel"),1),1===p.value?(l(),t("button",{key:0,onClick:O,disabled:!y.value||C.value,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium disabled:opacity-50"},n(C.value?"Analyzing...":"Next"),9,Cl)):2===p.value?(l(),t("button",{key:1,onClick:q,disabled:M.value,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium disabled:opacity-50"},n(M.value?"Importing...":j.value?"Preview Import":"Import"),9,Vl)):s("",!0)])])])]))}},jl={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Ml={class:"space-y-4"},Kl={class:"grid grid-cols-3 gap-2"},_l=["onClick"],Tl={class:"font-medium"},Al={class:"text-xs opacity-75 mt-1"},Dl=["placeholder"],zl={class:"text-xs text-muted-foreground"},El={class:"font-medium"},Bl={class:"font-medium"},Ol={class:"font-medium"},ql={class:"flex justify-end space-x-3 mt-6"},Ul=["disabled"],Ll={key:0},Il={key:1},Nl={__name:"ExportModal",props:{vault:String,stage:String},emits:["close"],setup(s,{emit:r}){const o=s,i=r,d=z(),{secrets:m}=Ye(),p=f(!1),g=f("env"),y=f(""),b=[{value:"env",label:".env",description:"KEY=value"},{value:"json",label:"JSON",description:'{"key": "value"}'},{value:"csv",label:"CSV",description:"Spreadsheet"}],x=e(()=>m.value.length),C=e(()=>{const e=(new Date).toISOString().split("T")[0];return`${o.vault}-${o.stage}-${e}.${g.value}`});async function V(){p.value=!0;try{let e="";const t=y.value||C.value;switch(g.value){case"json":const t={};m.value.forEach(e=>{t[e.key]=e.value}),e=JSON.stringify(t,null,2);break;case"csv":e="Key,Value,Modified\n",m.value.forEach(t=>{const l=$(t.key),a=$(t.value),s=$(t.modified||"");e+=`${l},${a},${s}\n`});break;default:m.value.forEach(t=>{e+=`${t.key}=${function(e){"string"!=typeof e&&(e=String(e||""));if(e.includes("\n")||e.includes('"')||e.includes(" "))return`"${e.replace(/"/g,'\\"')}"`;return e}(t.value)}\n`})}const l=new Blob([e],{type:"text/plain;charset=utf-8"}),a=window.URL.createObjectURL(l),s=document.createElement("a");s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a),d.success("Export Complete",`Secrets downloaded as ${t}`),i("close")}catch(e){d.error("Export Failed",e.message)}finally{p.value=!1}}function $(e){return"string"!=typeof e&&(e=String(e||"")),/[,"\n\r]/.test(e)?'"'+e.replace(/"/g,'""')+'"':e}return(e,r)=>(l(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:r[2]||(r[2]=h(t=>e.$emit("close"),["self"]))},[a("div",jl,[r[8]||(r[8]=a("h2",{class:"text-lg font-semibold mb-4"},"Download Secrets",-1)),a("div",Ml,[a("div",null,[r[3]||(r[3]=a("label",{class:"block text-sm font-medium mb-2"},"Export Format",-1)),a("div",Kl,[(l(),t(c,null,v(b,e=>a("button",{key:e.value,onClick:t=>g.value=e.value,class:u(["p-3 border rounded-md transition-colors",g.value===e.value?"border-primary bg-primary/10 text-primary":"border-border hover:bg-muted"])},[a("div",Tl,n(e.label),1),a("div",Al,n(e.description),1)],10,_l)),64))])]),a("div",null,[r[4]||(r[4]=a("label",{class:"block text-sm font-medium mb-1"},"Filename",-1)),k(a("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>y.value=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:C.value},null,8,Dl),[[w,y.value]])]),a("div",zl,[a("div",null,[r[5]||(r[5]=S("Vault: ",-1)),a("span",El,n(s.vault),1)]),a("div",null,[r[6]||(r[6]=S("Stage: ",-1)),a("span",Bl,n(s.stage),1)]),a("div",null,[r[7]||(r[7]=S("Secrets: ",-1)),a("span",Ol,n(x.value),1)])])]),a("div",ql,[a("button",{type:"button",onClick:r[1]||(r[1]=t=>e.$emit("close")),class:"px-4 py-2 text-sm font-medium border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),a("button",{onClick:V,disabled:p.value,class:"px-4 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50"},[p.value?(l(),t("span",Il,"Preparing...")):(l(),t("span",Ll,"Download"))],8,Ul)])])]))}},Fl={class:"relative"},Rl={class:"py-1"},Pl={__name:"TableActionsMenu",props:{vault:String,stage:String},emits:["imported"],setup(e,{emit:o}){const n=o,u=f(!1),i=f(!1),d=f(!1);function c(){u.value=!u.value}function v(){i.value=!1,n("imported")}return document.addEventListener("click",()=>{u.value=!1}),(o,n)=>(l(),t("div",Fl,[a("button",{onClick:c,class:"p-2 rounded hover:bg-muted transition-colors",title:"Actions"},[...n[5]||(n[5]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})],-1)])]),u.value?(l(),t("div",{key:0,onClick:n[2]||(n[2]=h(()=>{},["stop"])),class:"absolute right-0 mt-2 w-48 bg-popover border border-border rounded-md shadow-lg z-20"},[a("div",Rl,[a("button",{onClick:n[0]||(n[0]=e=>{i.value=!0,u.value=!1}),class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors flex items-center space-x-2"},[...n[6]||(n[6]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),a("span",null,"Import .env File",-1)])]),a("button",{onClick:n[1]||(n[1]=e=>{d.value=!0,u.value=!1}),class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors flex items-center space-x-2"},[...n[7]||(n[7]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),a("span",null,"Download Secrets",-1)])])])])):s("",!0),i.value?(l(),r($l,{key:1,vault:e.vault,stage:e.stage,onImported:v,onClose:n[3]||(n[3]=e=>i.value=!1)},null,8,["vault","stage"])):s("",!0),d.value?(l(),r(Nl,{key:2,vault:e.vault,stage:e.stage,onClose:n[4]||(n[4]=e=>d.value=!1)},null,8,["vault","stage"])):s("",!0)]))}};function Hl(){const t=f([]),l=f([]),a=f({}),s=f(!1),r=f(null),o=e(()=>{var e,l;return(null==(e=t.value.find(e=>e.isDefault))?void 0:e.slug)||(null==(l=t.value[0])?void 0:l.slug)||"vault"}),n=e(()=>a.value.default_stage||"prod");return{vaults:t,stages:l,settings:a,loading:s,error:r,defaultVault:o,defaultStage:n,loadVaults:async function(){s.value=!0,r.value=null;try{const e=await We.listVaults();t.value=e.vaults}catch(e){throw r.value=e.message,e}finally{s.value=!1}},loadStages:async function(){s.value=!0,r.value=null;try{const e=await We.listStages();l.value=e.stages}catch(e){throw r.value=e.message,e}finally{s.value=!1}},loadSettings:async function(){s.value=!0,r.value=null;try{a.value=await We.getSettings()}catch(e){throw r.value=e.message,e}finally{s.value=!1}},loadAll:async function(){s.value=!0,r.value=null;try{const[e,s,r]=await Promise.all([We.listVaults(),We.listStages(),We.getSettings()]);t.value=e.vaults,l.value=s.stages,a.value=r}catch(e){throw r.value=e.message,e}finally{s.value=!1}},verifyVaults:async function(){s.value=!0,r.value=null;try{return await We.verifyVaults()}catch(e){throw r.value=e.message,e}finally{s.value=!1}}}}const Jl={class:"flex items-center justify-between mb-6"},Wl={class:"flex items-center"},Yl={class:"flex items-center space-x-3"},Gl={class:"relative"},Xl={class:"border border-border rounded-lg"},Ql={class:"bg-muted"},Zl={class:"w-6/12 text-left px-6 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider"},ea={class:"flex items-center space-x-2"},ta=["title"],la={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},aa={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sa={class:"divide-y divide-border"},ra={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},oa={class:"px-6 py-4 whitespace-nowrap text-sm"},na={class:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground"},ua={class:"px-6 py-4 whitespace-nowrap text-right text-sm"},ia={key:0,class:"p-8 text-center text-muted-foreground"},da={__name:"SecretsTable",emits:["refresh"],setup(o,{emit:d}){const p=z(),{vaults:y,stages:b,settings:h,loadAll:S}=Hl(),{secrets:C,loading:V,loadSecrets:$,createSecret:j,updateSecret:M,deleteSecret:K,renameSecret:_,copySecretToStage:T}=Ye(),A=f(localStorage.getItem("keep.secrets.vault")||""),D=f(localStorage.getItem("keep.secrets.stage")||""),E=f(""),O=f(!1),q=f(new Set),U=f(!1),L=f(null),I=f(null),N=f(null),F=f(null),R=f(null),P=e(()=>{if(!E.value)return C.value;const e=E.value.toLowerCase();return C.value.filter(t=>{const l=t.key.toLowerCase().includes(e),a=t.value&&t.value.toLowerCase().includes(e);return l||a})});async function H(){if(A.value&&D.value)try{await $(A.value,D.value,!0)}catch(e){}}function J(e){L.value=e}async function W(e){try{L.value?(await M(e.key,e.value,A.value,D.value),p.success("Secret updated",`Secret '${e.key}' has been updated successfully`)):(await j(e.key,e.value,A.value,D.value),p.success("Secret created",`Secret '${e.key}' has been created successfully`)),ae()}catch(t){p.error("Failed to save secret",t.message)}}function Y(e){I.value=e}function G(e){N.value=e}function X(e){F.value=e}function Q(e){R.value=e}function Z(e){p.success("Copied to clipboard","Secret value has been copied to your clipboard")}async function ee(){if(R.value)try{await K(R.value.key,A.value,D.value),p.success("Secret deleted",`Secret '${R.value.key}' has been deleted successfully`),R.value=null}catch(e){p.error("Failed to delete secret",e.message)}}async function te(e){try{await _(I.value.key,e,A.value,D.value),p.success("Secret renamed",`Secret renamed from '${I.value.key}' to '${e}'`),I.value=null}catch(t){p.error("Failed to rename secret",t.message)}}async function le({targetVault:e,targetStage:t}){try{await T(N.value.key,t,e,D.value,A.value),p.success("Secret copied",`Secret '${N.value.key}' copied to ${e}:${t}`),N.value=null}catch(l){p.error("Failed to copy secret",l.message)}}function ae(){U.value=!1,L.value=null}return g(async()=>{await async function(){try{if(await S(),!A.value){const e=h.value.default_vault;e?(A.value=e,localStorage.setItem("keep.secrets.vault",A.value)):y.value.length>0&&(A.value=y.value[0].slug||y.value[0],localStorage.setItem("keep.secrets.vault",A.value))}!D.value&&b.value.length&&(D.value=b.value[0],localStorage.setItem("keep.secrets.stage",D.value))}catch(e){}}(),await H()}),x(()=>[A.value,D.value],()=>{A.value&&localStorage.setItem("keep.secrets.vault",A.value),D.value&&localStorage.setItem("keep.secrets.stage",D.value),H()}),(e,o)=>(l(),t("div",null,[a("div",Jl,[a("div",Wl,[i(ve,{vault:A.value,"onUpdate:vault":o[0]||(o[0]=e=>A.value=e),stage:D.value,"onUpdate:stage":o[1]||(o[1]=e=>D.value=e),vaults:m(y),stages:m(b)},null,8,["vault","stage","vaults","stages"])]),a("div",Yl,[a("div",Gl,[k(a("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>E.value=e),type:"text",placeholder:"Search secrets...",class:"w-64 px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[w,E.value]]),o[9]||(o[9]=a("svg",{class:"absolute right-3 top-2.5 w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),a("button",{onClick:o[3]||(o[3]=e=>U.value=!0),class:"flex items-center space-x-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"},[...o[10]||(o[10]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),a("span",null,"Add Secret",-1)])]),i(Pl,{vault:A.value,stage:D.value,onImported:H},null,8,["vault","stage"])])]),a("div",Xl,[a("table",{class:u(["w-full",m(V)&&"opacity-50 pointer-events-none"])},[a("thead",Ql,[a("tr",null,[o[14]||(o[14]=a("th",{class:"w-3/12 text-left px-6 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider rounded-tl-lg"},"Key",-1)),a("th",Zl,[a("div",ea,[o[13]||(o[13]=a("span",null,"Value",-1)),a("button",{onClick:o[4]||(o[4]=e=>O.value=!O.value),class:"p-1 rounded hover:bg-accent transition-colors",title:O.value?"Hide all values":"Show all values"},[O.value?(l(),t("svg",aa,[...o[12]||(o[12]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(l(),t("svg",la,[...o[11]||(o[11]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))],8,ta)])]),o[15]||(o[15]=a("th",{class:"w-2/12 text-left px-6 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider",title:"Times shown in your local timezone"},"Modified",-1)),o[16]||(o[16]=a("th",{class:"relative px-6 py-3 rounded-tr-lg"},[a("span",{class:"sr-only"},"Actions")],-1))])]),a("tbody",sa,[(l(!0),t(c,null,v(P.value,e=>(l(),t("tr",{key:e.key,class:"transition-colors"},[a("td",ra,n(e.key),1),a("td",oa,[i(be,{value:e.value,masked:!O.value&&!q.value.has(e.key),onToggle:t=>{return l=e.key,void(q.value.has(l)?q.value.delete(l):q.value.add(l));var l}},null,8,["value","masked","onToggle"])]),a("td",na,n(m(B)(e.modified)),1),a("td",ua,[i(Et,{secretKey:e.key,secretValue:e.value,vault:A.value,stage:D.value,onEdit:J,onRename:Y,onCopyValue:Z,onCopyTo:G,onHistory:X,onDelete:Q,onRefresh:H},null,8,["secretKey","secretValue","vault","stage"])])]))),128))])],2),m(V)||0!==P.value.length?s("",!0):(l(),t("div",ia," No secrets found "))]),U.value||L.value?(l(),r(Me,{key:0,secret:L.value,vault:A.value,stage:D.value,onSave:W,onClose:ae},null,8,["secret","vault","stage"])):s("",!0),I.value?(l(),r(Be,{key:1,currentKey:I.value.key,onRename:te,onClose:o[5]||(o[5]=e=>I.value=null)},null,8,["currentKey"])):s("",!0),N.value?(l(),r(Je,{key:2,secretKey:N.value.key,currentVault:A.value,currentStage:D.value,vaults:m(y),stages:m(b),onCopy:le,onClose:o[6]||(o[6]=e=>N.value=null)},null,8,["secretKey","currentVault","currentStage","vaults","stages"])):s("",!0),F.value?(l(),r(St,{key:3,secretKey:F.value.key,vault:A.value,stage:D.value,onRefresh:H,onClose:o[7]||(o[7]=e=>F.value=null)},null,8,["secretKey","vault","stage"])):s("",!0),R.value?(l(),r(At,{key:4,secretKey:R.value.key,vault:A.value,stage:D.value,onConfirm:ee,onClose:o[8]||(o[8]=e=>R.value=null)},null,8,["secretKey","vault","stage"])):s("",!0)]))}},ca={class:"mb-6 flex items-center justify-between"},va={class:"flex items-center space-x-4"},ma={class:"relative"},pa={key:0,class:"absolute top-full left-0 mt-1 bg-popover border border-border rounded-md shadow-lg z-20"},fa={class:"p-2 space-y-1 max-h-96 overflow-y-auto",style:{"min-width":"max-content"}},ga=["value"],ya={class:"text-sm"},ba={class:"flex items-center space-x-2"},xa={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ha={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ka={key:0,class:"text-center py-12"},wa={key:1,class:"border border-border rounded-lg overflow-y-visible overflow-x-auto"},Sa={class:"w-full"},Ca={class:"bg-muted sticky top-0 z-10"},Va={class:"flex flex-col"},$a={class:"font-semibold"},ja={class:"text-[10px] opacity-75"},Ma={class:"divide-y divide-border"},Ka={class:"sticky left-0 z-10 border-r border-border p-0"},_a={class:"bg-background"},Ta={class:"font-mono text-sm font-medium"},Aa=["onClick","title"],Da={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},za={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ea={key:0,class:"flex items-center justify-between"},Ba={class:"font-mono text-sm"},Oa={key:1,class:"flex items-center justify-between"},qa={key:2,class:"text-center py-12 text-muted-foreground"},Ua={key:3,class:"text-center py-12 text-muted-foreground"},La={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Ia={class:"flex items-center justify-between mb-4"},Na={class:"space-y-4"},Fa=["value"],Ra=["value"],Pa=["value","disabled"],Ha={class:"flex justify-end space-x-2 mt-6"},Ja=["disabled"],Wa={__name:"DiffView",setup(o){const d=z(),{vaults:p,stages:y,loadAll:b}=Hl(),{createSecret:w,updateSecret:S,deleteSecret:C,renameSecret:$,copySecretToStage:j}=Ye(),M=f([]),K=f([]),T=f(null),A=f(!1),D=f(!1),B=f(new Set),O=f(!1),q=f(null),U=f(null),L=f(null),I=f(null),N=f(null),F=f(null),R=f(null),P=f(""),H=f(null),J=f(null),W=e(()=>M.value.map(e=>{const[t,l]=e.split(":"),a=p.value.find(e=>(e.slug||e.name||e)===t),s=(null==a?void 0:a.name)||(null==a?void 0:a.display)||t;return{vault:t,stage:l,vaultDisplay:s}}));x(M,e=>{localStorage.setItem("keep.diff.selections",JSON.stringify(e))},{deep:!0});const Y=e(()=>{if(!T.value)return{};if(0===M.value.length)return{};const e={};for(const[t,l]of Object.entries(T.value)){let a=!1;const s={};for(const[e,t]of Object.entries(l)){const l={};for(const[s,r]of Object.entries(t))M.value.includes(`${e}:${s}`)&&(l[s]=r,a=!0);Object.keys(l).length>0&&(s[e]=l)}a&&(e[t]=s)}return e}),G=e(()=>Object.keys(Y.value).sort((e,t)=>e.localeCompare(t)));function X(e,t=!0){const l=function(e){if(!Y.value[e])return"incomplete";const t=[];let l=W.value.length,a=0;for(const s of W.value){const l=ee(e,s.vault,s.stage);null!=l&&(t.push(l),a++)}return a<l?"incomplete":1===new Set(t).size?"identical":"different"}(e);switch(l){case"incomplete":return"bg-red-500/10 "+(t?"hover:bg-red-500/15":"");case"identical":return"bg-green-500/10 "+(t?"hover:bg-green-500/15":"");case"different":return"bg-yellow-500/10 "+(t?"hover:bg-yellow-500/15":"");default:return"hover:bg-muted/50"}}function Q(e){e.target.closest(".relative")||(O.value=!1),q.value&&!e.target.closest("[data-menu-key]")&&(q.value=null,U.value=null,L.value=null)}async function Z(){const e=p.value.map(e=>e.slug||e.name||e),t=[...y.value];A.value=!0;try{const l=await window.$api.getDiff(t,e);T.value=l.diff||{}}catch(l){d.error("Failed to load comparison",l.message),T.value={}}finally{A.value=!1}}function ee(e,t,l){return Y.value[e]&&Y.value[e][t]&&Y.value[e][t][l]||null}function te(e,t,l){return ee(e,t,l)?"":"bg-muted/30"}function le(e,t,l){const a=ee(e,t,l);return a?D.value||B.value.has(e)?a:E(a,"•"):""}function ae(e){I.value={key:e.key,vault:e.vault,stage:e.stage,value:"",isNew:!0}}function se(e){I.value={key:e.key,vault:e.vault,stage:e.stage,value:e.value}}function re(e){F.value={key:e.key,vault:e.vault,stage:e.stage,value:e.value}}function oe(e){H.value={key:e.key,vault:e.vault,stage:e.stage}}function ne(e){J.value={key:e.key,vault:e.vault,stage:e.stage}}function ue(e){d.success("Copied to clipboard","Secret value has been copied to your clipboard")}async function ie(){if(J.value)try{await C(J.value.key,J.value.vault,J.value.stage),d.success("Secret deleted",`Secret '${J.value.key}' has been deleted successfully`),await Z(),J.value=null}catch(e){d.error("Failed to delete secret",e.message)}}async function de(){if(I.value)try{I.value.isNew?(await w(I.value.key,I.value.value,I.value.vault,I.value.stage),d.success("Secret created",`Created '${I.value.key}'`)):(await S(I.value.key,I.value.value,I.value.vault,I.value.stage),d.success("Secret updated",`Updated '${I.value.key}'`)),I.value=null,await Z()}catch(e){d.error(I.value.isNew?"Create failed":"Update failed",e.message)}}async function ce(){if(!R.value||!P.value)return;const[e,t]=P.value.split(":");try{await j(R.value.key,t,e,R.value.stage,R.value.vault),d.success("Secret copied",`Copied '${R.value.key}' to ${e}:${t}`),R.value=null,P.value="",await Z()}catch(l){d.error("Copy failed",l.message)}}function ve(){M.value=K.value.map(e=>e.key)}function me(){M.value=[]}async function pe({targetVault:e,targetStage:t}){try{await j(F.value.key,t,e,F.value.stage,F.value.vault),d.success("Secret copied",`Secret '${F.value.key}' copied to ${e}:${t}`),F.value=null,await Z()}catch(l){d.error("Failed to copy secret",l.message)}}async function fe(e){try{await $(N.value.key,e,N.value.vault,N.value.stage),d.success("Secret renamed",`Secret renamed from '${N.value.key}' to '${e}'`),await Z(),N.value=null}catch(t){d.error("Failed to rename secret",t.message)}}return g(()=>{document.addEventListener("click",Q),async function(){try{await b(),K.value=[];for(const e of p.value)for(const t of y.value){const l=e.slug||e.name||e;K.value.push({key:`${l}:${t}`,vault:l,vaultDisplay:e.display||e,stage:t})}const t=localStorage.getItem("keep.diff.selections");if(t)try{const e=JSON.parse(t);M.value=e.filter(e=>K.value.some(t=>t.key===e))}catch(e){M.value=K.value.map(e=>e.key)}else M.value=K.value.map(e=>e.key);await Z()}catch(t){d.error("Failed to load data",t.message)}}()}),(e,o)=>{var d,f,g;return l(),t("div",null,[a("div",ca,[a("div",va,[a("div",ma,[a("button",{onClick:o[0]||(o[0]=e=>O.value=!O.value),class:"flex items-center space-x-2 px-3 py-2 bg-input border border-border rounded-md text-sm hover:bg-accent transition-colors"},[a("span",null,"Toggle Vaults / Stages ("+n(M.value.length)+"/"+n(K.value.length)+")",1),o[12]||(o[12]=a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),O.value?(l(),t("div",pa,[a("div",fa,[(l(!0),t(c,null,v(K.value,e=>(l(),t("label",{key:e.key,class:"flex items-center px-2 py-1.5 hover:bg-accent rounded cursor-pointer whitespace-nowrap"},[k(a("input",{type:"checkbox",value:e.key,"onUpdate:modelValue":o[1]||(o[1]=e=>M.value=e),class:"mr-3 rounded border-border bg-input text-primary focus:ring-2 focus:ring-ring"},null,8,ga),[[_,M.value]]),a("span",ya,[a("span",null,n(e.vaultDisplay)+" ("+n(e.vault)+")",1),o[13]||(o[13]=a("span",{class:"mx-2 text-muted-foreground"},"/",-1)),a("strong",null,n(e.stage),1)])]))),128))])])):s("",!0)]),a("div",{class:"flex items-center space-x-2 text-sm"},[a("button",{onClick:ve,class:"text-muted-foreground hover:text-foreground transition-colors"}," Select All "),o[14]||(o[14]=a("span",{class:"text-muted-foreground"},"|",-1)),a("button",{onClick:me,class:"text-muted-foreground hover:text-foreground transition-colors"}," Clear All ")])]),a("div",ba,[a("button",{onClick:o[2]||(o[2]=e=>D.value=!D.value),class:"flex items-center space-x-2 px-3 py-1.5 text-sm border border-border rounded-md hover:bg-accent transition-colors"},[D.value?(l(),t("svg",ha,[...o[16]||(o[16]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(l(),t("svg",xa,[...o[15]||(o[15]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])])),a("span",null,n(D.value?"Hide Values":"Show Values"),1)])])]),A.value?(l(),t("div",ka,[...o[17]||(o[17]=[a("div",{class:"inline-flex items-center space-x-2 text-muted-foreground"},[a("svg",{class:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),a("span",null,"Loading comparison matrix...")],-1)])])):Y.value&&Object.keys(Y.value).length>0?(l(),t("div",wa,[a("table",Sa,[a("thead",Ca,[a("tr",null,[o[18]||(o[18]=a("th",{class:"text-left px-4 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider sticky left-0 bg-muted z-20 min-w-[200px]"}," Secret Key ",-1)),(l(!0),t(c,null,v(W.value,e=>(l(),t("th",{key:e,class:"px-4 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider text-center border-l border-border min-w-[80px]"},[a("div",Va,[a("span",$a,n(e.vault),1),a("span",ja,n(e.stage),1)])]))),128))])]),a("tbody",Ma,[(l(!0),t(c,null,v(G.value,e=>(l(),t("tr",{key:e,class:u([X(e),"transition-colors"])},[a("td",Ka,[a("div",_a,[a("div",{class:u(["px-4 py-3 flex items-center space-x-2",X(e,!1)])},[a("span",Ta,n(e),1),a("button",{onClick:t=>function(e){B.value.has(e)?B.value.delete(e):B.value.add(e)}(e),class:"p-1 rounded hover:bg-muted transition-colors",title:B.value.has(e)?"Hide values":"Show values"},[B.value.has(e)?(l(),t("svg",za,[...o[20]||(o[20]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(l(),t("svg",Da,[...o[19]||(o[19]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))],8,Aa)],2)])]),(l(!0),t(c,null,v(W.value,s=>(l(),t("td",{key:`${e}-${s.vault}-${s.stage}`,class:u(["px-4 py-3 text-left border-l border-border relative group",te(e,s.vault,s.stage)])},[ee(e,s.vault,s.stage)?(l(),t("div",Ea,[a("span",Ba,n(le(e,s.vault,s.stage)),1),i(Et,{secretKey:e,secretValue:ee(e,s.vault,s.stage),vault:s.vault,stage:s.stage,showRename:!1,buttonClass:"opacity-0 group-hover:opacity-100",onEdit:se,onCopyValue:ue,onCopyTo:re,onHistory:oe,onDelete:ne,onRefresh:Z},null,8,["secretKey","secretValue","vault","stage"])])):(l(),t("div",Oa,[o[21]||(o[21]=a("span",{class:"text-muted-foreground text-sm"},"—",-1)),i(Et,{secretKey:e,secretValue:null,vault:s.vault,stage:s.stage,showEdit:!1,showRename:!1,showCreate:!0,showCopyValue:!1,showCopyTo:!1,showDelete:!1,showHistory:!1,buttonClass:"opacity-0 group-hover:opacity-100",onCreate:ae},null,8,["secretKey","vault","stage"])]))],2))),128))],2))),128))])])])):A.value||null===Y.value||0!==Object.keys(Y.value).length?A.value||0!==M.value.length?s("",!0):(l(),t("div",Ua,[...o[23]||(o[23]=[a("svg",{class:"mx-auto h-12 w-12 mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),a("p",{class:"text-lg font-medium mb-2"},"Select Vault/Stage Combinations",-1),a("p",{class:"text-sm"},"Use the dropdown above to select at least one vault/stage combination",-1)])])):(l(),t("div",qa,[...o[22]||(o[22]=[a("svg",{class:"mx-auto h-12 w-12 mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),a("p",null,"No secrets found in the selected vaults and stages",-1)])])),I.value?(l(),r(Me,{key:4,secret:I.value.isNew?null:I.value,vault:I.value.vault,stage:I.value.stage,initialKey:I.value.isNew?I.value.key:void 0,onSave:de,onClose:o[3]||(o[3]=e=>I.value=null)},null,8,["secret","vault","stage","initialKey"])):s("",!0),R.value?(l(),t("div",{key:5,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:o[7]||(o[7]=h(e=>R.value=null,["self"]))},[a("div",La,[a("div",Ia,[o[25]||(o[25]=a("h2",{class:"text-lg font-semibold"},"Copy Secret",-1)),a("button",{onClick:o[4]||(o[4]=e=>R.value=null),class:"p-1 rounded-md hover:bg-muted transition-colors"},[...o[24]||(o[24]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),a("div",Na,[a("div",null,[o[26]||(o[26]=a("label",{class:"block text-sm font-medium mb-1"},"Key",-1)),a("input",{type:"text",value:null==(d=R.value)?void 0:d.key,disabled:"",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm opacity-50"},null,8,Fa)]),a("div",null,[o[27]||(o[27]=a("label",{class:"block text-sm font-medium mb-1"},"From",-1)),a("input",{type:"text",value:`${null==(f=R.value)?void 0:f.vault} / ${null==(g=R.value)?void 0:g.stage}`,disabled:"",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm opacity-50"},null,8,Ra)]),a("div",null,[o[29]||(o[29]=a("label",{class:"block text-sm font-medium mb-1"},"Copy To",-1)),k(a("select",{"onUpdate:modelValue":o[5]||(o[5]=e=>P.value=e),class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm"},[o[28]||(o[28]=a("option",{value:""},"Select destination...",-1)),(l(!0),t(c,null,v(K.value,e=>{var a,s;return l(),t("option",{key:e.key,value:e.key,disabled:e.key===`${null==(a=R.value)?void 0:a.vault}:${null==(s=R.value)?void 0:s.stage}`},n(e.vaultDisplay)+" / "+n(e.stage),9,Pa)}),128))],512),[[V,P.value]])])]),a("div",Ha,[a("button",{onClick:o[6]||(o[6]=e=>{R.value=null,P.value=""}),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),a("button",{onClick:ce,disabled:!P.value,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed"}," Copy Secret ",8,Ja)])])])):s("",!0),N.value?(l(),r(Be,{key:6,currentKey:N.value.key,onRename:fe,onClose:o[8]||(o[8]=e=>N.value=null)},null,8,["currentKey"])):s("",!0),F.value?(l(),r(Je,{key:7,secretKey:F.value.key,currentVault:F.value.vault,currentStage:F.value.stage,vaults:m(p),stages:m(y),onCopy:pe,onClose:o[9]||(o[9]=e=>F.value=null)},null,8,["secretKey","currentVault","currentStage","vaults","stages"])):s("",!0),H.value?(l(),r(St,{key:8,secretKey:H.value.key,vault:H.value.vault,stage:H.value.stage,onRefresh:Z,onClose:o[10]||(o[10]=e=>H.value=null)},null,8,["secretKey","vault","stage"])):s("",!0),J.value?(l(),r(At,{key:9,secretKey:J.value.key,vault:J.value.vault,stage:J.value.stage,onConfirm:ie,onClose:o[11]||(o[11]=e=>J.value=null)},null,8,["secretKey","vault","stage"])):s("",!0)])}}},Ya={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Ga={class:"flex items-start space-x-3 mb-4"},Xa={class:"flex-1"},Qa={class:"text-lg font-semibold mb-2"},Za={class:"text-sm text-muted-foreground"},es={class:"flex justify-end space-x-2 mt-6"},ts={__name:"DeleteConfirmationModal",props:{title:{type:String,default:"Confirm Deletion"},message:{type:String,required:!0},confirmText:{type:String,default:"Delete"}},emits:["confirm","cancel"],setup(e,{expose:o,emit:u}){const i=u,d=f(!1);function c(){i("confirm"),d.value=!1}function v(){i("cancel"),d.value=!1}return o({open:function(){d.value=!0},close:v}),(o,u)=>(l(),r(M,{to:"body"},[d.value?(l(),t("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:h(v,["self"])},[a("div",Ya,[a("div",Ga,[u[0]||(u[0]=a("div",{class:"flex-shrink-0 w-10 h-10 rounded-full bg-destructive/10 flex items-center justify-center"},[a("svg",{class:"w-5 h-5 text-destructive",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),a("div",Xa,[a("h3",Qa,n(e.title),1),a("p",Za,n(e.message),1)])]),a("div",es,[a("button",{onClick:v,class:"px-4 py-2 border border-border rounded-md hover:bg-muted transition-colors text-sm font-medium"}," Cancel "),a("button",{onClick:c,class:"px-4 py-2 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors text-sm font-medium"},n(e.confirmText),1)])])])):s("",!0)]))}},ls={class:"flex gap-6 mx-auto max-w-5xl"},as={class:"w-48 flex-shrink-0"},ss={class:"space-y-1"},rs=["onClick"],os={class:"flex-1"},ns={key:0,class:"space-y-6"},us={class:"border border-border rounded-lg p-6 space-y-4"},is=["value"],ds=["value"],cs={class:"border border-border rounded-lg p-4 space-y-2 text-sm"},vs={class:"flex items-center justify-between"},ms={class:"font-mono"},ps={class:"flex items-center justify-between"},fs={class:"font-mono"},gs={key:1,class:"space-y-6"},ys={class:"space-y-3"},bs={class:"flex items-start justify-between"},xs={class:"flex-1"},hs={class:"flex items-center space-x-3 mb-2"},ks={class:"font-medium"},ws={key:0,class:"px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full"},Ss={class:"space-y-1 text-sm text-muted-foreground"},Cs={class:"font-mono"},Vs={class:"font-mono"},$s={class:"flex items-center space-x-2"},js=["onClick"],Ms=["onClick"],Ks={class:"flex justify-between items-center pt-4"},_s=["disabled"],Ts={key:2,class:"space-y-6"},As={class:"border border-border rounded-lg p-4"},Ds={class:"space-y-2"},zs={class:"font-medium"},Es=["onClick"],Bs={class:"flex items-center space-x-2 mt-4 pt-4 border-t border-border"},Os=["disabled"],qs={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Us={class:"text-lg font-semibold mb-4"},Ls={class:"space-y-4"},Is=["disabled"],Ns={class:"text-xs text-muted-foreground mt-1"},Fs={key:0},Rs=["placeholder"],Ps={key:1},Hs=["placeholder","disabled"],Js={class:"text-xs text-muted-foreground mt-1"},Ws={key:2,class:"flex items-center space-x-2"},Ys={class:"flex justify-end space-x-2 mt-6"},Gs={class:"bg-card border border-border rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto"},Xs={class:"flex items-center justify-between mb-4"},Qs={key:0,class:"space-y-4"},Zs={class:"flex items-center justify-between mb-3"},er={class:"font-medium"},tr={key:0,class:"grid grid-cols-5 gap-2 text-sm"},lr={key:0,class:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ar={key:1,class:"w-4 h-4 text-destructive",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sr={key:1,class:"text-sm text-destructive mt-2"},rr={key:1,class:"text-center py-8 text-muted-foreground"},or={class:"flex justify-end mt-6"},nr=[{path:"/",redirect:"/secrets"},{path:"/secrets",name:"secrets",component:da},{path:"/diff",name:"diff",component:Wa},{path:"/settings",name:"settings",component:{__name:"SettingsView",setup(r){const o=z(),d=[{id:"general",label:"General"},{id:"vaults",label:"Vaults"},{id:"stages",label:"Stages"}],m=f("general"),p=f({appName:"",namespace:"",defaultVault:"",defaultStage:""}),y=f("1.0.0-beta"),b=f([]),x=f(!1),$=f(null),j=f({name:"",slug:"",driver:"",isDefault:!1}),M=f(!1),K=f(!1),T=f(null),A=f(null),D=f(null),E=f([]),B=f(""),O=f(""),q=f(null),U=e(()=>"undefined"!=typeof window?window.location.origin:"");function L(e){const t=b.value.find(t=>t.slug===e);return t?`${t.name} (${t.slug})`:e}function I(e){return{secretsmanager:{name:"AWS Secrets Manager",slug:"aws-secrets"},ssm:{name:"AWS SSM Parameter Store",slug:"aws-ssm"},test:{name:"Test Vault",slug:"test"}}[e]||{name:"",slug:""}}function N(){if(!$.value&&j.value.driver){const e=I(j.value.driver);j.value.name||(j.value.name=e.name),j.value.slug||(j.value.slug=e.slug)}}async function F(){try{await window.$api.updateSettings({app_name:p.value.appName,namespace:p.value.namespace,default_vault:p.value.defaultVault,default_stage:p.value.defaultStage}),o.success("Settings saved","Your changes have been saved successfully")}catch(e){o.error("Failed to save settings",e.message)}}async function R(){if(A.value)try{await window.$api.deleteVault(A.value.slug),b.value=b.value.filter(e=>e.slug!==A.value.slug),o.success("Vault deleted",`Vault "${A.value.name}" has been deleted`)}catch(e){o.error("Failed to delete vault",e.message)}finally{A.value=null}}function P(){x.value=!1,$.value=null,j.value={name:"",slug:"",driver:"",isDefault:!1}}async function H(){try{if($.value){await window.$api.updateVault($.value.slug,j.value);const e=b.value.findIndex(e=>e.slug===$.value.slug);-1!==e&&(b.value[e]={...j.value}),o.success("Vault updated",`Vault "${j.value.name}" has been updated`)}else await window.$api.addVault(j.value),b.value.push({...j.value}),o.success("Vault added",`Vault "${j.value.name}" has been added`);P()}catch(e){o.error("Failed to save vault",e.message)}}async function J(){M.value=!0,K.value=!0,T.value=null;try{const e=(await window.$api.verifyVaults()).results||{};T.value=e;const t=Object.entries(e).filter(([e,t])=>!t.success);0===t.length?o.success("All vaults verified","All vaults are properly configured and accessible"):o.error("Verification failed",`${t.length} vault(s) failed verification`)}catch(e){o.error("Failed to verify vaults",e.message),K.value=!1}finally{M.value=!1}}async function W(){if(B.value)if(E.value.includes(B.value))o.error("Stage exists",`Stage "${B.value}" already exists`);else try{await window.$api.addStage(B.value),E.value.push(B.value),o.success("Stage added",`Stage "${B.value}" has been added`),B.value=""}catch(e){o.error("Failed to add stage",e.message)}}async function Y(){if(O.value)try{await window.$api.removeStage(O.value);const e=E.value.indexOf(O.value);e>-1&&(E.value.splice(e,1),o.success("Stage removed",`Stage "${O.value}" has been removed`))}catch(e){o.error("Failed to remove stage",e.message)}finally{O.value=""}}return g(async()=>{await async function(){try{const e=await window.$api.getSettings();p.value.appName=e.app_name||"MyApp",p.value.namespace=e.namespace||"",p.value.defaultVault=e.default_vault||"",p.value.defaultStage=e.default_stage||"prod",y.value=e.keep_version||"1.0.0-beta"}catch(e){o.error("Failed to load settings",e.message)}}(),await async function(){try{const e=await window.$api.listVaults();b.value=e.vaults||[]}catch(e){o.error("Failed to load vaults",e.message)}}(),await async function(){try{const e=await window.$api.listStages();E.value=e.stages||[]}catch(e){o.error("Failed to load stages",e.message)}}()}),(e,r)=>{var o;return l(),t(c,null,[a("div",ls,[a("div",as,[a("div",ss,[(l(),t(c,null,v(d,e=>a("button",{key:e.id,onClick:t=>m.value=e.id,class:u(["w-full px-4 py-2 rounded-md text-sm font-medium transition-colors text-left",m.value===e.id?"bg-muted text-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted/50"])},n(e.label),11,rs)),64))])]),a("div",os,["general"===m.value?(l(),t("div",ns,[r[27]||(r[27]=a("div",null,[a("h1",{class:"text-2xl font-semibold mb-2"},"General Settings"),a("p",{class:"text-sm text-muted-foreground"},"Configure your Keep application settings")],-1)),a("div",us,[a("div",null,[r[13]||(r[13]=a("label",{class:"block text-sm font-medium mb-2"},"Application Name",-1)),k(a("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>p.value.appName=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"MyApp"},null,512),[[w,p.value.appName]]),r[14]||(r[14]=a("p",{class:"text-xs text-muted-foreground mt-1"},"The name of your application",-1))]),a("div",null,[r[15]||(r[15]=a("label",{class:"block text-sm font-medium mb-2"},"Namespace",-1)),k(a("input",{"onUpdate:modelValue":r[1]||(r[1]=e=>p.value.namespace=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"my-app"},null,512),[[w,p.value.namespace]]),r[16]||(r[16]=a("p",{class:"text-xs text-muted-foreground mt-1"},"All secrets will be prefixed with this namespace",-1))]),a("div",null,[r[18]||(r[18]=a("label",{class:"block text-sm font-medium mb-2"},"Default Vault",-1)),k(a("select",{"onUpdate:modelValue":r[2]||(r[2]=e=>p.value.defaultVault=e),class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},[r[17]||(r[17]=a("option",{value:""},"Select default vault...",-1)),(l(!0),t(c,null,v(b.value,e=>(l(),t("option",{key:e.slug,value:e.slug},n(e.name),9,is))),128))],512),[[V,p.value.defaultVault]]),r[19]||(r[19]=a("p",{class:"text-xs text-muted-foreground mt-1"},"The default vault to use when none is specified",-1))]),a("div",null,[r[21]||(r[21]=a("label",{class:"block text-sm font-medium mb-2"},"Default Stage",-1)),k(a("select",{"onUpdate:modelValue":r[3]||(r[3]=e=>p.value.defaultStage=e),class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},[r[20]||(r[20]=a("option",{value:""},"Select default stage...",-1)),(l(!0),t(c,null,v(E.value,e=>(l(),t("option",{key:e,value:e},n(e),9,ds))),128))],512),[[V,p.value.defaultStage]]),r[22]||(r[22]=a("p",{class:"text-xs text-muted-foreground mt-1"},"The default stage to use when none is specified",-1))]),a("div",{class:"pt-4 flex justify-end"},[a("button",{onClick:F,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"}," Save Changes ")])]),a("div",null,[r[26]||(r[26]=a("h2",{class:"text-lg font-medium mb-4"},"Server Information",-1)),a("div",cs,[a("div",vs,[r[23]||(r[23]=a("span",{class:"text-muted-foreground"},"Server URL",-1)),a("span",ms,n(U.value),1)]),a("div",ps,[r[24]||(r[24]=a("span",{class:"text-muted-foreground"},"Keep Version",-1)),a("span",fs,n(y.value),1)]),r[25]||(r[25]=a("div",{class:"flex items-center justify-between"},[a("span",{class:"text-muted-foreground"},"Authentication"),a("span",{class:"text-green-500"},"Token Active")],-1))])])])):s("",!0),"vaults"===m.value?(l(),t("div",gs,[r[32]||(r[32]=a("div",null,[a("h1",{class:"text-2xl font-semibold mb-2"},"Vault Configuration"),a("p",{class:"text-sm text-muted-foreground"},"Manage your vault connections and settings")],-1)),a("div",ys,[(l(!0),t(c,null,v(b.value,e=>(l(),t("div",{key:e.slug,class:"border border-border rounded-lg p-4"},[a("div",bs,[a("div",xs,[a("div",hs,[a("h3",ks,n(e.name),1),e.isDefault?(l(),t("span",ws," Default ")):s("",!0)]),a("div",Ss,[a("p",null,[r[28]||(r[28]=S("Driver: ",-1)),a("span",Cs,n(e.driver),1)]),a("p",null,[r[29]||(r[29]=S("Slug: ",-1)),a("span",Vs,n(e.slug),1)])])]),a("div",$s,[a("button",{onClick:t=>function(e){$.value=e,j.value={name:e.name,slug:e.slug,driver:e.driver,isDefault:e.isDefault||!1},x.value=!0}(e),class:"p-2 rounded-md hover:bg-muted transition-colors"},[...r[30]||(r[30]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,js),a("button",{onClick:t=>function(e){A.value=e,D.value.open()}(e),class:"p-2 rounded-md hover:bg-muted transition-colors text-destructive"},[...r[31]||(r[31]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ms)])])]))),128))]),a("div",Ks,[a("button",{onClick:r[4]||(r[4]=e=>($.value=null,j.value={name:"",slug:"",driver:"",isDefault:!1},void(x.value=!0))),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"}," Add New Vault "),a("button",{onClick:J,disabled:M.value,class:"px-4 py-2 border border-border rounded-md hover:bg-muted transition-colors text-sm font-medium disabled:opacity-50"},n(M.value?"Verifying...":"Verify All Vaults"),9,_s)])])):s("",!0),"stages"===m.value?(l(),t("div",Ts,[r[34]||(r[34]=a("div",null,[a("h1",{class:"text-2xl font-semibold mb-2"},"Stage Configuration"),a("p",{class:"text-sm text-muted-foreground"},"Manage your deployment stages and environments")],-1)),a("div",As,[a("div",Ds,[(l(!0),t(c,null,v(E.value,e=>(l(),t("div",{key:e,class:"flex items-center justify-between py-3 border-b border-border last:border-0"},[a("span",zs,n(e),1),a("button",{onClick:t=>function(e){O.value=e,q.value.open()}(e),class:"p-2 rounded-md hover:bg-muted transition-colors text-destructive"},[...r[33]||(r[33]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Es)]))),128))]),a("div",Bs,[k(a("input",{"onUpdate:modelValue":r[5]||(r[5]=e=>B.value=e),onKeyup:C(W,["enter"]),type:"text",placeholder:"Enter new stage name...",class:"flex-1 px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},null,544),[[w,B.value]]),a("button",{onClick:W,disabled:!B.value,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium disabled:opacity-50"}," Add Stage ",8,Os)])]),r[35]||(r[35]=a("div",{class:"bg-muted/30 rounded-lg p-4 text-sm text-muted-foreground"},[a("p",{class:"font-medium mb-1"},"About Stages"),a("p",null,"Stages represent different deployment environments for your secrets. Common stages include development, staging, and production. System stages (local, staging, production) cannot be removed.")],-1))])):s("",!0)])]),x.value?(l(),t("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:h(P,["self"])},[a("div",qs,[a("h2",Us,n($.value?"Edit Vault":"Add New Vault"),1),a("div",Ls,[a("div",null,[r[37]||(r[37]=a("label",{class:"block text-sm font-medium mb-1"},"Driver",-1)),k(a("select",{"onUpdate:modelValue":r[6]||(r[6]=e=>j.value.driver=e),onChange:N,class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",disabled:!!$.value},[...r[36]||(r[36]=[a("option",{value:""},"Select driver...",-1),a("option",{value:"secretsmanager"},"AWS Secrets Manager",-1),a("option",{value:"ssm"},"AWS SSM Parameter Store",-1),a("option",{value:"test"},"Test Vault",-1)])],40,Is),[[V,j.value.driver]]),a("p",Ns,n($.value?"Driver cannot be changed after creation":"Select the backend vault type"),1)]),j.value.driver||$.value?(l(),t("div",Fs,[r[38]||(r[38]=a("label",{class:"block text-sm font-medium mb-1"},"Name",-1)),k(a("input",{"onUpdate:modelValue":r[7]||(r[7]=e=>j.value.name=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:I(j.value.driver).name},null,8,Rs),[[w,j.value.name]]),r[39]||(r[39]=a("p",{class:"text-xs text-muted-foreground mt-1"},"Friendly display name for this vault",-1))])):s("",!0),j.value.driver||$.value?(l(),t("div",Ps,[r[40]||(r[40]=a("label",{class:"block text-sm font-medium mb-1"},"Slug",-1)),k(a("input",{"onUpdate:modelValue":r[8]||(r[8]=e=>j.value.slug=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:I(j.value.driver).slug,disabled:!!$.value},null,8,Hs),[[w,j.value.slug]]),a("p",Js,n($.value?"Slug cannot be changed after creation":"Unique identifier for this vault"),1)])):s("",!0),j.value.driver||$.value?(l(),t("div",Ws,[k(a("input",{"onUpdate:modelValue":r[9]||(r[9]=e=>j.value.isDefault=e),type:"checkbox",id:"vault-default",class:"rounded border-border"},null,512),[[_,j.value.isDefault]]),r[41]||(r[41]=a("label",{for:"vault-default",class:"text-sm"},"Set as default vault",-1))])):s("",!0)]),a("div",Ys,[a("button",{onClick:P,class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),a("button",{onClick:H,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"},n($.value?"Save Changes":"Add Vault"),1)])])])):s("",!0),K.value?(l(),t("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:r[12]||(r[12]=h(e=>K.value=!1,["self"]))},[a("div",Gs,[a("div",Xs,[r[43]||(r[43]=a("h2",{class:"text-lg font-semibold"},"Vault Verification Results",-1)),a("button",{onClick:r[10]||(r[10]=e=>K.value=!1),class:"p-1 rounded-md hover:bg-muted transition-colors"},[...r[42]||(r[42]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),T.value?(l(),t("div",Qs,[(l(!0),t(c,null,v(T.value,(e,o)=>(l(),t("div",{key:o,class:"border border-border rounded-lg p-4"},[a("div",Zs,[a("h3",er,n(L(o)),1),a("span",{class:u(["px-2 py-1 rounded text-xs font-medium",e.success?"bg-green-500/10 text-green-500":"bg-destructive/10 text-destructive"])},n(e.success?"Connected":"Failed"),3)]),e.success&&e.permissions?(l(),t("div",tr,[(l(!0),t(c,null,v(e.permissions,(e,s)=>(l(),t("div",{key:s,class:"flex items-center space-x-2"},[e?(l(),t("svg",lr,[...r[44]||(r[44]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(l(),t("svg",ar,[...r[45]||(r[45]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])])),a("span",{class:u(e?"text-muted-foreground":"text-destructive")},n(s),3)]))),128))])):e.error?(l(),t("div",sr,n(e.error),1)):s("",!0)]))),128))])):(l(),t("div",rr,[...r[46]||(r[46]=[a("div",{class:"animate-spin h-8 w-8 border-2 border-primary border-t-transparent rounded-full mx-auto mb-4"},null,-1),S(" Verifying vaults... ",-1)])])),a("div",or,[a("button",{onClick:r[11]||(r[11]=e=>K.value=!1),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"}," Close ")])])])):s("",!0),i(ts,{ref_key:"deleteStageModal",ref:q,title:"Delete Stage",message:`Are you sure you want to remove the stage '${O.value}'?`,confirmText:"Remove Stage",onConfirm:Y},null,8,["message"]),i(ts,{ref_key:"deleteVaultModal",ref:D,title:"Delete Vault",message:`Are you sure you want to delete the vault '${null==(o=A.value)?void 0:o.name}'?`,confirmText:"Delete Vault",onConfirm:R},null,8,["message"])],64)}}}}],ur=T({history:A(),routes:nr});window.$api=We,D(le).use(ur).mount("#app");
//# sourceMappingURL=app.Ce7Jp65G.js.map
