import{c as e,a as t,o as i,b as s,d as n,e as r,f as o,t as l,n as a,g as h,w as c,F as u,h as d,u as f,T as p,r as g,i as m,j as v,k as y,l as b,m as w,p as x,q as k,v as S,s as C,x as M,y as A,z as O,A as T,B as D,C as E,D as R,E as L,G as B,H as P,I as N}from"./vendor.Cf2WvAOg.js";import{u as V,m as I,f as H}from"./utils.CALJnGAX.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const F={class:"flex items-start space-x-3"},z={key:0,class:"flex-shrink-0 mt-0.5"},W={class:"flex-1"},$={key:0,class:"font-semibold text-sm"},j={key:1,class:"text-sm mt-1 opacity-90"},q={__name:"Toast",props:{toast:{type:Object,required:!0}},emits:["dismiss"],setup(h){const c=h,u=e(()=>{const e={default:"bg-card border-border text-card-foreground",success:"bg-green-950 border-green-900 text-green-100",destructive:"bg-red-950 border-red-900 text-red-100"};return e[c.toast.variant]||e.default}),d=e(()=>"success"===c.toast.variant?{template:'\n        <svg class="text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />\n        </svg>\n      '}:"destructive"===c.toast.variant?{template:'\n        <svg class="text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n        </svg>\n      '}:null);return(e,c)=>(i(),t("div",{class:a(["pointer-events-auto relative flex w-full items-center justify-between rounded-lg border p-4 shadow-lg transition-all",u.value])},[s("div",F,[d.value?(i(),t("div",z,[(i(),r(o(d.value),{class:"h-5 w-5"}))])):n("",!0),s("div",W,[h.toast.title?(i(),t("div",$,l(h.toast.title),1)):n("",!0),h.toast.description?(i(),t("div",j,l(h.toast.description),1)):n("",!0)])]),s("button",{onClick:c[0]||(c[0]=t=>e.$emit("dismiss",h.toast.id)),class:"flex-shrink-0 ml-4 inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors hover:bg-accent"},[...c[1]||(c[1]=[s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])],2))}},_=(e,t)=>{const i=e.__vccOpts||e;for(const[s,n]of t)i[s]=n;return i},K={class:"fixed bottom-0 right-0 z-50 p-4 space-y-4 max-w-md w-full pointer-events-none"},U=_({__name:"ToastContainer",setup(e){const{toasts:s,dismiss:n}=V();return(e,o)=>(i(),t("div",K,[h(p,{name:"toast",tag:"div"},{default:c(()=>[(i(!0),t(u,null,d(f(s),e=>(i(),r(q,{key:e.id,toast:e,onDismiss:f(n)},null,8,["toast","onDismiss"]))),128))]),_:1})]))}},[["__scopeId","data-v-ac8f77a9"]]),G=g({search:null,closeModal:[],toggleMask:null});function J(){function e(e){"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"SELECT"!==e.target.tagName?("/"!==e.key||e.metaKey||e.ctrlKey||(e.preventDefault(),G.value.search&&G.value.search()),"Escape"===e.key&&(e.preventDefault(),G.value.closeModal.forEach(e=>e())),"m"!==e.key||e.metaKey||e.ctrlKey||(e.preventDefault(),G.value.toggleMask&&G.value.toggleMask())):"Escape"===e.key&&(e.preventDefault(),G.value.closeModal.forEach(e=>e()))}let t=!1;return{registerSearchHandler:function(e){G.value.search=e},registerModalCloseHandler:function(e){return G.value.closeModal.push(e),()=>{const t=G.value.closeModal.indexOf(e);t>-1&&G.value.closeModal.splice(t,1)}},registerMaskToggleHandler:function(e){G.value.toggleMask=e},setupGlobalListener:function(){t||(document.addEventListener("keydown",e),t=!0)},teardownGlobalListener:function(){t&&(document.removeEventListener("keydown",e),t=!1)}}}const Y={class:"min-h-screen bg-background text-foreground"},X={class:"border-b border-border"},Q={class:"max-w-full px-4 sm:px-6 lg:px-8"},Z={class:"flex items-center justify-between h-16"},ee={class:"flex items-center w-1/3"},te={class:"text-xl font-semibold opacity-75"},ie={class:"flex items-center space-x-2 bg-muted rounded-full p-1"},se=["onClick"],ne={class:"w-1/3 text-right"},re={href:"https://github.com/stechstudio/keep",target:"_blank",class:"text-white/50 hover:text-white"},oe={class:"max-w-full px-4 sm:px-6 lg:px-8 py-6"},le={__name:"App",setup(e){const n=[{id:"secrets",label:"Secrets",path:"/secrets"},{id:"templates",label:"Templates",path:"/templates"},{id:"diff",label:"Compare",path:"/diff"},{id:"settings",label:"Settings",path:"/settings"}],r=g("Keep"),o=g(""),{setupGlobalListener:f,teardownGlobalListener:p}=J();return m(async()=>{f(),await async function(){try{const e=await window.$api.getSettings();r.value=e.app_name||"Keep",o.value=e.keep_version||""}catch(e){console.error("Failed to load settings:",e)}}()}),v(()=>{p()}),(e,f)=>{const p=y("router-link"),g=y("router-view");return i(),t("div",Y,[h(U),s("nav",X,[s("div",Q,[s("div",Z,[s("div",ee,[f[0]||(f[0]=s("div",{class:"size-9 pl-3 pr-2 rounded bg-muted mr-3 flex items-center justify-center text-primary"},[s("svg",{fill:"none",height:"100%",viewBox:"0 0 59 70",width:"59",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"m58.4476 69.14c-10.35 0-23.67-12.33-31.41-22.05-5.13-6.39-7.11-8.91-9.45-11.7l-4.32 4.32v25.29h-12.599982v-64.620005h12.599982v32.580005l31.5-32.580005h7.2l-24.21 24.570005z",fill:"currentColor"})])],-1)),s("span",te,l(r.value)+" Secrets",1)]),s("div",ie,[(i(),t(u,null,d(n,t=>h(p,{key:t.id,to:t.path,custom:""},{default:c(({isActive:i})=>[s("button",{onClick:i=>e.$router.push(t.path),class:a(["px-4 py-1.5 rounded-full text-sm font-medium transition-colors",i?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"])},l(t.label),11,se)]),_:2},1032,["to"])),64))]),s("div",ne,[s("a",re,"Keep v"+l(o.value),1)])])])]),s("main",oe,[h(g)])])}}},ae={class:"flex items-center space-x-3"},he={class:"relative"},ce={key:0,class:"absolute top-full mt-1 bg-popover border border-border rounded-md shadow-lg z-10"},ue={class:"py-1"},de=["onClick"],fe={class:"relative"},pe={key:0,class:"absolute top-full mt-1 w-48 bg-popover border border-border rounded-md shadow-lg z-10"},ge={class:"py-1"},me=["onClick"],ve={__name:"VaultStageSelector",props:{vault:String,stage:String,vaults:Array,stages:Array},emits:["update:vault","update:stage"],setup(r,{emit:o}){const h=r,c=o,f=g(!1),p=g(!1),m=e(()=>{var e;if(!h.vault)return"";const t=null==(e=h.vaults)?void 0:e.find(e=>("object"==typeof e?e.slug||e.name:e)===h.vault);return(null==t?void 0:t.display)||h.vault});return document.addEventListener("click",e=>{e.target.closest(".relative")||(f.value=!1,p.value=!1)}),(e,o)=>(i(),t("div",ae,[s("div",he,[s("button",{onClick:o[0]||(o[0]=e=>f.value=!f.value),class:"flex items-center space-x-2 px-3 pl-0 py-1.5 transition-colors"},[s("span",null,l(m.value||"Select Vault"),1),o[2]||(o[2]=s("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),f.value?(i(),t("div",ce,[s("div",ue,[(i(!0),t(u,null,d(r.vaults,e=>(i(),t("button",{key:e.slug||e.name||e,onClick:t=>function(e){c("update:vault",e),f.value=!1}(e.slug||e.name||e),class:a(["w-full text-left px-3 py-2 text-sm hover:bg-accent transition-colors whitespace-nowrap",r.vault===(e.slug||e.name||e)?"bg-white/10":""])},l(e.display||e),11,de))),128))])])):n("",!0)]),o[4]||(o[4]=s("div",{class:"text-lg text-white/30 font-bold pr-3"},"/",-1)),s("div",fe,[s("button",{onClick:o[1]||(o[1]=e=>p.value=!p.value),class:"flex items-center space-x-2 px-3 pl-0 py-1.5 transition-colors"},[s("span",null,l(r.stage||"Select Stage"),1),o[3]||(o[3]=s("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),p.value?(i(),t("div",pe,[s("div",ge,[(i(!0),t(u,null,d(r.stages,e=>(i(),t("button",{key:e,onClick:t=>function(e){c("update:stage",e),p.value=!1}(e),class:a(["w-full text-left px-3 py-2 text-sm hover:bg-accent transition-colors",r.stage===e?"bg-white/10":""])},l(e),11,me))),128))])])):n("",!0)])]))}},ye={class:"flex items-center space-x-2"},be={class:"font-mono text-sm"},we=["title"],xe={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ke={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Se={__name:"SecretValue",props:{value:String,masked:{type:Boolean,default:!0}},emits:["toggle"],setup(n){const r=n,o=e(()=>r.masked?I(r.value):r.value);return(e,r)=>(i(),t("div",ye,[s("span",be,l(o.value),1),s("button",{onClick:r[0]||(r[0]=t=>e.$emit("toggle")),class:"p-1 rounded hover:bg-muted transition-colors",title:n.masked?"Show value":"Hide value"},[n.masked?(i(),t("svg",xe,[...r[1]||(r[1]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])])):(i(),t("svg",ke,[...r[2]||(r[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])]))],8,we)]))}};const Ce=new class{constructor(){this.baseUrl="",this.token=window.KEEP_AUTH_TOKEN}async request(e,t={}){const i=await fetch(`${this.baseUrl}/api${e}`,{...t,headers:{"X-Auth-Token":this.token,"Content-Type":"application/json",...t.headers}});if(!i.ok){const e=await i.json().catch(()=>({error:"Request failed"}));throw new Error(e.error||`HTTP ${i.status}`)}return i.json()}async get(e){return this.request(e)}async post(e,t={}){return this.request(e,{method:"POST",body:JSON.stringify(t)})}async put(e,t={}){return this.request(e,{method:"PUT",body:JSON.stringify(t)})}async delete(e){return this.request(e,{method:"DELETE"})}async listSecrets(e,t,i=!1){return this.request(`/secrets?vault=${e}&stage=${t}&unmask=${i}`)}async getSecret(e,t,i,s=!1){return this.request(`/secrets/${encodeURIComponent(e)}?vault=${t}&stage=${i}&unmask=${s}`)}async createSecret(e,t,i,s){return this.request("/secrets",{method:"POST",body:JSON.stringify({key:e,value:t,vault:i,stage:s})})}async updateSecret(e,t,i,s){return this.request(`/secrets/${encodeURIComponent(e)}`,{method:"PUT",body:JSON.stringify({value:t,vault:i,stage:s})})}async deleteSecret(e,t,i){return this.request(`/secrets/${encodeURIComponent(e)}`,{method:"DELETE",body:JSON.stringify({vault:t,stage:i})})}async renameSecret(e,t,i,s){return this.request(`/secrets/${encodeURIComponent(e)}/rename`,{method:"POST",body:JSON.stringify({newKey:t,vault:i,stage:s})})}async copySecretToStage(e,t,i,s,n){return this.request(`/secrets/${encodeURIComponent(e)}/copy-to-stage?vault=${n}&stage=${s}`,{method:"POST",body:JSON.stringify({targetStage:t,targetVault:i})})}async searchSecrets(e,t,i,s=!1){return this.request(`/search?q=${encodeURIComponent(e)}&vault=${t}&stage=${i}&unmask=${s}`)}async getSecretHistory(e,t,i,s=10,n=!1){return this.request(`/secrets/${encodeURIComponent(e)}/history?vault=${t}&stage=${i}&limit=${s}&unmask=${n}`)}async getSettings(){return this.request("/settings")}async updateSettings(e){return this.request("/settings",{method:"PUT",body:JSON.stringify(e)})}async listVaults(){return this.request("/vaults")}async addVault(e){return this.request("/vaults",{method:"POST",body:JSON.stringify(e)})}async updateVault(e,t){return this.request(`/vaults/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteVault(e){return this.request(`/vaults/${e}`,{method:"DELETE"})}async listStages(){return this.request("/stages")}async addStage(e){return this.request("/stages",{method:"POST",body:JSON.stringify({stage:e})})}async removeStage(e){return this.request("/stages",{method:"DELETE",body:JSON.stringify({stage:e})})}async verifyVaults(){return this.request("/verify",{method:"POST"})}async getDiff(e=null,t=null){let i="/diff?";return e&&(i+=`stages=${e.join(",")}&`),t&&(i+=`vaults=${t.join(",")}`),this.request(i)}async exportSecrets(e,t,i="env"){return this.request("/export",{method:"POST",body:JSON.stringify({vault:e,stage:t,format:i})})}async analyzeImport({content:e,vault:t,stage:i,only:s=null,except:n=null}){return this.request("/import/analyze",{method:"POST",body:JSON.stringify({content:e,vault:t,stage:i,only:s,except:n})})}async executeImport({content:e,vault:t,stage:i,strategy:s,only:n=null,except:r=null,dry_run:o=!1}){return this.request("/import/execute",{method:"POST",body:JSON.stringify({content:e,vault:t,stage:i,strategy:s,only:n,except:r,dry_run:o})})}};function Me(){const e=g([]),t=g(!1),i=g(null);return{secrets:e,loading:t,error:i,loadSecrets:async function(s,n,r=!1){t.value=!0,i.value=null;try{const t=await Ce.listSecrets(s,n,r);return e.value=t.secrets,e.value}catch(o){throw i.value=o.message,e.value=[],o}finally{t.value=!1}},createSecret:async function(e,s,n,r){t.value=!0,i.value=null;try{return await Ce.createSecret(e,s,n,r)}catch(o){throw i.value=o.message,o}finally{t.value=!1}},updateSecret:async function(e,s,n,r){t.value=!0,i.value=null;try{return await Ce.updateSecret(e,s,n,r)}catch(o){throw i.value=o.message,o}finally{t.value=!1}},deleteSecret:async function(e,s,n){t.value=!0,i.value=null;try{return await Ce.deleteSecret(e,s,n)}catch(r){throw i.value=r.message,r}finally{t.value=!1}},renameSecret:async function(e,s,n,r){t.value=!0,i.value=null;try{return await Ce.renameSecret(e,s,n,r)}catch(o){throw i.value=o.message,o}finally{t.value=!1}},copySecretToStage:async function(e,s,n,r,o){t.value=!0,i.value=null;try{return await Ce.copySecretToStage(e,s,n,r,o)}catch(l){throw i.value=l.message,l}finally{t.value=!1}},searchSecrets:async function(s,n,r,o=!1){t.value=!0,i.value=null;try{const t=await Ce.searchSecrets(s,n,r,o);return e.value=t.secrets,e.value}catch(l){throw i.value=l.message,e.value=[],l}finally{t.value=!1}},getSecretHistory:async function(e,s,n,r=10,o=!1){t.value=!0,i.value=null;try{return await Ce.getSecretHistory(e,s,n,r,o)}catch(l){throw i.value=l.message,l}finally{t.value=!1}},clearError:function(){i.value=null}}}const Ae={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Oe={class:"text-lg font-semibold mb-4"},Te={class:"space-y-4"},De=["disabled"],Ee={key:0,class:"mt-1 text-xs text-red-500"},Re={class:"text-xs text-muted-foreground"},Le={class:"font-medium"},Be={class:"font-medium"},Pe={key:0,class:"p-3 bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900 rounded-md"},Ne={class:"text-sm text-red-600 dark:text-red-400"},Ve={class:"flex justify-end space-x-3 mt-6"},Ie=["disabled"],He={__name:"SecretDialog",props:{secret:Object,vault:String,stage:String,initialKey:String},emits:["success","close"],setup(r,{emit:o}){const h=r,c=o,u=V(),{createSecret:d,updateSecret:f}=Me(),p=b({key:"",value:""}),m=g(""),v=g(""),y=g(!1),M=e(()=>p.key?p.key.includes(" ")?(m.value="No spaces allowed",!1):/^[A-Za-z0-9_\-/.]+$/.test(p.key)?(m.value="",!0):(m.value="Only letters, numbers, _, -, /, . allowed",!1):(m.value="",!0));async function A(){if(M.value&&!y.value){v.value="",y.value=!0;try{h.secret?(await f(p.key,p.value,h.vault,h.stage),u.success("Secret updated",`Secret '${p.key}' has been updated successfully`)):(await d(p.key,p.value,h.vault,h.stage),u.success("Secret created",`Secret '${p.key}' has been created successfully`)),c("success"),c("close")}catch(e){v.value=e.message||"Failed to save secret",console.error("Failed to save secret:",e)}finally{y.value=!1}}}return w(()=>h.secret,e=>{e?(p.key=e.key,p.value=e.value):(p.key=h.initialKey||"",p.value="")},{immediate:!0}),w(()=>h.initialKey,e=>{!h.secret&&e&&(p.key=e)},{immediate:!0}),w(()=>p.key,()=>{M.value}),(e,o)=>(i(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:o[3]||(o[3]=x(t=>e.$emit("close"),["self"]))},[s("div",Ae,[s("h2",Oe,l(r.secret?"Edit Secret":"Add Secret"),1),s("form",{onSubmit:x(A,["prevent"])},[s("div",Te,[s("div",null,[o[4]||(o[4]=s("label",{class:"block text-sm font-medium mb-1"},"Key",-1)),k(s("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>p.key=e),type:"text",disabled:!!r.secret,class:a(["w-full px-3 py-2 bg-input border rounded-md text-sm focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed",m.value?"border-red-500 focus:ring-red-500":"border-border focus:ring-ring"]),placeholder:"SECRET_KEY",required:""},null,10,De),[[S,p.key]]),m.value?(i(),t("p",Ee,l(m.value),1)):n("",!0)]),s("div",null,[o[5]||(o[5]=s("label",{class:"block text-sm font-medium mb-1"},"Value",-1)),k(s("textarea",{"onUpdate:modelValue":o[1]||(o[1]=e=>p.value=e),rows:"4",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring font-mono",placeholder:"Secret value...",required:""},null,512),[[S,p.value]])]),s("div",Re,[o[6]||(o[6]=C(" Vault: ",-1)),s("span",Le,l(r.vault),1),o[7]||(o[7]=C(" • Stage: ",-1)),s("span",Be,l(r.stage),1)]),v.value?(i(),t("div",Pe,[s("p",Ne,l(v.value),1)])):n("",!0)]),s("div",Ve,[s("button",{type:"button",onClick:o[2]||(o[2]=t=>e.$emit("close")),class:"px-4 py-2 text-sm font-medium border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),s("button",{type:"submit",disabled:!M.value||y.value,class:"px-4 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},l(y.value?"Saving...":r.secret?"Save":"Add"),9,Ie)])],32)])]))}},Fe={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ze={class:"bg-card border border-border rounded-lg p-6 w-96 max-w-full"},We={class:"mb-4"},$e=["value"],je={class:"mb-6"},qe={key:0,class:"mt-1 text-xs text-red-500"},_e={key:1,class:"mt-2 text-sm text-red-500"},Ke={class:"flex justify-end space-x-3"},Ue=["disabled"],Ge={__name:"RenameDialog",props:{currentKey:{type:String,required:!0},vault:{type:String,required:!0},stage:{type:String,required:!0}},emits:["close","success"],setup(r,{emit:o}){const h=r,c=o,u=V(),{renameSecret:d}=Me(),f=g(h.currentKey),p=g(""),m=g(""),v=g(!1),y=e(()=>{const e=f.value.trim();return e?e===h.currentKey?(p.value="",!1):e.includes(" ")?(p.value="No spaces allowed",!1):/^[A-Za-z0-9_\-/.]+$/.test(e)?(p.value="",!0):(p.value="Only letters, numbers, _, -, /, . allowed",!1):(p.value="",!1)}),b=e(()=>y.value);async function x(){if(b.value&&!v.value){m.value="",v.value=!0;try{await d(h.currentKey,f.value.trim(),h.vault,h.stage),u.success("Secret renamed",`Secret renamed from '${h.currentKey}' to '${f.value.trim()}'`),c("success"),c("close")}catch(e){m.value=e.message||"Failed to rename secret",console.error("Failed to rename secret:",e)}finally{v.value=!1}}}return w(()=>f.value,()=>{y.value}),(e,o)=>(i(),t("div",Fe,[s("div",ze,[o[4]||(o[4]=s("h2",{class:"text-lg font-semibold mb-4"},"Rename Secret",-1)),s("div",We,[o[2]||(o[2]=s("label",{class:"block text-sm font-medium mb-2"},"Current Key",-1)),s("input",{value:r.currentKey,disabled:"",class:"w-full px-3 py-2 bg-muted border border-border rounded-md text-sm opacity-60"},null,8,$e)]),s("div",je,[o[3]||(o[3]=s("label",{class:"block text-sm font-medium mb-2"},"New Key",-1)),k(s("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>f.value=e),onKeyup:M(x,["enter"]),type:"text",placeholder:"Enter new key name",class:a(["w-full px-3 py-2 bg-input border rounded-md text-sm focus:outline-none focus:ring-2",p.value||m.value?"border-red-500 focus:ring-red-500":"border-border focus:ring-ring"])},null,34),[[S,f.value]]),p.value?(i(),t("p",qe,l(p.value),1)):n("",!0),m.value&&!p.value?(i(),t("p",_e,l(m.value),1)):n("",!0)]),s("div",Ke,[s("button",{onClick:o[1]||(o[1]=t=>e.$emit("close")),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-accent transition-colors"}," Cancel "),s("button",{onClick:x,disabled:!b.value||v.value,class:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},l(v.value?"Renaming...":"Rename"),9,Ue)])])]))}},Je={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ye={class:"bg-card border border-border rounded-lg p-6 w-96 max-w-full"},Xe={class:"mb-4"},Qe=["value"],Ze={class:"mb-4"},et=["value"],tt={class:"mb-6"},it=["value","disabled"],st={class:"flex justify-end space-x-3"},nt=["disabled"],rt={__name:"CopyToStageDialog",props:{secretKey:{type:String,required:!0},currentVault:{type:String,required:!0},currentStage:{type:String,required:!0},vaults:{type:Array,required:!0},stages:{type:Array,required:!0}},emits:["close","copy"],setup(n,{emit:r}){const o=n,a=r,h=g(""),c=e(()=>{const e=[];for(const t of o.vaults)for(const i of o.stages)e.push({key:`${t.slug||t}:${i}`,vaultSlug:t.slug||t,display:t.display||t.name||t,stage:i});return e});function f(){if(h.value){const[e,t]=h.value.split(":");a("copy",{targetVault:e,targetStage:t})}}return(e,r)=>(i(),t("div",Je,[s("div",Ye,[r[6]||(r[6]=s("h2",{class:"text-lg font-semibold mb-4"},"Copy Secret",-1)),s("div",Xe,[r[2]||(r[2]=s("label",{class:"block text-sm font-medium mb-2"},"Secret Key",-1)),s("input",{value:n.secretKey,disabled:"",class:"w-full px-3 py-2 bg-muted border border-border rounded-md text-sm opacity-60"},null,8,Qe)]),s("div",Ze,[r[3]||(r[3]=s("label",{class:"block text-sm font-medium mb-2"},"From",-1)),s("input",{value:`${n.currentVault} / ${n.currentStage}`,disabled:"",class:"w-full px-3 py-2 bg-muted border border-border rounded-md text-sm opacity-60"},null,8,et)]),s("div",tt,[r[5]||(r[5]=s("label",{class:"block text-sm font-medium mb-2"},"Copy To",-1)),k(s("select",{"onUpdate:modelValue":r[0]||(r[0]=e=>h.value=e),class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},[r[4]||(r[4]=s("option",{value:""},"Select destination...",-1)),(i(!0),t(u,null,d(c.value,e=>(i(),t("option",{key:e.key,value:e.key,disabled:e.key===`${n.currentVault}:${n.currentStage}`},l(e.display)+" / "+l(e.stage),9,it))),128))],512),[[A,h.value]])]),s("div",st,[s("button",{onClick:r[1]||(r[1]=t=>e.$emit("close")),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-accent transition-colors"}," Cancel "),s("button",{onClick:f,disabled:!h.value,class:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Copy Secret ",8,nt)])])]))}},ot={class:"bg-card border border-border rounded-lg p-6 w-full max-w-4xl max-h-[80vh] flex flex-col"},lt={class:"flex items-center justify-between mb-4"},at={class:"text-sm text-muted-foreground mt-1"},ht={key:0,class:"flex-1 flex items-center justify-center"},ct={key:1,class:"flex-1 flex items-center justify-center"},ut={class:"text-destructive"},dt={key:2,class:"flex-1 flex items-center justify-center"},ft={key:3,class:"flex-1 overflow-y-auto"},pt={class:"w-full"},gt={class:"sticky top-0 bg-card border-b border-border"},mt={class:"text-left px-4 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wider"},vt={class:"flex items-center space-x-2"},yt=["title"],bt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wt={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xt={class:"divide-y divide-border"},kt={class:"px-4 py-3 text-sm"},St={class:"px-4 py-3 text-sm"},Ct={class:"font-mono"},Mt={class:"px-4 py-3 text-sm text-muted-foreground"},At={class:"px-4 py-3"},Ot={class:"text-sm"},Tt={class:"text-xs text-muted-foreground/70"},Dt={class:"flex justify-between items-center mt-4 pt-4 border-t border-border"},Et={class:"text-sm text-muted-foreground"},Rt={__name:"HistoryDialog",props:{secretKey:{type:String,required:!0},vault:{type:String,required:!0},stage:{type:String,required:!0}},emits:["close","refresh"],setup(e,{emit:n}){const r=e,{getSecretHistory:o}=Me(),h=g([]),c=g(!0),p=g(null),v=g(!1);function y(){v.value=!v.value}return m(()=>{!async function(){c.value=!0,p.value=null;try{const e=await o(r.secretKey,r.vault,r.stage,20,!0);h.value=e.history||[]}catch(e){console.error("Failed to load history:",e),p.value=e.message||"Failed to load history"}finally{c.value=!1}}()}),(n,r)=>(i(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:r[2]||(r[2]=x(e=>n.$emit("close"),["self"]))},[s("div",ot,[s("div",lt,[s("div",null,[r[3]||(r[3]=s("h2",{class:"text-lg font-semibold"},"Secret History",-1)),s("p",at,l(e.secretKey)+" • "+l(e.vault)+" / "+l(e.stage),1)]),s("button",{onClick:r[0]||(r[0]=e=>n.$emit("close")),class:"p-1 rounded-md hover:bg-muted transition-colors"},[...r[4]||(r[4]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),c.value?(i(),t("div",ht,[...r[5]||(r[5]=[s("div",{class:"text-muted-foreground"},"Loading history...",-1)])])):p.value?(i(),t("div",ct,[s("div",ut,l(p.value),1)])):0===h.value.length?(i(),t("div",dt,[...r[6]||(r[6]=[s("div",{class:"text-muted-foreground"},"No history found for this secret",-1)])])):(i(),t("div",ft,[s("table",pt,[s("thead",gt,[s("tr",null,[r[10]||(r[10]=s("th",{class:"text-left px-4 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Version",-1)),s("th",mt,[s("div",vt,[r[9]||(r[9]=s("span",null,"Value",-1)),s("button",{onClick:y,class:"p-1 rounded hover:bg-accent transition-colors",title:v.value?"Hide values":"Show values"},[v.value?(i(),t("svg",wt,[...r[8]||(r[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(i(),t("svg",bt,[...r[7]||(r[7]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))],8,yt)])]),r[11]||(r[11]=s("th",{class:"text-left px-4 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Type",-1)),r[12]||(r[12]=s("th",{class:"text-left px-4 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Modified",-1))])]),s("tbody",xt,[(i(!0),t(u,null,d(h.value,(e,n)=>{return i(),t("tr",{key:`${e.version}-${n}`,class:"hover:bg-muted/50 transition-colors"},[s("td",kt,[s("span",{class:a(["inline-flex items-center px-2 py-1 rounded-md text-xs font-medium",0===n?"bg-primary/10 text-primary":"bg-accent"])}," v"+l(e.version),3)]),s("td",St,[s("span",Ct,l((r=e.value,r?v.value?r:I(r):"(null)")),1)]),s("td",Mt,l(e.dataType),1),s("td",At,[s("div",Ot,l(f(H)(e.timestamp||e.modifiedDate)),1),s("div",Tt,l(e.modifiedBy),1)])]);var r}),128))])])])),s("div",Dt,[s("div",Et," Showing "+l(h.value.length)+" revision"+l(1===h.value.length?"":"s"),1),s("button",{onClick:r[1]||(r[1]=e=>n.$emit("close")),class:"px-4 py-2 text-sm font-medium border border-border rounded-md hover:bg-muted transition-colors"}," Close ")])])]))}},Lt={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Bt={class:"flex items-start space-x-3"},Pt={class:"flex-1"},Nt={class:"mt-3 p-3 bg-muted/50 rounded-md"},Vt={class:"text-sm"},It={class:"font-medium"},Ht={class:"text-xs text-muted-foreground mt-1"},Ft={key:0,class:"mt-3 p-3 bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900 rounded-md"},zt={class:"text-sm text-red-600 dark:text-red-400"},Wt={class:"flex justify-end space-x-3 mt-6"},$t=["disabled"],jt={__name:"DeleteConfirmDialog",props:{secretKey:{type:String,required:!0},vault:{type:String,required:!0},stage:{type:String,required:!0}},emits:["close","success"],setup(e,{emit:r}){const o=e,a=r,h=V(),{deleteSecret:c}=Me(),u=g(""),d=g(!1);async function f(){if(!d.value){u.value="",d.value=!0;try{await c(o.secretKey,o.vault,o.stage),h.success("Secret deleted",`Secret '${o.secretKey}' has been deleted successfully`),a("success"),a("close")}catch(e){u.value=e.message||"Failed to delete secret",console.error("Failed to delete secret:",e)}finally{d.value=!1}}}return(r,o)=>(i(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:o[1]||(o[1]=x(e=>r.$emit("close"),["self"]))},[s("div",Lt,[s("div",Bt,[o[5]||(o[5]=s("div",{class:"flex-shrink-0"},[s("div",{class:"h-10 w-10 rounded-full bg-destructive/10 flex items-center justify-center"},[s("svg",{class:"h-6 w-6 text-destructive",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])])],-1)),s("div",Pt,[o[2]||(o[2]=s("h3",{class:"text-lg font-semibold"},"Delete Secret",-1)),o[3]||(o[3]=s("p",{class:"mt-2 text-sm text-muted-foreground"}," Are you sure you want to delete this secret? ",-1)),s("div",Nt,[s("div",Vt,[s("div",It,l(e.secretKey),1),s("div",Ht,l(e.vault)+" / "+l(e.stage),1)])]),o[4]||(o[4]=s("p",{class:"mt-3 text-sm text-muted-foreground"}," This action cannot be undone. ",-1)),u.value?(i(),t("div",Ft,[s("p",zt,l(u.value),1)])):n("",!0)])]),s("div",Wt,[s("button",{onClick:o[0]||(o[0]=e=>r.$emit("close")),class:"px-4 py-2 text-sm font-medium border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),s("button",{onClick:f,disabled:d.value,class:"px-4 py-2 text-sm font-medium bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},l(d.value?"Deleting...":"Delete Secret"),9,$t)])])]))}},qt={class:"relative inline-block text-left"},_t={class:"py-1 flex flex-col"},Kt={__name:"SecretActionsMenu",props:{secretKey:{type:String,required:!0},secretValue:{type:String,default:null},vault:{type:String,required:!0},stage:{type:String,required:!0},showEdit:{type:Boolean,default:!0},showRename:{type:Boolean,default:!0},showCreate:{type:Boolean,default:!1},showCopyValue:{type:Boolean,default:!0},showCopyTo:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},showHistory:{type:Boolean,default:!0},buttonClass:{type:String,default:""}},emits:["edit","rename","create","copyValue","copyTo","delete","history","refresh"],setup(e,{emit:o}){const l=e,h=o,c=g(!1),u=g({}),d=g(null);function f(e){if(e.stopPropagation(),c.value)c.value=!1;else{document.dispatchEvent(new CustomEvent("close-all-menus"));const t=e.currentTarget.getBoundingClientRect(),i=192,s=40*[l.showEdit,l.showRename,l.showCreate,l.showCopyValue,l.showCopyTo,l.showHistory,l.showDelete].filter(Boolean).length+8;let n=t.right-i,r=t.bottom+4+window.scrollY;t.bottom+s>window.innerHeight&&t.top>s&&(r=t.top-s+16+window.scrollY),n<0&&(n=t.left),u.value={left:`${n}px`,top:`${r}px`},setTimeout(()=>{c.value=!0},0)}}function p(){h("edit",{key:l.secretKey,value:l.secretValue,vault:l.vault,stage:l.stage}),c.value=!1}function y(){h("rename",{key:l.secretKey,value:l.secretValue,vault:l.vault,stage:l.stage}),c.value=!1}function b(){h("create",{key:l.secretKey,vault:l.vault,stage:l.stage}),c.value=!1}function w(){l.secretValue&&navigator.clipboard.writeText(l.secretValue),h("copyValue",{key:l.secretKey,vault:l.vault,stage:l.stage}),c.value=!1}function x(){h("copyTo",{key:l.secretKey,value:l.secretValue,vault:l.vault,stage:l.stage}),c.value=!1}function k(){h("history",{key:l.secretKey,vault:l.vault,stage:l.stage}),c.value=!1}function S(){h("delete",{key:l.secretKey,vault:l.vault,stage:l.stage}),c.value=!1}function C(e){c.value&&d.value&&!d.value.contains(e.target)&&(c.value=!1)}function M(){c.value=!1}function A(){c.value&&(c.value=!1)}return m(()=>{document.addEventListener("click",C),document.addEventListener("close-all-menus",M),window.addEventListener("scroll",A,!0)}),v(()=>{document.removeEventListener("click",C),document.removeEventListener("close-all-menus",M),window.removeEventListener("scroll",A,!0)}),(o,l)=>(i(),t("div",qt,[s("button",{ref_key:"buttonRef",ref:d,onClick:f,class:a(["p-1 rounded hover:bg-muted transition-colors",e.buttonClass])},[...l[0]||(l[0]=[s("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})],-1)])],2),c.value?(i(),r(T,{key:0,to:"body"},[s("div",{style:O(u.value),class:"absolute w-48 bg-popover border border-border rounded-md shadow-lg z-50"},[s("div",_t,[e.showEdit?(i(),t("button",{key:0,onClick:p,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Edit ")):n("",!0),e.showRename?(i(),t("button",{key:1,onClick:y,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Rename ")):n("",!0),e.showCreate?(i(),t("button",{key:2,onClick:b,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Create ")):n("",!0),e.showCopyValue?(i(),t("button",{key:3,onClick:w,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Copy Value ")):n("",!0),e.showCopyTo?(i(),t("button",{key:4,onClick:x,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," Copy To... ")):n("",!0),e.showHistory?(i(),t("button",{key:5,onClick:k,class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"}," History ")):n("",!0),e.showDelete?(i(),t("button",{key:6,onClick:S,class:"w-full text-left px-4 py-2 text-sm text-destructive hover:bg-accent transition-colors"}," Delete ")):n("",!0)])],4)])):n("",!0)]))}},Ut={class:"bg-card border border-border rounded-lg w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col"},Gt={class:"flex-1 overflow-y-auto px-6 py-4"},Jt={key:0,class:"space-y-4"},Yt={class:"text-sm font-medium mb-2"},Xt={class:"text-sm text-muted-foreground mt-3"},Qt={class:"space-y-3 pt-4 border-t border-border"},Zt={class:"grid grid-cols-2 gap-4"},ei={key:1,class:"space-y-4"},ti={class:"flex items-center space-x-6 text-sm"},ii={class:"font-medium text-green-500"},si={class:"font-medium text-yellow-500"},ni={class:"font-medium text-red-500"},ri={class:"font-medium text-gray-500"},oi={key:0,class:"border border-yellow-500/20 bg-yellow-500/5 rounded-lg p-4"},li={class:"space-y-2"},ai={class:"flex items-center space-x-2"},hi={class:"flex items-center space-x-2"},ci={class:"border border-border rounded-lg overflow-hidden"},ui={class:"w-full text-sm"},di={class:"divide-y divide-border"},fi={class:"px-4 py-2 font-mono"},pi={class:"px-4 py-2 font-mono text-xs"},gi={class:"px-4 py-2"},mi={key:0,class:"block text-xs text-red-500 mt-1"},vi={class:"flex items-center space-x-2"},yi={key:2,class:"space-y-4"},bi={class:"font-medium mb-2"},wi={class:"flex items-center space-x-6 text-sm"},xi={class:"font-medium text-green-500"},ki={class:"font-medium text-yellow-500"},Si={class:"font-medium text-red-500"},Ci={key:0,class:"border border-blue-500/20 bg-blue-500/5 rounded-lg p-4"},Mi={key:1,class:"border border-red-500/20 bg-red-500/5 rounded-lg p-4"},Ai={class:"list-disc list-inside space-y-1"},Oi={class:"border border-border rounded-lg overflow-hidden"},Ti={class:"w-full text-sm"},Di={class:"divide-y divide-border"},Ei={class:"px-4 py-2 font-mono"},Ri={class:"px-4 py-2"},Li={class:"px-4 py-2 text-muted-foreground"},Bi={class:"flex justify-between items-center px-6 py-4 border-t border-border"},Pi={class:"flex space-x-2"},Ni=["disabled"],Vi=["disabled"],Ii={__name:"ImportWizard",props:{vault:String,stage:String},emits:["imported","close"],setup(r,{emit:o}){const h=r,c=o,f=V(),p=g(1),m=g(""),v=g(""),y=g(!1),b=g({only:"",except:""}),w=g(!1),M=g({total:0,new:0,existing:0,invalid:0,empty:0,secrets:[]}),A=g("skip"),O=g(!1),T=g(!1),R=g({imported:0,skipped:0,failed:0,results:{},errors:[]}),L=e(()=>M.value.secrets||[]);function B(e){const t=e.target.files[0];t&&N(t)}function P(e){e.preventDefault(),y.value=!1;const t=e.dataTransfer.files;if(0===t.length)return;const i=t[0];i.name.match(/\.env(\.|$)/)?N(i):f.error("Invalid file","Please upload a .env file")}function N(e){m.value=e.name;const t=new FileReader;t.onload=e=>{v.value=e.target.result},t.onerror=()=>{f.error("Failed to read file","Could not read the selected file")},t.readAsText(e)}async function I(){if(v.value){w.value=!0;try{const e=await window.$api.analyzeImport({content:v.value,vault:h.vault,stage:h.stage,only:b.value.only||null,except:b.value.except||null});M.value=e.analysis,p.value=2,0===M.value.existing&&(A.value="skip")}catch(e){f.error("Failed to analyze import",e.message)}finally{w.value=!1}}else f.error("No content to import","Please upload a file or paste content")}async function H(){T.value=!0;try{const e=await window.$api.executeImport({content:v.value,vault:h.vault,stage:h.stage,strategy:A.value,only:b.value.only||null,except:b.value.except||null,dry_run:O.value});R.value=e,p.value=3,!O.value&&e.imported>0&&(f.success("Import successful",`Imported ${e.imported} secrets`),c("imported"))}catch(e){f.error("Failed to import",e.message)}finally{T.value=!1}}function F(){p.value=1,m.value="",v.value="",y.value=!1,c("close"),b.value={only:"",except:""},M.value={total:0,new:0,existing:0,invalid:0,empty:0,secrets:[]},A.value="skip",O.value=!1,R.value={imported:0,skipped:0,failed:0,results:{},errors:[]}}function z(e){switch(e){case"new":return"bg-green-500/10 text-green-500";case"existing":return"bg-yellow-500/10 text-yellow-500";case"invalid":return"bg-red-500/10 text-red-500";case"empty":return"bg-gray-500/10 text-gray-500";default:return"bg-muted text-muted-foreground"}}function W(e){switch(e){case"new":return"New";case"existing":return"Exists";case"invalid":return"Invalid";case"empty":return"Empty";default:return e}}function $(e){switch(e){case"imported":case"would_import":return"bg-green-500/10 text-green-500";case"skipped":return"bg-yellow-500/10 text-yellow-500";case"failed":return"bg-red-500/10 text-red-500";default:return"bg-muted text-muted-foreground"}}function j(e){switch(e.status){case"imported":return"Imported";case"would_import":return"Would Import";case"skipped":switch(e.reason){case"empty_value":return"Skipped (empty)";case"exists":return"Skipped (exists)";default:return"Skipped"}case"failed":switch(e.reason){case"invalid_key":return"Failed (invalid)";case"exists":return"Failed (exists)";case"vault_error":return"Failed (error)";default:return"Failed"}default:return e.status}}return(e,r)=>(i(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:x(F,["self"])},[s("div",Ut,[s("div",{class:"flex items-center justify-between px-6 py-4 border-b border-border"},[r[13]||(r[13]=s("h2",{class:"text-lg font-semibold"},"Import .env File",-1)),s("button",{onClick:F,class:"p-1 rounded-md hover:bg-muted transition-colors"},[...r[12]||(r[12]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s("div",Gt,[1===p.value?(i(),t("div",Jt,[r[20]||(r[20]=s("div",null,[s("h3",{class:"font-medium mb-2"},"Upload or Paste .env Content"),s("p",{class:"text-sm text-muted-foreground mb-4"}," Select a .env file from your computer or paste the content directly. ")],-1)),s("div",{onDrop:P,onDragover:r[1]||(r[1]=x(()=>{},["prevent"])),onDragenter:[r[2]||(r[2]=x(()=>{},["prevent"])),r[4]||(r[4]=e=>y.value=!0)],onDragleave:r[3]||(r[3]=e=>y.value=!1),class:a(["border-2 border-dashed rounded-lg p-6 text-center transition-colors",y.value?"border-primary bg-primary/5":"border-border"])},[s("input",{type:"file",ref:"fileInput",onChange:B,accept:".env,.env.*",class:"hidden"},null,544),r[14]||(r[14]=s("svg",{class:"w-12 h-12 mx-auto mb-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),s("p",Yt,l(y.value?"Drop file here...":"Drag & drop your .env file here"),1),r[15]||(r[15]=s("p",{class:"text-xs text-muted-foreground mb-4"},"or",-1)),s("button",{onClick:r[0]||(r[0]=t=>e.$refs.fileInput.click()),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"}," Browse Files "),s("p",Xt,l(m.value||"Supports .env and .env.* files"),1)],34),r[21]||(r[21]=s("div",{class:"text-center text-muted-foreground text-sm"},"— OR —",-1)),s("div",null,[r[16]||(r[16]=s("label",{class:"block text-sm font-medium mb-2"},"Paste .env Content",-1)),k(s("textarea",{"onUpdate:modelValue":r[5]||(r[5]=e=>v.value=e),class:"w-full h-48 px-3 py-2 bg-input border border-border rounded-md text-sm font-mono focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"KEY1=value1\nKEY2=value2\nKEY3=value3"},null,512),[[S,v.value]])]),s("div",Qt,[r[19]||(r[19]=s("h4",{class:"text-sm font-medium"},"Filter Options (Optional)",-1)),s("div",Zt,[s("div",null,[r[17]||(r[17]=s("label",{class:"block text-xs text-muted-foreground mb-1"},"Only include keys matching",-1)),k(s("input",{"onUpdate:modelValue":r[6]||(r[6]=e=>b.value.only=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"e.g., DB_* or APP_*"},null,512),[[S,b.value.only]])]),s("div",null,[r[18]||(r[18]=s("label",{class:"block text-xs text-muted-foreground mb-1"},"Exclude keys matching",-1)),k(s("input",{"onUpdate:modelValue":r[7]||(r[7]=e=>b.value.except=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"e.g., MAIL_* or TEST_*"},null,512),[[S,b.value.except]])])])])])):2===p.value?(i(),t("div",ei,[s("div",null,[r[26]||(r[26]=s("h3",{class:"font-medium mb-2"},"Review Import",-1)),s("div",ti,[s("span",null,[s("span",ii,l(M.value.new),1),r[22]||(r[22]=C(" new ",-1))]),s("span",null,[s("span",si,l(M.value.existing),1),r[23]||(r[23]=C(" existing ",-1))]),s("span",null,[s("span",ni,l(M.value.invalid),1),r[24]||(r[24]=C(" invalid ",-1))]),s("span",null,[s("span",ri,l(M.value.empty),1),r[25]||(r[25]=C(" empty ",-1))])])]),M.value.existing>0?(i(),t("div",oi,[r[29]||(r[29]=s("h4",{class:"font-medium text-yellow-500 mb-3"},"Conflict Resolution",-1)),s("div",li,[s("label",ai,[k(s("input",{type:"radio","onUpdate:modelValue":r[8]||(r[8]=e=>A.value=e),value:"skip",class:"text-primary focus:ring-primary"},null,512),[[D,A.value]]),r[27]||(r[27]=s("span",{class:"text-sm"},"Skip existing secrets (keep current values)",-1))]),s("label",hi,[k(s("input",{type:"radio","onUpdate:modelValue":r[9]||(r[9]=e=>A.value=e),value:"overwrite",class:"text-primary focus:ring-primary"},null,512),[[D,A.value]]),r[28]||(r[28]=s("span",{class:"text-sm"},"Overwrite existing secrets (replace with new values)",-1))])])])):n("",!0),s("div",ci,[s("table",ui,[r[30]||(r[30]=s("thead",{class:"bg-muted"},[s("tr",null,[s("th",{class:"text-left px-4 py-2 font-medium"},"Key"),s("th",{class:"text-left px-4 py-2 font-medium"},"Value"),s("th",{class:"text-left px-4 py-2 font-medium"},"Status")])],-1)),s("tbody",di,[(i(!0),t(u,null,d(L.value,e=>(i(),t("tr",{key:e.key,class:a({"opacity-50":"empty"===e.status||"invalid"===e.status})},[s("td",fi,l(e.key),1),s("td",pi,l(e.value||"(empty)"),1),s("td",gi,[s("span",{class:a(["px-2 py-1 rounded text-xs font-medium",z(e.status)])},l(W(e.status)),3),e.error?(i(),t("span",mi,l(e.error),1)):n("",!0)])],2))),128))])])]),s("div",vi,[k(s("input",{type:"checkbox","onUpdate:modelValue":r[10]||(r[10]=e=>O.value=e),id:"dry-run",class:"rounded border-border"},null,512),[[E,O.value]]),r[31]||(r[31]=s("label",{for:"dry-run",class:"text-sm"}," Dry run (preview what would be imported without making changes) ",-1))])])):3===p.value?(i(),t("div",yi,[s("div",null,[s("h3",bi,"Import "+l(O.value?"Preview":"Complete"),1),s("div",wi,[s("span",null,[s("span",xi,l(R.value.imported),1),r[32]||(r[32]=C(" imported ",-1))]),s("span",null,[s("span",ki,l(R.value.skipped),1),r[33]||(r[33]=C(" skipped ",-1))]),s("span",null,[s("span",Si,l(R.value.failed),1),r[34]||(r[34]=C(" failed ",-1))])])]),O.value?(i(),t("div",Ci,[...r[35]||(r[35]=[s("p",{class:"text-sm text-blue-500"}," This was a dry run. No secrets were actually imported. ",-1)])])):n("",!0),R.value.errors&&R.value.errors.length>0?(i(),t("div",Mi,[r[36]||(r[36]=s("h4",{class:"font-medium text-red-500 mb-2"},"Errors",-1)),s("ul",Ai,[(i(!0),t(u,null,d(R.value.errors,(e,s)=>(i(),t("li",{key:s,class:"text-sm text-red-500"},l(e),1))),128))])])):n("",!0),s("div",Oi,[s("table",Ti,[r[37]||(r[37]=s("thead",{class:"bg-muted"},[s("tr",null,[s("th",{class:"text-left px-4 py-2 font-medium"},"Key"),s("th",{class:"text-left px-4 py-2 font-medium"},"Status"),s("th",{class:"text-left px-4 py-2 font-medium"},"Revision")])],-1)),s("tbody",Di,[(i(!0),t(u,null,d(R.value.results,(e,n)=>(i(),t("tr",{key:n},[s("td",Ei,l(n),1),s("td",Ri,[s("span",{class:a(["px-2 py-1 rounded text-xs font-medium",$(e.status)])},l(j(e)),3)]),s("td",Li,l(e.revision||"-"),1)]))),128))])])])])):n("",!0)]),s("div",Bi,[s("div",null,[2===p.value?(i(),t("button",{key:0,onClick:r[11]||(r[11]=e=>p.value--),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Back ")):n("",!0)]),s("div",Pi,[s("button",{onClick:F,class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"},l(3===p.value?"Close":"Cancel"),1),1===p.value?(i(),t("button",{key:0,onClick:I,disabled:!v.value||w.value,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium disabled:opacity-50"},l(w.value?"Analyzing...":"Next"),9,Ni)):2===p.value?(i(),t("button",{key:1,onClick:H,disabled:T.value,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium disabled:opacity-50"},l(T.value?"Importing...":O.value?"Preview Import":"Import"),9,Vi)):n("",!0)])])])]))}},Hi={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Fi={class:"space-y-4"},zi={class:"grid grid-cols-3 gap-2"},Wi=["onClick"],$i={class:"font-medium"},ji={class:"text-xs opacity-75 mt-1"},qi=["placeholder"],_i={class:"text-xs text-muted-foreground"},Ki={class:"font-medium"},Ui={class:"font-medium"},Gi={class:"font-medium"},Ji={class:"flex justify-end space-x-3 mt-6"},Yi=["disabled"],Xi={key:0},Qi={key:1},Zi={__name:"ExportModal",props:{vault:String,stage:String,secrets:{type:Array,default:()=>[]}},emits:["close"],setup(n,{emit:r}){const o=n,h=r,c=V(),f=g(!1),p=g("env"),m=g(""),v=[{value:"env",label:".env",description:"KEY=value"},{value:"json",label:"JSON",description:'{"key": "value"}'},{value:"csv",label:"CSV",description:"Spreadsheet"}],y=e(()=>o.secrets.length),b=e(()=>{const e=(new Date).toISOString().split("T")[0];return`${o.vault}-${o.stage}-${e}.${p.value}`});async function w(){f.value=!0;try{let e="";const t=m.value||b.value;switch(p.value){case"json":const t={};o.secrets.forEach(e=>{t[e.key]=e.value}),e=JSON.stringify(t,null,2);break;case"csv":e="Key,Value,Modified\n",o.secrets.forEach(t=>{const i=M(t.key),s=M(t.value),n=M(H(t.modified));e+=`${i},${s},${n}\n`});break;default:o.secrets.forEach(t=>{e+=`${t.key}=${function(e){"string"!=typeof e&&(e=String(e||""));if(e.includes("\n")||e.includes('"')||e.includes(" "))return`"${e.replace(/"/g,'\\"')}"`;return e}(t.value)}\n`})}const i=new Blob([e],{type:"text/plain;charset=utf-8"}),s=window.URL.createObjectURL(i),n=document.createElement("a");n.href=s,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s),c.success("Export Complete",`Secrets downloaded as ${t}`),h("close")}catch(e){console.error("Export failed:",e),c.error("Export Failed",e.message)}finally{f.value=!1}}function M(e){return"string"!=typeof e&&(e=String(e||"")),/[,"\n\r]/.test(e)?'"'+e.replace(/"/g,'""')+'"':e}return(e,r)=>(i(),t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:r[2]||(r[2]=x(t=>e.$emit("close"),["self"]))},[s("div",Hi,[r[8]||(r[8]=s("h2",{class:"text-lg font-semibold mb-4"},"Download Secrets",-1)),s("div",Fi,[s("div",null,[r[3]||(r[3]=s("label",{class:"block text-sm font-medium mb-2"},"Export Format",-1)),s("div",zi,[(i(),t(u,null,d(v,e=>s("button",{key:e.value,onClick:t=>p.value=e.value,class:a(["p-3 border rounded-md transition-colors",p.value===e.value?"border-primary bg-primary/10 text-primary":"border-border hover:bg-muted"])},[s("div",$i,l(e.label),1),s("div",ji,l(e.description),1)],10,Wi)),64))])]),s("div",null,[r[4]||(r[4]=s("label",{class:"block text-sm font-medium mb-1"},"Filename",-1)),k(s("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>m.value=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:b.value},null,8,qi),[[S,m.value]])]),s("div",_i,[s("div",null,[r[5]||(r[5]=C("Vault: ",-1)),s("span",Ki,l(n.vault),1)]),s("div",null,[r[6]||(r[6]=C("Stage: ",-1)),s("span",Ui,l(n.stage),1)]),s("div",null,[r[7]||(r[7]=C("Secrets: ",-1)),s("span",Gi,l(y.value),1)])])]),s("div",Ji,[s("button",{type:"button",onClick:r[1]||(r[1]=t=>e.$emit("close")),class:"px-4 py-2 text-sm font-medium border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),s("button",{onClick:w,disabled:f.value,class:"px-4 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50"},[f.value?(i(),t("span",Qi,"Preparing...")):(i(),t("span",Xi,"Download"))],8,Yi)])])]))}},es={class:"relative"},ts={class:"py-1"},is={__name:"TableActionsMenu",props:{vault:String,stage:String,secrets:{type:Array,default:()=>[]}},emits:["imported"],setup(e,{emit:o}){const l=o,a=g(!1),h=g(!1),c=g(!1);function u(){h.value=!1,l("imported")}function d(e){const t=e.target.closest("button"),i=e.target.closest(".absolute.right-0");t||i||(a.value=!1)}return w(a,e=>{e?setTimeout(()=>{document.addEventListener("click",d)},0):document.removeEventListener("click",d)}),R(()=>{document.removeEventListener("click",d)}),(o,l)=>(i(),t("div",es,[s("button",{onClick:l[0]||(l[0]=e=>(e.stopPropagation(),void(a.value=!a.value))),class:"p-2 rounded hover:bg-muted transition-colors",title:"Actions"},[...l[6]||(l[6]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})],-1)])]),a.value?(i(),t("div",{key:0,onClick:l[3]||(l[3]=x(()=>{},["stop"])),class:"absolute right-0 mt-2 w-48 bg-popover border border-border rounded-md shadow-lg z-20"},[s("div",ts,[s("button",{onClick:l[1]||(l[1]=e=>{h.value=!0,a.value=!1}),class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors flex items-center space-x-2"},[...l[7]||(l[7]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),s("span",null,"Import .env File",-1)])]),s("button",{onClick:l[2]||(l[2]=e=>{c.value=!0,a.value=!1}),class:"w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors flex items-center space-x-2"},[...l[8]||(l[8]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),s("span",null,"Download Secrets",-1)])])])])):n("",!0),h.value?(i(),r(Ii,{key:1,vault:e.vault,stage:e.stage,onImported:u,onClose:l[4]||(l[4]=e=>h.value=!1)},null,8,["vault","stage"])):n("",!0),c.value?(i(),r(Zi,{key:2,vault:e.vault,stage:e.stage,secrets:e.secrets,onClose:l[5]||(l[5]=e=>c.value=!1)},null,8,["vault","stage","secrets"])):n("",!0)]))}};function ss(){const t=g([]),i=g([]),s=g({}),n=g(!1),r=g(null),o=e(()=>{var e,i;return(null==(e=t.value.find(e=>e.isDefault))?void 0:e.slug)||(null==(i=t.value[0])?void 0:i.slug)||"vault"}),l=e(()=>s.value.default_stage||"prod");return{vaults:t,stages:i,settings:s,loading:n,error:r,defaultVault:o,defaultStage:l,loadVaults:async function(){n.value=!0,r.value=null;try{const e=await Ce.listVaults();t.value=e.vaults}catch(e){throw r.value=e.message,e}finally{n.value=!1}},loadStages:async function(){n.value=!0,r.value=null;try{const e=await Ce.listStages();i.value=e.stages}catch(e){throw r.value=e.message,e}finally{n.value=!1}},loadSettings:async function(){n.value=!0,r.value=null;try{s.value=await Ce.getSettings()}catch(e){throw r.value=e.message,e}finally{n.value=!1}},loadAll:async function(){n.value=!0,r.value=null;try{const[e,n,r]=await Promise.all([Ce.listVaults(),Ce.listStages(),Ce.getSettings()]);t.value=e.vaults,i.value=n.stages,s.value=r}catch(e){throw r.value=e.message,e}finally{n.value=!1}},verifyVaults:async function(){n.value=!0,r.value=null;try{return await Ce.verifyVaults()}catch(e){throw r.value=e.message,e}finally{n.value=!1}}}}const ns={class:"flex items-center justify-between mb-6"},rs={class:"flex items-center"},os={class:"flex space-x-3"},ls={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},as={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},hs={class:"relative"},cs={class:"border border-border rounded-lg"},us={class:"divide-y divide-border"},ds={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},fs={class:"px-6 py-4 text-sm"},ps={class:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground"},gs={class:"px-6 py-4 whitespace-nowrap text-right text-sm"},ms={key:0,class:"p-8 text-center text-muted-foreground"},vs={__name:"SecretsTable",emits:["refresh"],setup(o,{emit:c}){const p=V(),{vaults:y,stages:b,settings:x,loadAll:C}=ss(),{secrets:M,loading:A,loadSecrets:O,copySecretToStage:T}=Me(),{registerSearchHandler:D,registerModalCloseHandler:E,registerMaskToggleHandler:R}=J(),L=g(localStorage.getItem("keep.secrets.vault")||""),B=g(localStorage.getItem("keep.secrets.stage")||""),P=g(""),N=g(null),I=g(!1),F=g(new Set),z=g(!1),W=g(null),$=g(null),j=g(null),q=g(null),_=g(null),K=e(()=>{if(!P.value)return M.value;const e=P.value.toLowerCase();return M.value.filter(t=>{const i=t.key.toLowerCase().includes(e),s=t.value&&t.value.toLowerCase().includes(e);return i||s})});let U=null;async function G(){if(L.value&&B.value)try{await O(L.value,B.value,!0)}catch(e){console.error("Failed to load secrets:",e)}}function Y(e){W.value=e}async function X(){oe(),await G()}function Q(e){$.value=e}function Z(e){j.value=e}function ee(e){q.value=e}function te(e){_.value=e}function ie(e){p.success("Copied to clipboard","Secret value has been copied to your clipboard")}async function se(){_.value=null,await G()}async function ne(){$.value=null,await G()}async function re({targetVault:e,targetStage:t}){try{await T(j.value.key,t,e,j.value.stage,j.value.vault),p.success("Secret copied",`Secret '${j.value.key}' copied to ${e}:${t}`),j.value=null}catch(i){console.error("Failed to copy secret:",i),p.error("Failed to copy secret",i.message)}}function oe(){z.value=!1,W.value=null}return m(async()=>{await async function(){try{if(await C(),!L.value){const e=x.value.default_vault;e?(L.value=e,localStorage.setItem("keep.secrets.vault",L.value)):y.value.length>0&&(L.value=y.value[0].slug||y.value[0],localStorage.setItem("keep.secrets.vault",L.value))}!B.value&&b.value.length&&(B.value=b.value[0],localStorage.setItem("keep.secrets.stage",B.value))}catch(e){console.error("Failed to load vaults and stages:",e)}}(),await G(),D(()=>{N.value&&N.value.focus()}),U=E(()=>{z.value=!1,W.value=null,$.value=null,j.value=null,q.value=null,_.value=null}),R(()=>{I.value=!I.value})}),v(()=>{U&&U()}),w(()=>[L.value,B.value],()=>{L.value&&localStorage.setItem("keep.secrets.vault",L.value),B.value&&localStorage.setItem("keep.secrets.stage",B.value),G()}),(e,o)=>(i(),t("div",null,[s("div",ns,[s("div",rs,[h(ve,{vault:L.value,"onUpdate:vault":o[0]||(o[0]=e=>L.value=e),stage:B.value,"onUpdate:stage":o[1]||(o[1]=e=>B.value=e),vaults:f(y),stages:f(b)},null,8,["vault","stage","vaults","stages"])]),s("div",os,[s("button",{onClick:o[2]||(o[2]=e=>I.value=!I.value),class:"flex items-center space-x-2 px-3 py-1.5 text-sm border border-border rounded-md hover:bg-accent transition-colors"},[I.value?(i(),t("svg",as,[...o[10]||(o[10]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(i(),t("svg",ls,[...o[9]||(o[9]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))]),s("div",hs,[k(s("input",{ref_key:"searchInput",ref:N,"onUpdate:modelValue":o[3]||(o[3]=e=>P.value=e),type:"text",placeholder:"Search by secret key or value...",class:"w-64 px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[S,P.value]]),o[11]||(o[11]=s("svg",{class:"absolute right-3 top-2.5 w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),s("button",{onClick:o[4]||(o[4]=e=>z.value=!0),class:"flex items-center space-x-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"},[...o[12]||(o[12]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),s("span",null,"Add Secret",-1)])]),h(is,{vault:L.value,stage:B.value,secrets:K.value,onImported:G},null,8,["vault","stage","secrets"])])]),s("div",cs,[s("table",{class:a(["w-full",f(A)&&"opacity-50 pointer-events-none"])},[o[13]||(o[13]=s("thead",{class:"bg-muted"},[s("tr",null,[s("th",{class:"w-3/12 text-left px-6 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider rounded-tl-lg"},"Key"),s("th",{class:"w-6/12 text-left px-6 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Value"),s("th",{class:"w-2/12 text-left px-6 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider",title:"Times shown in your local timezone"},"Modified"),s("th",{class:"relative px-6 py-3 rounded-tr-lg"},[s("span",{class:"sr-only"},"Actions")])])],-1)),s("tbody",us,[(i(!0),t(u,null,d(K.value,e=>(i(),t("tr",{key:e.key,class:"transition-colors"},[s("td",ds,l(e.key),1),s("td",fs,[h(Se,{value:e.value,masked:!I.value&&!F.value.has(e.key),onToggle:t=>{return i=e.key,void(F.value.has(i)?F.value.delete(i):F.value.add(i));var i}},null,8,["value","masked","onToggle"])]),s("td",ps,l(f(H)(e.modified)),1),s("td",gs,[h(Kt,{secretKey:e.key,secretValue:e.value,vault:L.value,stage:B.value,onEdit:Y,onRename:Q,onCopyValue:ie,onCopyTo:Z,onHistory:ee,onDelete:te,onRefresh:G},null,8,["secretKey","secretValue","vault","stage"])])]))),128))])],2),f(A)||0!==K.value.length?n("",!0):(i(),t("div",ms," No secrets found "))]),z.value||W.value?(i(),r(He,{key:0,secret:W.value,vault:W.value?W.value.vault:L.value,stage:W.value?W.value.stage:B.value,onSuccess:X,onClose:oe},null,8,["secret","vault","stage"])):n("",!0),$.value?(i(),r(Ge,{key:1,currentKey:$.value.key,vault:L.value,stage:B.value,onSuccess:ne,onClose:o[5]||(o[5]=e=>$.value=null)},null,8,["currentKey","vault","stage"])):n("",!0),j.value?(i(),r(rt,{key:2,secretKey:j.value.key,currentVault:L.value,currentStage:B.value,vaults:f(y),stages:f(b),onCopy:re,onClose:o[6]||(o[6]=e=>j.value=null)},null,8,["secretKey","currentVault","currentStage","vaults","stages"])):n("",!0),q.value?(i(),r(Rt,{key:3,secretKey:q.value.key,vault:L.value,stage:B.value,onRefresh:G,onClose:o[7]||(o[7]=e=>q.value=null)},null,8,["secretKey","vault","stage"])):n("",!0),_.value?(i(),r(jt,{key:4,secretKey:_.value.key,vault:L.value,stage:B.value,onSuccess:se,onClose:o[8]||(o[8]=e=>_.value=null)},null,8,["secretKey","vault","stage"])):n("",!0)]))}},ys={class:"mb-6 flex justify-between"},bs={class:"flex items-center space-x-4"},ws={class:"relative"},xs={key:0,class:"absolute top-full left-0 mt-1 bg-popover border border-border rounded-md shadow-lg z-20"},ks={class:"p-2 space-y-1 max-h-96 overflow-y-auto",style:{"min-width":"max-content"}},Ss=["value"],Cs={class:"text-sm"},Ms={class:"flex space-x-2"},As={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Os={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ts={class:"relative"},Ds={key:0,class:"text-center py-12"},Es={key:1,class:"border border-border rounded-lg overflow-y-visible overflow-x-auto"},Rs={class:"w-full"},Ls={class:"bg-muted sticky top-0 z-10"},Bs={class:"flex flex-col"},Ps={class:"font-semibold"},Ns={class:"text-[10px] opacity-75"},Vs={class:"divide-y divide-border"},Is={class:"sticky left-0 z-10 border-r border-border p-0"},Hs={class:"bg-background"},Fs={class:"font-mono text-sm font-medium"},zs=["onClick","title"],Ws={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$s={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},js={key:0,class:"flex items-center justify-between"},qs={class:"font-mono text-sm"},_s={key:1,class:"flex items-center justify-between"},Ks={key:2,class:"text-center py-12 text-muted-foreground"},Us={key:3,class:"text-center py-12 text-muted-foreground"},Gs={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Js={class:"flex items-center justify-between mb-4"},Ys={class:"space-y-4"},Xs=["value"],Qs=["value"],Zs=["value","disabled"],en={class:"flex justify-end space-x-2 mt-6"},tn=["disabled"],sn={__name:"DiffView",setup(o){const c=V(),{vaults:p,stages:y,loadAll:b}=ss(),{copySecretToStage:C}=Me(),{registerSearchHandler:M,registerModalCloseHandler:O,registerMaskToggleHandler:T}=J(),D=g([]),R=g([]),L=g(null),B=g(!1),P=g(!1),N=g(new Set),H=g(!1),F=g(null),z=g(null),W=g(null),$=g(null),j=g(null),q=g(null),_=g(null),K=g(""),U=g(null),G=g(null),Y=g(""),X=g(null),Q=e(()=>D.value.map(e=>{const[t,i]=e.split(":"),s=p.value.find(e=>(e.slug||e.name||e)===t),n=(null==s?void 0:s.name)||(null==s?void 0:s.display)||t;return{vault:t,stage:i,vaultDisplay:n}}));w(D,e=>{localStorage.setItem("keep.diff.selections",JSON.stringify(e))},{deep:!0});const Z=e(()=>{if(!L.value)return{};if(0===D.value.length)return{};const e=Y.value.toLowerCase().trim(),t={};for(const[i,s]of Object.entries(L.value)){let n=!1;const r={};let o=!e||i.toLowerCase().includes(e);for(const[t,i]of Object.entries(s)){const s={};for(const[r,l]of Object.entries(i))D.value.includes(`${t}:${r}`)&&(s[r]=l,n=!0,!o&&e&&l&&(o=l.toLowerCase().includes(e)));Object.keys(s).length>0&&(r[t]=s)}n&&o&&(t[i]=r)}return t}),ee=e(()=>Object.keys(Z.value).sort((e,t)=>e.localeCompare(t)));function te(e,t=!0){const i=function(e){if(!Z.value[e])return"incomplete";const t=[];let i=Q.value.length,s=0;for(const n of Q.value){const i=re(e,n.vault,n.stage);null!=i&&(t.push(i),s++)}return s<i?"incomplete":1===new Set(t).size?"identical":"different"}(e);switch(i){case"incomplete":return"bg-red-500/10 "+(t?"hover:bg-red-500/15":"");case"identical":return"bg-green-500/10 "+(t?"hover:bg-green-500/15":"");case"different":return"bg-yellow-500/10 "+(t?"hover:bg-yellow-500/15":"");default:return"hover:bg-muted/50"}}let ie=null;function se(e){e.target.closest(".relative")||(H.value=!1),F.value&&!e.target.closest("[data-menu-key]")&&(F.value=null,z.value=null,W.value=null)}async function ne(){const e=p.value.map(e=>e.slug||e.name||e),t=[...y.value];B.value=!0;try{const i=await window.$api.getDiff(t,e);L.value=i.diff||{}}catch(i){console.error("Failed to load diff:",i),c.error("Failed to load comparison",i.message),L.value={}}finally{B.value=!1}}function re(e,t,i){return Z.value[e]&&Z.value[e][t]&&Z.value[e][t][i]||null}function oe(e,t,i){return re(e,t,i)?"":"bg-muted/30"}function le(e,t,i){const s=re(e,t,i);return s?P.value||N.value.has(e)?s:I(s,"•"):""}function ae(e){$.value={key:e.key,vault:e.vault,stage:e.stage,value:"",isNew:!0}}function he(e){$.value={key:e.key,vault:e.vault,stage:e.stage,value:e.value}}function ce(e){q.value={key:e.key,vault:e.vault,stage:e.stage,value:e.value}}function ue(e){U.value={key:e.key,vault:e.vault,stage:e.stage}}function de(e){G.value={key:e.key,vault:e.vault,stage:e.stage}}function fe(e){c.success("Copied to clipboard","Secret value has been copied to your clipboard")}async function pe(){await ne(),G.value=null}async function ge(){$.value=null,await ne()}async function me(){if(!_.value||!K.value)return;const[e,t]=K.value.split(":");try{await C(_.value.key,t,e,_.value.stage,_.value.vault),c.success("Secret copied",`Copied '${_.value.key}' to ${e}:${t}`),_.value=null,K.value="",await ne()}catch(i){c.error("Copy failed",i.message)}}function ve(){D.value=R.value.map(e=>e.key)}function ye(){D.value=[]}async function be({targetVault:e,targetStage:t}){try{await C(q.value.key,t,e,q.value.stage,q.value.vault),c.success("Secret copied",`Secret '${q.value.key}' copied to ${e}:${t}`),q.value=null,await ne()}catch(i){console.error("Failed to copy secret:",i),c.error("Failed to copy secret",i.message)}}async function we(){await ne(),j.value=null}return m(()=>{document.addEventListener("click",se),async function(){try{await b(),R.value=[];for(const e of p.value)for(const t of y.value){const i=e.slug||e.name||e;R.value.push({key:`${i}:${t}`,vault:i,vaultDisplay:e.display||e,stage:t})}const t=localStorage.getItem("keep.diff.selections");if(t)try{const e=JSON.parse(t);D.value=e.filter(e=>R.value.some(t=>t.key===e))}catch(e){D.value=R.value.map(e=>e.key)}else D.value=R.value.map(e=>e.key);await ne()}catch(t){console.error("Failed to load initial data:",t),c.error("Failed to load data",t.message)}}(),M(()=>{X.value&&X.value.focus()}),ie=O(()=>{$.value=null,j.value=null,_.value=null,U.value=null,G.value=null}),T(()=>{P.value=!P.value})}),v(()=>{document.removeEventListener("click",se),ie&&ie()}),(e,o)=>{var c,g,m;return i(),t("div",null,[s("div",ys,[s("div",bs,[s("div",ws,[s("button",{onClick:o[0]||(o[0]=e=>H.value=!H.value),class:"flex items-center space-x-2 px-3 py-2 bg-input border border-border rounded-md text-sm hover:bg-accent transition-colors"},[s("span",null,"Toggle Vaults / Stages ("+l(D.value.length)+"/"+l(R.value.length)+")",1),o[13]||(o[13]=s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),H.value?(i(),t("div",xs,[s("div",ks,[(i(!0),t(u,null,d(R.value,e=>(i(),t("label",{key:e.key,class:"flex items-center px-2 py-1.5 hover:bg-accent rounded cursor-pointer whitespace-nowrap"},[k(s("input",{type:"checkbox",value:e.key,"onUpdate:modelValue":o[1]||(o[1]=e=>D.value=e),class:"mr-3 rounded border-border bg-input text-primary focus:ring-2 focus:ring-ring"},null,8,Ss),[[E,D.value]]),s("span",Cs,[s("span",null,l(e.vaultDisplay)+" ("+l(e.vault)+")",1),o[14]||(o[14]=s("span",{class:"mx-2 text-muted-foreground"},"/",-1)),s("strong",null,l(e.stage),1)])]))),128))])])):n("",!0)]),s("div",{class:"flex items-center space-x-2 text-sm"},[s("button",{onClick:ve,class:"text-muted-foreground hover:text-foreground transition-colors"}," Select All "),o[15]||(o[15]=s("span",{class:"text-muted-foreground"},"|",-1)),s("button",{onClick:ye,class:"text-muted-foreground hover:text-foreground transition-colors"}," Clear All ")])]),s("div",Ms,[s("button",{onClick:o[2]||(o[2]=e=>P.value=!P.value),class:"flex items-center space-x-2 px-3 py-2 text-sm border border-border rounded-md hover:bg-accent transition-colors"},[P.value?(i(),t("svg",Os,[...o[17]||(o[17]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(i(),t("svg",As,[...o[16]||(o[16]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))]),s("div",Ts,[k(s("input",{ref_key:"searchInput",ref:X,"onUpdate:modelValue":o[3]||(o[3]=e=>Y.value=e),type:"text",placeholder:"Search by key or value...",class:"w-64 px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[S,Y.value]]),o[18]||(o[18]=s("svg",{class:"absolute right-3 top-2.5 w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])])]),B.value?(i(),t("div",Ds,[...o[19]||(o[19]=[s("div",{class:"inline-flex items-center space-x-2 text-muted-foreground"},[s("svg",{class:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),s("span",null,"Loading comparison matrix...")],-1)])])):Z.value&&Object.keys(Z.value).length>0?(i(),t("div",Es,[s("table",Rs,[s("thead",Ls,[s("tr",null,[o[20]||(o[20]=s("th",{class:"text-left px-4 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider sticky left-0 bg-muted z-20 min-w-[200px]"}," Secret Key ",-1)),(i(!0),t(u,null,d(Q.value,e=>(i(),t("th",{key:e,class:"px-4 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider text-center border-l border-border min-w-[80px]"},[s("div",Bs,[s("span",Ps,l(e.vault),1),s("span",Ns,l(e.stage),1)])]))),128))])]),s("tbody",Vs,[(i(!0),t(u,null,d(ee.value,e=>(i(),t("tr",{key:e,class:a([te(e),"transition-colors"])},[s("td",Is,[s("div",Hs,[s("div",{class:a(["px-4 py-3 flex items-center space-x-2",te(e,!1)])},[s("span",Fs,l(e),1),s("button",{onClick:t=>function(e){N.value.has(e)?N.value.delete(e):N.value.add(e)}(e),class:"p-1 rounded hover:bg-muted transition-colors",title:N.value.has(e)?"Hide values":"Show values"},[N.value.has(e)?(i(),t("svg",$s,[...o[22]||(o[22]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(i(),t("svg",Ws,[...o[21]||(o[21]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))],8,zs)],2)])]),(i(!0),t(u,null,d(Q.value,n=>(i(),t("td",{key:`${e}-${n.vault}-${n.stage}`,class:a(["px-4 py-3 text-left border-l border-border relative group",oe(e,n.vault,n.stage)])},[re(e,n.vault,n.stage)?(i(),t("div",js,[s("span",qs,l(le(e,n.vault,n.stage)),1),h(Kt,{secretKey:e,secretValue:re(e,n.vault,n.stage),vault:n.vault,stage:n.stage,showRename:!1,buttonClass:"opacity-0 group-hover:opacity-100",onEdit:he,onCopyValue:fe,onCopyTo:ce,onHistory:ue,onDelete:de,onRefresh:ne},null,8,["secretKey","secretValue","vault","stage"])])):(i(),t("div",_s,[o[23]||(o[23]=s("span",{class:"text-muted-foreground text-sm"},"—",-1)),h(Kt,{secretKey:e,secretValue:null,vault:n.vault,stage:n.stage,showEdit:!1,showRename:!1,showCreate:!0,showCopyValue:!1,showCopyTo:!1,showDelete:!1,showHistory:!1,buttonClass:"opacity-0 group-hover:opacity-100",onCreate:ae},null,8,["secretKey","vault","stage"])]))],2))),128))],2))),128))])])])):B.value||null===Z.value||0!==Object.keys(Z.value).length?B.value||0!==D.value.length?n("",!0):(i(),t("div",Us,[...o[25]||(o[25]=[s("svg",{class:"mx-auto h-12 w-12 mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),s("p",{class:"text-lg font-medium mb-2"},"Select Vault/Stage Combinations",-1),s("p",{class:"text-sm"},"Use the dropdown above to select at least one vault/stage combination",-1)])])):(i(),t("div",Ks,[...o[24]||(o[24]=[s("svg",{class:"mx-auto h-12 w-12 mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),s("p",null,"No secrets found in the selected vaults and stages",-1)])])),$.value?(i(),r(He,{key:4,secret:$.value.isNew?null:$.value,vault:$.value.vault,stage:$.value.stage,initialKey:$.value.isNew?$.value.key:void 0,onSuccess:ge,onClose:o[4]||(o[4]=e=>$.value=null)},null,8,["secret","vault","stage","initialKey"])):n("",!0),_.value?(i(),t("div",{key:5,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:o[8]||(o[8]=x(e=>_.value=null,["self"]))},[s("div",Gs,[s("div",Js,[o[27]||(o[27]=s("h2",{class:"text-lg font-semibold"},"Copy Secret",-1)),s("button",{onClick:o[5]||(o[5]=e=>_.value=null),class:"p-1 rounded-md hover:bg-muted transition-colors"},[...o[26]||(o[26]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s("div",Ys,[s("div",null,[o[28]||(o[28]=s("label",{class:"block text-sm font-medium mb-1"},"Key",-1)),s("input",{type:"text",value:null==(c=_.value)?void 0:c.key,disabled:"",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm opacity-50"},null,8,Xs)]),s("div",null,[o[29]||(o[29]=s("label",{class:"block text-sm font-medium mb-1"},"From",-1)),s("input",{type:"text",value:`${null==(g=_.value)?void 0:g.vault} / ${null==(m=_.value)?void 0:m.stage}`,disabled:"",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm opacity-50"},null,8,Qs)]),s("div",null,[o[31]||(o[31]=s("label",{class:"block text-sm font-medium mb-1"},"Copy To",-1)),k(s("select",{"onUpdate:modelValue":o[6]||(o[6]=e=>K.value=e),class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm"},[o[30]||(o[30]=s("option",{value:""},"Select destination...",-1)),(i(!0),t(u,null,d(R.value,e=>{var s,n;return i(),t("option",{key:e.key,value:e.key,disabled:e.key===`${null==(s=_.value)?void 0:s.vault}:${null==(n=_.value)?void 0:n.stage}`},l(e.vaultDisplay)+" / "+l(e.stage),9,Zs)}),128))],512),[[A,K.value]])])]),s("div",en,[s("button",{onClick:o[7]||(o[7]=e=>{_.value=null,K.value=""}),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),s("button",{onClick:me,disabled:!K.value,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed"}," Copy Secret ",8,tn)])])])):n("",!0),j.value?(i(),r(Ge,{key:6,currentKey:j.value.key,vault:j.value.vault,stage:j.value.stage,onSuccess:we,onClose:o[9]||(o[9]=e=>j.value=null)},null,8,["currentKey","vault","stage"])):n("",!0),q.value?(i(),r(rt,{key:7,secretKey:q.value.key,currentVault:q.value.vault,currentStage:q.value.stage,vaults:f(p),stages:f(y),onCopy:be,onClose:o[10]||(o[10]=e=>q.value=null)},null,8,["secretKey","currentVault","currentStage","vaults","stages"])):n("",!0),U.value?(i(),r(Rt,{key:8,secretKey:U.value.key,vault:U.value.vault,stage:U.value.stage,onRefresh:ne,onClose:o[11]||(o[11]=e=>U.value=null)},null,8,["secretKey","vault","stage"])):n("",!0),G.value?(i(),r(jt,{key:9,secretKey:G.value.key,vault:G.value.vault,stage:G.value.stage,onSuccess:pe,onClose:o[12]||(o[12]=e=>G.value=null)},null,8,["secretKey","vault","stage"])):n("",!0)])}}},nn={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},rn={class:"flex items-start space-x-3 mb-4"},on={class:"flex-1"},ln={class:"text-lg font-semibold mb-2"},an={class:"text-sm text-muted-foreground"},hn={class:"flex justify-end space-x-2 mt-6"},cn={__name:"DeleteConfirmationModal",props:{title:{type:String,default:"Confirm Deletion"},message:{type:String,required:!0},confirmText:{type:String,default:"Delete"}},emits:["confirm","cancel"],setup(e,{expose:o,emit:a}){const h=a,c=g(!1);function u(){h("confirm"),c.value=!1}function d(){h("cancel"),c.value=!1}return o({open:function(){c.value=!0},close:d}),(o,a)=>(i(),r(T,{to:"body"},[c.value?(i(),t("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:x(d,["self"])},[s("div",nn,[s("div",rn,[a[0]||(a[0]=s("div",{class:"flex-shrink-0 w-10 h-10 rounded-full bg-destructive/10 flex items-center justify-center"},[s("svg",{class:"w-5 h-5 text-destructive",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),s("div",on,[s("h3",ln,l(e.title),1),s("p",an,l(e.message),1)])]),s("div",hn,[s("button",{onClick:d,class:"px-4 py-2 border border-border rounded-md hover:bg-muted transition-colors text-sm font-medium"}," Cancel "),s("button",{onClick:u,class:"px-4 py-2 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors text-sm font-medium"},l(e.confirmText),1)])])])):n("",!0)]))}},un={class:"flex gap-6 mx-auto max-w-5xl"},dn={class:"w-48 flex-shrink-0"},fn={class:"space-y-1"},pn=["onClick"],gn={class:"flex-1"},mn={key:0,class:"space-y-6"},vn={class:"border border-border rounded-lg p-6 space-y-4"},yn=["value"],bn={class:"border border-border rounded-lg p-4 space-y-2 text-sm"},wn={class:"flex items-center justify-between"},xn={class:"font-mono"},kn={class:"flex items-center justify-between"},Sn={class:"font-mono"},Cn={key:1,class:"space-y-6"},Mn={class:"space-y-3"},An={class:"flex items-start justify-between"},On={class:"flex-1"},Tn={class:"flex items-center space-x-3 mb-2"},Dn={class:"font-medium"},En={key:0,class:"px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full"},Rn={class:"space-y-1 text-sm text-muted-foreground"},Ln={class:"font-mono"},Bn={class:"font-mono"},Pn={key:0},Nn={class:"font-mono"},Vn={class:"flex items-center space-x-2"},In=["onClick"],Hn=["onClick"],Fn={class:"flex justify-between items-center pt-4"},zn=["disabled"],Wn={key:2,class:"space-y-6"},$n={class:"border border-border rounded-lg p-4"},jn={class:"space-y-2"},qn={class:"font-medium"},_n=["onClick"],Kn={class:"flex items-center space-x-2 mt-4 pt-4 border-t border-border"},Un=["disabled"],Gn={class:"bg-card border border-border rounded-lg p-6 w-full max-w-md"},Jn={class:"text-lg font-semibold mb-4"},Yn={class:"space-y-4"},Xn=["disabled"],Qn={class:"text-xs text-muted-foreground mt-1"},Zn={key:0},er=["placeholder"],tr={key:1},ir=["placeholder","disabled"],sr={class:"text-xs text-muted-foreground mt-1"},nr={key:2},rr={key:3,class:"flex items-center space-x-2"},or={class:"flex justify-end space-x-2 mt-6"},lr={class:"bg-card border border-border rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto"},ar={class:"flex items-center justify-between mb-4"},hr={key:0,class:"space-y-4"},cr={class:"flex items-center justify-between mb-3"},ur={class:"font-medium"},dr={key:0,class:"grid grid-cols-5 gap-2 text-sm"},fr={key:0,class:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},pr={key:1,class:"w-4 h-4 text-destructive",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},gr={key:1,class:"text-sm text-destructive mt-2"},mr={key:1,class:"text-center py-8 text-muted-foreground"},vr={class:"flex justify-end mt-6"},yr={__name:"SettingsView",setup(r){const o=V(),c=[{id:"general",label:"General"},{id:"vaults",label:"Vaults"},{id:"stages",label:"Stages"}],f=g("general"),p=g({appName:"",namespace:"",defaultVault:"",templatePath:""}),v=g("1.0.0-beta"),y=g([]),b=g(!1),w=g(null),O=g({name:"",slug:"",driver:"",scope:"",isDefault:!1}),T=g(!1),D=g(!1),R=g(null),L=g(null),B=g(null),P=g([]),N=g(""),I=g(""),H=g(null),F=e(()=>"undefined"!=typeof window?window.location.origin:"");function z(e){const t=y.value.find(t=>t.slug===e);return t?`${t.name} (${t.slug})`:e}function W(e){return{secretsmanager:{name:"AWS Secrets Manager",slug:"aws-secrets"},ssm:{name:"AWS SSM Parameter Store",slug:"aws-ssm"},test:{name:"Test Vault",slug:"test"}}[e]||{name:"",slug:""}}function $(){if(!w.value&&O.value.driver){const e=W(O.value.driver);O.value.name||(O.value.name=e.name),O.value.slug||(O.value.slug=e.slug)}}async function j(){try{await window.$api.updateSettings({app_name:p.value.appName,namespace:p.value.namespace,default_vault:p.value.defaultVault,template_path:p.value.templatePath}),o.success("Settings saved","Your changes have been saved successfully")}catch(e){o.error("Failed to save settings",e.message)}}async function q(){if(L.value)try{await window.$api.deleteVault(L.value.slug),y.value=y.value.filter(e=>e.slug!==L.value.slug),o.success("Vault deleted",`Vault "${L.value.name}" has been deleted`)}catch(e){o.error("Failed to delete vault",e.message)}finally{L.value=null}}function _(){b.value=!1,w.value=null,O.value={name:"",slug:"",driver:"",scope:"",isDefault:!1}}async function K(){try{if(w.value){await window.$api.updateVault(w.value.slug,O.value);const e=y.value.findIndex(e=>e.slug===w.value.slug);-1!==e&&(y.value[e]={...O.value}),o.success("Vault updated",`Vault "${O.value.name}" has been updated`)}else await window.$api.addVault(O.value),y.value.push({...O.value}),o.success("Vault added",`Vault "${O.value.name}" has been added`);_()}catch(e){o.error("Failed to save vault",e.message)}}async function U(){T.value=!0,D.value=!0,R.value=null;try{const e=(await window.$api.verifyVaults()).results||{};R.value=e;const t=Object.entries(e).filter(([e,t])=>!t.success);0===t.length?o.success("All vaults verified","All vaults are properly configured and accessible"):o.error("Verification failed",`${t.length} vault(s) failed verification`)}catch(e){o.error("Failed to verify vaults",e.message),D.value=!1}finally{T.value=!1}}async function G(){if(N.value)if(P.value.includes(N.value))o.error("Stage exists",`Stage "${N.value}" already exists`);else try{await window.$api.addStage(N.value),P.value.push(N.value),o.success("Stage added",`Stage "${N.value}" has been added`),N.value=""}catch(e){o.error("Failed to add stage",e.message)}}async function J(){if(I.value)try{await window.$api.removeStage(I.value);const e=P.value.indexOf(I.value);e>-1&&(P.value.splice(e,1),o.success("Stage removed",`Stage "${I.value}" has been removed`))}catch(e){o.error("Failed to remove stage",e.message)}finally{I.value=""}}return m(async()=>{await async function(){try{const e=await window.$api.getSettings();p.value.appName=e.app_name||"MyApp",p.value.namespace=e.namespace||"",p.value.defaultVault=e.default_vault||"",p.value.templatePath=e.template_path||"env",v.value=e.keep_version||"1.0.0-beta"}catch(e){console.error("Failed to load settings:",e),o.error("Failed to load settings",e.message)}}(),await async function(){try{const e=await window.$api.listVaults();y.value=e.vaults||[]}catch(e){console.error("Failed to load vaults:",e),o.error("Failed to load vaults",e.message)}}(),await async function(){try{const e=await window.$api.listStages();P.value=e.stages||[]}catch(e){console.error("Failed to load stages:",e),o.error("Failed to load stages",e.message)}}()}),(e,r)=>{var o;return i(),t(u,null,[s("div",un,[s("div",dn,[s("div",fn,[(i(),t(u,null,d(c,e=>s("button",{key:e.id,onClick:t=>f.value=e.id,class:a(["w-full px-4 py-2 rounded-md text-sm font-medium transition-colors text-left",f.value===e.id?"bg-muted text-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted/50"])},l(e.label),11,pn)),64))])]),s("div",gn,["general"===f.value?(i(),t("div",mn,[r[27]||(r[27]=s("div",null,[s("h1",{class:"text-2xl font-semibold mb-2"},"General Settings"),s("p",{class:"text-sm text-muted-foreground"},"Configure your Keep application settings")],-1)),s("div",vn,[s("div",null,[r[14]||(r[14]=s("label",{class:"block text-sm font-medium mb-2"},"Application Name",-1)),k(s("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>p.value.appName=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"MyApp"},null,512),[[S,p.value.appName]]),r[15]||(r[15]=s("p",{class:"text-xs text-muted-foreground mt-1"},"The name of your application",-1))]),s("div",null,[r[16]||(r[16]=s("label",{class:"block text-sm font-medium mb-2"},"Namespace",-1)),k(s("input",{"onUpdate:modelValue":r[1]||(r[1]=e=>p.value.namespace=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"my-app"},null,512),[[S,p.value.namespace]]),r[17]||(r[17]=s("p",{class:"text-xs text-muted-foreground mt-1"},"All secrets will be organized under this namespace",-1))]),s("div",null,[r[19]||(r[19]=s("label",{class:"block text-sm font-medium mb-2"},"Default Vault",-1)),k(s("select",{"onUpdate:modelValue":r[2]||(r[2]=e=>p.value.defaultVault=e),class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},[r[18]||(r[18]=s("option",{value:""},"Select default vault...",-1)),(i(!0),t(u,null,d(y.value,e=>(i(),t("option",{key:e.slug,value:e.slug},l(e.name),9,yn))),128))],512),[[A,p.value.defaultVault]]),r[20]||(r[20]=s("p",{class:"text-xs text-muted-foreground mt-1"},"The default vault to use when none is specified",-1))]),s("div",null,[r[21]||(r[21]=s("label",{class:"block text-sm font-medium mb-2"},"Template Directory",-1)),k(s("input",{"onUpdate:modelValue":r[3]||(r[3]=e=>p.value.templatePath=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"env"},null,512),[[S,p.value.templatePath]]),r[22]||(r[22]=s("p",{class:"text-xs text-muted-foreground mt-1"},"Directory where .env template files are stored",-1))]),s("div",{class:"pt-4 flex justify-end"},[s("button",{onClick:j,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"}," Save Changes ")])]),s("div",null,[r[26]||(r[26]=s("h2",{class:"text-lg font-medium mb-4"},"Server Information",-1)),s("div",bn,[s("div",wn,[r[23]||(r[23]=s("span",{class:"text-muted-foreground"},"Server URL",-1)),s("span",xn,l(F.value),1)]),s("div",kn,[r[24]||(r[24]=s("span",{class:"text-muted-foreground"},"Keep Version",-1)),s("span",Sn,l(v.value),1)]),r[25]||(r[25]=s("div",{class:"flex items-center justify-between"},[s("span",{class:"text-muted-foreground"},"Authentication"),s("span",{class:"text-green-500"},"Token Active")],-1))])])])):n("",!0),"vaults"===f.value?(i(),t("div",Cn,[r[33]||(r[33]=s("div",null,[s("h1",{class:"text-2xl font-semibold mb-2"},"Vault Configuration"),s("p",{class:"text-sm text-muted-foreground"},"Manage your vault connections and settings")],-1)),s("div",Mn,[(i(!0),t(u,null,d(y.value,e=>(i(),t("div",{key:e.slug,class:"border border-border rounded-lg p-4"},[s("div",An,[s("div",On,[s("div",Tn,[s("h3",Dn,l(e.name),1),e.isDefault?(i(),t("span",En," Default ")):n("",!0)]),s("div",Rn,[s("p",null,[r[28]||(r[28]=C("Driver: ",-1)),s("span",Ln,l(e.driver),1)]),s("p",null,[r[29]||(r[29]=C("Slug: ",-1)),s("span",Bn,l(e.slug),1)]),e.scope?(i(),t("p",Pn,[r[30]||(r[30]=C("Scope: ",-1)),s("span",Nn,l(e.scope),1)])):n("",!0)])]),s("div",Vn,[s("button",{onClick:t=>function(e){w.value=e,O.value={name:e.name,slug:e.slug,driver:e.driver,scope:e.scope||"",isDefault:e.isDefault||!1},b.value=!0}(e),class:"p-2 rounded-md hover:bg-muted transition-colors"},[...r[31]||(r[31]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,In),s("button",{onClick:t=>function(e){L.value=e,B.value.open()}(e),class:"p-2 rounded-md hover:bg-muted transition-colors text-destructive"},[...r[32]||(r[32]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Hn)])])]))),128))]),s("div",Fn,[s("button",{onClick:r[4]||(r[4]=e=>(w.value=null,O.value={name:"",slug:"",driver:"",scope:"",isDefault:!1},void(b.value=!0))),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"}," Add New Vault "),s("button",{onClick:U,disabled:T.value,class:"px-4 py-2 border border-border rounded-md hover:bg-muted transition-colors text-sm font-medium disabled:opacity-50"},l(T.value?"Verifying...":"Verify All Vaults"),9,zn)])])):n("",!0),"stages"===f.value?(i(),t("div",Wn,[r[35]||(r[35]=s("div",null,[s("h1",{class:"text-2xl font-semibold mb-2"},"Stage Configuration"),s("p",{class:"text-sm text-muted-foreground"},"Manage your deployment stages and environments")],-1)),s("div",$n,[s("div",jn,[(i(!0),t(u,null,d(P.value,e=>(i(),t("div",{key:e,class:"flex items-center justify-between py-3 border-b border-border last:border-0"},[s("span",qn,l(e),1),s("button",{onClick:t=>function(e){I.value=e,H.value.open()}(e),class:"p-2 rounded-md hover:bg-muted transition-colors text-destructive"},[...r[34]||(r[34]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,_n)]))),128))]),s("div",Kn,[k(s("input",{"onUpdate:modelValue":r[5]||(r[5]=e=>N.value=e),onKeyup:M(G,["enter"]),type:"text",placeholder:"Enter new stage name...",class:"flex-1 px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring"},null,544),[[S,N.value]]),s("button",{onClick:G,disabled:!N.value,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium disabled:opacity-50"}," Add Stage ",8,Un)])]),r[36]||(r[36]=s("div",{class:"bg-muted/30 rounded-lg p-4 text-sm text-muted-foreground"},[s("p",{class:"font-medium mb-1"},"About Stages"),s("p",null,"Stages represent different deployment environments for your secrets. Common stages include development, staging, and production. System stages (local, staging, production) cannot be removed.")],-1))])):n("",!0)])]),b.value?(i(),t("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:x(_,["self"])},[s("div",Gn,[s("h2",Jn,l(w.value?"Edit Vault":"Add New Vault"),1),s("div",Yn,[s("div",null,[r[38]||(r[38]=s("label",{class:"block text-sm font-medium mb-1"},"Driver",-1)),k(s("select",{"onUpdate:modelValue":r[6]||(r[6]=e=>O.value.driver=e),onChange:$,class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",disabled:!!w.value},[...r[37]||(r[37]=[s("option",{value:""},"Select driver...",-1),s("option",{value:"secretsmanager"},"AWS Secrets Manager",-1),s("option",{value:"ssm"},"AWS SSM Parameter Store",-1),s("option",{value:"test"},"Test Vault",-1)])],40,Xn),[[A,O.value.driver]]),s("p",Qn,l(w.value?"Driver cannot be changed after creation":"Select the backend vault type"),1)]),O.value.driver||w.value?(i(),t("div",Zn,[r[39]||(r[39]=s("label",{class:"block text-sm font-medium mb-1"},"Name",-1)),k(s("input",{"onUpdate:modelValue":r[7]||(r[7]=e=>O.value.name=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:W(O.value.driver).name},null,8,er),[[S,O.value.name]]),r[40]||(r[40]=s("p",{class:"text-xs text-muted-foreground mt-1"},"Friendly display name for this vault",-1))])):n("",!0),O.value.driver||w.value?(i(),t("div",tr,[r[41]||(r[41]=s("label",{class:"block text-sm font-medium mb-1"},"Slug",-1)),k(s("input",{"onUpdate:modelValue":r[8]||(r[8]=e=>O.value.slug=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:W(O.value.driver).slug,disabled:!!w.value},null,8,ir),[[S,O.value.slug]]),s("p",sr,l(w.value?"Slug cannot be changed after creation":"Unique identifier for this vault"),1)])):n("",!0),"ssm"===O.value.driver||"secretsmanager"===O.value.driver||w.value&&["ssm","secretsmanager"].includes(w.value.driver)?(i(),t("div",nr,[r[42]||(r[42]=s("label",{class:"block text-sm font-medium mb-1"},"Scope (optional)",-1)),k(s("input",{"onUpdate:modelValue":r[9]||(r[9]=e=>O.value.scope=e),type:"text",class:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"app2"},null,512),[[S,O.value.scope]]),r[43]||(r[43]=s("p",{class:"text-xs text-muted-foreground mt-1"},"Optional scope to isolate secrets within your namespace.",-1))])):n("",!0),O.value.driver||w.value?(i(),t("div",rr,[k(s("input",{"onUpdate:modelValue":r[10]||(r[10]=e=>O.value.isDefault=e),type:"checkbox",id:"vault-default",class:"rounded border-border"},null,512),[[E,O.value.isDefault]]),r[44]||(r[44]=s("label",{for:"vault-default",class:"text-sm"},"Set as default vault",-1))])):n("",!0)]),s("div",or,[s("button",{onClick:_,class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),s("button",{onClick:K,class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"},l(w.value?"Save Changes":"Add Vault"),1)])])])):n("",!0),D.value?(i(),t("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:r[13]||(r[13]=x(e=>D.value=!1,["self"]))},[s("div",lr,[s("div",ar,[r[46]||(r[46]=s("h2",{class:"text-lg font-semibold"},"Vault Verification Results",-1)),s("button",{onClick:r[11]||(r[11]=e=>D.value=!1),class:"p-1 rounded-md hover:bg-muted transition-colors"},[...r[45]||(r[45]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),R.value?(i(),t("div",hr,[(i(!0),t(u,null,d(R.value,(e,o)=>(i(),t("div",{key:o,class:"border border-border rounded-lg p-4"},[s("div",cr,[s("h3",ur,l(z(o)),1),s("span",{class:a(["px-2 py-1 rounded text-xs font-medium",e.success?"bg-green-500/10 text-green-500":"bg-destructive/10 text-destructive"])},l(e.success?"Connected":"Failed"),3)]),e.success&&e.permissions?(i(),t("div",dr,[(i(!0),t(u,null,d(e.permissions,(e,n)=>(i(),t("div",{key:n,class:"flex items-center space-x-2"},[e?(i(),t("svg",fr,[...r[47]||(r[47]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(i(),t("svg",pr,[...r[48]||(r[48]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])])),s("span",{class:a(e?"text-muted-foreground":"text-destructive")},l(n),3)]))),128))])):e.error?(i(),t("div",gr,l(e.error),1)):n("",!0)]))),128))])):(i(),t("div",mr,[...r[49]||(r[49]=[s("div",{class:"animate-spin h-8 w-8 border-2 border-primary border-t-transparent rounded-full mx-auto mb-4"},null,-1),C(" Verifying vaults... ",-1)])])),s("div",vr,[s("button",{onClick:r[12]||(r[12]=e=>D.value=!1),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"}," Close ")])])])):n("",!0),h(cn,{ref_key:"deleteStageModal",ref:H,title:"Delete Stage",message:`Are you sure you want to remove the stage '${I.value}'?`,confirmText:"Remove Stage",onConfirm:J},null,8,["message"]),h(cn,{ref_key:"deleteVaultModal",ref:B,title:"Delete Vault",message:`Are you sure you want to delete the vault '${null==(o=L.value)?void 0:o.name}'?`,confirmText:"Delete Vault",onConfirm:q},null,8,["message"])],64)}}},br={class:"fixed inset-0 z-50 overflow-y-auto"},wr={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0"},xr={class:"relative inline-block w-full max-w-2xl px-6 py-5 overflow-hidden text-left align-middle transition-all transform bg-background rounded-lg shadow-xl"},kr={class:"flex items-center justify-between mb-4"},Sr={class:"space-y-4"},Cr=["value"],Mr={key:0,class:"bg-red-500/5 border border-red-500/20 rounded-md p-3"},Ar={class:"flex items-center gap-2"},Or={class:"text-sm text-muted-foreground"},Tr={key:1,class:"space-y-2"},Dr={class:"relative"},Er={class:"bg-muted/50 rounded-md p-3 text-sm font-mono overflow-x-auto max-h-64 overflow-y-auto"},Rr={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Lr={key:1,class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Br={key:2,class:"bg-destructive/10 border border-destructive/20 rounded-md p-3"},Pr={class:"flex items-center gap-2"},Nr={class:"text-sm"},Vr={class:"flex justify-end gap-3 mt-6"},Ir=["disabled"],Hr=["disabled"],Fr={__name:"CreateTemplateModal",emits:["close","created"],setup(e,{emit:r}){const o=r,{showToast:a}=V(),h=g([]),c=g(""),f=g(""),p=g(""),v=g(!1),y=g(!1),b=g(!1),x=g(!1);async function S(){if(c.value)try{const e=(await window.$api.get("/templates")).templates||[];b.value=e.some(e=>e.stage===c.value),b.value&&(f.value="",p.value="")}catch(e){console.error("Failed to check existing templates:",e)}else b.value=!1}async function C(){if(c.value){p.value="",v.value=!0;try{const e=await window.$api.post("/templates/generate",{stage:c.value,vaults:[]});f.value=e.content||""}catch(e){p.value=e.message||"Failed to generate template preview",f.value=""}finally{v.value=!1}}else p.value="Please select a stage"}async function M(){if(c.value&&f.value){p.value="",y.value=!0;try{const e=await window.$api.post("/templates/create",{stage:c.value,vaults:[]});a(`Template created: ${e.filename}`,"success"),o("created",e)}catch(e){p.value=e.message||"Failed to create template"}finally{y.value=!1}}}async function O(){try{await navigator.clipboard.writeText(f.value),x.value=!0,setTimeout(()=>{x.value=!1},2e3)}catch(e){a("Failed to copy to clipboard","error")}}return m(async()=>{await async function(){try{const e=await window.$api.getSettings();h.value=e.stages||[]}catch(e){p.value="Failed to load stages",console.error("Failed to load stages:",e)}}()}),w(c,()=>{f.value="",p.value=""}),(e,r)=>(i(),t("div",br,[s("div",wr,[r[12]||(r[12]=s("div",{class:"fixed inset-0 transition-opacity"},[s("div",{class:"absolute inset-0 bg-black opacity-75"})],-1)),s("div",xr,[s("div",kr,[r[4]||(r[4]=s("h2",{class:"text-xl font-semibold"},"Add Template",-1)),s("button",{onClick:r[0]||(r[0]=t=>e.$emit("close")),class:"p-1 rounded hover:bg-muted transition-colors"},[...r[3]||(r[3]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s("div",Sr,[s("div",null,[k(s("select",{"onUpdate:modelValue":r[1]||(r[1]=e=>c.value=e),onChange:S,class:"w-full px-3 py-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-primary focus:border-transparent text-sm"},[r[5]||(r[5]=s("option",{value:""},"Select a stage",-1)),(i(!0),t(u,null,d(h.value,e=>(i(),t("option",{key:e,value:e},l(e),9,Cr))),128))],544),[[A,c.value]])]),b.value?(i(),t("div",Mr,[s("div",Ar,[r[7]||(r[7]=s("svg",{class:"w-5 h-5 text-red-500/80 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s("div",null,[r[6]||(r[6]=s("p",{class:"text-sm font-medium"},"Template already exists",-1)),s("p",Or,l(c.value)+".env already exists. You can edit it from the templates list.",1)])])])):n("",!0),f.value&&!b.value?(i(),t("div",Tr,[r[10]||(r[10]=s("label",{class:"block text-sm font-medium"},"Preview",-1)),s("div",Dr,[s("pre",Er,l(f.value),1),f.value?(i(),t("button",{key:0,onClick:O,class:"absolute top-2 right-2 p-1.5 bg-background border border-border rounded hover:bg-muted transition-colors",title:"Copy to clipboard"},[x.value?(i(),t("svg",Lr,[...r[9]||(r[9]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(i(),t("svg",Rr,[...r[8]||(r[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"},null,-1)])]))])):n("",!0)])])):n("",!0),p.value?(i(),t("div",Br,[s("div",Pr,[r[11]||(r[11]=s("svg",{class:"w-5 h-5 text-destructive flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s("p",Nr,l(p.value),1)])])):n("",!0)]),s("div",Vr,[s("button",{onClick:r[2]||(r[2]=t=>e.$emit("close")),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),f.value||!c.value||b.value?n("",!0):(i(),t("button",{key:0,onClick:C,disabled:v.value,class:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50"},l(v.value?"Generating...":"Generate Preview"),9,Ir)),f.value&&!b.value?(i(),t("button",{key:1,onClick:M,disabled:y.value,class:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50"},l(y.value?"Adding...":"Add Template"),9,Hr)):n("",!0)])])])]))}};let zr=[],Wr=[];function $r(e){if(e<768)return!1;for(let t=0,i=zr.length;;){let s=t+i>>1;if(e<zr[s])i=s;else{if(!(e>=Wr[s]))return!0;t=s+1}if(t==i)return!1}}function jr(e){return e>=127462&&e<=127487}(()=>{let e="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let t=0,i=0;t<e.length;t++)(t%2?Wr:zr).push(i+=e[t])})();function qr(e,t,i=!0,s=!0){return(i?_r:Kr)(e,t,s)}function _r(e,t,i){if(t==e.length)return t;t&&Gr(e.charCodeAt(t))&&Jr(e.charCodeAt(t-1))&&t--;let s=Ur(e,t);for(t+=Yr(s);t<e.length;){let n=Ur(e,t);if(8205==s||8205==n||i&&$r(n))t+=Yr(n),s=n;else{if(!jr(n))break;{let i=0,s=t-2;for(;s>=0&&jr(Ur(e,s));)i++,s-=2;if(i%2==0)break;t+=2}}}return t}function Kr(e,t,i){for(;t>0;){let s=_r(e,t-2,i);if(s<t)return s;t--}return 0}function Ur(e,t){let i=e.charCodeAt(t);if(!Jr(i)||t+1==e.length)return i;let s=e.charCodeAt(t+1);return Gr(s)?s-56320+(i-55296<<10)+65536:i}function Gr(e){return e>=56320&&e<57344}function Jr(e){return e>=55296&&e<56320}function Yr(e){return e<65536?1:2}let Xr=class e{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){[e,t]=oo(this,e,t);let s=[];return this.decompose(0,e,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(t,this.length,s,1),Zr.from(s,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=oo(this,e,t);let i=[];return this.decompose(e,t,i,0),Zr.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),s=new io(this),n=new io(e);for(let r=t,o=t;;){if(s.next(r),n.next(r),r=0,s.lineBreak!=n.lineBreak||s.done!=n.done||s.value!=n.value)return!1;if(o+=s.value.length,s.done||o>=i)return!0}}iter(e=1){return new io(this,e)}iterRange(e,t=this.length){return new so(this,e,t)}iterLines(e,t){let i;if(null==e)i=this.iter();else{null==t&&(t=this.lines+1);let s=this.line(e).from;i=this.iterRange(s,Math.max(s,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new no(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(t){if(0==t.length)throw new RangeError("A document must have at least one line");return 1!=t.length||t[0]?t.length<=32?new Qr(t):Zr.from(Qr.split(t,[])):e.empty}},Qr=class e extends Xr{constructor(e,t=function(e){let t=-1;for(let i of e)t+=i.length+1;return t}(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,s){for(let n=0;;n++){let r=this.text[n],o=s+r.length;if((t?i:o)>=e)return new ro(s,o,i,r);s=o+1,i++}}decompose(t,i,s,n){let r=t<=0&&i>=this.length?this:new e(to(this.text,t,i),Math.min(i,this.length)-Math.max(0,t));if(1&n){let t=s.pop(),i=eo(r.text,t.text.slice(),0,r.length);if(i.length<=32)s.push(new e(i,t.length+r.length));else{let t=i.length>>1;s.push(new e(i.slice(0,t)),new e(i.slice(t)))}}else s.push(r)}replace(t,i,s){if(!(s instanceof e))return super.replace(t,i,s);[t,i]=oo(this,t,i);let n=eo(this.text,eo(s.text,to(this.text,0,t)),i),r=this.length+s.length-(i-t);return n.length<=32?new e(n,r):Zr.from(e.split(n,[]),r)}sliceString(e,t=this.length,i="\n"){[e,t]=oo(this,e,t);let s="";for(let n=0,r=0;n<=t&&r<this.text.length;r++){let o=this.text[r],l=n+o.length;n>e&&r&&(s+=i),e<l&&t>n&&(s+=o.slice(Math.max(0,e-n),t-n)),n=l+1}return s}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(t,i){let s=[],n=-1;for(let r of t)s.push(r),n+=r.length+1,32==s.length&&(i.push(new e(s,n)),s=[],n=-1);return n>-1&&i.push(new e(s,n)),i}},Zr=class e extends Xr{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,s){for(let n=0;;n++){let r=this.children[n],o=s+r.length,l=i+r.lines-1;if((t?l:o)>=e)return r.lineInner(e,t,i,s);s=o+1,i=l+1}}decompose(e,t,i,s){for(let n=0,r=0;r<=t&&n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(e<=l&&t>=r){let n=s&((r<=e?1:0)|(l>=t?2:0));r>=e&&l<=t&&!n?i.push(o):o.decompose(e-r,t-r,i,n)}r=l+1}}replace(t,i,s){if([t,i]=oo(this,t,i),s.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(t>=r&&i<=l){let a=o.replace(t-r,i-r,s),h=this.lines-o.lines+a.lines;if(a.lines<h>>4&&a.lines>h>>6){let r=this.children.slice();return r[n]=a,new e(r,this.length-(i-t)+s.length)}return super.replace(r,l,a)}r=l+1}return super.replace(t,i,s)}sliceString(e,t=this.length,i="\n"){[e,t]=oo(this,e,t);let s="";for(let n=0,r=0;n<this.children.length&&r<=t;n++){let o=this.children[n],l=r+o.length;r>e&&n&&(s+=i),e<l&&t>r&&(s+=o.sliceString(e-r,t-r,i)),r=l+1}return s}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(t,i){if(!(t instanceof e))return 0;let s=0,[n,r,o,l]=i>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=i,r+=i){if(n==o||r==l)return s;let e=this.children[n],a=t.children[r];if(e!=a)return s+e.scanIdentical(a,i);s+=e.length+1}}static from(t,i=t.reduce((e,t)=>e+t.length+1,-1)){let s=0;for(let e of t)s+=e.lines;if(s<32){let e=[];for(let i of t)i.flatten(e);return new Qr(e,i)}let n=Math.max(32,s>>5),r=n<<1,o=n>>1,l=[],a=0,h=-1,c=[];function u(t){let i;if(t.lines>r&&t instanceof e)for(let e of t.children)u(e);else t.lines>o&&(a>o||!a)?(d(),l.push(t)):t instanceof Qr&&a&&(i=c[c.length-1])instanceof Qr&&t.lines+i.lines<=32?(a+=t.lines,h+=t.length+1,c[c.length-1]=new Qr(i.text.concat(t.text),i.length+1+t.length)):(a+t.lines>n&&d(),a+=t.lines,h+=t.length+1,c.push(t))}function d(){0!=a&&(l.push(1==c.length?c[0]:e.from(c,h)),h=-1,a=c.length=0)}for(let e of t)u(e);return d(),1==l.length?l[0]:new e(l,i)}};function eo(e,t,i=0,s=1e9){for(let n=0,r=0,o=!0;r<e.length&&n<=s;r++){let l=e[r],a=n+l.length;a>=i&&(a>s&&(l=l.slice(0,s-n)),n<i&&(l=l.slice(i-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=a+1}return t}function to(e,t,i){return eo(e,[""],t,i)}Xr.empty=new Qr([""],0);let io=class{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Qr?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],n=this.offsets[i],r=n>>1,o=s instanceof Qr?s.text.length:s.children.length;if(r==(t>0?o:0)){if(0==i)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&n)==(t>0?0:1)){if(this.offsets[i]+=t,0==e)return this.lineBreak=!0,this.value="\n",this;e--}else if(s instanceof Qr){let n=s.text[r+(t<0?-1:0)];if(this.offsets[i]+=t,n.length>Math.max(0,e))return this.value=0==e?n:t>0?n.slice(e):n.slice(0,n.length-e),this;e-=n.length}else{let n=s.children[r+(t<0?-1:0)];e>n.length?(e-=n.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(n),this.offsets.push(t>0?1:(n instanceof Qr?n.text.length:n.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}},so=class{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new io(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*t,this.value=s.length<=i?s:t<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}},no=class{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:s}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}};"undefined"!=typeof Symbol&&(Xr.prototype[Symbol.iterator]=function(){return this.iter()},io.prototype[Symbol.iterator]=so.prototype[Symbol.iterator]=no.prototype[Symbol.iterator]=function(){return this});let ro=class{constructor(e,t,i,s){this.from=e,this.to=t,this.number=i,this.text=s}get length(){return this.to-this.from}};function oo(e,t,i){return[t=Math.max(0,Math.min(e.length,t)),Math.max(t,Math.min(e.length,i))]}function lo(e,t,i=!0,s=!0){return qr(e,t,i,s)}function ao(e,t){let i=e.charCodeAt(t);if(!(s=i,s>=55296&&s<56320&&t+1!=e.length))return i;var s;let n=e.charCodeAt(t+1);return function(e){return e>=56320&&e<57344}(n)?n-56320+(i-55296<<10)+65536:i}function ho(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function co(e){return e<65536?1:2}const uo=/\r\n?|\n/;var fo=function(e){return e[e.Simple=0]="Simple",e[e.TrackDel=1]="TrackDel",e[e.TrackBefore=2]="TrackBefore",e[e.TrackAfter=3]="TrackAfter",e}(fo||(fo={}));let po=class e{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,s=0;t<this.sections.length;){let n=this.sections[t++],r=this.sections[t++];r<0?(e(i,s,n),s+=n):s+=r,i+=n}}iterChangedRanges(e,t=!1){yo(this,e,t)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new e(t)}composeDesc(e){return this.empty?e:e.empty?this:wo(this,e)}mapDesc(e,t=!1){return e.empty?this:bo(this,e,t)}mapPos(e,t=-1,i=fo.Simple){let s=0,n=0;for(let r=0;r<this.sections.length;){let o=this.sections[r++],l=this.sections[r++],a=s+o;if(l<0){if(a>e)return n+(e-s);n+=o}else{if(i!=fo.Simple&&a>=e&&(i==fo.TrackDel&&s<e&&a>e||i==fo.TrackBefore&&s<e||i==fo.TrackAfter&&a>e))return null;if(a>e||a==e&&t<0&&!o)return e==s||t<0?n:n+l;n+=l}s=a}if(e>s)throw new RangeError(`Position ${e} is out of range for changeset of length ${s}`);return n}touchesRange(e,t=e){for(let i=0,s=0;i<this.sections.length&&s<=t;){let n=s+this.sections[i++];if(this.sections[i++]>=0&&s<=t&&n>=e)return!(s<e&&n>t)||"cover";s=n}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],s=this.sections[t++];e+=(e?" ":"")+i+(s>=0?":"+s:"")}return e}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>"number"!=typeof e))throw new RangeError("Invalid JSON representation of ChangeDesc");return new e(t)}static create(t){return new e(t)}},go=class e extends po{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return yo(this,(t,i,s,n,r)=>e=e.replace(s,s+(i-t),r),!1),e}mapDesc(e,t=!1){return bo(this,e,t,!0)}invert(t){let i=this.sections.slice(),s=[];for(let e=0,n=0;e<i.length;e+=2){let r=i[e],o=i[e+1];if(o>=0){i[e]=o,i[e+1]=r;let l=e>>1;for(;s.length<l;)s.push(Xr.empty);s.push(r?t.slice(n,n+r):Xr.empty)}n+=r}return new e(i,s)}compose(e){return this.empty?e:e.empty?this:wo(this,e,!0)}map(e,t=!1){return e.empty?this:bo(this,e,t,!0)}iterChanges(e,t=!1){yo(this,e,t)}get desc(){return po.create(this.sections)}filter(t){let i=[],s=[],n=[],r=new xo(this);e:for(let e=0,o=0;;){let l=e==t.length?1e9:t[e++];for(;o<l||o==l&&0==r.len;){if(r.done)break e;let e=Math.min(r.len,l-o);mo(n,e,-1);let t=-1==r.ins?-1:0==r.off?r.ins:0;mo(i,e,t),t>0&&vo(s,i,r.text),r.forward(e),o+=e}let a=t[e++];for(;o<a;){if(r.done)break e;let e=Math.min(r.len,a-o);mo(i,e,-1),mo(n,e,-1==r.ins?-1:0==r.off?r.ins:0),r.forward(e),o+=e}}return{changes:new e(i,s),filtered:po.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],s=this.sections[t+1];s<0?e.push(i):0==s?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(t,i,s){let n=[],r=[],o=0,l=null;function a(t=!1){if(!t&&!n.length)return;o<i&&mo(n,i-o,-1);let s=new e(n,r);l=l?l.compose(s.map(l)):s,n=[],r=[],o=0}return function t(h){if(Array.isArray(h))for(let e of h)t(e);else if(h instanceof e){if(h.length!=i)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${i})`);a(),l=l?l.compose(h.map(l)):h}else{let{from:e,to:t=e,insert:l}=h;if(e>t||e<0||t>i)throw new RangeError(`Invalid change range ${e} to ${t} (in doc of length ${i})`);let c=l?"string"==typeof l?Xr.of(l.split(s||uo)):l:Xr.empty,u=c.length;if(e==t&&0==u)return;e<o&&a(),e>o&&mo(n,e-o,-1),mo(n,t-e,u),vo(r,n,c),o=t}}(t),a(!l),l}static empty(t){return new e(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let i=[],s=[];for(let e=0;e<t.length;e++){let n=t[e];if("number"==typeof n)i.push(n,-1);else{if(!Array.isArray(n)||"number"!=typeof n[0]||n.some((e,t)=>t&&"string"!=typeof e))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==n.length)i.push(n[0],0);else{for(;s.length<e;)s.push(Xr.empty);s[e]=Xr.of(n.slice(1)),i.push(n[0],s[e].length)}}}return new e(i,s)}static createSet(t,i){return new e(t,i)}};function mo(e,t,i,s=!1){if(0==t&&i<=0)return;let n=e.length-2;n>=0&&i<=0&&i==e[n+1]?e[n]+=t:n>=0&&0==t&&0==e[n]?e[n+1]+=i:s?(e[n]+=t,e[n+1]+=i):e.push(t,i)}function vo(e,t,i){if(0==i.length)return;let s=t.length-2>>1;if(s<e.length)e[e.length-1]=e[e.length-1].append(i);else{for(;e.length<s;)e.push(Xr.empty);e.push(i)}}function yo(e,t,i){let s=e.inserted;for(let n=0,r=0,o=0;o<e.sections.length;){let l=e.sections[o++],a=e.sections[o++];if(a<0)n+=l,r+=l;else{let h=n,c=r,u=Xr.empty;for(;h+=l,c+=a,a&&s&&(u=u.append(s[o-2>>1])),!(i||o==e.sections.length||e.sections[o+1]<0);)l=e.sections[o++],a=e.sections[o++];t(n,h,r,c,u),n=h,r=c}}}function bo(e,t,i,s=!1){let n=[],r=s?[]:null,o=new xo(e),l=new xo(t);for(let a=-1;;){if(o.done&&l.len||l.done&&o.len)throw new Error("Mismatched change set lengths");if(-1==o.ins&&-1==l.ins){let e=Math.min(o.len,l.len);mo(n,e,-1),o.forward(e),l.forward(e)}else if(l.ins>=0&&(o.ins<0||a==o.i||0==o.off&&(l.len<o.len||l.len==o.len&&!i))){let e=l.len;for(mo(n,l.ins,-1);e;){let t=Math.min(o.len,e);o.ins>=0&&a<o.i&&o.len<=t&&(mo(n,0,o.ins),r&&vo(r,n,o.text),a=o.i),o.forward(t),e-=t}l.next()}else{if(!(o.ins>=0)){if(o.done&&l.done)return r?go.createSet(n,r):po.create(n);throw new Error("Mismatched change set lengths")}{let e=0,t=o.len;for(;t;)if(-1==l.ins){let i=Math.min(t,l.len);e+=i,t-=i,l.forward(i)}else{if(!(0==l.ins&&l.len<t))break;t-=l.len,l.next()}mo(n,e,a<o.i?o.ins:0),r&&a<o.i&&vo(r,n,o.text),a=o.i,o.forward(o.len-t)}}}}function wo(e,t,i=!1){let s=[],n=i?[]:null,r=new xo(e),o=new xo(t);for(let l=!1;;){if(r.done&&o.done)return n?go.createSet(s,n):po.create(s);if(0==r.ins)mo(s,r.len,0,l),r.next();else if(0!=o.len||o.done){if(r.done||o.done)throw new Error("Mismatched change set lengths");{let e=Math.min(r.len2,o.len),t=s.length;if(-1==r.ins){let t=-1==o.ins?-1:o.off?0:o.ins;mo(s,e,t,l),n&&t&&vo(n,s,o.text)}else-1==o.ins?(mo(s,r.off?0:r.len,e,l),n&&vo(n,s,r.textBit(e))):(mo(s,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&vo(n,s,o.text));l=(r.ins>e||o.ins>=0&&o.len>e)&&(l||s.length>t),r.forward2(e),o.forward(e)}}else mo(s,0,o.ins,l),n&&vo(n,s,o.text),o.next()}}let xo=class{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?Xr.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?Xr.empty:t[i].slice(this.off,null==e?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){-1==this.ins?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}},ko=class e{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return 32&this.flags?this.to:this.from}get head(){return 32&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 8&this.flags?-1:16&this.flags?1:0}get bidiLevel(){let e=7&this.flags;return 7==e?null:e}get goalColumn(){let e=this.flags>>6;return 16777215==e?void 0:e}map(t,i=-1){let s,n;return this.empty?s=n=t.mapPos(this.from,i):(s=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),s==this.from&&n==this.to?this:new e(s,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return So.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return So.range(this.anchor,i)}eq(e,t=!1){return!(this.anchor!=e.anchor||this.head!=e.head||t&&this.empty&&this.assoc!=e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||"number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid JSON representation for SelectionRange");return So.range(e.anchor,e.head)}static create(t,i,s){return new e(t,i,s)}},So=class e{constructor(e,t){this.ranges=e,this.mainIndex=t}map(t,i=-1){return t.empty?this:e.create(this.ranges.map(e=>e.map(t,i)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new e([this.main],0)}addRange(t,i=!0){return e.create([t].concat(this.ranges),i?0:this.mainIndex+1)}replaceRange(t,i=this.mainIndex){let s=this.ranges.slice();return s[i]=t,e.create(s,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||"number"!=typeof t.main||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new e(t.ranges.map(e=>ko.fromJSON(e)),t.main)}static single(t,i=t){return new e([e.range(t,i)],0)}static create(t,i=0){if(0==t.length)throw new RangeError("A selection needs at least one range");for(let s=0,n=0;n<t.length;n++){let r=t[n];if(r.empty?r.from<=s:r.from<s)return e.normalized(t.slice(),i);s=r.to}return new e(t,i)}static cursor(e,t=0,i,s){return ko.create(e,e,(0==t?0:t<0?8:16)|(null==i?7:Math.min(6,i))|(null!=s?s:16777215)<<6)}static range(e,t,i,s){let n=(null!=i?i:16777215)<<6|(null==s?7:Math.min(6,s));return t<e?ko.create(t,e,48|n):ko.create(e,t,(t>e?8:0)|n)}static normalized(t,i=0){let s=t[i];t.sort((e,t)=>e.from-t.from),i=t.indexOf(s);for(let n=1;n<t.length;n++){let s=t[n],r=t[n-1];if(s.empty?s.from<=r.to:s.from<r.to){let o=r.from,l=Math.max(s.to,r.to);n<=i&&i--,t.splice(--n,2,s.anchor>s.head?e.range(l,o):e.range(o,l))}}return new e(t,i)}};function Co(e,t){for(let i of e.ranges)if(i.to>t)throw new RangeError("Selection points outside of document")}let Mo=0,Ao=class e{constructor(e,t,i,s,n){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=s,this.id=Mo++,this.default=e([]),this.extensions="function"==typeof n?n(this):n}get reader(){return this}static define(t={}){return new e(t.combine||(e=>e),t.compareInput||((e,t)=>e===t),t.compare||(t.combine?(e,t)=>e===t:Oo),!!t.static,t.enables)}of(e){return new To([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new To(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new To(e,this,2,t)}from(e,t){return t||(t=e=>e),this.compute([e],i=>t(i.field(e)))}};function Oo(e,t){return e==t||e.length==t.length&&e.every((e,i)=>e===t[i])}let To=class{constructor(e,t,i,s){this.dependencies=e,this.facet=t,this.type=i,this.value=s,this.id=Mo++}dynamicSlot(e){var t;let i=this.value,s=this.facet.compareInput,n=this.id,r=e[n]>>1,o=2==this.type,l=!1,a=!1,h=[];for(let c of this.dependencies)"doc"==c?l=!0:"selection"==c?a=!0:1&(null!==(t=e[c.id])&&void 0!==t?t:1)||h.push(e[c.id]);return{create:e=>(e.values[r]=i(e),1),update(e,t){if(l&&t.docChanged||a&&(t.docChanged||t.selection)||Eo(e,h)){let t=i(e);if(o?!Do(t,e.values[r],s):!s(t,e.values[r]))return e.values[r]=t,1}return 0},reconfigure:(e,t)=>{let l,a=t.config.address[n];if(null!=a){let n=_o(t,a);if(this.dependencies.every(i=>i instanceof Ao?t.facet(i)===e.facet(i):!(i instanceof Bo)||t.field(i,!1)==e.field(i,!1))||(o?Do(l=i(e),n,s):s(l=i(e),n)))return e.values[r]=n,0}else l=i(e);return e.values[r]=l,1}}}};function Do(e,t,i){if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],t[s]))return!1;return!0}function Eo(e,t){let i=!1;for(let s of t)1&qo(e,s)&&(i=!0);return i}function Ro(e,t,i){let s=i.map(t=>e[t.id]),n=i.map(e=>e.type),r=s.filter(e=>!(1&e)),o=e[t.id]>>1;function l(e){let i=[];for(let t=0;t<s.length;t++){let r=_o(e,s[t]);if(2==n[t])for(let e of r)i.push(e);else i.push(r)}return t.combine(i)}return{create(e){for(let t of s)qo(e,t);return e.values[o]=l(e),1},update(e,i){if(!Eo(e,r))return 0;let s=l(e);return t.compare(s,e.values[o])?0:(e.values[o]=s,1)},reconfigure(e,n){let r=Eo(e,s),a=n.config.facets[t.id],h=n.facet(t);if(a&&!r&&Oo(i,a))return e.values[o]=h,0;let c=l(e);return t.compare(c,h)?(e.values[o]=h,0):(e.values[o]=c,1)}}}const Lo=Ao.define({static:!0});let Bo=class e{constructor(e,t,i,s,n){this.id=e,this.createF=t,this.updateF=i,this.compareF=s,this.spec=n,this.provides=void 0}static define(t){let i=new e(Mo++,t.create,t.update,t.compare||((e,t)=>e===t),t);return t.provide&&(i.provides=t.provide(i)),i}create(e){let t=e.facet(Lo).find(e=>e.field==this);return((null==t?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:e=>(e.values[t]=this.create(e),1),update:(e,i)=>{let s=e.values[t],n=this.updateF(s,i);return this.compareF(s,n)?0:(e.values[t]=n,1)},reconfigure:(e,i)=>{let s,n=e.facet(Lo),r=i.facet(Lo);return(s=n.find(e=>e.field==this))&&s!=r.find(e=>e.field==this)?(e.values[t]=s.create(e),1):null!=i.config.address[this.id]?(e.values[t]=i.field(this),0):(e.values[t]=this.create(e),1)}}}init(e){return[this,Lo.of({field:this,create:e})]}get extension(){return this}};const Po=4,No=3,Vo=2,Io=1;function Ho(e){return t=>new zo(t,e)}const Fo={highest:Ho(0),high:Ho(Io),default:Ho(Vo),low:Ho(No),lowest:Ho(Po)};let zo=class{constructor(e,t){this.inner=e,this.prec=t}},Wo=class e{of(e){return new $o(this,e)}reconfigure(t){return e.reconfigure.of({compartment:this,extension:t})}get(e){return e.config.compartments.get(this)}},$o=class{constructor(e,t){this.compartment=e,this.inner=t}},jo=class e{constructor(e,t,i,s,n,r){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=s,this.staticValues=n,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return null==t?e.default:this.staticValues[t>>1]}static resolve(t,i,s){let n=[],r=Object.create(null),o=new Map;for(let e of function(e,t,i){let s=[[],[],[],[],[]],n=new Map;function r(e,o){let l=n.get(e);if(null!=l){if(l<=o)return;let t=s[l].indexOf(e);t>-1&&s[l].splice(t,1),e instanceof $o&&i.delete(e.compartment)}if(n.set(e,o),Array.isArray(e))for(let t of e)r(t,o);else if(e instanceof $o){if(i.has(e.compartment))throw new RangeError("Duplicate use of compartment in extensions");let s=t.get(e.compartment)||e.inner;i.set(e.compartment,s),r(s,o)}else if(e instanceof zo)r(e.inner,e.prec);else if(e instanceof Bo)s[o].push(e),e.provides&&r(e.provides,o);else if(e instanceof To)s[o].push(e),e.facet.extensions&&r(e.facet.extensions,Vo);else{let t=e.extension;if(!t)throw new Error(`Unrecognized extension value in extension set (${e}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(t,o)}}return r(e,Vo),s.reduce((e,t)=>e.concat(t))}(t,i,o))e instanceof Bo?n.push(e):(r[e.facet.id]||(r[e.facet.id]=[])).push(e);let l=Object.create(null),a=[],h=[];for(let e of n)l[e.id]=h.length<<1,h.push(t=>e.slot(t));let c=null==s?void 0:s.config.facets;for(let e in r){let t=r[e],i=t[0].facet,n=c&&c[e]||[];if(t.every(e=>0==e.type))if(l[i.id]=a.length<<1|1,Oo(n,t))a.push(s.facet(i));else{let e=i.combine(t.map(e=>e.value));a.push(s&&i.compare(e,s.facet(i))?s.facet(i):e)}else{for(let e of t)0==e.type?(l[e.id]=a.length<<1|1,a.push(e.value)):(l[e.id]=h.length<<1,h.push(t=>e.dynamicSlot(t)));l[i.id]=h.length<<1,h.push(e=>Ro(e,i,t))}}let u=h.map(e=>e(l));return new e(t,o,u,l,a,r)}};function qo(e,t){if(1&t)return 2;let i=t>>1,s=e.status[i];if(4==s)throw new Error("Cyclic dependency between fields and/or facets");if(2&s)return s;e.status[i]=4;let n=e.computeSlot(e,e.config.dynamicSlots[i]);return e.status[i]=2|n}function _o(e,t){return 1&t?e.config.staticValues[t>>1]:e.values[t>>1]}const Ko=Ao.define(),Uo=Ao.define({combine:e=>e.some(e=>e),static:!0}),Go=Ao.define({combine:e=>e.length?e[0]:void 0,static:!0}),Jo=Ao.define(),Yo=Ao.define(),Xo=Ao.define(),Qo=Ao.define({combine:e=>!!e.length&&e[0]});let Zo=class{constructor(e,t){this.type=e,this.value=t}static define(){return new el}},el=class{of(e){return new Zo(this,e)}},tl=class{constructor(e){this.map=e}of(e){return new il(this,e)}},il=class e{constructor(e,t){this.type=e,this.value=t}map(t){let i=this.type.map(this.value,t);return void 0===i?void 0:i==this.value?this:new e(this.type,i)}is(e){return this.type==e}static define(e={}){return new tl(e.map||(e=>e))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let s of e){let e=s.map(t);e&&i.push(e)}return i}};il.reconfigure=il.define(),il.appendConfig=il.define();let sl=class e{constructor(t,i,s,n,r,o){this.startState=t,this.changes=i,this.selection=s,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,s&&Co(s,i.newLength),r.some(t=>t.type==e.time)||(this.annotations=r.concat(e.time.of(Date.now())))}static create(t,i,s,n,r,o){return new e(t,i,s,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let i=this.annotation(e.userEvent);return!(!i||!(i==t||i.length>t.length&&i.slice(0,t.length)==t&&"."==i[t.length]))}};function nl(e,t){let i=[];for(let s=0,n=0;;){let r,o;if(s<e.length&&(n==t.length||t[n]>=e[s]))r=e[s++],o=e[s++];else{if(!(n<t.length))return i;r=t[n++],o=t[n++]}!i.length||i[i.length-1]<r?i.push(r,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function rl(e,t,i){var s;let n,r,o;return i?(n=t.changes,r=go.empty(t.changes.length),o=e.changes.compose(t.changes)):(n=t.changes.map(e.changes),r=e.changes.mapDesc(t.changes,!0),o=e.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(r):null===(s=e.selection)||void 0===s?void 0:s.map(n),effects:il.mapEffects(e.effects,n).concat(il.mapEffects(t.effects,r)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function ol(e,t,i){let s=t.selection,n=hl(t.annotations);return t.userEvent&&(n=n.concat(sl.userEvent.of(t.userEvent))),{changes:t.changes instanceof go?t.changes:go.of(t.changes||[],i,e.facet(Go)),selection:s&&(s instanceof So?s:So.single(s.anchor,s.head)),effects:hl(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function ll(e,t,i){let s=ol(e,t.length?t[0]:{},e.doc.length);t.length&&!1===t[0].filter&&(i=!1);for(let r=1;r<t.length;r++){!1===t[r].filter&&(i=!1);let n=!!t[r].sequential;s=rl(s,ol(e,t[r],n?s.changes.newLength:e.doc.length),n)}let n=sl.create(e,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function(e){let t=e.startState,i=t.facet(Xo),s=e;for(let n=i.length-1;n>=0;n--){let r=i[n](e);r&&Object.keys(r).length&&(s=rl(s,ol(t,r,e.changes.newLength),!0))}return s==e?e:sl.create(t,e.changes,e.selection,s.effects,s.annotations,s.scrollIntoView)}(i?function(e){let t=e.startState,i=!0;for(let n of t.facet(Jo)){let t=n(e);if(!1===t){i=!1;break}Array.isArray(t)&&(i=!0===i?t:nl(i,t))}if(!0!==i){let s,n;if(!1===i)n=e.changes.invertedDesc,s=go.empty(t.doc.length);else{let t=e.changes.filter(i);s=t.changes,n=t.filtered.mapDesc(t.changes).invertedDesc}e=sl.create(t,s,e.selection&&e.selection.map(n),il.mapEffects(e.effects,n),e.annotations,e.scrollIntoView)}let s=t.facet(Yo);for(let n=s.length-1;n>=0;n--){let i=s[n](e);e=i instanceof sl?i:Array.isArray(i)&&1==i.length&&i[0]instanceof sl?i[0]:ll(t,hl(i),!1)}return e}(n):n)}sl.time=Zo.define(),sl.userEvent=Zo.define(),sl.addToHistory=Zo.define(),sl.remote=Zo.define();const al=[];function hl(e){return null==e?al:Array.isArray(e)?e:[e]}var cl=function(e){return e[e.Word=0]="Word",e[e.Space=1]="Space",e[e.Other=2]="Other",e}(cl||(cl={}));const ul=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let dl;try{dl=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(sM){}function fl(e){return t=>{if(!/\S/.test(t))return cl.Space;if(function(e){if(dl)return dl.test(e);for(let t=0;t<e.length;t++){let i=e[t];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||ul.test(i)))return!0}return!1}(t))return cl.Word;for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return cl.Word;return cl.Other}}let pl=class e{constructor(e,t,i,s,n,r){this.config=e,this.doc=t,this.selection=i,this.values=s,this.status=e.statusTemplate.slice(),this.computeSlot=n,r&&(r._state=this);for(let o=0;o<this.config.dynamicSlots.length;o++)qo(this,o<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(null!=i)return qo(this,i),_o(this,i);if(t)throw new RangeError("Field is not present in this state")}update(...e){return ll(this,e,!0)}applyTransaction(t){let i,s=this.config,{base:n,compartments:r}=s;for(let e of t.effects)e.is(Wo.reconfigure)?(s&&(r=new Map,s.compartments.forEach((e,t)=>r.set(t,e)),s=null),r.set(e.value.compartment,e.value.extension)):e.is(il.reconfigure)?(s=null,n=e.value):e.is(il.appendConfig)&&(s=null,n=hl(n).concat(e.value));if(s)i=t.startState.values.slice();else{s=jo.resolve(n,r,this),i=new e(s,this.doc,this.selection,s.dynamicSlots.map(()=>null),(e,t)=>t.reconfigure(e,this),null).values}let o=t.startState.facet(Uo)?t.newSelection:t.newSelection.asSingle();new e(s,t.newDoc,o,i,(e,i)=>i.update(e,t),t)}replaceSelection(e){return"string"==typeof e&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:So.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),s=this.changes(i.changes),n=[i.range],r=hl(i.effects);for(let o=1;o<t.ranges.length;o++){let i=e(t.ranges[o]),l=this.changes(i.changes),a=l.map(s);for(let e=0;e<o;e++)n[e]=n[e].map(a);let h=s.mapDesc(l,!0);n.push(i.range.map(h)),s=s.compose(a),r=il.mapEffects(r,a).concat(il.mapEffects(hl(i.effects),h))}return{changes:s,selection:So.create(n,t.mainIndex),effects:r}}changes(t=[]){return t instanceof go?t:go.of(t,this.doc.length,this.facet(e.lineSeparator))}toText(t){return Xr.of(t.split(this.facet(e.lineSeparator)||uo))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return null==t?e.default:(qo(this,t),_o(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let s=e[i];s instanceof Bo&&null!=this.config.address[s.id]&&(t[i]=s.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(t,i={},s){if(!t||"string"!=typeof t.doc)throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(s)for(let e in s)if(Object.prototype.hasOwnProperty.call(t,e)){let i=s[e],r=t[e];n.push(i.init(e=>i.spec.fromJSON(r,e)))}return e.create({doc:t.doc,selection:So.fromJSON(t.selection),extensions:i.extensions?n.concat([i.extensions]):n})}static create(t={}){let i=jo.resolve(t.extensions||[],new Map),s=t.doc instanceof Xr?t.doc:Xr.of((t.doc||"").split(i.staticFacet(e.lineSeparator)||uo)),n=t.selection?t.selection instanceof So?t.selection:So.single(t.selection.anchor,t.selection.head):So.single(0);return Co(n,s.length),i.staticFacet(Uo)||(n=n.asSingle()),new e(i,s,n,i.dynamicSlots.map(()=>null),(e,t)=>t.create(e),null)}get tabSize(){return this.facet(e.tabSize)}get lineBreak(){return this.facet(e.lineSeparator)||"\n"}get readOnly(){return this.facet(Qo)}phrase(t,...i){for(let s of this.facet(e.phrases))if(Object.prototype.hasOwnProperty.call(s,t)){t=s[t];break}return i.length&&(t=t.replace(/\$(\$|\d*)/g,(e,t)=>{if("$"==t)return"$";let s=+(t||1);return!s||s>i.length?e:i[s-1]})),t}languageDataAt(e,t,i=-1){let s=[];for(let n of this.facet(Ko))for(let r of n(this,t,i))Object.prototype.hasOwnProperty.call(r,e)&&s.push(r[e]);return s}charCategorizer(e){return fl(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:s}=this.doc.lineAt(e),n=this.charCategorizer(e),r=e-i,o=e-i;for(;r>0;){let e=lo(t,r,!1);if(n(t.slice(e,r))!=cl.Word)break;r=e}for(;o<s;){let e=lo(t,o);if(n(t.slice(o,e))!=cl.Word)break;o=e}return r==o?null:So.range(r+i,o+i)}};function gl(e,t,i={}){let s={};for(let n of e)for(let e of Object.keys(n)){let t=n[e],r=s[e];if(void 0===r)s[e]=t;else if(r===t||void 0===t);else{if(!Object.hasOwnProperty.call(i,e))throw new Error("Config merge conflict for field "+e);s[e]=i[e](r,t)}}for(let n in t)void 0===s[n]&&(s[n]=t[n]);return s}pl.allowMultipleSelections=Uo,pl.tabSize=Ao.define({combine:e=>e.length?e[0]:4}),pl.lineSeparator=Go,pl.readOnly=Qo,pl.phrases=Ao.define({compare(e,t){let i=Object.keys(e),s=Object.keys(t);return i.length==s.length&&i.every(i=>e[i]==t[i])}}),pl.languageData=Ko,pl.changeFilter=Jo,pl.transactionFilter=Yo,pl.transactionExtender=Xo,Wo.reconfigure=il.define();let ml=class{eq(e){return this==e}range(e,t=e){return vl.create(e,t,this)}};ml.prototype.startSide=ml.prototype.endSide=0,ml.prototype.point=!1,ml.prototype.mapMode=fo.TrackDel;let vl=class e{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(t,i,s){return new e(t,i,s)}};function yl(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}let bl=class e{constructor(e,t,i,s){this.from=e,this.to=t,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,s=0){let n=i?this.to:this.from;for(let r=s,o=n.length;;){if(r==o)return r;let s=r+o>>1,l=n[s]-e||(i?this.value[s].endSide:this.value[s].startSide)-t;if(s==r)return l>=0?r:o;l>=0?o=s:r=s+1}}between(e,t,i,s){for(let n=this.findIndex(t,-1e9,!0),r=this.findIndex(i,1e9,!1,n);n<r;n++)if(!1===s(this.from[n]+e,this.to[n]+e,this.value[n]))return!1}map(t,i){let s=[],n=[],r=[],o=-1,l=-1;for(let e=0;e<this.value.length;e++){let a,h,c=this.value[e],u=this.from[e]+t,d=this.to[e]+t;if(u==d){let e=i.mapPos(u,c.startSide,c.mapMode);if(null==e)continue;if(a=h=e,c.startSide!=c.endSide&&(h=i.mapPos(u,c.endSide),h<a))continue}else if(a=i.mapPos(u,c.startSide),h=i.mapPos(d,c.endSide),a>h||a==h&&c.startSide>0&&c.endSide<=0)continue;(h-a||c.endSide-c.startSide)<0||(o<0&&(o=a),c.point&&(l=Math.max(l,h-a)),s.push(c),n.push(a-o),r.push(h-o))}return{mapped:s.length?new e(n,r,s,l):null,pos:o}}},wl=class e{constructor(e,t,i,s){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=s}static create(t,i,s,n){return new e(t,i,s,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(t){let{add:i=[],sort:s=!1,filterFrom:n=0,filterTo:r=this.length}=t,o=t.filter;if(0==i.length&&!o)return this;if(s&&(i=i.slice().sort(yl)),this.isEmpty)return i.length?e.of(i):this;let l=new Sl(this,null,-1).goto(0),a=0,h=[],c=new xl;for(;l.value||a<i.length;)if(a<i.length&&(l.from-i[a].from||l.startSide-i[a].value.startSide)>=0){let e=i[a++];c.addInner(e.from,e.to,e.value)||h.push(e)}else 1==l.rangeIndex&&l.chunkIndex<this.chunk.length&&(a==i.length||this.chunkEnd(l.chunkIndex)<i[a].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||h.push(vl.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!h.length?e.empty:this.nextLayer.update({add:h,filter:o,filterFrom:n,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let i=[],s=[],n=-1;for(let e=0;e<this.chunk.length;e++){let r=this.chunkPos[e],o=this.chunk[e],l=t.touchesRange(r,r+o.length);if(!1===l)n=Math.max(n,o.maxPoint),i.push(o),s.push(t.mapPos(r));else if(!0===l){let{mapped:e,pos:l}=o.map(r,t);e&&(n=Math.max(n,e.maxPoint),i.push(e),s.push(l))}}let r=this.nextLayer.map(t);return 0==i.length?r:new e(s,i,r||e.empty,n)}between(e,t,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],r=this.chunk[s];if(t>=n&&e<=n+r.length&&!1===r.between(n,e-n,t-n,i))return}this.nextLayer.between(e,t,i)}}iter(e=0){return Cl.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Cl.from(e).goto(t)}static compare(e,t,i,s,n=-1){let r=e.filter(e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=n),o=t.filter(e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=n),l=kl(r,o,i),a=new Al(r,l,n),h=new Al(o,l,n);i.iterGaps((e,t,i)=>Ol(a,e,h,t,i,s)),i.empty&&0==i.length&&Ol(a,0,h,0,0,s)}static eq(e,t,i=0,s){null==s&&(s=999999999);let n=e.filter(e=>!e.isEmpty&&t.indexOf(e)<0),r=t.filter(t=>!t.isEmpty&&e.indexOf(t)<0);if(n.length!=r.length)return!1;if(!n.length)return!0;let o=kl(n,r),l=new Al(n,o,0).goto(i),a=new Al(r,o,0).goto(i);for(;;){if(l.to!=a.to||!Tl(l.active,a.active)||l.point&&(!a.point||!l.point.eq(a.point)))return!1;if(l.to>s)return!0;l.next(),a.next()}}static spans(e,t,i,s,n=-1){let r=new Al(e,null,n).goto(t),o=t,l=r.openStart;for(;;){let e=Math.min(r.to,i);if(r.point){let i=r.activeForPoint(r.to),n=r.pointFrom<t?i.length+1:r.point.startSide<0?i.length:Math.min(i.length,l);s.point(o,e,r.point,i,n,r.pointRank),l=Math.min(r.openEnd(e),i.length)}else e>o&&(s.span(o,e,r.active,l),l=r.openEnd(e));if(r.to>i)return l+(r.point&&r.to>i?1:0);o=r.to,r.next()}}static of(e,t=!1){let i=new xl;for(let s of e instanceof vl?[e]:t?function(e){if(e.length>1)for(let t=e[0],i=1;i<e.length;i++){let s=e[i];if(yl(t,s)>0)return e.slice().sort(yl);t=s}return e}(e):e)i.add(s.from,s.to,s.value);return i.finish()}static join(t){if(!t.length)return e.empty;let i=t[t.length-1];for(let s=t.length-2;s>=0;s--)for(let n=t[s];n!=e.empty;n=n.nextLayer)i=new e(n.chunkPos,n.chunk,i,Math.max(n.maxPoint,i.maxPoint));return i}};wl.empty=new wl([],[],null,-1),wl.empty.nextLayer=wl.empty;let xl=class e{finishChunk(e){this.chunks.push(new bl(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(t,i,s){this.addInner(t,i,s)||(this.nextLayer||(this.nextLayer=new e)).add(t,i,s)}addInner(e,t,i){let s=e-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(s<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(wl.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return e;let t=wl.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}};function kl(e,t,i){let s=new Map;for(let r of e)for(let e=0;e<r.chunk.length;e++)r.chunk[e].maxPoint<=0&&s.set(r.chunk[e],r.chunkPos[e]);let n=new Set;for(let r of t)for(let e=0;e<r.chunk.length;e++){let t=s.get(r.chunk[e]);null==t||(i?i.mapPos(t):t)!=r.chunkPos[e]||(null==i?void 0:i.touchesRange(t,t+r.chunk[e].length))||n.add(r.chunk[e])}return n}let Sl=class{constructor(e,t,i,s=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let t=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(t)||this.layer.chunkEnd(this.chunkIndex)<e||t.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}},Cl=class e{constructor(e){this.heap=e}static from(t,i=null,s=-1){let n=[];for(let e=0;e<t.length;e++)for(let r=t[e];!r.isEmpty;r=r.nextLayer)r.maxPoint>=s&&n.push(new Sl(r,i,s,e));return 1==n.length?n[0]:new e(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)Ml(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)Ml(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Ml(this.heap,0)}}};function Ml(e,t){for(let i=e[t];;){let s=1+(t<<1);if(s>=e.length)break;let n=e[s];if(s+1<e.length&&n.compare(e[s+1])>=0&&(n=e[s+1],s++),i.compare(n)<0)break;e[s]=i,e[t]=n,t=s}}let Al=class{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Cl.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Dl(this.active,e),Dl(this.activeTo,e),Dl(this.activeRank,e),this.minActive=Rl(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:s,rank:n}=this.cursor;for(;t<this.activeRank.length&&(n-this.activeRank[t]||s-this.activeTo[t])>0;)t++;El(this.active,t,i),El(this.activeTo,t,s),El(this.activeRank,t,n),e&&El(e,t,this.cursor.from),this.minActive=Rl(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&Dl(i,s)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let e=this.cursor.value;if(e.point){if(!(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=e,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=e.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){this.openStart=0;for(let t=i.length-1;t>=0&&i[t]<e;t--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}};function Ol(e,t,i,s,n,r){e.goto(t),i.goto(s);let o=s+n,l=s,a=s-t;for(;;){let t=e.to+a-i.to,s=t||e.endSide-i.endSide,n=s<0?e.to+a:i.to,h=Math.min(n,o);if(e.point||i.point?e.point&&i.point&&(e.point==i.point||e.point.eq(i.point))&&Tl(e.activeForPoint(e.to),i.activeForPoint(i.to))||r.comparePoint(l,h,e.point,i.point):h>l&&!Tl(e.active,i.active)&&r.compareRange(l,h,e.active,i.active),n>o)break;(t||e.openEnd!=i.openEnd)&&r.boundChange&&r.boundChange(n),l=n,s<=0&&e.next(),s>=0&&i.next()}}function Tl(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i]&&!e[i].eq(t[i]))return!1;return!0}function Dl(e,t){for(let i=t,s=e.length-1;i<s;i++)e[i]=e[i+1];e.pop()}function El(e,t,i){for(let s=e.length-1;s>=t;s--)e[s+1]=e[s];e[t]=i}function Rl(e,t){let i=-1,s=1e9;for(let n=0;n<t.length;n++)(t[n]-s||e[n].endSide-e[i].endSide)<0&&(i=n,s=t[n]);return i}const Ll="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),Bl="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),Pl="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class Nl{constructor(e,t){this.rules=[];let{finish:i}=t||{};function s(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function n(e,t,r,o){let l=[],a=/^@(\w+)\b/.exec(e[0]),h=a&&"keyframes"==a[1];if(a&&null==t)return r.push(e[0]+";");for(let i in t){let o=t[i];if(/&/.test(i))n(i.split(/,\s*/).map(t=>e.map(e=>t.replace(/&/,e))).reduce((e,t)=>e.concat(t)),o,r);else if(o&&"object"==typeof o){if(!a)throw new RangeError("The value of a property ("+i+") should be a primitive value.");n(s(i),o,l,h)}else null!=o&&l.push(i.replace(/_.*/,"").replace(/[A-Z]/g,e=>"-"+e.toLowerCase())+": "+o+";")}(l.length||h)&&r.push((!i||a||o?e:e.map(i)).join(", ")+" {"+l.join(" ")+"}")}for(let r in e)n(s(r),e[r],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let e=Pl[Ll]||1;return Pl[Ll]=e+1,"ͼ"+e.toString(36)}static mount(e,t,i){let s=e[Bl],n=i&&i.nonce;s?n&&s.setNonce(n):s=new Il(e,n),s.mount(Array.isArray(t)?t:[t],e)}}let Vl=new Map;class Il{constructor(e,t){let i=e.ownerDocument||e,s=i.defaultView;if(!e.head&&e.adoptedStyleSheets&&s.CSSStyleSheet){let t=Vl.get(i);if(t)return e[Bl]=t;this.sheet=new s.CSSStyleSheet,Vl.set(i,this)}else this.styleTag=i.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[Bl]=this}mount(e,t){let i=this.sheet,s=0,n=0;for(let r=0;r<e.length;r++){let t=e[r],o=this.modules.indexOf(t);if(o<n&&o>-1&&(this.modules.splice(o,1),n--,o=-1),-1==o){if(this.modules.splice(n++,0,t),i)for(let e=0;e<t.rules.length;e++)i.insertRule(t.rules[e],s++)}else{for(;n<o;)s+=this.modules[n++].rules.length;s+=t.rules.length,n++}}if(i)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let e="";for(let t=0;t<this.modules.length;t++)e+=this.modules[t].getRules()+"\n";this.styleTag.textContent=e;let i=t.head||t;this.styleTag.parentNode!=i&&i.insertBefore(this.styleTag,i.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}for(var Hl={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Fl={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},zl="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),Wl="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),$l=0;$l<10;$l++)Hl[48+$l]=Hl[96+$l]=String($l);for($l=1;$l<=24;$l++)Hl[$l+111]="F"+$l;for($l=65;$l<=90;$l++)Hl[$l]=String.fromCharCode($l+32),Fl[$l]=String.fromCharCode($l);for(var jl in Hl)Fl.hasOwnProperty(jl)||(Fl[jl]=Hl[jl]);function ql(e){var t=!(zl&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||Wl&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?Fl:Hl)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}function _l(){var e=arguments[0];"string"==typeof e&&(e=document.createElement(e));var t=1,i=arguments[1];if(i&&"object"==typeof i&&null==i.nodeType&&!Array.isArray(i)){for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){var n=i[s];"string"==typeof n?e.setAttribute(s,n):null!=n&&(e[s]=n)}t++}for(;t<arguments.length;t++)Kl(e,arguments[t]);return e}function Kl(e,t){if("string"==typeof t)e.appendChild(document.createTextNode(t));else if(null==t);else if(null!=t.nodeType)e.appendChild(t);else{if(!Array.isArray(t))throw new RangeError("Unsupported child node: "+t);for(var i=0;i<t.length;i++)Kl(e,t[i])}}function Ul(e){let t;return t=11==e.nodeType?e.getSelection?e:e.ownerDocument:e,t.getSelection()}function Gl(e,t){return!!t&&(e==t||e.contains(1!=t.nodeType?t.parentNode:t))}function Jl(e,t){if(!t.anchorNode)return!1;try{return Gl(e,t.anchorNode)}catch(sM){return!1}}function Yl(e){return 3==e.nodeType?ha(e,0,e.nodeValue.length).getClientRects():1==e.nodeType?e.getClientRects():[]}function Xl(e,t,i,s){return!!i&&(ea(e,t,i,s,-1)||ea(e,t,i,s,1))}function Ql(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t}function Zl(e){return 1==e.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}function ea(e,t,i,s,n){for(;;){if(e==i&&t==s)return!0;if(t==(n<0?0:ta(e))){if("DIV"==e.nodeName)return!1;let i=e.parentNode;if(!i||1!=i.nodeType)return!1;t=Ql(e)+(n<0?0:1),e=i}else{if(1!=e.nodeType)return!1;if(1==(e=e.childNodes[t+(n<0?-1:0)]).nodeType&&"false"==e.contentEditable)return!1;t=n<0?ta(e):0}}}function ta(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function ia(e,t){let i=t?e.left:e.right;return{left:i,right:i,top:e.top,bottom:e.bottom}}function sa(e){let t=e.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}function na(e,t){let i=t.width/e.offsetWidth,s=t.height/e.offsetHeight;return(i>.995&&i<1.005||!isFinite(i)||Math.abs(t.width-e.offsetWidth)<1)&&(i=1),(s>.995&&s<1.005||!isFinite(s)||Math.abs(t.height-e.offsetHeight)<1)&&(s=1),{scaleX:i,scaleY:s}}let ra,oa=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?ta(t):0),i,Math.min(e.focusOffset,i?ta(i):0))}set(e,t,i,s){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=s}},la=null;function aa(e){if(e.setActive)return e.setActive();if(la)return e.focus(la);let t=[];for(let i=e;i&&(t.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(e.focus(null==la?{get preventScroll(){return la={preventScroll:!0},!0}}:void 0),!la){la=!1;for(let e=0;e<t.length;){let i=t[e++],s=t[e++],n=t[e++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function ha(e,t,i=t){let s=ra||(ra=document.createRange());return s.setEnd(e,i),s.setStart(e,t),s}function ca(e,t,i,s){let n={key:t,code:t,keyCode:i,which:i,cancelable:!0};s&&({altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey,metaKey:n.metaKey}=s);let r=new KeyboardEvent("keydown",n);r.synthetic=!0,e.dispatchEvent(r);let o=new KeyboardEvent("keyup",n);return o.synthetic=!0,e.dispatchEvent(o),r.defaultPrevented||o.defaultPrevented}function ua(e){for(;e.attributes.length;)e.removeAttributeNode(e.attributes[0])}function da(e){return e.scrollTop>Math.max(1,e.scrollHeight-e.clientHeight-4)}function fa(e,t){for(let i=e,s=t;;){if(3==i.nodeType&&s>0)return{node:i,offset:s};if(1==i.nodeType&&s>0){if("false"==i.contentEditable)return null;i=i.childNodes[s-1],s=ta(i)}else{if(!i.parentNode||Zl(i))return null;s=Ql(i),i=i.parentNode}}}function pa(e,t){for(let i=e,s=t;;){if(3==i.nodeType&&s<i.nodeValue.length)return{node:i,offset:s};if(1==i.nodeType&&s<i.childNodes.length){if("false"==i.contentEditable)return null;i=i.childNodes[s],s=0}else{if(!i.parentNode||Zl(i))return null;s=Ql(i)+1,i=i.parentNode}}}let ga=class e{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(t,i){return new e(t.parentNode,Ql(t),i)}static after(t,i){return new e(t.parentNode,Ql(t)+1,i)}};const ma=[];let va=class e{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(t,i){if(2&this.flags){let s,n=this.dom,r=null;for(let o of this.children){if(7&o.flags){if(!o.dom&&(s=r?r.nextSibling:n.firstChild)){let t=e.get(s);(!t||!t.parent&&t.canReuseDOM(o))&&o.reuseDOM(s)}o.sync(t,i),o.flags&=-8}if(s=r?r.nextSibling:n.firstChild,i&&!i.written&&i.node==n&&s!=o.dom&&(i.written=!0),o.dom.parentNode==n)for(;s&&s!=o.dom;)s=ya(s);else n.insertBefore(o.dom,s);r=o.dom}for(s=r?r.nextSibling:n.firstChild,s&&i&&i.node==n&&(i.written=!0);s;)s=ya(s)}else if(1&this.flags)for(let e of this.children)7&e.flags&&(e.sync(t,i),e.flags&=-8)}reuseDOM(e){}localPosFromDOM(t,i){let s;if(t==this.dom)s=this.dom.childNodes[i];else{let e=0==ta(t)?0:0==i?-1:1;for(;;){let i=t.parentNode;if(i==this.dom)break;0==e&&i.firstChild!=i.lastChild&&(e=t==i.firstChild?-1:1),t=i}s=e<0?t:t.nextSibling}if(s==this.dom.firstChild)return 0;for(;s&&!e.get(s);)s=s.nextSibling;if(!s)return this.length;for(let e=0,n=0;;e++){let t=this.children[e];if(t.dom==s)return n;n+=t.length+t.breakAfter}}domBoundsAround(e,t,i=0){let s=-1,n=-1,r=-1,o=-1;for(let l=0,a=i,h=i;l<this.children.length;l++){let i=this.children[l],c=a+i.length;if(a<e&&c>t)return i.domBoundsAround(e,t,a);if(c>=e&&-1==s&&(s=l,n=a),a>t&&i.dom.parentNode==this.dom){r=l,o=h;break}h=c,a=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),1&t.flags)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,7&this.flags&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=ma){this.markDirty();for(let s=e;s<t;s++){let e=this.children[s];e.parent==this&&i.indexOf(e)<0&&e.destroy()}i.length<250?this.children.splice(e,t-e,...i):this.children=[].concat(this.children.slice(0,e),i,this.children.slice(t));for(let s=0;s<i.length;s++)i[s].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ba(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==e?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,i,s,n,r){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!(8&(this.flags|e.flags))}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}};function ya(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}va.prototype.breakAfter=0;let ba=class{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}};function wa(e,t,i,s,n,r,o,l,a){let{children:h}=e,c=h.length?h[t]:null,u=r.length?r[r.length-1]:null,d=u?u.breakAfter:o;if(!(t==s&&c&&!o&&!d&&r.length<2&&c.merge(i,n,r.length?u:null,0==i,l,a))){if(s<h.length){let e=h[s];e&&(n<e.length||e.breakAfter&&(null==u?void 0:u.breakAfter))?(t==s&&(e=e.split(n),n=0),!d&&u&&e.merge(0,n,u,!0,0,a)?r[r.length-1]=e:((n||e.children.length&&!e.children[0].length)&&e.merge(0,n,null,!1,0,a),r.push(e))):(null==e?void 0:e.breakAfter)&&(u?u.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),t++));t<s&&r.length;)if(h[s-1].become(r[r.length-1]))s--,r.pop(),a=r.length?0:l;else{if(!h[t].become(r[0]))break;t++,r.shift(),l=r.length?0:a}!r.length&&t&&s<h.length&&!h[t-1].breakAfter&&h[s].merge(0,0,h[t-1],!1,l,a)&&t--,(t<s||r.length)&&e.replaceChildren(t,s,r)}}function xa(e,t,i,s,n,r){let o=e.childCursor(),{i:l,off:a}=o.findPos(i,1),{i:h,off:c}=o.findPos(t,-1),u=t-i;for(let d of s)u+=d.length;e.length+=u,wa(e,h,c,l,a,s,0,n,r)}let ka="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Sa="undefined"!=typeof document?document:{documentElement:{style:{}}};const Ca=/Edge\/(\d+)/.exec(ka.userAgent),Ma=/MSIE \d/.test(ka.userAgent),Aa=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ka.userAgent),Oa=!!(Ma||Aa||Ca),Ta=!Oa&&/gecko\/(\d+)/i.test(ka.userAgent),Da=!Oa&&/Chrome\/(\d+)/.exec(ka.userAgent),Ea="webkitFontSmoothing"in Sa.documentElement.style,Ra=!Oa&&/Apple Computer/.test(ka.vendor),La=Ra&&(/Mobile\/\w+/.test(ka.userAgent)||ka.maxTouchPoints>2);var Ba={mac:La||/Mac/.test(ka.platform),windows:/Win/.test(ka.platform),linux:/Linux|X11/.test(ka.platform),ie:Oa,ie_version:Ma?Sa.documentMode||6:Aa?+Aa[1]:Ca?+Ca[1]:0,gecko:Ta,gecko_version:Ta?+(/Firefox\/(\d+)/.exec(ka.userAgent)||[0,0])[1]:0,chrome:!!Da,chrome_version:Da?+Da[1]:0,ios:La,android:/Android\b/.test(ka.userAgent),safari:Ra,webkit_version:Ea?+(/\bAppleWebKit\/(\d+)/.exec(ka.userAgent)||[0,0])[1]:0,tabSize:null!=Sa.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};let Pa=class e extends va{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){3==e.nodeType&&this.createDOM(e)}merge(t,i,s){return!(8&this.flags||s&&(!(s instanceof e)||this.length-(i-t)+s.length>256||8&s.flags))&&(this.text=this.text.slice(0,t)+(s?s.text:"")+this.text.slice(i),this.markDirty(),!0)}split(t){let i=new e(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),i.flags|=8&this.flags,i}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new ga(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return function(e,t,i){let s=e.nodeValue.length;t>s&&(t=s);let n=t,r=t,o=0;0==t&&i<0||t==s&&i>=0?Ba.chrome||Ba.gecko||(t?(n--,o=1):r<s&&(r++,o=-1)):i<0?n--:r<s&&r++;let l=ha(e,n,r).getClientRects();if(!l.length)return null;let a=l[(o?o<0:i>=0)?0:l.length-1];Ba.safari&&!o&&0==a.width&&(a=Array.prototype.find.call(l,e=>e.width)||a);return o?ia(a,o<0):a||null}(this.dom,e,t)}},Na=class e extends va{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let s of t)s.setParent(this)}setAttrs(e){if(ua(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!(8&(this.flags|e.flags))}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?4&this.flags&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(t,i,s,n,r,o){return(!s||!(!(s instanceof e&&s.mark.eq(this.mark))||t&&r<=0||i<this.length&&o<=0))&&(xa(this,t,i,s?s.children.slice():[],r-1,o-1),this.markDirty(),!0)}split(t){let i=[],s=0,n=-1,r=0;for(let e of this.children){let o=s+e.length;o>t&&i.push(s<t?e.split(t-s):e),n<0&&s>=t&&(n=r),s=o,r++}let o=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new e(this.mark,i,o)}domAtPos(e){return Ha(this,e)}coordsAt(e,t){return za(this,e,t)}};let Va=class e extends va{static create(t,i,s){return new e(t,i,s)}constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}split(t){let i=e.create(this.widget,this.length-t,this.side);return this.length-=t,i}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(t,i,s,n,r,o){return!(s&&(!(s instanceof e&&this.widget.compare(s.widget))||t>0&&r<=0||i<this.length&&o<=0))&&(this.length=t+(s?s.length:0)+(this.length-i),!0)}become(t){return t instanceof e&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.compare(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(0==this.length)return Xr.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,i=t&&t.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):Xr.empty}domAtPos(e){return(this.length?0==e:this.side>0)?ga.before(this.dom):ga.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);if(i)return i;let s=this.dom.getClientRects(),n=null;if(!s.length)return null;let r=this.side?this.side<0:e>0;for(let o=r?s.length-1:0;n=s[o],!(e>0?0==o:o==s.length-1||n.top<n.bottom);o+=r?-1:1);return ia(n,!r)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},Ia=class e extends va{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(t){return t instanceof e&&t.side==this.side}split(){return new e(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?ga.before(this.dom):ga.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Xr.empty}get isHidden(){return!0}};function Ha(e,t){let i=e.dom,{children:s}=e,n=0;for(let r=0;n<s.length;n++){let e=s[n],o=r+e.length;if(!(o==r&&e.getSide()<=0)){if(t>r&&t<o&&e.dom.parentNode==i)return e.domAtPos(t-r);if(t<=r)break;r=o}}for(let r=n;r>0;r--){let e=s[r-1];if(e.dom.parentNode==i)return e.domAtPos(e.length)}for(let r=n;r<s.length;r++){let e=s[r];if(e.dom.parentNode==i)return e.domAtPos(0)}return new ga(i,0)}function Fa(e,t,i){let s,{children:n}=e;i>0&&t instanceof Na&&n.length&&(s=n[n.length-1])instanceof Na&&s.mark.eq(t.mark)?Fa(s,t.children[0],i-1):(n.push(t),t.setParent(e)),e.length+=t.length}function za(e,t,i){let s=null,n=-1,r=null,o=-1;!function e(t,l){for(let a=0,h=0;a<t.children.length&&h<=l;a++){let c=t.children[a],u=h+c.length;u>=l&&(c.children.length?e(c,l-h):(!r||r.isHidden&&(i>0||Wa(r,c)))&&(u>l||h==u&&c.getSide()>0)?(r=c,o=l-h):(h<l||h==u&&c.getSide()<0&&!c.isHidden)&&(s=c,n=l-h)),h=u}}(e,t);let l=(i<0?s:r)||s||r;return l?l.coordsAt(Math.max(0,l==s?n:o),i):function(e){let t=e.dom.lastChild;if(!t)return e.dom.getBoundingClientRect();let i=Yl(t);return i[i.length-1]||null}(e)}function Wa(e,t){let i=e.coordsAt(0,1),s=t.coordsAt(0,1);return i&&s&&s.top<i.bottom}function $a(e,t){for(let i in e)"class"==i&&t.class?t.class+=" "+e.class:"style"==i&&t.style?t.style+=";"+e.style:t[i]=e[i];return t}Pa.prototype.children=Va.prototype.children=Ia.prototype.children=ma;const ja=Object.create(null);function qa(e,t,i){if(e==t)return!0;e||(e=ja),t||(t=ja);let s=Object.keys(e),n=Object.keys(t);if(s.length-(i&&s.indexOf(i)>-1?1:0)!=n.length-(i&&n.indexOf(i)>-1?1:0))return!1;for(let r of s)if(r!=i&&(-1==n.indexOf(r)||e[r]!==t[r]))return!1;return!0}function _a(e,t,i){let s=!1;if(t)for(let n in t)i&&n in i||(s=!0,"style"==n?e.style.cssText="":e.removeAttribute(n));if(i)for(let n in i)t&&t[n]==i[n]||(s=!0,"style"==n?e.style.cssText=i[n]:e.setAttribute(n,i[n]));return s}function Ka(e){let t=Object.create(null);for(let i=0;i<e.attributes.length;i++){let s=e.attributes[i];t[s.name]=s.value}return t}let Ua=class{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}};var Ga=function(e){return e[e.Text=0]="Text",e[e.WidgetBefore=1]="WidgetBefore",e[e.WidgetAfter=2]="WidgetAfter",e[e.WidgetRange=3]="WidgetRange",e}(Ga||(Ga={}));let Ja=class extends ml{constructor(e,t,i,s){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(e){return new Ya(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new Qa(e,t,t,i,e.widget||null,!1)}static replace(e){let t,i,s=!!e.block;if(e.isBlockGap)t=-5e8,i=4e8;else{let{start:n,end:r}=Za(e,s);t=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new Qa(e,t,i,s,e.widget||null,!0)}static line(e){return new Xa(e)}static set(e,t=!1){return wl.of(e,t)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}};Ja.none=wl.empty;let Ya=class e extends Ja{constructor(e){let{start:t,end:i}=Za(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(t){var i,s;return this==t||t instanceof e&&this.tagName==t.tagName&&(this.class||(null===(i=this.attrs)||void 0===i?void 0:i.class))==(t.class||(null===(s=t.attrs)||void 0===s?void 0:s.class))&&qa(this.attrs,t.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}};Ya.prototype.point=!1;let Xa=class e extends Ja{constructor(e){super(-2e8,-2e8,null,e)}eq(t){return t instanceof e&&this.spec.class==t.spec.class&&qa(this.spec.attributes,t.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}};Xa.prototype.mapMode=fo.TrackBefore,Xa.prototype.point=!0;let Qa=class e extends Ja{constructor(e,t,i,s,n,r){super(t,i,n,e),this.block=s,this.isReplace=r,this.mapMode=s?t<=0?fo.TrackBefore:fo.TrackAfter:fo.TrackDel}get type(){return this.startSide!=this.endSide?Ga.WidgetRange:this.startSide<=0?Ga.WidgetBefore:Ga.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(t){return t instanceof e&&(i=this.widget,s=t.widget,i==s||!!(i&&s&&i.compare(s)))&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide;var i,s}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}};function Za(e,t=!1){let{inclusiveStart:i,inclusiveEnd:s}=e;return null==i&&(i=e.inclusive),null==s&&(s=e.inclusive),{start:null!=i?i:t,end:null!=s?s:t}}function eh(e,t,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=e?i[n]=Math.max(i[n],t):i.push(e,t)}Qa.prototype.point=!0;let th=class e extends va{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,i,s,n,r,o){if(s){if(!(s instanceof e))return!1;this.dom||s.transferDOM(this)}return n&&this.setDeco(s?s.attrs:null),xa(this,t,i,s?s.children.slice():[],r,o),!0}split(t){let i=new e;if(i.breakAfter=this.breakAfter,0==this.length)return i;let{i:s,off:n}=this.childPos(t);n&&(i.append(this.children[s].split(n),0),this.children[s].merge(n,this.children[s].length,null,!1,0,0),s++);for(let e=s;e<this.children.length;e++)i.append(this.children[e],0);for(;s>0&&0==this.children[s-1].length;)this.children[--s].destroy();return this.children.length=s,this.markDirty(),this.length=t,i}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){qa(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Fa(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=$a(t,this.attrs||{})),i&&(this.attrs=$a({class:i},this.attrs||{}))}domAtPos(e){return Ha(this,e)}reuseDOM(e){"DIV"==e.nodeName&&(this.setDOM(e),this.flags|=6)}sync(e,t){var i;this.dom?4&this.flags&&(ua(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(_a(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let s=this.dom.lastChild;for(;s&&va.get(s)instanceof Na;)s=s.lastChild;if(!(s&&this.length&&("BR"==s.nodeName||0!=(null===(i=va.get(s))||void 0===i?void 0:i.isEditable)||Ba.ios&&this.children.some(e=>e instanceof Pa)))){let e=document.createElement("BR");e.cmIgnore=!0,this.dom.appendChild(e)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let e,t=0;for(let i of this.children){if(!(i instanceof Pa)||/[^ -~]/.test(i.text))return null;let s=Yl(i.dom);if(1!=s.length)return null;t+=s[0].width,e=s[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(e,t){let i=za(this,e,t);if(!this.children.length&&i&&this.parent){let{heightOracle:e}=this.parent.view.viewState,t=i.bottom-i.top;if(Math.abs(t-e.lineHeight)<2&&e.textHeight<t){let s=(t-e.textHeight)/2;return{top:i.top+s,bottom:i.bottom-s,left:i.left,right:i.left}}}return i}become(t){return t instanceof e&&0==this.children.length&&0==t.children.length&&qa(this.attrs,t.attrs)&&this.breakAfter==t.breakAfter}covers(){return!0}static find(t,i){for(let s=0,n=0;s<t.children.length;s++){let r=t.children[s],o=n+r.length;if(o>=i){if(r instanceof e)return r;if(o>i)break}n=o+r.breakAfter}return null}},ih=class e extends va{constructor(e,t,i){super(),this.widget=e,this.length=t,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(t,i,s,n,r,o){return!(s&&(!(s instanceof e&&this.widget.compare(s.widget))||t>0&&r<=0||i<this.length&&o<=0))&&(this.length=t+(s?s.length:0)+(this.length-i),!0)}domAtPos(e){return 0==e?ga.before(this.dom):ga.after(this.dom,e==this.length)}split(t){let i=this.length-t;this.length=t;let s=new e(this.widget,i,this.deco);return s.breakAfter=this.breakAfter,s}get children(){return ma}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Xr.empty}domBoundsAround(){return null}become(t){return t instanceof e&&t.widget.constructor==this.widget.constructor&&(t.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.deco=t.deco,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);return i||(this.widget instanceof sh?null:ia(this.dom.getBoundingClientRect(),this.length?0==e:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:i}=this.deco;return t!=i&&(e<0?t<0:i>0)}},sh=class extends Ua{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}},nh=class e{constructor(e,t,i,s){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof ih&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new th),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(rh(new Ia(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||e&&this.content.length&&this.content[this.content.length-1]instanceof ih||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:t,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}this.text=t,this.textOff=0}let s=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-i)),this.getLine().append(rh(new Pa(this.text.slice(this.textOff,this.textOff+s)),t),i),this.atCursorPos=!0,this.textOff+=s,e-=s,i=0}}span(e,t,i,s){this.buildText(t-e,i,s),this.pos=t,this.openStart<0&&(this.openStart=s)}point(e,t,i,s,n,r){if(this.disallowBlockEffectsFor[r]&&i instanceof Qa){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=t-e;if(i instanceof Qa)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new ih(i.widget||oh.block,o,i));else{let r=Va.create(i.widget||oh.inline,o,o?0:i.startSide),l=this.atCursorPos&&!r.isEditable&&n<=s.length&&(e<t||i.startSide>0),a=!r.isEditable&&(e<t||n>s.length||i.startSide<=0),h=this.getLine();2!=this.pendingBuffer||l||r.isEditable||(this.pendingBuffer=0),this.flushBuffer(s),l&&(h.append(rh(new Ia(1),s),n),n=s.length+Math.max(0,n-s.length)),h.append(rh(r,s),n),this.atCursorPos=a,this.pendingBuffer=a?e<t||n>s.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=s.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=n)}static build(t,i,s,n,r){let o=new e(t,i,s,r);return o.openEnd=wl.spans(n,i,s,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}};function rh(e,t){for(let i of t)e=new Na(i,[e],e.length);return e}let oh=class extends Ua{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}};oh.inline=new oh("span"),oh.block=new oh("div");var lh=function(e){return e[e.LTR=0]="LTR",e[e.RTL=1]="RTL",e}(lh||(lh={}));const ah=lh.LTR,hh=lh.RTL;function ch(e){let t=[];for(let i=0;i<e.length;i++)t.push(1<<+e[i]);return t}const uh=ch("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),dh=ch("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),fh=Object.create(null),ph=[];for(let nM of["()","[]","{}"]){let e=nM.charCodeAt(0),t=nM.charCodeAt(1);fh[e]=t,fh[t]=-e}function gh(e){return e<=247?uh[e]:1424<=e&&e<=1524?2:1536<=e&&e<=1785?dh[e-1536]:1774<=e&&e<=2220?4:8192<=e&&e<=8204?256:64336<=e&&e<=65023?4:1}const mh=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;let vh=class{get dir(){return this.level%2?hh:ah}constructor(e,t,i){this.from=e,this.to=t,this.level=i}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,i,s){let n=-1;for(let r=0;r<e.length;r++){let o=e[r];if(o.from<=t&&o.to>=t){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<t:o.to>t:e[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}};function yh(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let s=e[i],n=t[i];if(s.from!=n.from||s.to!=n.to||s.direction!=n.direction||!yh(s.inner,n.inner))return!1}return!0}const bh=[];function wh(e,t,i,s,n,r,o){let l=s%2?2:1;if(s%2==n%2)for(let a=t,h=0;a<i;){let t=!0,c=!1;if(h==r.length||a<r[h].from){let e=bh[a];e!=l&&(t=!1,c=16==e)}let u=t||1!=l?null:[],d=t?s:s+1,f=a;e:for(;;)if(h<r.length&&f==r[h].from){if(c)break e;let p=r[h];if(!t)for(let e=p.to,t=h+1;;){if(e==i)break e;if(!(t<r.length&&r[t].from==e)){if(bh[e]==l)break e;break}e=r[t++].to}if(h++,u)u.push(p);else{p.from>a&&o.push(new vh(a,p.from,d)),xh(e,p.direction==ah!=!(d%2)?s+1:s,n,p.inner,p.from,p.to,o),a=p.to}f=p.to}else{if(f==i||(t?bh[f]!=l:bh[f]==l))break;f++}u?wh(e,a,f,s+1,n,u,o):a<f&&o.push(new vh(a,f,d)),a=f}else for(let a=i,h=r.length;a>t;){let i=!0,c=!1;if(!h||a>r[h-1].to){let e=bh[a-1];e!=l&&(i=!1,c=16==e)}let u=i||1!=l?null:[],d=i?s:s+1,f=a;e:for(;;)if(h&&f==r[h-1].to){if(c)break e;let p=r[--h];if(!i)for(let e=p.from,i=h;;){if(e==t)break e;if(!i||r[i-1].to!=e){if(bh[e-1]==l)break e;break}e=r[--i].from}if(u)u.push(p);else{p.to<a&&o.push(new vh(p.to,a,d)),xh(e,p.direction==ah!=!(d%2)?s+1:s,n,p.inner,p.from,p.to,o),a=p.from}f=p.from}else{if(f==t||(i?bh[f-1]!=l:bh[f-1]==l))break;f--}u?wh(e,f,a,s+1,n,u,o):f<a&&o.push(new vh(f,a,d)),a=f}}function xh(e,t,i,s,n,r,o){let l=t%2?2:1;!function(e,t,i,s,n){for(let r=0;r<=s.length;r++){let o=r?s[r-1].to:t,l=r<s.length?s[r].from:i,a=r?256:n;for(let t=o,i=a,s=a;t<l;t++){let n=gh(e.charCodeAt(t));512==n?n=i:8==n&&4==s&&(n=16),bh[t]=4==n?2:n,7&n&&(s=n),i=n}for(let e=o,t=a,s=a;e<l;e++){let n=bh[e];if(128==n)e<l-1&&t==bh[e+1]&&24&t?n=bh[e]=t:bh[e]=256;else if(64==n){let n=e+1;for(;n<l&&64==bh[n];)n++;let r=e&&8==t||n<i&&8==bh[n]?1==s?1:8:256;for(let t=e;t<n;t++)bh[t]=r;e=n-1}else 8==n&&1==s&&(bh[e]=1);t=n,7&n&&(s=n)}}}(e,n,r,s,l),function(e,t,i,s,n){let r=1==n?2:1;for(let o=0,l=0,a=0;o<=s.length;o++){let h=o?s[o-1].to:t,c=o<s.length?s[o].from:i;for(let t,i,s,o=h;o<c;o++)if(i=fh[t=e.charCodeAt(o)])if(i<0){for(let e=l-3;e>=0;e-=3)if(ph[e+1]==-i){let t=ph[e+2],i=2&t?n:4&t?1&t?r:n:0;i&&(bh[o]=bh[ph[e]]=i),l=e;break}}else{if(189==ph.length)break;ph[l++]=o,ph[l++]=t,ph[l++]=a}else if(2==(s=bh[o])||1==s){let e=s==n;a=e?0:1;for(let t=l-3;t>=0;t-=3){let i=ph[t+2];if(2&i)break;if(e)ph[t+2]|=2;else{if(4&i)break;ph[t+2]|=4}}}}}(e,n,r,s,l),function(e,t,i,s){for(let n=0,r=s;n<=i.length;n++){let o=n?i[n-1].to:e,l=n<i.length?i[n].from:t;for(let a=o;a<l;){let o=bh[a];if(256==o){let o=a+1;for(;;)if(o==l){if(n==i.length)break;o=i[n++].to,l=n<i.length?i[n].from:t}else{if(256!=bh[o])break;o++}let h=1==r,c=h==(1==(o<t?bh[o]:s))?h?1:2:s;for(let t=o,s=n,r=s?i[s-1].to:e;t>a;)t==r&&(t=i[--s].from,r=s?i[s-1].to:e),bh[--t]=c;a=o}else r=o,a++}}}(n,r,s,l),wh(e,n,r,t,i,s,o)}function kh(e){return[new vh(0,e,0)]}let Sh="";function Ch(e,t,i,s,n){var r;let o=s.head-e.from,l=vh.find(t,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc),a=t[l],h=a.side(n,i);if(o==h){let e=l+=n?1:-1;if(e<0||e>=t.length)return null;a=t[l=e],o=a.side(!n,i),h=a.side(n,i)}let c=lo(e.text,o,a.forward(n,i));(c<a.from||c>a.to)&&(c=h),Sh=e.text.slice(Math.min(o,c),Math.max(o,c));let u=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return u&&c==h&&u.level+(n?0:1)<a.level?So.cursor(u.side(!n,i)+e.from,u.forward(n,i)?1:-1,u.level):So.cursor(c+e.from,a.forward(n,i)?-1:1,a.level)}function Mh(e,t,i){for(let s=t;s<i;s++){let t=gh(e.charCodeAt(s));if(1==t)return ah;if(2==t||4==t)return hh}return ah}const Ah=Ao.define(),Oh=Ao.define(),Th=Ao.define(),Dh=Ao.define(),Eh=Ao.define(),Rh=Ao.define(),Lh=Ao.define(),Bh=Ao.define(),Ph=Ao.define(),Nh=Ao.define({combine:e=>e.some(e=>e)}),Vh=Ao.define({combine:e=>e.some(e=>e)}),Ih=Ao.define();let Hh=class e{constructor(e,t="nearest",i="nearest",s=5,n=5,r=!1){this.range=e,this.y=t,this.x=i,this.yMargin=s,this.xMargin=n,this.isSnapshot=r}map(t){return t.empty?this:new e(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(t){return this.range.to<=t.doc.length?this:new e(So.cursor(t.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}};const Fh=il.define({map:(e,t)=>e.map(t)}),zh=il.define();function Wh(e,t,i){let s=e.facet(Dh);s.length?s[0](t):window.onerror&&window.onerror(String(t),i,void 0,void 0,t)||(i?console.error(i+":",t):console.error(t))}const $h=Ao.define({combine:e=>!e.length||e[0]});let jh=0;const qh=Ao.define({combine:e=>e.filter((t,i)=>{for(let s=0;s<i;s++)if(e[s].plugin==t.plugin)return!1;return!0})});let _h=class e{constructor(e,t,i,s,n){this.id=e,this.create=t,this.domEventHandlers=i,this.domEventObservers=s,this.baseExtensions=n(this),this.extension=this.baseExtensions.concat(qh.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(qh.of({plugin:this,arg:e}))}static define(t,i){const{eventHandlers:s,eventObservers:n,provide:r,decorations:o}=i||{};return new e(jh++,t,s,n,e=>{let t=[];return o&&t.push(Jh.of(t=>{let i=t.plugin(e);return i?o(i):Ja.none})),r&&t.push(r(e)),t})}static fromClass(t,i){return e.define((e,i)=>new t(e,i),i)}},Kh=class{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(t){if(Wh(e.state,t,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(sM){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){Wh(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(null===(t=this.value)||void 0===t?void 0:t.destroy)try{this.value.destroy()}catch(i){Wh(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}};const Uh=Ao.define(),Gh=Ao.define(),Jh=Ao.define(),Yh=Ao.define(),Xh=Ao.define(),Qh=Ao.define();function Zh(e,t){let i=e.state.facet(Qh);if(!i.length)return i;let s=i.map(t=>t instanceof Function?t(e):t),n=[];return wl.spans(s,t.from,t.to,{point(){},span(e,i,s,r){let o=e-t.from,l=i-t.from,a=n;for(let n=s.length-1;n>=0;n--,r--){let e,i=s[n].spec.bidiIsolate;if(null==i&&(i=Mh(t.text,o,l)),r>0&&a.length&&(e=a[a.length-1]).to==o&&e.direction==i)e.to=l,a=e.inner;else{let e={from:o,to:l,direction:i,inner:[]};a.push(e),a=e.inner}}}}),n}const ec=Ao.define();function tc(e){let t=0,i=0,s=0,n=0;for(let r of e.state.facet(ec)){let o=r(e);o&&(null!=o.left&&(t=Math.max(t,o.left)),null!=o.right&&(i=Math.max(i,o.right)),null!=o.top&&(s=Math.max(s,o.top)),null!=o.bottom&&(n=Math.max(n,o.bottom)))}return{left:t,right:i,top:s,bottom:n}}const ic=Ao.define();let sc=class e{constructor(e,t,i,s){this.fromA=e,this.toA=t,this.fromB=i,this.toB=s}join(t){return new e(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let s=e[t-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(t,i){if(0==i.length)return t;let s=[];for(let n=0,r=0,o=0,l=0;;n++){let a=n==t.length?null:t[n],h=o-l,c=a?a.fromB:1e9;for(;r<i.length&&i[r]<c;){let t=i[r],n=i[r+1],o=Math.max(l,t),a=Math.min(c,n);if(o<=a&&new e(o+h,a+h,o,a).addToSet(s),n>c)break;r+=2}if(!a)return s;new e(a.fromA,a.toA,a.fromB,a.toB).addToSet(s),o=a.toA,l=a.toB}}},nc=class e{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=go.empty(this.startState.doc.length);for(let n of i)this.changes=this.changes.compose(n.changes);let s=[];this.changes.iterChangedRanges((e,t,i,n)=>s.push(new sc(e,t,i,n))),this.changedRanges=s}static create(t,i,s){return new e(t,i,s)}get viewportChanged(){return(4&this.flags)>0}get viewportMoved(){return(8&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(18&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return 0==this.flags&&0==this.transactions.length}},rc=class extends va{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Ja.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new th],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new sc(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:e,toA:t})=>t<this.minWidthFrom||e>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&((null===(t=this.domChanged)||void 0===t?void 0:t.newSel)?s=this.domChanged.newSel.head:function(e,t){let i=!1;t&&e.iterChangedRanges((e,s)=>{e<t.to&&s>t.from&&(i=!0)});return i}(e.changes,this.hasComposition)||e.selectionSet||(s=e.state.selection.main.head));let n=s>-1?function(e,t,i){let s=oc(e,i);if(!s)return null;let{node:n,from:r,to:o}=s,l=n.nodeValue;if(/[\n\r]/.test(l))return null;if(e.state.doc.sliceString(s.from,s.to)!=l)return null;let a=t.invertedDesc,h=new sc(a.mapPos(r),a.mapPos(o),r,o),c=[];for(let u=n.parentNode;;u=u.parentNode){let t=va.get(u);if(t instanceof Na)c.push({node:u,deco:t.mark});else{if(t instanceof th||"DIV"==u.nodeName&&u.parentNode==e.contentDOM)return{range:h,text:n,marks:c,line:u};if(u==e.contentDOM)return null;c.push({node:u,deco:new Ya({inclusive:!0,attributes:Ka(u),tagName:u.tagName.toLowerCase()})})}}}(this.view,e.changes,s):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:t,to:s}=this.hasComposition;i=new sc(t,s,e.changes.mapPos(t,-1),e.changes.mapPos(s,1)).addToSet(i.slice())}this.hasComposition=n?{from:n.range.fromB,to:n.range.toB}:null,(Ba.ie||Ba.chrome)&&!n&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let r=function(e,t,i){let s=new lc;return wl.compare(e,t,i,s),s.changes}(this.decorations,this.updateDeco(),e.changes);return i=sc.extendWithRanges(i,r),!!(7&this.flags||0!=i.length)&&(this.updateInner(i,e.startState.doc.length,n),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,i);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let e=Ba.chrome||Ba.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,e),this.flags&=-8,e&&(e.written||s.selectionRange.focusNode!=e.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(e=>e.flags&=-9);let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let r of this.children)r instanceof ih&&r.widget instanceof sh&&n.push(r.dom);s.updateGaps(n)}updateChildren(e,t,i){let s=i?i.range.addToSet(e.slice()):e,n=this.childCursor(t);for(let r=s.length-1;;r--){let e=r>=0?s[r]:null;if(!e)break;let t,o,l,a,{fromA:h,toA:c,fromB:u,toB:d}=e;if(i&&i.range.fromB<d&&i.range.toB>u){let e=nh.build(this.view.state.doc,u,i.range.fromB,this.decorations,this.dynamicDecorationMap),s=nh.build(this.view.state.doc,i.range.toB,d,this.decorations,this.dynamicDecorationMap);o=e.breakAtStart,l=e.openStart,a=s.openEnd;let n=this.compositionView(i);s.breakAtStart?n.breakAfter=1:s.content.length&&n.merge(n.length,n.length,s.content[0],!1,s.openStart,0)&&(n.breakAfter=s.content[0].breakAfter,s.content.shift()),e.content.length&&n.merge(0,0,e.content[e.content.length-1],!0,0,e.openEnd)&&e.content.pop(),t=e.content.concat(n).concat(s.content)}else({content:t,breakAtStart:o,openStart:l,openEnd:a}=nh.build(this.view.state.doc,u,d,this.decorations,this.dynamicDecorationMap));let{i:f,off:p}=n.findPos(c,1),{i:g,off:m}=n.findPos(h,-1);wa(this,g,m,f,p,t,o,l,a)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let e of t.effects)e.is(zh)&&(this.editContextFormatting=e.value)}compositionView(e){let t=new Pa(e.text.nodeValue);t.flags|=8;for(let{deco:s}of e.marks)t=new Na(s,[t],t.length);let i=new th;return i.append(t,0),i}fixCompositionDOM(e){let t=(e,t)=>{t.flags|=8|(t.children.some(e=>7&e.flags)?1:0),this.markedForComposition.add(t);let i=va.get(e);i&&i!=t&&(i.dom=null),t.setDOM(e)},i=this.childPos(e.range.fromB,1),s=this.children[i.i];t(e.line,s);for(let n=e.marks.length-1;n>=-1;n--)i=s.childPos(i.off,1),s=s.children[i.i],t(n>=0?e.marks[n].node:e.text,s)}updateSelection(e=!1,t=!1){!e&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange();let i=this.view.root.activeElement,s=i==this.dom,n=!s&&!(this.view.state.facet($h)||this.dom.tabIndex>-1)&&Jl(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(s||t||n))return;let r=this.forceSelection;this.forceSelection=!1;let o=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(o.anchor)),a=o.empty?l:this.moveToLine(this.domAtPos(o.head));if(Ba.gecko&&o.empty&&!this.hasComposition&&(1==(h=l).node.nodeType&&h.node.firstChild&&(0==h.offset||"false"==h.node.childNodes[h.offset-1].contentEditable)&&(h.offset==h.node.childNodes.length||"false"==h.node.childNodes[h.offset].contentEditable))){let e=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(e,l.node.childNodes[l.offset]||null)),l=a=new ga(e,0),r=!0}var h;let c=this.view.observer.selectionRange;!r&&c.focusNode&&(Xl(l.node,l.offset,c.anchorNode,c.anchorOffset)&&Xl(a.node,a.offset,c.focusNode,c.focusOffset)||this.suppressWidgetCursorChange(c,o))||(this.view.observer.ignore(()=>{Ba.android&&Ba.chrome&&this.dom.contains(c.focusNode)&&function(e,t){for(let i=e;i&&i!=t;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let e=Ul(this.view.root);if(e)if(o.empty){if(Ba.gecko){let e=(t=l.node,s=l.offset,1!=t.nodeType?0:(s&&"false"==t.childNodes[s-1].contentEditable?1:0)|(s<t.childNodes.length&&"false"==t.childNodes[s].contentEditable?2:0));if(e&&3!=e){let t=(1==e?fa:pa)(l.node,l.offset);t&&(l=new ga(t.node,t.offset))}}e.collapse(l.node,l.offset),null!=o.bidiLevel&&void 0!==e.caretBidiLevel&&(e.caretBidiLevel=o.bidiLevel)}else if(e.extend){e.collapse(l.node,l.offset);try{e.extend(a.node,a.offset)}catch(sM){}}else{let t=document.createRange();o.anchor>o.head&&([l,a]=[a,l]),t.setEnd(a.node,a.offset),t.setStart(l.node,l.offset),e.removeAllRanges(),e.addRange(t)}else;var t,s;n&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(l,a)),this.impreciseAnchor=l.precise?null:new ga(c.anchorNode,c.anchorOffset),this.impreciseHead=a.precise?null:new ga(c.focusNode,c.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&Xl(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,i=Ul(e.root),{anchorNode:s,anchorOffset:n}=e.observer.selectionRange;if(!(i&&t.empty&&t.assoc&&i.modify))return;let r=th.find(this,t.head);if(!r)return;let o=r.posAtStart;if(t.head==o||t.head==o+r.length)return;let l=this.coordsAt(t.head,-1),a=this.coordsAt(t.head,1);if(!l||!a||l.bottom>a.top)return;let h=this.domAtPos(t.head+t.assoc);i.collapse(h.node,h.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let c=e.observer.selectionRange;e.docView.posFromDOM(c.anchorNode,c.anchorOffset)!=t.from&&i.collapse(s,n)}moveToLine(e){let t,i=this.dom;if(e.node!=i)return e;for(let s=e.offset;!t&&s<i.childNodes.length;s++){let e=va.get(i.childNodes[s]);e instanceof th&&(t=e.domAtPos(0))}for(let s=e.offset-1;!t&&s>=0;s--){let e=va.get(i.childNodes[s]);e instanceof th&&(t=e.domAtPos(e.length))}return t?new ga(t.node,t.offset,!0):e}nearest(e){for(let t=e;t;){let e=va.get(t);if(e&&e.rootView==this)return e;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let e=this.children[t];if(i<e.length||e instanceof th)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){let i=null,s=0;for(let n=this.length,r=this.children.length-1;r>=0;r--){let o=this.children[r],l=n-o.breakAfter,a=l-o.length;if(l<e)break;if(a<=e&&(a<e||o.covers(-1))&&(l>e||o.covers(1))&&(!i||o instanceof th&&!(i instanceof th&&t>=0)))i=o,s=a;else if(i&&a==e&&l==e&&o instanceof ih&&Math.abs(t)<2){if(o.deco.startSide<0)break;r&&(i=null)}n=a}return i?i.coordsAt(e-s,t):null}coordsForChar(e){let{i:t,off:i}=this.childPos(e,1),s=this.children[t];if(!(s instanceof th))return null;for(;s.children.length;){let{i:e,off:t}=s.childPos(i,1);for(;;e++){if(e==s.children.length)return null;if((s=s.children[e]).length)break}i=t}if(!(s instanceof Pa))return null;let n=lo(s.text,i);if(n==i)return null;let r=ha(s.dom,i,n).getClientRects();for(let o=0;o<r.length;o++){let e=r[o];if(o==r.length-1||e.top<e.bottom&&e.left<e.right)return e}return null}measureVisibleLineHeights(e){let t=[],{from:i,to:s}=e,n=this.view.contentDOM.clientWidth,r=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,l=this.view.textDirection==lh.LTR;for(let a=0,h=0;h<this.children.length;h++){let e=this.children[h],c=a+e.length;if(c>s)break;if(a>=i){let i=e.dom.getBoundingClientRect();if(t.push(i.height),r){let t=e.dom.lastChild,s=t?Yl(t):[];if(s.length){let e=s[s.length-1],t=l?e.right-i.left:i.right-e.left;t>o&&(o=t,this.minWidth=n,this.minWidthFrom=a,this.minWidthTo=c)}}}a=c+e.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return"rtl"==getComputedStyle(this.children[t].dom).direction?lh.RTL:lh.LTR}measureTextSize(){for(let n of this.children)if(n instanceof th){let e=n.measureTextSize();if(e)return e}let e,t,i,s=document.createElement("div");return s.className="cm-line",s.style.width="99999px",s.style.position="absolute",s.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(s);let n=Yl(s.firstChild)[0];e=s.getBoundingClientRect().height,t=n?n.width/27:7,i=n?n.height:e,s.remove()}),{lineHeight:e,charWidth:t,textHeight:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new ba(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,s=0;;s++){let n=s==t.viewports.length?null:t.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=(t.lineBlockAt(r).bottom-t.lineBlockAt(i).top)/this.view.scaleY;e.push(Ja.replace({widget:new sh(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return Ja.set(e)}updateDeco(){let e=1,t=this.view.state.facet(Jh).map(t=>(this.dynamicDecorationMap[e++]="function"==typeof t)?t(this.view):t),i=!1,s=this.view.state.facet(Yh).map((e,t)=>{let s="function"==typeof e;return s&&(i=!0),s?e(this.view):e});for(s.length&&(this.dynamicDecorationMap[e++]=i,t.push(wl.join(s))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let t=this.view.viewState.lineBlockAt(e.range.head);return this.view.scrollDOM.scrollTop=t.top-e.yMargin,void(this.view.scrollDOM.scrollLeft=e.xMargin)}for(let h of this.view.state.facet(Ih))try{if(h(this.view,e.range,e))return!0}catch(a){Wh(this.view.state,a,"scroll handler")}let t,{range:i}=e,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(t=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,t.left),top:Math.min(s.top,t.top),right:Math.max(s.right,t.right),bottom:Math.max(s.bottom,t.bottom)});let n=tc(this.view),r={left:s.left-n.left,top:s.top-n.top,right:s.right+n.right,bottom:s.bottom+n.bottom},{offsetWidth:o,offsetHeight:l}=this.view.scrollDOM;!function(e,t,i,s,n,r,o,l){let a=e.ownerDocument,h=a.defaultView||window;for(let c=e,u=!1;c&&!u;)if(1==c.nodeType){let e,d=c==a.body,f=1,p=1;if(d)e=sa(h);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(u=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let t=c.getBoundingClientRect();({scaleX:f,scaleY:p}=na(c,t)),e={left:t.left,right:t.left+c.clientWidth*f,top:t.top,bottom:t.top+c.clientHeight*p}}let g=0,m=0;if("nearest"==n)t.top<e.top?(m=t.top-(e.top+o),i>0&&t.bottom>e.bottom+m&&(m=t.bottom-e.bottom+o)):t.bottom>e.bottom&&(m=t.bottom-e.bottom+o,i<0&&t.top-m<e.top&&(m=t.top-(e.top+o)));else{let s=t.bottom-t.top,r=e.bottom-e.top;m=("center"==n&&s<=r?t.top+s/2-r/2:"start"==n||"center"==n&&i<0?t.top-o:t.bottom-r+o)-e.top}if("nearest"==s?t.left<e.left?(g=t.left-(e.left+r),i>0&&t.right>e.right+g&&(g=t.right-e.right+r)):t.right>e.right&&(g=t.right-e.right+r,i<0&&t.left<e.left+g&&(g=t.left-(e.left+r))):g=("center"==s?t.left+(t.right-t.left)/2-(e.right-e.left)/2:"start"==s==l?t.left-r:t.right-(e.right-e.left)+r)-e.left,g||m)if(d)h.scrollBy(g,m);else{let e=0,i=0;if(m){let e=c.scrollTop;c.scrollTop+=m/p,i=(c.scrollTop-e)*p}if(g){let t=c.scrollLeft;c.scrollLeft+=g/f,e=(c.scrollLeft-t)*f}t={left:t.left-e,top:t.top-i,right:t.right-e,bottom:t.bottom-i},e&&Math.abs(e-g)<1&&(s="nearest"),i&&Math.abs(i-m)<1&&(n="nearest")}if(d)break;(t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right)&&(t={left:Math.max(t.left,e.left),right:Math.min(t.right,e.right),top:Math.max(t.top,e.top),bottom:Math.min(t.bottom,e.bottom)}),c=c.assignedSlot||c.parentNode}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,r,i.head<i.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,o),-o),Math.max(Math.min(e.yMargin,l),-l),this.view.textDirection==lh.LTR)}};function oc(e,t){let i=e.observer.selectionRange;if(!i.focusNode)return null;let s=fa(i.focusNode,i.focusOffset),n=pa(i.focusNode,i.focusOffset),r=s||n;if(n&&s&&n.node!=s.node){let t=va.get(n.node);if(!t||t instanceof Pa&&t.text!=n.node.nodeValue)r=n;else if(e.docView.lastCompositionAfterCursor){let e=va.get(s.node);!e||e instanceof Pa&&e.text!=s.node.nodeValue||(r=n)}}if(e.docView.lastCompositionAfterCursor=r!=s,!r)return null;let o=t-r.offset;return{from:o,to:o+r.node.nodeValue.length,node:r.node}}let lc=class{constructor(){this.changes=[]}compareRange(e,t){eh(e,t,this.changes)}comparePoint(e,t){eh(e,t,this.changes)}boundChange(e){eh(e,e,this.changes)}};function ac(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function hc(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function cc(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function uc(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function dc(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function fc(e,t,i){let s,n,r,o,l,a,h,c,u=!1;for(let f=e.firstChild;f;f=f.nextSibling){let e=Yl(f);for(let d=0;d<e.length;d++){let p=e[d];n&&cc(n,p)&&(p=uc(dc(p,n.bottom),n.top));let g=ac(t,p),m=hc(i,p);if(0==g&&0==m)return 3==f.nodeType?pc(f,t,i):fc(f,t,i);(!s||o>m||o==m&&r>g)&&(s=f,n=p,r=g,o=m,u=!g||(t<p.left?d>0:d<e.length-1)),0==g?i>p.bottom&&(!h||h.bottom<p.bottom)?(l=f,h=p):i<p.top&&(!c||c.top>p.top)&&(a=f,c=p):h&&cc(h,p)?h=dc(h,p.bottom):c&&cc(c,p)&&(c=uc(c,p.top))}}if(h&&h.bottom>=i?(s=l,n=h):c&&c.top<=i&&(s=a,n=c),!s)return{node:e,offset:0};let d=Math.max(n.left,Math.min(n.right,t));return 3==s.nodeType?pc(s,d,i):u&&"false"!=s.contentEditable?fc(s,d,i):{node:e,offset:Array.prototype.indexOf.call(e.childNodes,s)+(t>=(n.left+n.right)/2?1:0)}}function pc(e,t,i){let s=e.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<s;l++){let s=ha(e,l,l+1).getClientRects();for(let a=0;a<s.length;a++){let h=s[a];if(h.top==h.bottom)continue;o||(o=t-h.left);let c=(h.top>i?h.top-i:i-h.bottom)-1;if(h.left-1<=t&&h.right+1>=t&&c<r){let i=t>=(h.left+h.right)/2,s=i;if(Ba.chrome||Ba.gecko){ha(e,l).getBoundingClientRect().left==h.right&&(s=!i)}if(c<=0)return{node:e,offset:l+(s?1:0)};n=l+(s?1:0),r=c}}}return{node:e,offset:n>-1?n:o>0?e.nodeValue.length:0}}function gc(e,t,i,s=-1){var n,r;let o,l=e.contentDOM.getBoundingClientRect(),a=l.top+e.viewState.paddingTop,{docHeight:h}=e.viewState,{x:c,y:u}=t,d=u-a;if(d<0)return 0;if(d>h)return e.state.doc.length;for(let w=e.viewState.heightOracle.textHeight/2,x=!1;o=e.elementAtHeight(d),o.type!=Ga.Text;)for(;d=s>0?o.bottom+w:o.top-w,!(d>=0&&d<=h);){if(x)return i?null:0;x=!0,s=-s}u=a+d;let f=o.from;if(f<e.viewport.from)return 0==e.viewport.from?0:i?null:mc(e,l,o,c,u);if(f>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:i?null:mc(e,l,o,c,u);let p=e.dom.ownerDocument,g=e.root.elementFromPoint?e.root:p,m=g.elementFromPoint(c,u);m&&!e.contentDOM.contains(m)&&(m=null),m||(c=Math.max(l.left+1,Math.min(l.right-1,c)),m=g.elementFromPoint(c,u),m&&!e.contentDOM.contains(m)&&(m=null));let v,y=-1;if(m&&0!=(null===(n=e.docView.nearest(m))||void 0===n?void 0:n.isEditable)){if(p.caretPositionFromPoint){let e=p.caretPositionFromPoint(c,u);e&&({offsetNode:v,offset:y}=e)}else if(p.caretRangeFromPoint){let t=p.caretRangeFromPoint(c,u);t&&(({startContainer:v,startOffset:y}=t),(!e.contentDOM.contains(v)||Ba.safari&&function(e,t,i){let s,n=e;if(3!=e.nodeType||t!=(s=e.nodeValue.length))return!1;for(;;){let e=n.nextSibling;if(e){if("BR"==e.nodeName)break;return!1}{let e=n.parentNode;if(!e||"DIV"==e.nodeName)break;n=e}}return ha(e,s-1,s).getBoundingClientRect().right>i}(v,y,c)||Ba.chrome&&function(e,t,i){if(0!=t)return!1;for(let n=e;;){let e=n.parentNode;if(!e||1!=e.nodeType||e.firstChild!=n)return!1;if(e.classList.contains("cm-line"))break;n=e}let s=1==e.nodeType?e.getBoundingClientRect():ha(e,0,Math.max(e.nodeValue.length,1)).getBoundingClientRect();return i-s.left>5}(v,y,c))&&(v=void 0))}v&&(y=Math.min(ta(v),y))}if(!v||!e.docView.dom.contains(v)){let t=th.find(e.docView,f);if(!t)return d>o.top+o.height/2?o.to:o.from;({node:v,offset:y}=fc(t.dom,c,u))}let b=e.docView.nearest(v);if(!b)return null;if(b.isWidget&&1==(null===(r=b.dom)||void 0===r?void 0:r.nodeType)){let e=b.dom.getBoundingClientRect();return t.y<e.top||t.y<=e.bottom&&t.x<=(e.left+e.right)/2?b.posAtStart:b.posAtEnd}return b.localPosFromDOM(v,y)+b.posAtStart}function mc(e,t,i,s,n){let r=Math.round((s-t.left)*e.defaultCharacterWidth);if(e.lineWrapping&&i.height>1.5*e.defaultLineHeight){let t=e.viewState.heightOracle.textHeight;r+=Math.floor((n-i.top-.5*(e.defaultLineHeight-t))/t)*e.viewState.heightOracle.lineLength}let o=e.state.sliceDoc(i.from,i.to);return i.from+function(e,t,i){for(let s=0,n=0;;){if(n>=t)return s;if(s==e.length)break;n+=9==e.charCodeAt(s)?i-n%i:1,s=lo(e,s)}return e.length}(o,r,e.state.tabSize)}function vc(e,t,i){let s=e.lineBlockAt(t);if(Array.isArray(s.type)){let e;for(let n of s.type){if(n.from>t)break;if(!(n.to<t)){if(n.from<t&&n.to>t)return n;e&&(n.type!=Ga.Text||e.type==n.type&&!(i<0?n.from<t:n.to>t))||(e=n)}}return e||s}return s}function yc(e,t,i,s){let n=e.state.doc.lineAt(t.head),r=e.bidiSpans(n),o=e.textDirectionAt(n.from);for(let l=t,a=null;;){let t=Ch(n,r,o,l,i),h=Sh;if(!t){if(n.number==(i?e.state.doc.lines:1))return l;h="\n",n=e.state.doc.line(n.number+(i?1:-1)),r=e.bidiSpans(n),t=e.visualLineSide(n,!i)}if(a){if(!a(h))return l}else{if(!s)return t;a=s(h)}l=t}}function bc(e,t,i){for(;;){let s=0;for(let n of e)n.between(t-1,t+1,(e,n,r)=>{if(t>e&&t<n){let r=s||i||(t-e<n-t?-1:1);t=r<0?e:n,s=r}});if(!s)return t}}function wc(e,t){let i=null;for(let s=0;s<t.ranges.length;s++){let n=t.ranges[s],r=null;if(n.empty){let t=bc(e,n.from,0);t!=n.from&&(r=So.cursor(t,-1))}else{let t=bc(e,n.from,-1),i=bc(e,n.to,1);t==n.from&&i==n.to||(r=So.range(n.from==n.anchor?t:i,n.from==n.head?t:i))}r&&(i||(i=t.ranges.slice()),i[s]=r)}return i?So.create(i,t.mainIndex):t}function xc(e,t,i){let s=bc(e.state.facet(Xh).map(t=>t(e)),i.from,t.head>i.from?-1:1);return s==i.from?i:So.cursor(s,s<i.from?1:-1)}const kc="￿";let Sc=class{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(pl.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=kc}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let s=e;;){this.findPointBefore(i,s);let e=this.text.length;this.readNode(s);let n=s.nextSibling;if(n==t)break;let r=va.get(s),o=va.get(n);(r&&o?r.breakAfter:(r?r.breakAfter:Zl(s))||Zl(n)&&("BR"!=s.nodeName||s.cmIgnore)&&this.text.length>e)&&this.lineBreak(),s=n}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(t))&&(r=n.index,o=n[0].length),this.append(t.slice(i,r<0?t.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let t of this.points)t.node==e&&t.pos>this.text.length&&(t.pos-=o-1);i=r+o}}readNode(e){if(e.cmIgnore)return;let t=va.get(e),i=t&&t.overrideDOMText;if(null!=i){this.findPointInside(e,i.length);for(let e=i.iter();!e.next().done;)e.lineBreak?this.lineBreak():this.append(e.value)}else 3==e.nodeType?this.readTextNode(e):"BR"==e.nodeName?e.nextSibling&&this.lineBreak():1==e.nodeType&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(3==e.nodeType?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+(Cc(e,i.node,i.offset)?t:0))}};function Cc(e,t,i){for(;;){if(!t||i<ta(t))return!1;if(t==e)return!0;i=Ql(t)+1,t=t.parentNode}}let Mc=class{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}};class Ac{constructor(e,t,i,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:n,impreciseAnchor:r}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,i,0))){let t=n||r?[]:function(e){let t=[];if(e.root.activeElement!=e.contentDOM)return t;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=e.observer.selectionRange;i&&(t.push(new Mc(i,s)),n==i&&r==s||t.push(new Mc(n,r)));return t}(e),i=new Sc(t,e.state);i.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=i.text,this.newSel=function(e,t){if(0==e.length)return null;let i=e[0].pos,s=2==e.length?e[1].pos:i;return i>-1&&s>-1?So.single(i+t,s+t):null}(t,this.bounds.from)}else{let t=e.observer.selectionRange,i=n&&n.node==t.focusNode&&n.offset==t.focusOffset||!Gl(e.contentDOM,t.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(t.focusNode,t.focusOffset),s=r&&r.node==t.anchorNode&&r.offset==t.anchorOffset||!Gl(e.contentDOM,t.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(t.anchorNode,t.anchorOffset),o=e.viewport;if((Ba.ios||Ba.chrome)&&e.state.selection.main.empty&&i!=s&&(o.from>0||o.to<e.state.doc.length)){let t=Math.min(i,s),n=Math.max(i,s),r=o.from-t,l=o.to-n;0!=r&&1!=r&&0!=t||0!=l&&-1!=l&&n!=e.state.doc.length||(i=0,s=e.state.doc.length)}this.newSel=So.single(s,i)}}}function Oc(e,t){let i,{newSel:s}=t,n=e.state.selection.main,r=e.inputState.lastKeyTime>Date.now()-100?e.inputState.lastKeyCode:-1;if(t.bounds){let{from:s,to:o}=t.bounds,l=n.from,a=null;(8===r||Ba.android&&t.text.length<o-s)&&(l=n.to,a="end");let h=function(e,t,i,s){let n=Math.min(e.length,t.length),r=0;for(;r<n&&e.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==n&&e.length==t.length)return null;let o=e.length,l=t.length;for(;o>0&&l>0&&e.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&e.length<t.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(e.state.doc.sliceString(s,o,kc),t.text,l-s,a);h&&(Ba.chrome&&13==r&&h.toB==h.from+2&&t.text.slice(h.from,h.toB)==kc+kc&&h.toB--,i={from:s+h.from,to:s+h.toA,insert:Xr.of(t.text.slice(h.from,h.toB).split(kc))})}else s&&(!e.hasFocus&&e.state.facet($h)||s.main.eq(n))&&(s=null);if(!i&&!s)return!1;if(!i&&t.typeOver&&!n.empty&&s&&s.main.empty?i={from:n.from,to:n.to,insert:e.state.doc.slice(n.from,n.to)}:(Ba.mac||Ba.android)&&i&&i.from==i.to&&i.from==n.head-1&&/^\. ?$/.test(i.insert.toString())&&"off"==e.contentDOM.getAttribute("autocorrect")?(s&&2==i.insert.length&&(s=So.single(s.main.anchor-1,s.main.head-1)),i={from:i.from,to:i.to,insert:Xr.of([i.insert.toString().replace("."," ")])}):i&&i.from>=n.from&&i.to<=n.to&&(i.from!=n.from||i.to!=n.to)&&n.to-n.from-(i.to-i.from)<=4?i={from:n.from,to:n.to,insert:e.state.doc.slice(n.from,i.from).append(i.insert).append(e.state.doc.slice(i.to,n.to))}:Ba.chrome&&i&&i.from==i.to&&i.from==n.head&&"\n "==i.insert.toString()&&e.lineWrapping&&(s&&(s=So.single(s.main.anchor-1,s.main.head-1)),i={from:n.from,to:n.to,insert:Xr.of([" "])}),i)return Tc(e,i,s,r);if(s&&!s.main.eq(n)){let t=!1,i="select";return e.inputState.lastSelectionTime>Date.now()-50&&("select"==e.inputState.lastSelectionOrigin&&(t=!0),i=e.inputState.lastSelectionOrigin,"select.pointer"==i&&(s=wc(e.state.facet(Xh).map(t=>t(e)),s))),e.dispatch({selection:s,scrollIntoView:t,userEvent:i}),!0}return!1}function Tc(e,t,i,s=-1){if(Ba.ios&&e.inputState.flushIOSKey(t))return!0;let n=e.state.selection.main;if(Ba.android&&(t.to==n.to&&(t.from==n.from||t.from==n.from-1&&" "==e.state.sliceDoc(t.from,n.from))&&1==t.insert.length&&2==t.insert.lines&&ca(e.contentDOM,"Enter",13)||(t.from==n.from-1&&t.to==n.to&&0==t.insert.length||8==s&&t.insert.length<t.to-t.from&&t.to>n.head)&&ca(e.contentDOM,"Backspace",8)||t.from==n.from&&t.to==n.to+1&&0==t.insert.length&&ca(e.contentDOM,"Delete",46)))return!0;let r,o=t.insert.toString();e.inputState.composing>=0&&e.inputState.composing++;let l=()=>r||(r=function(e,t,i){let s,n=e.state,r=n.selection.main;if(t.from>=r.from&&t.to<=r.to&&t.to-t.from>=(r.to-r.from)/3&&(!i||i.main.empty&&i.main.from==t.from+t.insert.length)&&e.inputState.composing<0){let i=r.from<t.from?n.sliceDoc(r.from,t.from):"",o=r.to>t.to?n.sliceDoc(t.to,r.to):"";s=n.replaceSelection(e.state.toText(i+t.insert.sliceString(0,void 0,e.state.lineBreak)+o))}else{let o=n.changes(t),l=i&&i.main.to<=o.newLength?i.main:void 0;if(n.selection.ranges.length>1&&e.inputState.composing>=0&&t.to<=r.to&&t.to>=r.to-10){let a,h=e.state.sliceDoc(t.from,t.to),c=i&&oc(e,i.main.head);if(c){let e=t.insert.length-(t.to-t.from);a={from:c.from,to:c.to-e}}else a=e.state.doc.lineAt(r.head);let u=r.to-t.to,d=r.to-r.from;s=n.changeByRange(i=>{if(i.from==r.from&&i.to==r.to)return{changes:o,range:l||i.map(o)};let s=i.to-u,c=s-h.length;if(i.to-i.from!=d||e.state.sliceDoc(c,s)!=h||i.to>=a.from&&i.from<=a.to)return{range:i};let f=n.changes({from:c,to:s,insert:t.insert}),p=i.to-r.to;return{changes:f,range:l?So.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}})}else s={changes:o,selection:l&&n.selection.replaceRange(l)}}let o="input.type";(e.composing||e.inputState.compositionPendingChange&&e.inputState.compositionEndedAt>Date.now()-50)&&(e.inputState.compositionPendingChange=!1,o+=".compose",e.inputState.compositionFirstChange&&(o+=".start",e.inputState.compositionFirstChange=!1));return n.update(s,{userEvent:o,scrollIntoView:!0})}(e,t,i));return e.state.facet(Rh).some(i=>i(e,t.from,t.to,o,l))||e.dispatch(l()),!0}let Dc=class{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){var t;this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,Ba.safari&&e.contentDOM.addEventListener("input",()=>null),Ba.gecko&&(t=e.contentDOM.ownerDocument,tu.has(t)||(tu.add(t),t.addEventListener("copy",()=>{}),t.addEventListener("cut",()=>{})))}handleEvent(e){(function(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let i,s=t.target;s!=e.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=va.get(s))&&i.ignoreEvent(t))return!1;return!0})(this.view,e)&&!this.ignoreDuringComposition(e)&&("keydown"==e.type&&this.keydown(e)||(0!=this.view.updateState?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e)))}runHandlers(e,t){let i=this.handlers[e];if(i){for(let e of i.observers)e(this.view,t);for(let e of i.handlers){if(t.defaultPrevented)break;if(e(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=function(e){let t=Object.create(null);function i(e){return t[e]||(t[e]={observers:[],handlers:[]})}for(let s of e){let e=s.spec,t=e&&e.plugin.domEventHandlers,n=e&&e.plugin.domEventObservers;if(t)for(let r in t){let e=t[r];e&&i(r).handlers.push(Ec(s.value,e))}if(n)for(let r in n){let e=n[r];e&&i(r).observers.push(Ec(s.value,e))}}for(let s in Vc)i(s).handlers.push(Vc[s]);for(let s in Ic)i(s).observers.push(Ic[s]);return t}(e),i=this.handlers,s=this.view.contentDOM;for(let n in t)if("scroll"!=n){let e=!t[n].handlers.length,r=i[n];r&&e!=!r.handlers.length&&(s.removeEventListener(n,this.handleEvent),r=null),r||s.addEventListener(n,this.handleEvent,{passive:e})}for(let n in i)"scroll"==n||t[n]||s.removeEventListener(n,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&27!=e.keyCode&&Bc.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),Ba.android&&Ba.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return!Ba.ios||e.synthetic||e.altKey||e.metaKey||!((t=Rc.find(t=>t.keyCode==e.keyCode))&&!e.ctrlKey||Lc.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(229!=e.keyCode&&this.view.observer.forceFlush(),!1):(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0)}flushIOSKey(e){let t=this.pendingIOSKey;return!!t&&(!("Enter"==t.key&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString()))&&(this.pendingIOSKey=void 0,ca(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0)))}ignoreDuringComposition(e){return!!/^key/.test(e.type)&&(this.composing>0||!!(Ba.safari&&!Ba.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100)&&(this.compositionPendingKey=!1,!0))}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};function Ec(e,t){return(i,s)=>{try{return t.call(e,s,i)}catch(n){Wh(i.state,n)}}}const Rc=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Lc="dthko",Bc=[16,17,18,20,91,92,224,225];function Pc(e){return.7*Math.max(0,e)+8}let Nc=class{constructor(e,t,i,s){this.view=e,this.startEvent=t,this.style=i,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=function(e){let t,i,s=e.ownerDocument;for(let n=e.parentNode;n&&!(n==s.body||t&&i);)if(1==n.nodeType)!i&&n.scrollHeight>n.clientHeight&&(i=n),!t&&n.scrollWidth>n.clientWidth&&(t=n),n=n.assignedSlot||n.parentNode;else{if(11!=n.nodeType)break;n=n.host}return{x:t,y:i}}(e.contentDOM),this.atoms=e.state.facet(Xh).map(t=>t(e));let n=e.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(pl.allowMultipleSelections)&&function(e,t){let i=e.state.facet(Ah);return i.length?i[0](t):Ba.mac?t.metaKey:t.ctrlKey}(e,t),this.dragging=!(!function(e,t){let{main:i}=e.state.selection;if(i.empty)return!1;let s=Ul(e.root);if(!s||0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let e=n[r];if(e.left<=t.clientX&&e.right>=t.clientX&&e.top<=t.clientY&&e.bottom>=t.clientY)return!0}return!1}(e,t)||1!=Jc(t))&&null}start(e){!1===this.dragging&&this.select(e)}move(e){if(0==e.buttons)return this.destroy();if(this.dragging||null==this.dragging&&(t=this.startEvent,i=e,Math.max(Math.abs(t.clientX-i.clientX),Math.abs(t.clientY-i.clientY))<10))return;var t,i;this.select(this.lastEvent=e);let s=0,n=0,r=0,o=0,l=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:r,right:l}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:o,bottom:a}=this.scrollParents.y.getBoundingClientRect());let h=tc(this.view);e.clientX-h.left<=r+6?s=-Pc(r-e.clientX):e.clientX+h.right>=l-6&&(s=Pc(e.clientX-l)),e.clientY-h.top<=o+6?n=-Pc(o-e.clientY):e.clientY+h.bottom>=a-6&&(n=Pc(e.clientY-a)),this.setScrollSpeed(s,n)}up(e){null==this.dragging&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),!1===this.dragging&&this.select(this.lastEvent)}select(e){let{view:t}=this,i=wc(this.atoms,this.style.get(e,this.extend,this.multiple));!this.mustSelect&&i.eq(t.state.selection,!1===this.dragging)||this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(e=>e.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}};const Vc=Object.create(null),Ic=Object.create(null),Hc=Ba.ie&&Ba.ie_version<15||Ba.ios&&Ba.webkit_version<604;function Fc(e,t,i){for(let s of e.facet(t))i=s(i,e);return i}function zc(e,t){t=Fc(e.state,Bh,t);let i,{state:s}=e,n=1,r=s.toText(t),o=r.lines==s.selection.ranges.length;if(null!=Xc&&s.selection.ranges.every(e=>e.empty)&&Xc==r.toString()){let e=-1;i=s.changeByRange(i=>{let l=s.doc.lineAt(i.from);if(l.from==e)return{range:i};e=l.from;let a=s.toText((o?r.line(n++).text:t)+s.lineBreak);return{changes:{from:l.from,insert:a},range:So.cursor(i.from+a.length)}})}else i=o?s.changeByRange(e=>{let t=r.line(n++);return{changes:{from:e.from,to:e.to,insert:t.text},range:So.cursor(e.from+t.length)}}):s.replaceSelection(r);e.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}function Wc(e,t,i,s){if(1==s)return So.cursor(t,i);if(2==s)return function(e,t,i=1){let s=e.charCategorizer(t),n=e.doc.lineAt(t),r=t-n.from;if(0==n.length)return So.cursor(t);0==r?i=1:r==n.length&&(i=-1);let o=r,l=r;i<0?o=lo(n.text,r,!1):l=lo(n.text,r);let a=s(n.text.slice(o,l));for(;o>0;){let e=lo(n.text,o,!1);if(s(n.text.slice(e,o))!=a)break;o=e}for(;l<n.length;){let e=lo(n.text,l);if(s(n.text.slice(l,e))!=a)break;l=e}return So.range(o+n.from,l+n.from)}(e.state,t,i);{let i=th.find(e.docView,t),s=e.state.doc.lineAt(i?i.posAtEnd:t),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<e.state.doc.length&&r==s.to&&r++,So.range(n,r)}}Ic.scroll=e=>{e.inputState.lastScrollTop=e.scrollDOM.scrollTop,e.inputState.lastScrollLeft=e.scrollDOM.scrollLeft},Vc.keydown=(e,t)=>(e.inputState.setSelectionOrigin("select"),27==t.keyCode&&0!=e.inputState.tabFocusMode&&(e.inputState.tabFocusMode=Date.now()+2e3),!1),Ic.touchstart=(e,t)=>{e.inputState.lastTouchTime=Date.now(),e.inputState.setSelectionOrigin("select.pointer")},Ic.touchmove=e=>{e.inputState.setSelectionOrigin("select.pointer")},Vc.mousedown=(e,t)=>{if(e.observer.flush(),e.inputState.lastTouchTime>Date.now()-2e3)return!1;let i=null;for(let s of e.state.facet(Th))if(i=s(e,t),i)break;if(i||0!=t.button||(i=function(e,t){let i=qc(e,t),s=Jc(t),n=e.state.selection;return{update(e){e.docChanged&&(i.pos=e.changes.mapPos(i.pos),n=n.map(e.changes))},get(t,r,o){let l,a=qc(e,t),h=Wc(e,a.pos,a.bias,s);if(i.pos!=a.pos&&!r){let t=Wc(e,i.pos,i.bias,s),n=Math.min(t.from,h.from),r=Math.max(t.to,h.to);h=n<h.from?So.range(n,r):So.range(r,n)}return r?n.replaceRange(n.main.extend(h.from,h.to)):o&&1==s&&n.ranges.length>1&&(l=function(e,t){for(let i=0;i<e.ranges.length;i++){let{from:s,to:n}=e.ranges[i];if(s<=t&&n>=t)return So.create(e.ranges.slice(0,i).concat(e.ranges.slice(i+1)),e.mainIndex==i?0:e.mainIndex-(e.mainIndex>i?1:0))}return null}(n,a.pos))?l:o?n.addRange(h):So.create([h])}}}(e,t)),i){let s=!e.hasFocus;e.inputState.startMouseSelection(new Nc(e,t,i,s)),s&&e.observer.ignore(()=>{aa(e.contentDOM);let t=e.root.activeElement;t&&!t.contains(e.contentDOM)&&t.blur()});let n=e.inputState.mouseSelection;if(n)return n.start(t),!1===n.dragging}else e.inputState.setSelectionOrigin("select.pointer");return!1};let $c=(e,t,i)=>t>=i.top&&t<=i.bottom&&e>=i.left&&e<=i.right;function jc(e,t,i,s){let n=th.find(e.docView,t);if(!n)return 1;let r=t-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&$c(i,s,o))return-1;let l=n.coordsAt(r,1);return l&&$c(i,s,l)?1:o&&o.bottom>=s?-1:1}function qc(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:i,bias:jc(e,i,t.clientX,t.clientY)}}const _c=Ba.ie&&Ba.ie_version<=11;let Kc=null,Uc=0,Gc=0;function Jc(e){if(!_c)return e.detail;let t=Kc,i=Gc;return Kc=e,Gc=Date.now(),Uc=!t||i>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(Uc+1)%3:1}function Yc(e,t,i,s){if(!(i=Fc(e.state,Bh,i)))return;let n=e.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:r}=e.inputState,o=s&&r&&function(e,t){let i=e.state.facet(Oh);return i.length?i[0](t):Ba.mac?!t.altKey:!t.ctrlKey}(e,t)?{from:r.from,to:r.to}:null,l={from:n,insert:i},a=e.state.changes(o?[o,l]:l);e.focus(),e.dispatch({changes:a,selection:{anchor:a.mapPos(n,-1),head:a.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"}),e.inputState.draggedContent=null}Vc.dragstart=(e,t)=>{let{selection:{main:i}}=e.state;if(t.target.draggable){let s=e.docView.nearest(t.target);if(s&&s.isWidget){let e=s.posAtStart,t=e+s.length;(e>=i.to||t<=i.from)&&(i=So.range(e,t))}}let{inputState:s}=e;return s.mouseSelection&&(s.mouseSelection.dragging=!0),s.draggedContent=i,t.dataTransfer&&(t.dataTransfer.setData("Text",Fc(e.state,Ph,e.state.sliceDoc(i.from,i.to))),t.dataTransfer.effectAllowed="copyMove"),!1},Vc.dragend=e=>(e.inputState.draggedContent=null,!1),Vc.drop=(e,t)=>{if(!t.dataTransfer)return!1;if(e.state.readOnly)return!0;let i=t.dataTransfer.files;if(i&&i.length){let s=Array(i.length),n=0,r=()=>{++n==i.length&&Yc(e,t,s.filter(e=>null!=e).join(e.state.lineBreak),!1)};for(let e=0;e<i.length;e++){let t=new FileReader;t.onerror=r,t.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(t.result)||(s[e]=t.result),r()},t.readAsText(i[e])}return!0}{let i=t.dataTransfer.getData("Text");if(i)return Yc(e,t,i,!0),!0}return!1},Vc.paste=(e,t)=>{if(e.state.readOnly)return!0;e.observer.flush();let i=Hc?null:t.clipboardData;return i?(zc(e,i.getData("text/plain")||i.getData("text/uri-list")),!0):(function(e){let t=e.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout(()=>{e.focus(),i.remove(),zc(e,i.value)},50)}(e),!1)};let Xc=null;Vc.copy=Vc.cut=(e,t)=>{let{text:i,ranges:s,linewise:n}=function(e){let t=[],i=[],s=!1;for(let n of e.selection.ranges)n.empty||(t.push(e.sliceDoc(n.from,n.to)),i.push(n));if(!t.length){let n=-1;for(let{from:s}of e.selection.ranges){let r=e.doc.lineAt(s);r.number>n&&(t.push(r.text),i.push({from:r.from,to:Math.min(e.doc.length,r.to+1)})),n=r.number}s=!0}return{text:Fc(e,Ph,t.join(e.lineBreak)),ranges:i,linewise:s}}(e.state);if(!i&&!n)return!1;Xc=n?i:null,"cut"!=t.type||e.state.readOnly||e.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"});let r=Hc?null:t.clipboardData;return r?(r.clearData(),r.setData("text/plain",i),!0):(function(e,t){let i=e.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=t,s.focus(),s.selectionEnd=t.length,s.selectionStart=0,setTimeout(()=>{s.remove(),e.focus()},50)}(e,i),!1)};const Qc=Zo.define();function Zc(e,t){let i=[];for(let s of e.facet(Lh)){let n=s(e,t);n&&i.push(n)}return i.length?e.update({effects:i,annotations:Qc.of(!0)}):null}function eu(e){setTimeout(()=>{let t=e.hasFocus;if(t!=e.inputState.notifiedFocused){let i=Zc(e.state,t);i?e.dispatch(i):e.update([])}},10)}Ic.focus=e=>{e.inputState.lastFocusTime=Date.now(),e.scrollDOM.scrollTop||!e.inputState.lastScrollTop&&!e.inputState.lastScrollLeft||(e.scrollDOM.scrollTop=e.inputState.lastScrollTop,e.scrollDOM.scrollLeft=e.inputState.lastScrollLeft),eu(e)},Ic.blur=e=>{e.observer.clearSelectionRange(),eu(e)},Ic.compositionstart=Ic.compositionupdate=e=>{e.observer.editContext||(null==e.inputState.compositionFirstChange&&(e.inputState.compositionFirstChange=!0),e.inputState.composing<0&&(e.inputState.composing=0))},Ic.compositionend=e=>{e.observer.editContext||(e.inputState.composing=-1,e.inputState.compositionEndedAt=Date.now(),e.inputState.compositionPendingKey=!0,e.inputState.compositionPendingChange=e.observer.pendingRecords().length>0,e.inputState.compositionFirstChange=null,Ba.chrome&&Ba.android?e.observer.flushSoon():e.inputState.compositionPendingChange?Promise.resolve().then(()=>e.observer.flush()):setTimeout(()=>{e.inputState.composing<0&&e.docView.hasComposition&&e.update([])},50))},Ic.contextmenu=e=>{e.inputState.lastContextMenu=Date.now()},Vc.beforeinput=(e,t)=>{var i,s;if("insertReplacementText"==t.inputType&&e.observer.editContext){let s=null===(i=t.dataTransfer)||void 0===i?void 0:i.getData("text/plain"),n=t.getTargetRanges();if(s&&n.length){let t=n[0],i=e.posAtDOM(t.startContainer,t.startOffset),r=e.posAtDOM(t.endContainer,t.endOffset);return Tc(e,{from:i,to:r,insert:e.state.toText(s)},null),!0}}let n;if(Ba.chrome&&Ba.android&&(n=Rc.find(e=>e.inputType==t.inputType))&&(e.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let t=(null===(s=window.visualViewport)||void 0===s?void 0:s.height)||0;setTimeout(()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>t+10&&e.hasFocus&&(e.contentDOM.blur(),e.focus())},100)}return Ba.ios&&"deleteContentForward"==t.inputType&&e.observer.flushSoon(),Ba.safari&&"insertText"==t.inputType&&e.inputState.composing>=0&&setTimeout(()=>Ic.compositionend(e,t),20),!1};const tu=new Set;const iu=["pre-wrap","normal","pre-line","break-spaces"];let su=!1;function nu(){su=!1}let ru=class{constructor(e){this.lineWrapping=e,this.doc=Xr.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return iu.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let s=e[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(t=!0,this.heightSamples[Math.floor(10*s)]=!0)}return t}refresh(e,t,i,s,n,r){let o=iu.indexOf(e)>-1,l=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=t,this.charWidth=i,this.textHeight=s,this.lineLength=n,l){this.heightSamples={};for(let e=0;e<r.length;e++){let t=r[e];t<0?e++:this.heightSamples[Math.floor(10*t)]=!0}}return l}},ou=class{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}},lu=class e{constructor(e,t,i,s,n){this.from=e,this.length=t,this.top=i,this.height=s,this._content=n}get type(){return"number"==typeof this._content?Ga.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Qa?this._content.widget:null}get widgetLineBreaks(){return"number"==typeof this._content?this._content:0}join(t){let i=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(t._content)?t._content:[t]);return new e(this.from,this.length+t.length,this.top,this.height+t.height,i)}};var au=function(e){return e[e.ByPos=0]="ByPos",e[e.ByHeight=1]="ByHeight",e[e.ByPosNoHeight=2]="ByPosNoHeight",e}(au||(au={}));const hu=.001;let cu=class e{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(e){this.flags=(e?2:0)|-3&this.flags}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>hu&&(su=!0),this.height=e)}replace(t,i,s){return e.of(s)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,s){let n=this,r=i.doc;for(let o=s.length-1;o>=0;o--){let{fromA:l,toA:a,fromB:h,toB:c}=s[o],u=n.lineAt(l,au.ByPosNoHeight,i.setDoc(t),0,0),d=u.to>=a?u:n.lineAt(a,au.ByPosNoHeight,i,0,0);for(c+=d.to-a,a=d.to;o>0&&u.from<=s[o-1].toA;)l=s[o-1].fromA,h=s[o-1].fromB,o--,l<u.from&&(u=n.lineAt(l,au.ByPosNoHeight,i,0,0));h+=u.from-l,l=u.from;let f=vu.build(i.setDoc(r),e,h,c);n=uu(n,n.replace(l,a,f))}return n.updateHeight(i,0)}static empty(){return new fu(0,0)}static of(t){if(1==t.length)return t[0];let i=0,s=t.length,n=0,r=0;for(;;)if(i==s)if(n>2*r){let e=t[i-1];e.break?t.splice(--i,1,e.left,null,e.right):t.splice(--i,1,e.left,e.right),s+=1+e.break,n-=e.size}else{if(!(r>2*n))break;{let e=t[s];e.break?t.splice(s,1,e.left,null,e.right):t.splice(s,1,e.left,e.right),s+=2+e.break,r-=e.size}}else if(n<r){let e=t[i++];e&&(n+=e.size)}else{let e=t[--s];e&&(r+=e.size)}let o=0;return null==t[i-1]?(o=1,i--):null==t[i]&&(o=1,s++),new gu(e.of(t.slice(0,i)),o,e.of(t.slice(s)))}};function uu(e,t){return e==t?e:(e.constructor!=t.constructor&&(su=!0),t)}cu.prototype.size=1;let du=class extends cu{constructor(e,t,i){super(e,t),this.deco=i}blockAt(e,t,i,s){return new lu(s,this.length,i,this.height,this.deco||0)}lineAt(e,t,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(e,t,i,s,n,r){e<=n+this.length&&t>=n&&r(this.blockAt(0,i,s,n))}updateHeight(e,t=0,i=!1,s){return s&&s.from<=t&&s.more&&this.setHeight(s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},fu=class e extends du{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,i,s){return new lu(s,this.length,i,this.height,this.breaks)}replace(t,i,s){let n=s[0];return 1==s.length&&(n instanceof e||n instanceof pu&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof pu?n=new e(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):cu.of(s)}updateHeight(e,t=0,i=!1,s){return s&&s.from<=t&&s.more?this.setHeight(s.heights[s.index++]):(i||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},pu=class e extends cu{constructor(e){super(e,0)}heightMetrics(e,t){let i,s=e.doc.lineAt(t).number,n=e.doc.lineAt(t+this.length).number,r=n-s+1,o=0;if(e.lineWrapping){let t=Math.min(this.height,e.lineHeight*r);i=t/r,this.length>r+1&&(o=(this.height-t)/(this.length-r-1))}else i=this.height/r;return{firstLine:s,lastLine:n,perLine:i,perChar:o}}blockAt(e,t,i,s){let{firstLine:n,lastLine:r,perLine:o,perChar:l}=this.heightMetrics(t,s);if(t.lineWrapping){let n=s+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length)),r=t.doc.lineAt(n),a=o+r.length*l,h=Math.max(i,e-a/2);return new lu(r.from,r.length,h,a,0)}{let s=Math.max(0,Math.min(r-n,Math.floor((e-i)/o))),{from:l,length:a}=t.doc.line(n+s);return new lu(l,a,i+o*s,o,0)}}lineAt(e,t,i,s,n){if(t==au.ByHeight)return this.blockAt(e,i,s,n);if(t==au.ByPosNoHeight){let{from:t,to:s}=i.doc.lineAt(e);return new lu(t,s-t,0,0,0)}let{firstLine:r,perLine:o,perChar:l}=this.heightMetrics(i,n),a=i.doc.lineAt(e),h=o+a.length*l,c=a.number-r,u=s+o*c+l*(a.from-n-c);return new lu(a.from,a.length,Math.max(s,Math.min(u,s+this.height-h)),h,0)}forEachLine(e,t,i,s,n,r){e=Math.max(e,n),t=Math.min(t,n+this.length);let{firstLine:o,perLine:l,perChar:a}=this.heightMetrics(i,n);for(let h=e,c=s;h<=t;){let t=i.doc.lineAt(h);if(h==e){let i=t.number-o;c+=l*i+a*(e-n-i)}let s=l+a*t.length;r(new lu(t.from,t.length,c,s,0)),c+=s,h=t.to+1}}replace(t,i,s){let n=this.length-i;if(n>0){let t=s[s.length-1];t instanceof e?s[s.length-1]=new e(t.length+n):s.push(null,new e(n-1))}if(t>0){let i=s[0];i instanceof e?s[0]=new e(t+i.length):s.unshift(new e(t-1),null)}return cu.of(s)}decomposeLeft(t,i){i.push(new e(t-1),null)}decomposeRight(t,i){i.push(null,new e(this.length-t-1))}updateHeight(t,i=0,s=!1,n){let r=i+this.length;if(n&&n.from<=i+this.length&&n.more){let s=[],o=Math.max(i,n.from),l=-1;for(n.from>i&&s.push(new e(n.from-i-1).updateHeight(t,i));o<=r&&n.more;){let e=t.doc.lineAt(o).length;s.length&&s.push(null);let i=n.heights[n.index++];-1==l?l=i:Math.abs(i-l)>=hu&&(l=-2);let r=new fu(e,i);r.outdated=!1,s.push(r),o+=e+1}o<=r&&s.push(null,new e(r-o).updateHeight(t,o));let a=cu.of(s);return(l<0||Math.abs(a.height-this.height)>=hu||Math.abs(l-this.heightMetrics(t,i).perLine)>=hu)&&(su=!0),uu(this,a)}return(s||this.outdated)&&(this.setHeight(t.heightForGap(i,i+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}},gu=class extends cu{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return 1&this.flags}blockAt(e,t,i,s){let n=i+this.left.height;return e<n?this.left.blockAt(e,t,i,s):this.right.blockAt(e,t,n,s+this.left.length+this.break)}lineAt(e,t,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,l=t==au.ByHeight?e<r:e<o,a=l?this.left.lineAt(e,t,i,s,n):this.right.lineAt(e,t,i,r,o);if(this.break||(l?a.to<o:a.from>o))return a;let h=t==au.ByPosNoHeight?au.ByPosNoHeight:au.ByPos;return l?a.join(this.right.lineAt(o,h,i,r,o)):this.left.lineAt(o,h,i,s,n).join(a)}forEachLine(e,t,i,s,n,r){let o=s+this.left.height,l=n+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,t,i,s,n,r),t>=l&&this.right.forEachLine(e,t,i,o,l,r);else{let a=this.lineAt(l,au.ByPos,i,s,n);e<a.from&&this.left.forEachLine(e,a.from-1,i,s,n,r),a.to>=e&&a.from<=t&&r(a),t>a.to&&this.right.forEachLine(a.to+1,t,i,o,l,r)}}replace(e,t,i){let s=this.left.length+this.break;if(t<s)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,t-s,i));let n=[];e>0&&this.decomposeLeft(e,n);let r=n.length;for(let o of i)n.push(o);if(e>0&&mu(n,r-1),t<this.length){let e=n.length;this.decomposeRight(t,n),mu(n,e)}return cu.of(n)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,s=i+this.break;if(e>=s)return this.right.decomposeRight(e-s,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<s&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?cu.of(this.break?[e,null,t]:[e,t]):(this.left=uu(this.left,e),this.right=uu(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,s){let{left:n,right:r}=this,o=t+n.length+this.break,l=null;return s&&s.from<=t+n.length&&s.more?l=n=n.updateHeight(e,t,i,s):n.updateHeight(e,t,i),s&&s.from<=o+r.length&&s.more?l=r=r.updateHeight(e,o,i,s):r.updateHeight(e,o,i),l?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function mu(e,t){let i,s;null==e[t]&&(i=e[t-1])instanceof pu&&(s=e[t+1])instanceof pu&&e.splice(t-1,3,new pu(i.length+1+s.length))}let vu=class e{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let e=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof fu?i.length+=e-this.pos:(e>this.pos||!this.isCovered)&&this.nodes.push(new fu(e-this.pos,-1)),this.writtenTo=e,t>e&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0,n=i.widget?i.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let r=t-e;i.block?this.addBlock(new du(r,s,i)):(r||n||s>=5)&&this.addLineDeco(s,n,r)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new fu(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new pu(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof fu)return e;let t=new fu(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,i){let s=this.ensureLine();s.length+=i,s.collapsed+=i,s.widgetHeight=Math.max(s.widgetHeight,e),s.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||t instanceof fu||this.isCovered?(this.writtenTo<this.pos||null==t)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new fu(0,-1));let i=e;for(let s of this.nodes)s instanceof fu&&s.updateHeight(this.oracle,i),i+=s?s.length:1;return this.nodes}static build(t,i,s,n){let r=new e(s,t);return wl.spans(i,s,n,r,0),r.finish(s)}};let yu=class{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,s){(e<t||i&&i.heightRelevant||s&&s.heightRelevant)&&eh(e,t,this.changes,5)}};function bu(e,t){let i=e.getBoundingClientRect(),s=e.ownerDocument,n=s.defaultView||window,r=Math.max(0,i.left),o=Math.min(n.innerWidth,i.right),l=Math.max(0,i.top),a=Math.min(n.innerHeight,i.bottom);for(let h=e.parentNode;h&&h!=s.body;)if(1==h.nodeType){let t=h,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let i=t.getBoundingClientRect();r=Math.max(r,i.left),o=Math.min(o,i.right),l=Math.max(l,i.top),a=Math.min(h==e.parentNode?n.innerHeight:a,i.bottom)}h="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=h.nodeType)break;h=h.host}return{left:r-i.left,right:Math.max(r,o)-i.left,top:l-(i.top+t),bottom:Math.max(l,a)-(i.top+t)}}function wu(e,t){let i=e.getBoundingClientRect();return{left:0,right:i.right-i.left,top:t,bottom:i.bottom-(i.top+t)}}let xu=class{constructor(e,t,i,s){this.from=e,this.to=t,this.size=i,this.displaySize=s}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let s=e[i],n=t[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(e,t){return Ja.replace({widget:new ku(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}},ku=class extends Ua{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}},Su=class{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Ou,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=lh.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(Gh).some(e=>"function"!=typeof e&&"cm-lineWrapping"==e.class);this.heightOracle=new ru(t),this.stateDeco=e.facet(Jh).filter(e=>"function"!=typeof e),this.heightMap=cu.empty().applyChanges(this.stateDeco,Xr.empty,this.heightOracle.setDoc(e.doc),[new sc(0,0,0,e.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Ja.set(this.lineGaps.map(e=>e.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let s=i?t.head:t.anchor;if(!e.some(({from:e,to:t})=>s>=e&&s<=t)){let{from:t,to:i}=this.lineBlockAt(s);e.push(new Cu(t,i))}}return this.viewports=e.sort((e,t)=>e.from-t.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?Ou:new Tu(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(Du(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Jh).filter(e=>"function"!=typeof e);let s=e.changedRanges,n=sc.extendWithRanges(s,function(e,t,i){let s=new yu;return wl.compare(e,t,i,s,0),s.changes}(i,this.stateDeco,e?e.changes:go.empty(this.state.doc.length))),r=this.heightMap.height,o=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);nu(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),n),(this.heightMap.height!=r||su)&&(e.flags|=2),o?(this.scrollAnchorPos=e.changes.mapPos(o.from,-1),this.scrollAnchorHeight=o.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=r);let l=n.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<l.from||t.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,t));let a=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,e.flags|=this.updateForViewport(),(a||!e.changes.empty||2&e.flags)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(Vh)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),s=this.heightOracle,n=i.whiteSpace;this.defaultTextDirection="rtl"==i.direction?lh.RTL:lh.LTR;let r=this.heightOracle.mustRefreshForWrapping(n),o=t.getBoundingClientRect(),l=r||this.mustMeasureContent||this.contentDOMHeight!=o.height;this.contentDOMHeight=o.height,this.mustMeasureContent=!1;let a=0,h=0;if(o.width&&o.height){let{scaleX:e,scaleY:i}=na(t,o);(e>.005&&Math.abs(this.scaleX-e)>.005||i>.005&&Math.abs(this.scaleY-i)>.005)&&(this.scaleX=e,this.scaleY=i,a|=16,r=l=!0)}let c=(parseInt(i.paddingTop)||0)*this.scaleY,u=(parseInt(i.paddingBottom)||0)*this.scaleY;this.paddingTop==c&&this.paddingBottom==u||(this.paddingTop=c,this.paddingBottom=u,a|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,a|=16);let d=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=d&&(this.scrollAnchorHeight=-1,this.scrollTop=d),this.scrolledToBottom=da(e.scrollDOM);let f=(this.printing?wu:bu)(t,this.paddingTop),p=f.top-this.pixelViewport.top,g=f.bottom-this.pixelViewport.bottom;this.pixelViewport=f;let m=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(m!=this.inView&&(this.inView=m,m&&(l=!0)),!this.inView&&!this.scrollTarget&&!function(e){let t=e.getBoundingClientRect(),i=e.ownerDocument.defaultView||window;return t.left<i.innerWidth&&t.right>0&&t.top<i.innerHeight&&t.bottom>0}(e.dom))return 0;let v=o.width;if(this.contentDOMWidth==v&&this.editorHeight==e.scrollDOM.clientHeight||(this.contentDOMWidth=o.width,this.editorHeight=e.scrollDOM.clientHeight,a|=16),l){let t=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(t)&&(r=!0),r||s.lineWrapping&&Math.abs(v-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:o,textHeight:l}=e.docView.measureTextSize();r=i>0&&s.refresh(n,i,o,l,Math.max(5,v/o),t),r&&(e.docView.minWidth=0,a|=16)}p>0&&g>0?h=Math.max(p,g):p<0&&g<0&&(h=Math.min(p,g)),nu();for(let i of this.viewports){let n=i.from==this.viewport.from?t:e.docView.measureVisibleLineHeights(i);this.heightMap=(r?cu.empty().applyChanges(this.stateDeco,Xr.empty,this.heightOracle,[new sc(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(s,0,r,new ou(i.from,n))}su&&(a|=2)}let y=!this.viewportIsAppropriate(this.viewport,h)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(2&a&&(a|=this.updateScaler()),this.viewport=this.getViewport(h,this.scrollTarget),a|=this.updateForViewport()),(2&a||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(r?[]:this.lineGaps,e)),a|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),a}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,n=this.heightOracle,{visibleTop:r,visibleBottom:o}=this,l=new Cu(s.lineAt(r-1e3*i,au.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),au.ByHeight,n,0,0).to);if(t){let{head:e}=t.range;if(e<l.from||e>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(e,au.ByPos,n,0,0);i="center"==t.y?(o.top+o.bottom)/2-r/2:"start"==t.y||"nearest"==t.y&&e<l.from?o.top:o.bottom-r,l=new Cu(s.lineAt(i-500,au.ByHeight,n,0,0).from,s.lineAt(i+r+500,au.ByHeight,n,0,0).to)}}return l}mapViewport(e,t){let i=t.mapPos(e.from,-1),s=t.mapPos(e.to,1);return new Cu(this.heightMap.lineAt(i,au.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,au.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,au.ByPos,this.heightOracle,0,0),{bottom:n}=this.heightMap.lineAt(t,au.ByPos,this.heightOracle,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==e||s<=r-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let s of e)t.touchesRange(s.from,s.to)||i.push(new xu(t.mapPos(s.from),t.mapPos(s.to),s.size,s.displaySize));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,s=i?1e4:2e3,n=s>>1,r=s<<1;if(this.defaultTextDirection!=lh.LTR&&!i)return[];let o=[],l=(s,r,a,h)=>{if(r-s<n)return;let c=this.state.selection.main,u=[c.from];c.empty||u.push(c.to);for(let e of u)if(e>s&&e<r)return l(s,e-10,a,h),void l(e+10,r,a,h);let d=function(e,t){for(let i of e)if(t(i))return i;return}(e,e=>e.from>=a.from&&e.to<=a.to&&Math.abs(e.from-s)<n&&Math.abs(e.to-r)<n&&!u.some(t=>e.from<t&&e.to>t));if(!d){if(r<a.to&&t&&i&&t.visibleRanges.some(e=>e.from<=r&&e.to>=r)){let e=t.moveToLineBoundary(So.cursor(r),!1,!0).head;e>s&&(r=e)}let e=this.gapSize(a,s,r,h);d=new xu(s,r,e,i||e<2e6?e:2e6)}o.push(d)},a=t=>{if(t.length<r||t.type!=Ga.Text)return;let n=function(e,t,i){let s=[],n=e,r=0;wl.spans(i,e,t,{span(){},point(e,t){e>n&&(s.push({from:n,to:e}),r+=e-n),n=t}},20),n<t&&(s.push({from:n,to:t}),r+=t-n);return{total:r,ranges:s}}(t.from,t.to,this.stateDeco);if(n.total<r)return;let o,a,h=this.scrollTarget?this.scrollTarget.range.head:null;if(i){let e,i,r=s/this.heightOracle.lineLength*this.heightOracle.lineHeight;if(null!=h){let s=Au(n,h),o=((this.visibleBottom-this.visibleTop)/2+r)/t.height;e=s-o,i=s+o}else e=(this.visibleTop-t.top-r)/t.height,i=(this.visibleBottom-t.top+r)/t.height;o=Mu(n,e),a=Mu(n,i)}else{let i=n.total*this.heightOracle.charWidth,r=s*this.heightOracle.charWidth,l=0;if(i>2e6)for(let s of e)s.from>=t.from&&s.from<t.to&&s.size!=s.displaySize&&s.from*this.heightOracle.charWidth+l<this.pixelViewport.left&&(l=s.size-s.displaySize);let c,u,d=this.pixelViewport.left+l,f=this.pixelViewport.right+l;if(null!=h){let e=Au(n,h),t=((f-d)/2+r)/i;c=e-t,u=e+t}else c=(d-r)/i,u=(f+r)/i;o=Mu(n,c),a=Mu(n,u)}o>t.from&&l(t.from,o,t,n),a<t.to&&l(a,t.to,t,n)};for(let h of this.viewportLines)Array.isArray(h.type)?h.type.forEach(a):a(h);return o}gapSize(e,t,i,s){let n=Au(s,i)-Au(s,t);return this.heightOracle.lineWrapping?e.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(e){xu.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Ja.set(e.map(e=>e.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let i=[];wl.spans(t,this.viewport.from,this.viewport.to,{span(e,t){i.push({from:e,to:t})},point(){}},20);let s=0;if(i.length!=this.visibleRanges.length)s=12;else for(let n=0;n<i.length&&!(8&s);n++){let t=this.visibleRanges[n],r=i[n];t.from==r.from&&t.to==r.to||(s|=4,e&&e.mapPos(t.from,-1)==r.from&&e.mapPos(t.to,1)==r.to||(s|=8))}return this.visibleRanges=i,s}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Du(this.heightMap.lineAt(e,au.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||Du(this.heightMap.lineAt(this.scaler.fromDOM(e),au.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Du(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},Cu=class{constructor(e,t){this.from=e,this.to=t}};function Mu({total:e,ranges:t},i){if(i<=0)return t[0].from;if(i>=1)return t[t.length-1].to;let s=Math.floor(e*i);for(let n=0;;n++){let{from:e,to:i}=t[n],r=i-e;if(s<=r)return e+s;s-=r}}function Au(e,t){let i=0;for(let{from:s,to:n}of e.ranges){if(t<=n){i+=t-s;break}i+=n-s}return i/e.total}const Ou={toDOM:e=>e,fromDOM:e=>e,scale:1,eq(e){return e==this}};let Tu=class e{constructor(e,t,i){let s=0,n=0,r=0;this.viewports=i.map(({from:i,to:n})=>{let r=t.lineAt(i,au.ByPos,e,0,0).top,o=t.lineAt(n,au.ByPos,e,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(t.height-s);for(let o of this.viewports)o.domTop=r+(o.top-n)*this.scale,r=o.domBottom=o.domTop+(o.bottom-o.top),n=o.bottom}toDOM(e){for(let t=0,i=0,s=0;;t++){let n=t<this.viewports.length?this.viewports[t]:null;if(!n||e<n.top)return s+(e-i)*this.scale;if(e<=n.bottom)return n.domTop+(e-n.top);i=n.bottom,s=n.domBottom}}fromDOM(e){for(let t=0,i=0,s=0;;t++){let n=t<this.viewports.length?this.viewports[t]:null;if(!n||e<n.domTop)return i+(e-s)/this.scale;if(e<=n.domBottom)return n.top+(e-n.domTop);i=n.bottom,s=n.domBottom}}eq(t){return t instanceof e&&(this.scale==t.scale&&this.viewports.length==t.viewports.length&&this.viewports.every((e,i)=>e.from==t.viewports[i].from&&e.to==t.viewports[i].to))}};function Du(e,t){if(1==t.scale)return e;let i=t.toDOM(e.top),s=t.toDOM(e.bottom);return new lu(e.from,e.length,i,s-i,Array.isArray(e._content)?e._content.map(e=>Du(e,t)):e._content)}const Eu=Ao.define({combine:e=>e.join(" ")}),Ru=Ao.define({combine:e=>e.indexOf(!0)>-1}),Lu=Nl.newName(),Bu=Nl.newName(),Pu=Nl.newName(),Nu={"&light":"."+Bu,"&dark":"."+Pu};function Vu(e,t,i){return new Nl(t,{finish:t=>/&/.test(t)?t.replace(/&\w*/,t=>{if("&"==t)return e;if(!i||!i[t])throw new RangeError(`Unsupported selector: ${t}`);return i[t]}):e+" "+t})}const Iu=Vu("."+Lu,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>\')',backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Nu),Hu={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Fu=Ba.ie&&Ba.ie_version<=11;let zu=class{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new oa,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let e of t)this.queue.push(e);(Ba.ie&&Ba.ie_version<=11||Ba.ios&&e.composing)&&t.some(e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length)?this.flushSoon():this.flush()}),!window.EditContext||!Ba.android||!1===e.constructor.EDIT_CONTEXT||Ba.chrome&&Ba.chrome_version<126||(this.editContext=new ju(e),e.state.facet($h)&&(e.contentDOM.editContext=this.editContext.editContext)),Fu&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),"function"==typeof ResizeObserver&&(this.resizeScroll=new ResizeObserver(()=>{var e;(null===(e=this.view.docView)||void 0===e?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver(e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){("change"!=e.type&&e.type||e.matches)&&(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,s=this.selectionRange;if(i.state.facet($h)?i.root.activeElement!=this.dom:!Jl(this.dom,s))return;let n=s.anchorNode&&i.docView.nearest(s.anchorNode);n&&n.ignoreEvent(e)?t||(this.selectionChanged=!1):(Ba.ie&&Ba.ie_version<=11||Ba.android&&Ba.chrome)&&!i.state.selection.main.empty&&s.focusNode&&Xl(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=Ul(e.root);if(!t)return!1;let i=Ba.safari&&11==e.root.nodeType&&e.root.activeElement==this.dom&&function(e,t){if(t.getComposedRanges){let i=t.getComposedRanges(e.root)[0];if(i)return $u(e,i)}let i=null;function s(e){e.preventDefault(),e.stopImmediatePropagation(),i=e.getTargetRanges()[0]}return e.contentDOM.addEventListener("beforeinput",s,!0),e.dom.ownerDocument.execCommand("indent"),e.contentDOM.removeEventListener("beforeinput",s,!0),i?$u(e,i):null}(this.view,t)||t;if(!i||this.selectionRange.eq(i))return!1;let s=Jl(this.dom,i);return s&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&function(e,t){let i=t.focusNode,s=t.focusOffset;if(!i||t.anchorNode!=i||t.anchorOffset!=s)return!1;for(s=Math.min(s,ta(i));;)if(s){if(1!=i.nodeType)return!1;let e=i.childNodes[s-1];"false"==e.contentEditable?s--:(i=e,s=ta(i))}else{if(i==e)return!0;s=Ql(i),i=i.parentNode}}(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),s&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(1==i.nodeType)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);for(let e of this.scrollTargets=t)e.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Hu),Fu&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Fu&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let e=()=>{let e=this.delayedAndroidKey;if(e){this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=e.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&e.force&&ca(this.dom,e.key,e.keyCode)}};this.flushingAndroidKey=this.view.win.requestAnimationFrame(e)}this.delayedAndroidKey&&"Enter"!=e||(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(null===(i=this.delayedAndroidKey)||void 0===i?void 0:i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,s=!1;for(let n of e){let e=this.readMutation(n);e&&(e.typeOver&&(s=!0),-1==t?({from:t,to:i}=e):(t=Math.min(e.from,t),i=Math.max(e.to,i)))}return{from:t,to:i,typeOver:s}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),s=this.selectionChanged&&Jl(this.dom,this.selectionRange);if(e<0&&!s)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let n=new Ac(this.view,e,t,i);return this.view.docView.domChanged={newSel:n.newSel?n.newSel.main:null},n}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let i=this.view.state,s=Oc(this.view,t);return this.view.state==i&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),s}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty("attributes"==e.type),"attributes"==e.type&&(t.flags|=4),"childList"==e.type){let i=Wu(t,e.previousSibling||e.target.previousSibling,-1),s=Wu(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:s?t.posBefore(s):t.posAtEnd,typeOver:!1}}return"characterData"==e.type?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet($h)!=e.state.facet($h)&&(e.view.contentDOM.editContext=e.state.facet($h)?this.editContext.editContext:null))}destroy(){var e,t,i;this.stop(),null===(e=this.intersection)||void 0===e||e.disconnect(),null===(t=this.gapIntersection)||void 0===t||t.disconnect(),null===(i=this.resizeScroll)||void 0===i||i.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}};function Wu(e,t,i){for(;t;){let s=va.get(t);if(s&&s.parent==e)return s;let n=t.parentNode;t=n!=e.dom?n:i>0?t.nextSibling:t.previousSibling}return null}function $u(e,t){let i=t.startContainer,s=t.startOffset,n=t.endContainer,r=t.endOffset,o=e.docView.domAtPos(e.state.selection.main.anchor);return Xl(o.node,o.offset,n,r)&&([i,s,n,r]=[n,r,i,s]),{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}}class ju{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=t=>{let i=e.state.selection.main,{anchor:s,head:n}=i,r=this.toEditorPos(t.updateRangeStart),o=this.toEditorPos(t.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:t.updateRangeStart,editorBase:r,drifted:!1});let l={from:r,to:o,insert:Xr.of(t.text.split("\n"))};if(l.from==this.from&&s<this.from?l.from=s:l.to==this.to&&s>this.to&&(l.to=s),l.from==l.to&&!l.insert.length){let s=So.single(this.toEditorPos(t.selectionStart),this.toEditorPos(t.selectionEnd));return void(s.main.eq(i)||e.dispatch({selection:s,userEvent:"select"}))}if((Ba.mac||Ba.android)&&l.from==n-1&&/^\. ?$/.test(t.text)&&"off"==e.contentDOM.getAttribute("autocorrect")&&(l={from:r,to:o,insert:Xr.of([t.text.replace("."," ")])}),this.pendingContextChange=l,!e.state.readOnly){let i=this.to-this.from+(l.to-l.from+l.insert.length);Tc(e,l,So.single(this.toEditorPos(t.selectionStart,i),this.toEditorPos(t.selectionEnd,i)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state))},this.handlers.characterboundsupdate=i=>{let s=[],n=null;for(let t=this.toEditorPos(i.rangeStart),r=this.toEditorPos(i.rangeEnd);t<r;t++){let i=e.coordsForChar(t);n=i&&new DOMRect(i.left,i.top,i.right-i.left,i.bottom-i.top)||n||new DOMRect,s.push(n)}t.updateCharacterBounds(i.rangeStart,s)},this.handlers.textformatupdate=t=>{let i=[];for(let e of t.getTextFormats()){let t=e.underlineStyle,s=e.underlineThickness;if("None"!=t&&"None"!=s){let n=this.toEditorPos(e.rangeStart),r=this.toEditorPos(e.rangeEnd);if(n<r){let e=`text-decoration: underline ${"Dashed"==t?"dashed ":"Squiggle"==t?"wavy ":""}${"Thin"==s?1:2}px`;i.push(Ja.mark({attributes:{style:e}}).range(n,r))}}}e.dispatch({effects:zh.of(Ja.set(i))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:t}=this.composing;this.composing=null,t&&this.reset(e.state)}};for(let i in this.handlers)t.addEventListener(i,this.handlers[i]);this.measureReq={read:e=>{this.editContext.updateControlBounds(e.contentDOM.getBoundingClientRect());let t=Ul(e.root);t&&t.rangeCount&&this.editContext.updateSelectionBounds(t.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,i=!1,s=this.pendingContextChange;return e.changes.iterChanges((n,r,o,l,a)=>{if(i)return;let h=a.length-(r-n);if(s&&r>=s.to){if(s.from==n&&s.to==r&&s.insert.eq(a))return s=this.pendingContextChange=null,t+=h,void(this.to+=h);s=null,this.revertPending(e.state)}if(n+=t,(r+=t)<=this.from)this.from+=h,this.to+=h;else if(n<this.to){if(n<this.from||r>this.to||this.to-this.from+a.length>3e4)return void(i=!0);this.editContext.updateText(this.toContextPos(n),this.toContextPos(r),a.toString()),this.to+=h}t+=h}),s&&!i&&this.revertPending(e.state),!i}update(e){let t=this.pendingContextChange,i=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(i.from,i.to)&&e.transactions.some(e=>!e.isUserEvent("input.type")&&e.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):this.applyEdits(e)&&this.rangeIsValid(e.state)?(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state):(this.pendingContextChange=null,this.reset(e.state)),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),s=this.toContextPos(t.head);this.editContext.selectionStart==i&&this.editContext.selectionEnd==s||this.editContext.updateSelection(i,s)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>3e4)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let i=this.composing;return i&&i.drifted?i.editorBase+(e-i.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}let qu=class e{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:i}=e;this.dispatchTransactions=e.dispatchTransactions||i&&(e=>e.forEach(e=>i(e,this)))||(e=>this.update(e)),this.dispatch=this.dispatch.bind(this),this._root=e.root||function(e){for(;e;){if(e&&(9==e.nodeType||11==e.nodeType&&e.host))return e;e=e.assignedSlot||e.parentNode}return null}(e.parent)||document,this.viewState=new Su(e.state||pl.create(e)),e.scrollTo&&e.scrollTo.is(Fh)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(qh).map(e=>new Kh(e));for(let s of this.plugins)s.update(this);this.observer=new zu(this),this.inputState=new Dc(this),this.inputState.ensureHandlers(this.plugins),this.docView=new rc(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),(null===(t=document.fonts)||void 0===t?void 0:t.ready)&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let t=1==e.length&&e[0]instanceof sl?e:1==e.length&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t,i=!1,s=!1,n=this.state;for(let d of e){if(d.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=d.state}if(this.destroyed)return void(this.viewState.state=n);let r=this.hasFocus,o=0,l=null;e.some(e=>e.annotation(Qc))?(this.inputState.notifiedFocused=r,o=1):r!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=r,l=Zc(n,r),l||(o=1));let a=this.observer.delayedAndroidKey,h=null;if(a?(this.observer.clearDelayedAndroidKey(),h=this.observer.readChange(),(h&&!this.state.doc.eq(n.doc)||!this.state.selection.eq(n.selection))&&(h=null)):this.observer.clear(),n.facet(pl.phrases)!=this.state.facet(pl.phrases))return this.setState(n);t=nc.create(this,n,e),t.flags|=o;let c=this.viewState.scrollTarget;try{this.updateState=2;for(let t of e){if(c&&(c=c.map(t.changes)),t.scrollIntoView){let{main:e}=t.state.selection;c=new Hh(e.empty?e:So.cursor(e.head,e.head>e.anchor?-1:1))}for(let e of t.effects)e.is(Fh)&&(c=e.value.clip(this.state))}this.viewState.update(t,c),this.bidiCache=Uu.update(this.bidiCache,t.changes),t.empty||(this.updatePlugins(t),this.inputState.update(t)),i=this.docView.update(t),this.state.facet(ic)!=this.styleModules&&this.mountStyles(),s=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some(e=>e.isUserEvent("select.pointer")))}finally{this.updateState=0}if(t.startState.facet(Eu)!=t.state.facet(Eu)&&(this.viewState.mustMeasureContent=!0),(i||s||c||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),i&&this.docViewUpdate(),!t.empty)for(let d of this.state.facet(Eh))try{d(t)}catch(u){Wh(this.state,u,"update listener")}(l||h)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),h&&!Oc(this,h)&&a.force&&ca(this.contentDOM,a.key,a.keyCode)})}setState(e){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=e);this.updateState=2;let t=this.hasFocus;try{for(let e of this.plugins)e.destroy(this);this.viewState=new Su(e),this.plugins=e.facet(qh).map(e=>new Kh(e)),this.pluginMap.clear();for(let e of this.plugins)e.update(this);this.docView.destroy(),this.docView=new rc(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(qh),i=e.state.facet(qh);if(t!=i){let s=[];for(let n of i){let i=t.indexOf(n);if(i<0)s.push(new Kh(n));else{let t=this.plugins[i];t.mustUpdate=e,s.push(t)}}for(let t of this.plugins)t.mustUpdate!=e&&t.destroy(this);this.plugins=s,this.pluginMap.clear()}else for(let s of this.plugins)s.mustUpdate=e;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this);t!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let t of this.plugins){let i=t.value;if(i&&i.docViewUpdate)try{i.docViewUpdate(this)}catch(e){Wh(this.state,e,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey)return this.measureScheduled=-1,void this.requestMeasure();this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,s=i.scrollTop*this.scaleY,{scrollAnchorPos:n,scrollAnchorHeight:r}=this.viewState;Math.abs(s-this.viewState.scrollTop)>1&&(r=-1),this.viewState.scrollAnchorHeight=-1;try{for(let e=0;;e++){if(r<0)if(da(i))n=-1,r=this.viewState.heightMap.height;else{let e=this.viewState.scrollAnchorAt(s);n=e.from,r=e.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(e>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let a=[];4&l||([this.measureRequests,a]=[a,this.measureRequests]);let h=a.map(e=>{try{return e.read(this)}catch(t){return Wh(this.state,t),Ku}}),c=nc.create(this,this.state,[]),u=!1;c.flags|=l,t?t.flags|=l:t=c,this.updateState=2,c.empty||(this.updatePlugins(c),this.inputState.update(c),this.updateAttrs(),u=this.docView.update(c),u&&this.docViewUpdate());for(let e=0;e<a.length;e++)if(h[e]!=Ku)try{let t=a[e];t.write&&t.write(h[e],this)}catch(o){Wh(this.state,o)}if(u&&this.docView.updateSelection(!0),!c.viewportChanged&&0==this.measureRequests.length){if(this.viewState.editorHeight){if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,r=-1;continue}{let e=(n<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(n).top)-r;if(e>1||e<-1){s+=e,i.scrollTop=s/this.scaleY,r=-1;continue}}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let l of this.state.facet(Eh))l(t)}get themeClasses(){return Lu+" "+(this.state.facet(Ru)?Pu:Bu)+" "+this.state.facet(Eu)}updateAttrs(){let e=Gu(this,Uh,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet($h)?"true":"false",class:"cm-content",style:`${Ba.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),Gu(this,Gh,t);let i=this.observer.ignore(()=>{let i=_a(this.contentDOM,this.contentAttrs,t),s=_a(this.dom,this.editorAttrs,e);return i||s});return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(t){let i=!0;for(let s of t)for(let t of s.effects)if(t.is(e.announce)){i&&(this.announceDOM.textContent=""),i=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value}}mountStyles(){this.styleModules=this.state.facet(ic);let t=this.state.facet(e.cspNonce);Nl.mount(this.root,this.styleModules.concat(Iu).reverse(),t?{nonce:t}:void 0)}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(null!=e.key)for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key)return void(this.measureRequests[t]=e);this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(void 0===t||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find(t=>t.plugin==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return xc(this,e,yc(this,e,t,i))}moveByGroup(e,t){return xc(this,e,yc(this,e,t,t=>function(e,t,i){let s=e.state.charCategorizer(t),n=s(i);return e=>{let t=s(e);return n==cl.Space&&(n=t),n==t}}(this,e.head,t)))}visualLineSide(e,t){let i=this.bidiSpans(e),s=this.textDirectionAt(e.from),n=i[t?i.length-1:0];return So.cursor(n.side(t,s)+e.from,n.forward(!t,s)?1:-1)}moveToLineBoundary(e,t,i=!0){return function(e,t,i,s){let n=vc(e,t.head,t.assoc||-1),r=s&&n.type==Ga.Text&&(e.lineWrapping||n.widgetLineBreaks)?e.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head):null;if(r){let t=e.dom.getBoundingClientRect(),s=e.textDirectionAt(n.from),o=e.posAtCoords({x:i==(s==lh.LTR)?t.right-1:t.left+1,y:(r.top+r.bottom)/2});if(null!=o)return So.cursor(o,i?-1:1)}return So.cursor(i?n.to:n.from,i?-1:1)}(this,e,t,i)}moveVertically(e,t,i){return xc(this,e,function(e,t,i,s){let n=t.head,r=i?1:-1;if(n==(i?e.state.doc.length:0))return So.cursor(n,t.assoc);let o,l=t.goalColumn,a=e.contentDOM.getBoundingClientRect(),h=e.coordsAtPos(n,t.assoc||-1),c=e.documentTop;if(h)null==l&&(l=h.left-a.left),o=r<0?h.top:h.bottom;else{let t=e.viewState.lineBlockAt(n);null==l&&(l=Math.min(a.right-a.left,e.defaultCharacterWidth*(n-t.from))),o=(r<0?t.top:t.bottom)+c}let u=a.left+l,d=null!=s?s:e.viewState.heightOracle.textHeight>>1;for(let f=0;;f+=10){let t=o+(d+f)*r,i=gc(e,{x:u,y:t},!1,r);if(t<a.top||t>a.bottom||(r<0?i<n:i>n)){let s=e.docView.coordsForChar(i),n=!s||t<s.top?-1:1;return So.cursor(i,n,void 0,l)}}}(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),gc(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(e),n=this.bidiSpans(s);return ia(i,n[vh.find(n,e-s.from,-1,t)].dir==lh.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(Nh)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>_u)return kh(e.length);let t,i=this.textDirectionAt(e.from);for(let n of this.bidiCache)if(n.from==e.from&&n.dir==i&&(n.fresh||yh(n.isolates,t=Zh(this,e))))return n.order;t||(t=Zh(this,e));let s=function(e,t,i){if(!e)return[new vh(0,0,t==hh?1:0)];if(t==ah&&!i.length&&!mh.test(e))return kh(e.length);if(i.length)for(;e.length>bh.length;)bh[bh.length]=256;let s=[],n=t==ah?0:1;return xh(e,n,n,i,0,e.length,s),s}(e.text,i,t);return this.bidiCache.push(new Uu(e.from,e.to,i,t,!0,s)),s}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||Ba.safari&&(null===(e=this.inputState)||void 0===e?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{aa(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((9==e.nodeType?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Fh.of(new Hh("number"==typeof e?So.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,i=this.viewState.scrollAnchorAt(e);return Fh.of(new Hh(So.cursor(i.from),"start","start",i.top-e,t,!0))}setTabFocusMode(e){null==e?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:"boolean"==typeof e?this.inputState.tabFocusMode=e?0:-1:0!=this.inputState.tabFocusMode&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return _h.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return _h.define(()=>({}),{eventObservers:e})}static theme(e,t){let i=Nl.newName(),s=[Eu.of(i),ic.of(Vu(`.${i}`,e))];return t&&t.dark&&s.push(Ru.of(!0)),s}static baseTheme(e){return Fo.lowest(ic.of(Vu("."+Lu,e,Nu)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),s=i&&va.get(i)||va.get(e);return(null===(t=null==s?void 0:s.rootView)||void 0===t?void 0:t.view)||null}};qu.styleModule=ic,qu.inputHandler=Rh,qu.clipboardInputFilter=Bh,qu.clipboardOutputFilter=Ph,qu.scrollHandler=Ih,qu.focusChangeEffect=Lh,qu.perLineTextDirection=Nh,qu.exceptionSink=Dh,qu.updateListener=Eh,qu.editable=$h,qu.mouseSelectionStyle=Th,qu.dragMovesSelection=Oh,qu.clickAddsSelectionRange=Ah,qu.decorations=Jh,qu.outerDecorations=Yh,qu.atomicRanges=Xh,qu.bidiIsolatedRanges=Qh,qu.scrollMargins=ec,qu.darkTheme=Ru,qu.cspNonce=Ao.define({combine:e=>e.length?e[0]:""}),qu.contentAttributes=Gh,qu.editorAttributes=Uh,qu.lineWrapping=qu.contentAttributes.of({class:"cm-lineWrapping"}),qu.announce=il.define();const _u=4096,Ku={};let Uu=class e{constructor(e,t,i,s,n,r){this.from=e,this.to=t,this.dir=i,this.isolates=s,this.fresh=n,this.order=r}static update(t,i){if(i.empty&&!t.some(e=>e.fresh))return t;let s=[],n=t.length?t[t.length-1].dir:lh.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir!=n||i.touchesRange(o.from,o.to)||s.push(new e(i.mapPos(o.from,1),i.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return s}};function Gu(e,t,i){for(let s=e.state.facet(t),n=s.length-1;n>=0;n--){let t=s[n],r="function"==typeof t?t(e):t;r&&$a(r,i)}return i}const Ju=Ba.mac?"mac":Ba.windows?"win":Ba.linux?"linux":"key";function Yu(e,t,i){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==i&&t.shiftKey&&(e="Shift-"+e),e}const Xu=Fo.default(qu.domEventHandlers({keydown:(e,t)=>function(e,t,i,s){id=t;let n=ql(t),r=co(ao(n,0))==n.length&&" "!=n,o="",l=!1,a=!1,h=!1;ed&&ed.view==i&&ed.scope==s&&(o=ed.prefix+" ",Bc.indexOf(t.keyCode)<0&&(a=!0,ed=null));let c,u,d=new Set,f=e=>{if(e){for(let t of e.run)if(!d.has(t)&&(d.add(t),t(i)))return e.stopPropagation&&(h=!0),!0;e.preventDefault&&(e.stopPropagation&&(h=!0),a=!0)}return!1},p=e[s];p&&(f(p[o+Yu(n,t,!r)])?l=!0:!r||!(t.altKey||t.metaKey||t.ctrlKey)||Ba.windows&&t.ctrlKey&&t.altKey||Ba.mac&&t.altKey&&!t.ctrlKey&&!t.metaKey||!(c=Hl[t.keyCode])||c==n?r&&t.shiftKey&&f(p[o+Yu(n,t,!0)])&&(l=!0):(f(p[o+Yu(c,t,!0)])||t.shiftKey&&(u=Fl[t.keyCode])!=n&&u!=c&&f(p[o+Yu(u,t,!1)]))&&(l=!0),!l&&f(p._any)&&(l=!0));a&&(l=!0);l&&h&&t.stopPropagation();return id=null,l}(function(e){let t=e.facet(Qu),i=Zu.get(t);i||Zu.set(t,i=function(e,t=Ju){let i=Object.create(null),s=Object.create(null),n=(e,t)=>{let i=s[e];if(null==i)s[e]=t;else if(i!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")},r=(e,s,r,o,l)=>{var a,h;let c=i[e]||(i[e]=Object.create(null)),u=s.split(/ (?!$)/).map(e=>function(e,t){const i=e.split(/-(?!$)/);let s,n,r,o,l=i[i.length-1];"Space"==l&&(l=" ");for(let a=0;a<i.length-1;++a){const e=i[a];if(/^(cmd|meta|m)$/i.test(e))o=!0;else if(/^a(lt)?$/i.test(e))s=!0;else if(/^(c|ctrl|control)$/i.test(e))n=!0;else if(/^s(hift)?$/i.test(e))r=!0;else{if(!/^mod$/i.test(e))throw new Error("Unrecognized modifier name: "+e);"mac"==t?o=!0:n=!0}}return s&&(l="Alt-"+l),n&&(l="Ctrl-"+l),o&&(l="Meta-"+l),r&&(l="Shift-"+l),l}(e,t));for(let t=1;t<u.length;t++){let i=u.slice(0,t).join(" ");n(i,!0),c[i]||(c[i]={preventDefault:!0,stopPropagation:!1,run:[t=>{let s=ed={view:t,prefix:i,scope:e};return setTimeout(()=>{ed==s&&(ed=null)},td),!0}]})}let d=u.join(" ");n(d,!1);let f=c[d]||(c[d]={preventDefault:!1,stopPropagation:!1,run:(null===(h=null===(a=c._any)||void 0===a?void 0:a.run)||void 0===h?void 0:h.slice())||[]});r&&f.run.push(r),o&&(f.preventDefault=!0),l&&(f.stopPropagation=!0)};for(let o of e){let e=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let t of e){let e=i[t]||(i[t]=Object.create(null));e._any||(e._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:s}=o;for(let t in e)e[t].run.push(e=>s(e,id))}let s=o[t]||o.key;if(s)for(let t of e)r(t,s,o.run,o.preventDefault,o.stopPropagation),o.shift&&r(t,"Shift-"+s,o.shift,o.preventDefault,o.stopPropagation)}return i}(t.reduce((e,t)=>e.concat(t),[])));return i}(t.state),e,t,"editor")})),Qu=Ao.define({enables:Xu}),Zu=new WeakMap;let ed=null;const td=4e3;let id=null;class sd{constructor(e,t,i,s,n){this.className=e,this.left=t,this.top=i,this.width=s,this.height=n}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className==this.className&&(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",null!=this.width&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,i){if(i.empty){let s=e.coordsAtPos(i.head,i.assoc||1);if(!s)return[];let n=nd(e);return[new sd(t,s.left-n.left,s.top-n.top,null,s.bottom-s.top)]}return function(e,t,i){if(i.to<=e.viewport.from||i.from>=e.viewport.to)return[];let s=Math.max(i.from,e.viewport.from),n=Math.min(i.to,e.viewport.to),r=e.textDirection==lh.LTR,o=e.contentDOM,l=o.getBoundingClientRect(),a=nd(e),h=o.querySelector(".cm-line"),c=h&&window.getComputedStyle(h),u=l.left+(c?parseInt(c.paddingLeft)+Math.min(0,parseInt(c.textIndent)):0),d=l.right-(c?parseInt(c.paddingRight):0),f=vc(e,s,1),p=vc(e,n,-1),g=f.type==Ga.Text?f:null,m=p.type==Ga.Text?p:null;g&&(e.lineWrapping||f.widgetLineBreaks)&&(g=rd(e,s,1,g));m&&(e.lineWrapping||p.widgetLineBreaks)&&(m=rd(e,n,-1,m));if(g&&m&&g.from==m.from&&g.to==m.to)return y(b(i.from,i.to,g));{let t=g?b(i.from,null,g):w(f,!1),s=m?b(null,i.to,m):w(p,!0),n=[];return(g||f).to<(m||p).from-(g&&m?1:0)||f.widgetLineBreaks>1&&t.bottom+e.defaultLineHeight/2<s.top?n.push(v(u,t.bottom,d,s.top)):t.bottom<s.top&&e.elementAtHeight((t.bottom+s.top)/2).type==Ga.Text&&(t.bottom=s.top=(t.bottom+s.top)/2),y(t).concat(n).concat(y(s))}function v(e,i,s,n){return new sd(t,e-a.left,i-a.top,s-e,n-i)}function y({top:e,bottom:t,horizontal:i}){let s=[];for(let n=0;n<i.length;n+=2)s.push(v(i[n],e,i[n+1],t));return s}function b(t,i,s){let n=1e9,o=-1e9,l=[];function a(t,i,a,h,c){let f=e.coordsAtPos(t,t==s.to?-2:2),p=e.coordsAtPos(a,a==s.from?2:-2);f&&p&&(n=Math.min(f.top,p.top,n),o=Math.max(f.bottom,p.bottom,o),c==lh.LTR?l.push(r&&i?u:f.left,r&&h?d:p.right):l.push(!r&&h?u:p.left,!r&&i?d:f.right))}let h=null!=t?t:s.from,c=null!=i?i:s.to;for(let r of e.visibleRanges)if(r.to>h&&r.from<c)for(let s=Math.max(r.from,h),n=Math.min(r.to,c);;){let r=e.state.doc.lineAt(s);for(let o of e.bidiSpans(r)){let e=o.from+r.from,l=o.to+r.from;if(e>=n)break;l>s&&a(Math.max(e,s),null==t&&e<=h,Math.min(l,n),null==i&&l>=c,o.dir)}if(s=r.to+1,s>=n)break}return 0==l.length&&a(h,null==t,c,null==i,e.textDirection),{top:n,bottom:o,horizontal:l}}function w(e,t){let i=l.top+(t?e.top:e.bottom);return{top:i,bottom:i,horizontal:[]}}}(e,t,i)}}function nd(e){let t=e.scrollDOM.getBoundingClientRect();return{left:(e.textDirection==lh.LTR?t.left:t.right-e.scrollDOM.clientWidth*e.scaleX)-e.scrollDOM.scrollLeft*e.scaleX,top:t.top-e.scrollDOM.scrollTop*e.scaleY}}function rd(e,t,i,s){let n=e.coordsAtPos(t,2*i);if(!n)return s;let r=e.dom.getBoundingClientRect(),o=(n.top+n.bottom)/2,l=e.posAtCoords({x:r.left+1,y:o}),a=e.posAtCoords({x:r.right-1,y:o});return null==l||null==a?s:{from:Math.max(s.from,Math.min(l,a)),to:Math.min(s.to,Math.max(l,a))}}class od{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(ld)!=e.state.facet(ld)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){!1!==this.layer.updateOnDocViewUpdate&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,i=e.facet(ld);for(;t<i.length&&i[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;e==this.scaleX&&t==this.scaleY||(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some((e,t)=>{return i=e,s=this.drawn[t],!(i.constructor==s.constructor&&i.eq(s));var i,s})){let t=this.dom.firstChild,i=0;for(let s of e)s.update&&t&&s.constructor&&this.drawn[i].constructor&&s.update(t,this.drawn[i])?(t=t.nextSibling,i++):this.dom.insertBefore(s.draw(),t);for(;t;){let e=t.nextSibling;t.remove(),t=e}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const ld=Ao.define();function ad(e){return[_h.define(t=>new od(t,e)),ld.of(e)]}const hd=Ao.define({combine:e=>gl(e,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})});function cd(e={}){return[hd.of(e),dd,pd,gd,Vh.of(!0)]}function ud(e){return e.startState.facet(hd)!=e.state.facet(hd)}const dd=ad({above:!0,markers(e){let{state:t}=e,i=t.facet(hd),s=[];for(let n of t.selection.ranges){let r=n==t.selection.main;if(n.empty||i.drawRangeCursor){let t=r?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",i=n.empty?n:So.cursor(n.head,n.head>n.anchor?-1:1);for(let n of sd.forRange(e,t,i))s.push(n)}}return s},update(e,t){e.transactions.some(e=>e.selection)&&(t.style.animationName="cm-blink"==t.style.animationName?"cm-blink2":"cm-blink");let i=ud(e);return i&&fd(e.state,t),e.docChanged||e.selectionSet||i},mount(e,t){fd(t.state,e)},class:"cm-cursorLayer"});function fd(e,t){t.style.animationDuration=e.facet(hd).cursorBlinkRate+"ms"}const pd=ad({above:!1,markers:e=>e.state.selection.ranges.map(t=>t.empty?[]:sd.forRange(e,"cm-selectionBackground",t)).reduce((e,t)=>e.concat(t)),update:(e,t)=>e.docChanged||e.selectionSet||e.viewportChanged||ud(e),class:"cm-selectionLayer"}),gd=Fo.highest(qu.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}}));const md=Ja.line({class:"cm-activeLine"}),vd=_h.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.docChanged||e.selectionSet)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=-1,i=[];for(let s of e.state.selection.ranges){let n=e.lineBlockAt(s.head);n.from>t&&(i.push(md.range(n.from)),t=n.from)}return Ja.set(i)}},{decorations:e=>e.decorations}),yd="-10000px";class bd{constructor(e,t,i,s){this.facet=t,this.createTooltipView=i,this.removeTooltipView=s,this.input=e.state.facet(t),this.tooltips=this.input.filter(e=>e);let n=null;this.tooltipViews=this.tooltips.map(e=>n=i(e,n))}update(e,t){var i;let s=e.state.facet(this.facet),n=s.filter(e=>e);if(s===this.input){for(let t of this.tooltipViews)t.update&&t.update(e);return!1}let r=[],o=t?[]:null;for(let l=0;l<n.length;l++){let i=n[l],s=-1;if(i){for(let e=0;e<this.tooltips.length;e++){let t=this.tooltips[e];t&&t.create==i.create&&(s=e)}if(s<0)r[l]=this.createTooltipView(i,l?r[l-1]:null),o&&(o[l]=!!i.above);else{let i=r[l]=this.tooltipViews[s];o&&(o[l]=t[s]),i.update&&i.update(e)}}}for(let l of this.tooltipViews)r.indexOf(l)<0&&(this.removeTooltipView(l),null===(i=l.destroy)||void 0===i||i.call(l));return t&&(o.forEach((e,i)=>t[i]=e),t.length=o.length),this.input=s,this.tooltips=n,this.tooltipViews=r,!0}}function wd(e){let t=e.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:t.clientHeight,right:t.clientWidth}}const xd=Ao.define({combine:e=>{var t,i,s;return{position:Ba.ios?"absolute":(null===(t=e.find(e=>e.position))||void 0===t?void 0:t.position)||"fixed",parent:(null===(i=e.find(e=>e.parent))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(s=e.find(e=>e.tooltipSpace))||void 0===s?void 0:s.tooltipSpace)||wd}}}),kd=new WeakMap,Sd=_h.fromClass(class{constructor(e){this.view=e,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let t=e.state.facet(xd);this.position=t.position,this.parent=t.parent,this.classes=e.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver="function"==typeof ResizeObserver?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new bd(e,Od,(e,t)=>this.createTooltip(e,t),e=>{this.resizeObserver&&this.resizeObserver.unobserve(e.dom),e.dom.remove()}),this.above=this.manager.tooltips.map(e=>!!e.above),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver(e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),e.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let e of this.manager.tooltipViews)this.intersectionObserver.observe(e.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(e){e.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(e,this.above);t&&this.observeIntersection();let i=t||e.geometryChanged,s=e.state.facet(xd);if(s.position!=this.position&&!this.madeAbsolute){this.position=s.position;for(let e of this.manager.tooltipViews)e.dom.style.position=this.position;i=!0}if(s.parent!=this.parent){this.parent&&this.container.remove(),this.parent=s.parent,this.createContainer();for(let e of this.manager.tooltipViews)this.container.appendChild(e.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(e,t){let i=e.create(this.view),s=t?t.dom:null;if(i.dom.classList.add("cm-tooltip"),e.arrow&&!i.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",i.dom.appendChild(e)}return i.dom.style.position=this.position,i.dom.style.top=yd,i.dom.style.left="0px",this.container.insertBefore(i.dom,s),i.mount&&i.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(i.dom),i}destroy(){var e,t,i;this.view.win.removeEventListener("resize",this.measureSoon);for(let s of this.manager.tooltipViews)s.dom.remove(),null===(e=s.destroy)||void 0===e||e.call(s);this.parent&&this.container.remove(),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),null===(i=this.intersectionObserver)||void 0===i||i.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let e=1,t=1,i=!1;if("fixed"==this.position&&this.manager.tooltipViews.length){let{dom:e}=this.manager.tooltipViews[0];if(Ba.gecko)i=e.offsetParent!=this.container.ownerDocument.body;else if(e.style.top==yd&&"0px"==e.style.left){let t=e.getBoundingClientRect();i=Math.abs(t.top+1e4)>1||Math.abs(t.left)>1}}if(i||"absolute"==this.position)if(this.parent){let i=this.parent.getBoundingClientRect();i.width&&i.height&&(e=i.width/this.parent.offsetWidth,t=i.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:t}=this.view.viewState);let s=this.view.scrollDOM.getBoundingClientRect(),n=tc(this.view);return{visible:{left:s.left+n.left,top:s.top+n.top,right:s.right-n.right,bottom:s.bottom-n.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((e,t)=>{let i=this.manager.tooltipViews[t];return i.getCoords?i.getCoords(e.pos):this.view.coordsAtPos(e.pos)}),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(xd).tooltipSpace(this.view),scaleX:e,scaleY:t,makeAbsolute:i}}writeMeasure(e){var t;if(e.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let e of this.manager.tooltipViews)e.dom.style.position="absolute"}let{visible:i,space:s,scaleX:n,scaleY:r}=e,o=[];for(let l=0;l<this.manager.tooltips.length;l++){let a=this.manager.tooltips[l],h=this.manager.tooltipViews[l],{dom:c}=h,u=e.pos[l],d=e.size[l];if(!u||!1!==a.clip&&(u.bottom<=Math.max(i.top,s.top)||u.top>=Math.min(i.bottom,s.bottom)||u.right<Math.max(i.left,s.left)-.1||u.left>Math.min(i.right,s.right)+.1)){c.style.top=yd;continue}let f=a.arrow?h.dom.querySelector(".cm-tooltip-arrow"):null,p=f?7:0,g=d.right-d.left,m=null!==(t=kd.get(h))&&void 0!==t?t:d.bottom-d.top,v=h.offset||Ad,y=this.view.textDirection==lh.LTR,b=d.width>s.right-s.left?y?s.left:s.right-d.width:y?Math.max(s.left,Math.min(u.left-(f?14:0)+v.x,s.right-g)):Math.min(Math.max(s.left,u.left-g+(f?14:0)-v.x),s.right-g),w=this.above[l];!a.strictSide&&(w?u.top-m-p-v.y<s.top:u.bottom+m+p+v.y>s.bottom)&&w==s.bottom-u.bottom>u.top-s.top&&(w=this.above[l]=!w);let x=(w?u.top-s.top:s.bottom-u.bottom)-p;if(x<m&&!1!==h.resize){if(x<this.view.defaultLineHeight){c.style.top=yd;continue}kd.set(h,m),c.style.height=(m=x)/r+"px"}else c.style.height&&(c.style.height="");let k=w?u.top-m-p-v.y:u.bottom+p+v.y,S=b+g;if(!0!==h.overlap)for(let e of o)e.left<S&&e.right>b&&e.top<k+m&&e.bottom>k&&(k=w?e.top-m-2-p:e.bottom+p+2);if("absolute"==this.position?(c.style.top=(k-e.parent.top)/r+"px",Cd(c,(b-e.parent.left)/n)):(c.style.top=k/r+"px",Cd(c,b/n)),f){let e=u.left+(y?v.x:-v.x)-(b+14-7);f.style.left=e/n+"px"}!0!==h.overlap&&o.push({left:b,top:k,right:S,bottom:k+m}),c.classList.toggle("cm-tooltip-above",w),c.classList.toggle("cm-tooltip-below",!w),h.positioned&&h.positioned(e.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let e of this.manager.tooltipViews)e.dom.style.top=yd}},{eventObservers:{scroll(){this.maybeMeasure()}}});function Cd(e,t){let i=parseInt(e.style.left,10);(isNaN(i)||Math.abs(t-i)>1)&&(e.style.left=t+"px")}const Md=qu.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),Ad={x:0,y:0},Od=Ao.define({enables:[Sd,Md]});function Td(e,t){let i=e.plugin(Sd);if(!i)return null;let s=i.manager.tooltips.indexOf(t);return s<0?null:i.manager.tooltipViews[s]}let Dd=class extends ml{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}};Dd.prototype.elementClass="",Dd.prototype.toDOM=void 0,Dd.prototype.mapMode=fo.TrackBefore,Dd.prototype.startSide=Dd.prototype.endSide=-1,Dd.prototype.point=!0;const Ed=Ao.define(),Rd=Ao.define(),Ld=Ao.define(),Bd=Ao.define({combine:e=>e.some(e=>e)});const Pd=_h.fromClass(class{constructor(e){this.view=e,this.domAfter=null,this.prevViewport=e.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=e.state.facet(Ld).map(t=>new Hd(e,t)),this.fixed=!e.state.facet(Bd);for(let t of this.gutters)"after"==t.config.side?this.getDOMAfter().appendChild(t.dom):this.dom.appendChild(t.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),e.scrollDOM.insertBefore(this.dom,e.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(e){if(this.updateGutters(e)){let t=this.prevViewport,i=e.view.viewport,s=Math.min(t.to,i.to)-Math.max(t.from,i.from);this.syncGutters(s<.8*(i.to-i.from))}if(e.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(Bd)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=e.view.viewport}syncGutters(e){let t=this.dom.nextSibling;e&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let i=wl.iter(this.view.state.facet(Ed),this.view.viewport.from),s=[],n=this.gutters.map(e=>new Id(e,this.view.viewport,-this.view.documentPadding.top));for(let r of this.view.viewportLineBlocks)if(s.length&&(s=[]),Array.isArray(r.type)){let e=!0;for(let t of r.type)if(t.type==Ga.Text&&e){Vd(i,s,t.from);for(let e of n)e.line(this.view,t,s);e=!1}else if(t.widget)for(let e of n)e.widget(this.view,t)}else if(r.type==Ga.Text){Vd(i,s,r.from);for(let e of n)e.line(this.view,r,s)}else if(r.widget)for(let e of n)e.widget(this.view,r);for(let r of n)r.finish();e&&(this.view.scrollDOM.insertBefore(this.dom,t),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(e){let t=e.startState.facet(Ld),i=e.state.facet(Ld),s=e.docChanged||e.heightChanged||e.viewportChanged||!wl.eq(e.startState.facet(Ed),e.state.facet(Ed),e.view.viewport.from,e.view.viewport.to);if(t==i)for(let n of this.gutters)n.update(e)&&(s=!0);else{s=!0;let n=[];for(let s of i){let i=t.indexOf(s);i<0?n.push(new Hd(this.view,s)):(this.gutters[i].update(e),n.push(this.gutters[i]))}for(let e of this.gutters)e.dom.remove(),n.indexOf(e)<0&&e.destroy();for(let e of n)"after"==e.config.side?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.gutters=n}return s}destroy(){for(let e of this.gutters)e.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:e=>qu.scrollMargins.of(t=>{let i=t.plugin(e);if(!i||0==i.gutters.length||!i.fixed)return null;let s=i.dom.offsetWidth*t.scaleX,n=i.domAfter?i.domAfter.offsetWidth*t.scaleX:0;return t.textDirection==lh.LTR?{left:s,right:n}:{right:s,left:n}})});function Nd(e){return Array.isArray(e)?e:[e]}function Vd(e,t,i){for(;e.value&&e.from<=i;)e.from==i&&t.push(e.value),e.next()}class Id{constructor(e,t,i){this.gutter=e,this.height=i,this.i=0,this.cursor=wl.iter(e.markers,t.from)}addElement(e,t,i){let{gutter:s}=this,n=(t.top-this.height)/e.scaleY,r=t.height/e.scaleY;if(this.i==s.elements.length){let t=new Fd(e,r,n,i);s.elements.push(t),s.dom.appendChild(t.dom)}else s.elements[this.i].update(e,r,n,i);this.height=t.bottom,this.i++}line(e,t,i){let s=[];Vd(this.cursor,s,t.from),i.length&&(s=s.concat(i));let n=this.gutter.config.lineMarker(e,t,s);n&&s.unshift(n);let r=this.gutter;(0!=s.length||r.config.renderEmptyElements)&&this.addElement(e,t,s)}widget(e,t){let i=this.gutter.config.widgetMarker(e,t.widget,t),s=i?[i]:null;for(let n of e.state.facet(Rd)){let i=n(e,t.widget,t);i&&(s||(s=[])).push(i)}s&&this.addElement(e,t,s)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Hd{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,s=>{let n,r=s.target;if(r!=this.dom&&this.dom.contains(r)){for(;r.parentNode!=this.dom;)r=r.parentNode;let e=r.getBoundingClientRect();n=(e.top+e.bottom)/2}else n=s.clientY;let o=e.lineBlockAtHeight(n-e.documentTop);t.domEventHandlers[i](e,o,s)&&s.preventDefault()});this.markers=Nd(t.markers(e)),t.initialSpacer&&(this.spacer=new Fd(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Nd(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let t=this.config.updateSpacer(this.spacer.markers[0],e);t!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[t])}let i=e.view.viewport;return!wl.eq(this.markers,t,i.from,i.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(e)}destroy(){for(let e of this.elements)e.destroy()}}class Fd{constructor(e,t,i,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,s)}update(e,t,i,s){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),function(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(!e[i].compare(t[i]))return!1;return!0}(this.markers,s)||this.setMarkers(e,s)}setMarkers(e,t){let i="cm-gutterElement",s=this.dom.firstChild;for(let n=0,r=0;;){let o=r,l=n<t.length?t[n++]:null,a=!1;if(l){let e=l.elementClass;e&&(i+=" "+e);for(let t=r;t<this.markers.length;t++)if(this.markers[t].compare(l)){o=t,a=!0;break}}else o=this.markers.length;for(;r<o;){let e=this.markers[r++];if(e.toDOM){e.destroy(s);let t=s.nextSibling;s.remove(),s=t}}if(!l)break;l.toDOM&&(a?s=s.nextSibling:this.dom.insertBefore(l.toDOM(e),s)),a&&r++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}const zd=Ao.define(),Wd=Ao.define(),$d=Ao.define({combine:e=>gl(e,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let s in t){let e=i[s],n=t[s];i[s]=e?(t,i,s)=>e(t,i,s)||n(t,i,s):n}return i}})});class jd extends Dd{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function qd(e,t){return e.state.facet($d).formatNumber(t,e.state)}const _d=Ld.compute([$d],e=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:e=>e.state.facet(zd),lineMarker:(e,t,i)=>i.some(e=>e.toDOM)?null:new jd(qd(e,e.state.doc.lineAt(t.from).number)),widgetMarker:(e,t,i)=>{for(let s of e.state.facet(Wd)){let n=s(e,t,i);if(n)return n}return null},lineMarkerChange:e=>e.startState.facet($d)!=e.state.facet($d),initialSpacer:e=>new jd(qd(e,Ud(e.state.doc.lines))),updateSpacer(e,t){let i=qd(t.view,Ud(t.view.state.doc.lines));return i==e.number?e:new jd(i)},domEventHandlers:e.facet($d).domEventHandlers,side:"before"}));function Kd(e={}){return[$d.of(e),[Pd],_d]}function Ud(e){let t=9;for(;t<e;)t=10*t+9;return t}const Gd=new class extends Dd{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},Jd=Ed.compute(["selection"],e=>{let t=[],i=-1;for(let s of e.selection.ranges){let n=e.doc.lineAt(s.head).from;n>i&&(i=n,t.push(Gd.range(n)))}return wl.of(t)});const Yd=1024;let Xd=0,Qd=class{constructor(e,t){this.from=e,this.to=t}};class Zd{constructor(e={}){this.id=Xd++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=sf.match(e)),t=>{let i=e(t);return void 0===i?null:[this,i]}}}Zd.closedBy=new Zd({deserialize:e=>e.split(" ")}),Zd.openedBy=new Zd({deserialize:e=>e.split(" ")}),Zd.group=new Zd({deserialize:e=>e.split(" ")}),Zd.isolate=new Zd({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw new RangeError("Invalid value for isolate: "+e);return e||"auto"}}),Zd.contextHash=new Zd({perNode:!0}),Zd.lookAhead=new Zd({perNode:!0}),Zd.mounted=new Zd({perNode:!0});class ef{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}static get(e){return e&&e.props&&e.props[Zd.mounted.id]}}const tf=Object.create(null);class sf{constructor(e,t,i,s=0){this.name=e,this.props=t,this.id=i,this.flags=s}static define(e){let t=e.props&&e.props.length?Object.create(null):tf,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),s=new sf(e.name||"",t,e.id,i);if(e.props)for(let n of e.props)if(Array.isArray(n)||(n=n(s)),n){if(n[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[n[0].id]=n[1]}return s}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(Zd.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let s of i.split(" "))t[s]=e[i];return e=>{for(let i=e.prop(Zd.group),s=-1;s<(i?i.length:0);s++){let n=t[s<0?e.name:i[s]];if(n)return n}}}}sf.none=new sf("",Object.create(null),0,8);class nf{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let s=null;for(let t of e){let e=t(i);e&&(s||(s=Object.assign({},i.props)),s[e[0].id]=e[1])}t.push(s?new sf(i.name,s,i.id,i.flags):i)}return new nf(t)}}const rf=new WeakMap,of=new WeakMap;var lf,af;(af=lf||(lf={}))[af.ExcludeBuffers=1]="ExcludeBuffers",af[af.IncludeAnonymous=2]="IncludeAnonymous",af[af.IgnoreMounts=4]="IgnoreMounts",af[af.IgnoreOverlays=8]="IgnoreOverlays";class hf{constructor(e,t,i,s,n){if(this.type=e,this.children=t,this.positions=i,this.length=s,this.props=null,n&&n.length){this.props=Object.create(null);for(let[e,t]of n)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=ef.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let e=i.toString();e&&(t&&(t+=","),t+=e)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new kf(this.topNode,e)}cursorAt(e,t=0,i=0){let s=rf.get(this)||this.topNode,n=new kf(s);return n.moveTo(e,t),rf.set(this,n._tree),n}get topNode(){return new gf(this,0,0,null)}resolve(e,t=0){let i=ff(rf.get(this)||this.topNode,e,t,!1);return rf.set(this,i),i}resolveInner(e,t=0){let i=ff(of.get(this)||this.topNode,e,t,!0);return of.set(this,i),i}resolveStack(e,t=0){return function(e,t,i){let s=e.resolveInner(t,i),n=null;for(let r=s instanceof gf?s:s.context.parent;r;r=r.parent)if(r.index<0){let e=r.parent;(n||(n=[s])).push(e.resolve(t,i)),r=e}else{let e=ef.get(r.tree);if(e&&e.overlay&&e.overlay[0].from<=t&&e.overlay[e.overlay.length-1].to>=t){let o=new gf(e.tree,e.overlay[0].from+r.from,-1,r);(n||(n=[s])).push(ff(o,t,i,!1))}}return n?wf(n):s}(this,e,t)}iterate(e){let{enter:t,leave:i,from:s=0,to:n=this.length}=e,r=e.mode||0,o=(r&lf.IncludeAnonymous)>0;for(let l=this.cursor(r|lf.IncludeAnonymous);;){let e=!1;if(l.from<=n&&l.to>=s&&(!o&&l.type.isAnonymous||!1!==t(l))){if(l.firstChild())continue;e=!0}for(;e&&i&&(o||!l.type.isAnonymous)&&i(l),!l.nextSibling();){if(!l.parent())return;e=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Af(sf.none,this.children,this.positions,0,this.children.length,0,this.length,(e,t,i)=>new hf(this.type,e,t,i,this.propValues),e.makeTree||((e,t,i)=>new hf(sf.none,e,t,i)))}static build(e){return function(e){var t;let{buffer:i,nodeSet:s,maxBufferLength:n=Yd,reused:r=[],minRepeatType:o=s.types.length}=e,l=Array.isArray(i)?new cf(i,i.length):i,a=s.types,h=0,c=0;function u(e,t,i,y,b,w){let{id:x,start:k,end:S,size:C}=l,M=c,A=h;for(;C<0;){if(l.next(),-1==C){let t=r[x];return i.push(t),void y.push(k-e)}if(-3==C)return void(h=x);if(-4==C)return void(c=x);throw new RangeError(`Unrecognized record size: ${C}`)}let O,T,D=a[x],E=k-e;if(S-k<=n&&(T=m(l.pos-t,b))){let t=new Uint16Array(T.size-T.skip),i=l.pos-T.size,n=t.length;for(;l.pos>i;)n=v(T.start,t,n);O=new uf(t,S-T.start,s),E=T.start-e}else{let e=l.pos-C;l.next();let t=[],i=[],s=x>=o?x:-1,r=0,a=S;for(;l.pos>e;)s>=0&&l.id==s&&l.size>=0?(l.end<=a-n&&(p(t,i,k,r,l.end,a,s,M,A),r=t.length,a=l.end),l.next()):w>2500?d(k,e,t,i):u(k,e,t,i,s,w+1);if(s>=0&&r>0&&r<t.length&&p(t,i,k,r,k,a,s,M,A),t.reverse(),i.reverse(),s>-1&&r>0){let e=f(D,A);O=Af(D,t,i,0,t.length,0,S-k,e,e)}else O=g(D,t,i,S-k,M-S,A)}i.push(O),y.push(E)}function d(e,t,i,r){let o=[],a=0,h=-1;for(;l.pos>t;){let{id:e,start:t,end:i,size:s}=l;if(s>4)l.next();else{if(h>-1&&t<h)break;h<0&&(h=i-n),o.push(e,t,i),a++,l.next()}}if(a){let t=new Uint16Array(4*a),n=o[o.length-2];for(let e=o.length-3,i=0;e>=0;e-=3)t[i++]=o[e],t[i++]=o[e+1]-n,t[i++]=o[e+2]-n,t[i++]=i;i.push(new uf(t,o[2]-n,s)),r.push(n-e)}}function f(e,t){return(i,s,n)=>{let r,o,l=0,a=i.length-1;if(a>=0&&(r=i[a])instanceof hf){if(!a&&r.type==e&&r.length==n)return r;(o=r.prop(Zd.lookAhead))&&(l=s[a]+r.length+o)}return g(e,i,s,n,l,t)}}function p(e,t,i,n,r,o,l,a,h){let c=[],u=[];for(;e.length>n;)c.push(e.pop()),u.push(t.pop()+i-r);e.push(g(s.types[l],c,u,o-r,a-o,h)),t.push(r-i)}function g(e,t,i,s,n,r,o){if(r){let e=[Zd.contextHash,r];o=o?[e].concat(o):[e]}if(n>25){let e=[Zd.lookAhead,n];o=o?[e].concat(o):[e]}return new hf(e,t,i,s,o)}function m(e,t){let i=l.fork(),s=0,r=0,a=0,h=i.end-n,c={size:0,start:0,skip:0};e:for(let n=i.pos-e;i.pos>n;){let e=i.size;if(i.id==t&&e>=0){c.size=s,c.start=r,c.skip=a,a+=4,s+=4,i.next();continue}let l=i.pos-e;if(e<0||l<n||i.start<h)break;let u=i.id>=o?4:0,d=i.start;for(i.next();i.pos>l;){if(i.size<0){if(-3!=i.size)break e;u+=4}else i.id>=o&&(u+=4);i.next()}r=d,s+=e,a+=u}return(t<0||s==e)&&(c.size=s,c.start=r,c.skip=a),c.size>4?c:void 0}function v(e,t,i){let{id:s,start:n,end:r,size:a}=l;if(l.next(),a>=0&&s<o){let o=i;if(a>4){let s=l.pos-(a-4);for(;l.pos>s;)i=v(e,t,i)}t[--i]=o,t[--i]=r-e,t[--i]=n-e,t[--i]=s}else-3==a?h=s:-4==a&&(c=s);return i}let y=[],b=[];for(;l.pos>0;)u(e.start||0,e.bufferStart||0,y,b,-1,0);let w=null!==(t=e.length)&&void 0!==t?t:y.length?b[0]+y[0].length:0;return new hf(a[e.topID],y.reverse(),b.reverse(),w)}(e)}}hf.empty=new hf(sf.none,[],[],0);class cf{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new cf(this.buffer,this.index)}}class uf{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return sf.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],s=this.set.types[t],n=s.name;if(/\W/.test(n)&&!s.isError&&(n=JSON.stringify(n)),i==(e+=4))return n;let r=[];for(;e<i;)r.push(this.childString(e)),e=this.buffer[e+3];return n+"("+r.join(",")+")"}findChild(e,t,i,s,n){let{buffer:r}=this,o=-1;for(let l=e;l!=t&&!(df(n,s,r[l+1],r[l+2])&&(o=l,i>0));l=r[l+3]);return o}slice(e,t,i){let s=this.buffer,n=new Uint16Array(t-e),r=0;for(let o=e,l=0;o<t;){n[l++]=s[o++],n[l++]=s[o++]-i;let t=n[l++]=s[o++]-i;n[l++]=s[o++]-e,r=Math.max(r,t)}return new uf(n,r,this.set)}}function df(e,t,i,s){switch(e){case-2:return i<t;case-1:return s>=t&&i<t;case 0:return i<t&&s>t;case 1:return i<=t&&s>t;case 2:return s>t;case 4:return!0}}function ff(e,t,i,s){for(var n;e.from==e.to||(i<1?e.from>=t:e.from>t)||(i>-1?e.to<=t:e.to<t);){let t=!s&&e instanceof gf&&e.index<0?null:e.parent;if(!t)return e;e=t}let r=s?0:lf.IgnoreOverlays;if(s)for(let o=e,l=o.parent;l;o=l,l=o.parent)o instanceof gf&&o.index<0&&(null===(n=l.enter(t,i,r))||void 0===n?void 0:n.from)!=o.from&&(e=l);for(;;){let s=e.enter(t,i,r);if(!s)return e;e=s}}class pf{cursor(e=0){return new kf(this,e)}getChild(e,t=null,i=null){let s=mf(this,e,t,i);return s.length?s[0]:null}getChildren(e,t=null,i=null){return mf(this,e,t,i)}resolve(e,t=0){return ff(this,e,t,!1)}resolveInner(e,t=0){return ff(this,e,t,!0)}matchContext(e){return vf(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(i=t,t=e.prevSibling):t=e}return i}get node(){return this}get next(){return this.parent}}class gf extends pf{constructor(e,t,i,s){super(),this._tree=e,this.from=t,this.index=i,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,s,n=0){for(let r=this;;){for(let{children:o,positions:l}=r._tree,a=t>0?o.length:-1;e!=a;e+=t){let a=o[e],h=l[e]+r.from;if(df(s,i,h,h+a.length))if(a instanceof uf){if(n&lf.ExcludeBuffers)continue;let o=a.findChild(0,a.buffer.length,t,i-h,s);if(o>-1)return new bf(new yf(r,a,e,h),null,o)}else if(n&lf.IncludeAnonymous||!a.type.isAnonymous||Sf(a)){let o;if(!(n&lf.IgnoreMounts)&&(o=ef.get(a))&&!o.overlay)return new gf(o.tree,h,e,r);let l=new gf(a,h,e,r);return n&lf.IncludeAnonymous||!l.type.isAnonymous?l:l.nextChild(t<0?a.children.length-1:0,t,i,s)}}if(n&lf.IncludeAnonymous||!r.type.isAnonymous)return null;if(e=r.index>=0?r.index+t:t<0?-1:r._parent._tree.children.length,r=r._parent,!r)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let s;if(!(i&lf.IgnoreOverlays)&&(s=ef.get(this._tree))&&s.overlay){let i=e-this.from;for(let{from:e,to:n}of s.overlay)if((t>0?e<=i:e<i)&&(t<0?n>=i:n>i))return new gf(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function mf(e,t,i,s){let n=e.cursor(),r=[];if(!n.firstChild())return r;if(null!=i)for(let o=!1;!o;)if(o=n.type.is(i),!n.nextSibling())return r;for(;;){if(null!=s&&n.type.is(s))return r;if(n.type.is(t)&&r.push(n.node),!n.nextSibling())return null==s?r:[]}}function vf(e,t,i=t.length-1){for(let s=e;i>=0;s=s.parent){if(!s)return!1;if(!s.type.isAnonymous){if(t[i]&&t[i]!=s.name)return!1;i--}}return!0}class yf{constructor(e,t,i,s){this.parent=e,this.buffer=t,this.index=i,this.start=s}}class bf extends pf{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.context.start,i);return n<0?null:new bf(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&lf.ExcludeBuffers)return null;let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return n<0?null:new bf(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new bf(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new bf(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,s=this.index+4,n=i.buffer[this.index+3];if(n>s){let r=i.buffer[this.index+1];e.push(i.slice(s,n,r)),t.push(0)}return new hf(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function wf(e){if(!e.length)return null;let t=0,i=e[0];for(let r=1;r<e.length;r++){let s=e[r];(s.from>i.from||s.to<i.to)&&(i=s,t=r)}let s=i instanceof gf&&i.index<0?null:i.parent,n=e.slice();return s?n[t]=s:n.splice(t,1),new xf(n,i)}class xf{constructor(e,t){this.heads=e,this.node=t}get next(){return wf(this.heads)}}class kf{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof gf)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:i,buffer:s}=this.buffer;return this.type=t||s.set.types[s.buffer[e]],this.from=i+s.buffer[e+1],this.to=i+s.buffer[e+2],!0}yield(e){return!!e&&(e instanceof gf?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:s}=this.buffer,n=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.buffer.start,i);return!(n<0)&&(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?!(i&lf.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&lf.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&lf.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let e=i<0?0:this.stack[i]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(e)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:s}=this;if(s){if(e>0){if(this.index<s.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(s.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:i}=s)}else({index:t,_parent:i}=this._tree);for(;i;({index:t,_parent:i}=i))if(t>-1)for(let s=t+e,n=e<0?-1:i._tree.children.length;s!=n;s+=e){let e=i._tree.children[s];if(this.mode&lf.IncludeAnonymous||e instanceof uf||!e.type.isAnonymous||Sf(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let s=this.index,n=this.stack.length;n>=0;){for(let r=e;r;r=r._parent)if(r.index==s){if(s==this.index)return r;t=r,i=n+1;break e}s=this.stack[--n]}for(let s=i;s<this.stack.length;s++)t=new bf(this.buffer,t,this.stack[s]);return this.bufferNode=new bf(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let s=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(s=!0)}for(;;){if(s&&t&&t(this),s=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,s=!0}}}matchContext(e){if(!this.buffer)return vf(this.node.parent,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let s=e.length-1,n=this.stack.length-1;s>=0;n--){if(n<0)return vf(this._tree,e,s);let r=i[t.buffer[this.stack[n]]];if(!r.isAnonymous){if(e[s]&&e[s]!=r.name)return!1;s--}}return!0}}function Sf(e){return e.children.some(e=>e instanceof uf||!e.type.isAnonymous||Sf(e))}const Cf=new WeakMap;function Mf(e,t){if(!e.isAnonymous||t instanceof uf||t.type!=e)return 1;let i=Cf.get(t);if(null==i){i=1;for(let s of t.children){if(s.type!=e||!(s instanceof hf)){i=1;break}i+=Mf(e,s)}Cf.set(t,i)}return i}function Af(e,t,i,s,n,r,o,l,a){let h=0;for(let f=s;f<n;f++)h+=Mf(e,t[f]);let c=Math.ceil(1.5*h/8),u=[],d=[];return function t(i,s,n,o,l){for(let h=n;h<o;){let n=h,f=s[h],p=Mf(e,i[h]);for(h++;h<o;h++){let t=Mf(e,i[h]);if(p+t>=c)break;p+=t}if(h==n+1){if(p>c){let e=i[n];t(e.children,e.positions,0,e.children.length,s[n]+l);continue}u.push(i[n])}else{let t=s[h-1]+i[h-1].length-f;u.push(Af(e,i,s,n,h,f,t,null,a))}d.push(f+l-r)}}(t,i,s,n,0),(l||a)(u,d,o)}class Of{constructor(e,t,i,s,n=!1,r=!1){this.from=e,this.to=t,this.tree=i,this.offset=s,this.open=(n?1:0)|(r?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(e,t=[],i=!1){let s=[new Of(0,e.length,e,0,!1,i)];for(let n of t)n.to>e.length&&s.push(n);return s}static applyChanges(e,t,i=128){if(!t.length)return e;let s=[],n=1,r=e.length?e[0]:null;for(let o=0,l=0,a=0;;o++){let h=o<t.length?t[o]:null,c=h?h.fromA:1e9;if(c-l>=i)for(;r&&r.from<c;){let t=r;if(l>=t.from||c<=t.to||a){let e=Math.max(t.from,l)-a,i=Math.min(t.to,c)-a;t=e>=i?null:new Of(e,i,t.tree,t.offset+a,o>0,!!h)}if(t&&s.push(t),r.to>c)break;r=n<e.length?e[n++]:null}if(!h)break;l=h.toA,a=h.toA-h.toB}return s}}class Tf{startParse(e,t,i){return"string"==typeof e&&(e=new Df(e)),i=i?i.length?i.map(e=>new Qd(e.from,e.to)):[new Qd(0,0)]:[new Qd(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let s=this.startParse(e,t,i);for(;;){let e=s.advance();if(e)return e}}}class Df{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new Zd({perNode:!0});let Ef=0;class Rf{constructor(e,t,i,s){this.name=e,this.set=t,this.base=i,this.modified=s,this.id=Ef++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let i="string"==typeof e?e:"?";if(e instanceof Rf&&(t=e),null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let s=new Rf(i,[],null,[]);if(s.set.push(s),t)for(let n of t.set)s.set.push(n);return s}static defineModifier(e){let t=new Bf(e);return e=>e.modified.indexOf(t)>-1?e:Bf.get(e.base||e,e.modified.concat(t).sort((e,t)=>e.id-t.id))}}let Lf=0;class Bf{constructor(e){this.name=e,this.instances=[],this.id=Lf++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(i=>{return i.base==e&&(s=t,n=i.modified,s.length==n.length&&s.every((e,t)=>e==n[t]));var s,n});if(i)return i;let s=[],n=new Rf(e.name,s,e,t);for(let o of t)o.instances.push(n);let r=function(e){let t=[[]];for(let i=0;i<e.length;i++)for(let s=0,n=t.length;s<n;s++)t.push(t[s].concat(e[i]));return t.sort((e,t)=>t.length-e.length)}(t);for(let o of e.set)if(!o.modified.length)for(let e of r)s.push(Bf.get(o,e));return n}}function Pf(e){let t=Object.create(null);for(let i in e){let s=e[i];Array.isArray(s)||(s=[s]);for(let e of i.split(" "))if(e){let i=[],n=2,r=e;for(let t=0;;){if("..."==r&&t>0&&t+3==e.length){n=1;break}let s=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(r);if(!s)throw new RangeError("Invalid path: "+e);if(i.push("*"==s[0]?"":'"'==s[0][0]?JSON.parse(s[0]):s[0]),t+=s[0].length,t==e.length)break;let o=e[t++];if(t==e.length&&"!"==o){n=0;break}if("/"!=o)throw new RangeError("Invalid path: "+e);r=e.slice(t)}let o=i.length-1,l=i[o];if(!l)throw new RangeError("Invalid path: "+e);let a=new Vf(s,n,o>0?i.slice(0,o):null);t[l]=a.sort(t[l])}}return Nf.add(t)}const Nf=new Zd;class Vf{constructor(e,t,i,s){this.tags=e,this.mode=t,this.context=i,this.next=s}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}function If(e,t){let i=Object.create(null);for(let r of e)if(Array.isArray(r.tag))for(let e of r.tag)i[e.id]=r.class;else i[r.tag.id]=r.class;let{scope:s,all:n=null}=t||{};return{style:e=>{let t=n;for(let s of e)for(let e of s.set){let s=i[e.id];if(s){t=t?t+" "+s:s;break}}return t},scope:s}}function Hf(e,t,i,s=0,n=e.length){let r=new Ff(s,Array.isArray(t)?t:[t],i);r.highlightRange(e.cursor(),s,n,"",r.highlighters),r.flush(n)}Vf.empty=new Vf([],2,null);class Ff{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,s,n){let{type:r,from:o,to:l}=e;if(o>=i||l<=t)return;r.isTop&&(n=this.highlighters.filter(e=>!e.scope||e.scope(r)));let a=s,h=function(e){let t=e.type.prop(Nf);for(;t&&t.context&&!e.matchContext(t.context);)t=t.next;return t||null}(e)||Vf.empty,c=function(e,t){let i=null;for(let s of e){let e=s.style(t);e&&(i=i?i+" "+e:e)}return i}(n,h.tags);if(c&&(a&&(a+=" "),a+=c,1==h.mode&&(s+=(s?" ":"")+c)),this.startSpan(Math.max(t,o),a),h.opaque)return;let u=e.tree&&e.tree.prop(Zd.mounted);if(u&&u.overlay){let r=e.node.enter(u.overlay[0].from+o,1),h=this.highlighters.filter(e=>!e.scope||e.scope(u.tree.type)),c=e.firstChild();for(let d=0,f=o;;d++){let p=d<u.overlay.length?u.overlay[d]:null,g=p?p.from+o:l,m=Math.max(t,f),v=Math.min(i,g);if(m<v&&c)for(;e.from<v&&(this.highlightRange(e,m,v,s,n),this.startSpan(Math.min(v,e.to),a),!(e.to>=g)&&e.nextSibling()););if(!p||g>i)break;f=p.to+o,f>t&&(this.highlightRange(r.cursor(),Math.max(t,p.from+o),Math.min(i,f),"",h),this.startSpan(Math.min(i,f),a))}c&&e.parent()}else if(e.firstChild()){u&&(s="");do{if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,s,n),this.startSpan(Math.min(i,e.to),a)}}while(e.nextSibling());e.parent()}}}const zf=Rf.define,Wf=zf(),$f=zf(),jf=zf($f),qf=zf($f),_f=zf(),Kf=zf(_f),Uf=zf(_f),Gf=zf(),Jf=zf(Gf),Yf=zf(),Xf=zf(),Qf=zf(),Zf=zf(Qf),ep=zf(),tp={comment:Wf,lineComment:zf(Wf),blockComment:zf(Wf),docComment:zf(Wf),name:$f,variableName:zf($f),typeName:jf,tagName:zf(jf),propertyName:qf,attributeName:zf(qf),className:zf($f),labelName:zf($f),namespace:zf($f),macroName:zf($f),literal:_f,string:Kf,docString:zf(Kf),character:zf(Kf),attributeValue:zf(Kf),number:Uf,integer:zf(Uf),float:zf(Uf),bool:zf(_f),regexp:zf(_f),escape:zf(_f),color:zf(_f),url:zf(_f),keyword:Yf,self:zf(Yf),null:zf(Yf),atom:zf(Yf),unit:zf(Yf),modifier:zf(Yf),operatorKeyword:zf(Yf),controlKeyword:zf(Yf),definitionKeyword:zf(Yf),moduleKeyword:zf(Yf),operator:Xf,derefOperator:zf(Xf),arithmeticOperator:zf(Xf),logicOperator:zf(Xf),bitwiseOperator:zf(Xf),compareOperator:zf(Xf),updateOperator:zf(Xf),definitionOperator:zf(Xf),typeOperator:zf(Xf),controlOperator:zf(Xf),punctuation:Qf,separator:zf(Qf),bracket:Zf,angleBracket:zf(Zf),squareBracket:zf(Zf),paren:zf(Zf),brace:zf(Zf),content:Gf,heading:Jf,heading1:zf(Jf),heading2:zf(Jf),heading3:zf(Jf),heading4:zf(Jf),heading5:zf(Jf),heading6:zf(Jf),contentSeparator:zf(Gf),list:zf(Gf),quote:zf(Gf),emphasis:zf(Gf),strong:zf(Gf),link:zf(Gf),monospace:zf(Gf),strikethrough:zf(Gf),inserted:zf(),deleted:zf(),changed:zf(),invalid:zf(),meta:ep,documentMeta:zf(ep),annotation:zf(ep),processingInstruction:zf(ep),definition:Rf.defineModifier("definition"),constant:Rf.defineModifier("constant"),function:Rf.defineModifier("function"),standard:Rf.defineModifier("standard"),local:Rf.defineModifier("local"),special:Rf.defineModifier("special")};for(let nM in tp){let e=tp[nM];e instanceof Rf&&(e.name=nM)}var ip;If([{tag:tp.link,class:"tok-link"},{tag:tp.heading,class:"tok-heading"},{tag:tp.emphasis,class:"tok-emphasis"},{tag:tp.strong,class:"tok-strong"},{tag:tp.keyword,class:"tok-keyword"},{tag:tp.atom,class:"tok-atom"},{tag:tp.bool,class:"tok-bool"},{tag:tp.url,class:"tok-url"},{tag:tp.labelName,class:"tok-labelName"},{tag:tp.inserted,class:"tok-inserted"},{tag:tp.deleted,class:"tok-deleted"},{tag:tp.literal,class:"tok-literal"},{tag:tp.string,class:"tok-string"},{tag:tp.number,class:"tok-number"},{tag:[tp.regexp,tp.escape,tp.special(tp.string)],class:"tok-string2"},{tag:tp.variableName,class:"tok-variableName"},{tag:tp.local(tp.variableName),class:"tok-variableName tok-local"},{tag:tp.definition(tp.variableName),class:"tok-variableName tok-definition"},{tag:tp.special(tp.variableName),class:"tok-variableName2"},{tag:tp.definition(tp.propertyName),class:"tok-propertyName tok-definition"},{tag:tp.typeName,class:"tok-typeName"},{tag:tp.namespace,class:"tok-namespace"},{tag:tp.className,class:"tok-className"},{tag:tp.macroName,class:"tok-macroName"},{tag:tp.propertyName,class:"tok-propertyName"},{tag:tp.operator,class:"tok-operator"},{tag:tp.comment,class:"tok-comment"},{tag:tp.meta,class:"tok-meta"},{tag:tp.invalid,class:"tok-invalid"},{tag:tp.punctuation,class:"tok-punctuation"}]);const sp=new Zd;const np=new Zd;class rp{constructor(e,t,i=[],s=""){this.data=e,this.name=s,pl.prototype.hasOwnProperty("tree")||Object.defineProperty(pl.prototype,"tree",{get(){return lp(this)}}),this.parser=t,this.extension=[mp.of(this),pl.languageData.of((e,t,i)=>{let s=op(e,t,i),n=s.type.prop(sp);if(!n)return[];let r=e.facet(n),o=s.type.prop(np);if(o){let n=s.resolve(t-s.from,i);for(let t of o)if(t.test(n,e)){let i=e.facet(t.facet);return"replace"==t.type?i:i.concat(r)}}return r})].concat(i)}isActiveAt(e,t,i=-1){return op(e,t,i).type.prop(sp)==this.data}findRegions(e){let t=e.facet(mp);if((null==t?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],s=(e,t)=>{if(e.prop(sp)==this.data)return void i.push({from:t,to:t+e.length});let n=e.prop(Zd.mounted);if(n){if(n.tree.prop(sp)==this.data){if(n.overlay)for(let e of n.overlay)i.push({from:e.from+t,to:e.to+t});else i.push({from:t,to:t+e.length});return}if(n.overlay){let e=i.length;if(s(n.tree,n.overlay[0].from+t),i.length>e)return}}for(let i=0;i<e.children.length;i++){let n=e.children[i];n instanceof hf&&s(n,e.positions[i]+t)}};return s(lp(e),0),i}get allowsNesting(){return!0}}function op(e,t,i){let s=e.facet(mp),n=lp(e).topNode;if(!s||s.allowsNesting)for(let r=n;r;r=r.enter(t,i,lf.ExcludeBuffers))r.type.isTop&&(n=r);return n}function lp(e){let t=e.field(rp.state,!1);return t?t.tree:hf.empty}rp.setState=il.define();class ap{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let hp=null;class cp{constructor(e,t,i=[],s,n,r,o,l){this.parser=e,this.state=t,this.fragments=i,this.tree=s,this.treeLen=n,this.viewport=r,this.skipped=o,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new cp(e,t,[],hf.empty,0,i,[],null)}startParse(){return this.parser.startParse(new ap(this.state.doc),this.fragments)}work(e,t){return null!=t&&t>=this.state.doc.length&&(t=void 0),this.tree!=hf.empty&&this.isDone(null!=t?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=t&&(null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let s=this.parse.advance();if(s){if(this.fragments=this.withoutTempSkipped(Of.addTree(s,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=s,this.parse=null,!(this.treeLen<(null!=t?t:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Of.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=hp;hp=this;try{return e()}finally{hp=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=up(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:s,treeLen:n,viewport:r,skipped:o}=this;if(this.takeTree(),!e.empty){let t=[];if(e.iterChangedRanges((e,i,s,n)=>t.push({fromA:e,toA:i,fromB:s,toB:n})),i=Of.applyChanges(i,t),s=hf.empty,n=0,r={from:e.mapPos(r.from,-1),to:e.mapPos(r.to,1)},this.skipped.length){o=[];for(let t of this.skipped){let i=e.mapPos(t.from,1),s=e.mapPos(t.to,-1);i<s&&o.push({from:i,to:s})}}}return new cp(this.parser,t,i,s,n,r,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:t,to:s}=this.skipped[i];t<e.to&&s>e.from&&(this.fragments=up(this.fragments,t,s),this.skipped.splice(i--,1))}return!(this.skipped.length>=t)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Tf{createParse(t,i,s){let n=s[0].from,r=s[s.length-1].to;return{parsedPos:n,advance(){let t=hp;if(t){for(let e of s)t.tempSkipped.push(e);e&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e)}return this.parsedPos=r,new hf(sf.none,[],[],r-n)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&0==t[0].from&&t[0].to>=e}static get(){return hp}}function up(e,t,i){return Of.applyChanges(e,[{fromA:t,toA:i,fromB:t,toB:i}])}class dp{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new dp(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=cp.create(e.facet(mp).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new dp(i)}}rp.state=Bo.define({create:dp.init,update(e,t){for(let i of t.effects)if(i.is(rp.setState))return i.value;return t.startState.facet(mp)!=t.state.facet(mp)?dp.init(t.state):e.apply(t)}});let fp=e=>{let t=setTimeout(()=>e(),500);return()=>clearTimeout(t)};"undefined"!=typeof requestIdleCallback&&(fp=e=>{let t=-1,i=setTimeout(()=>{t=requestIdleCallback(e,{timeout:400})},100);return()=>t<0?clearTimeout(i):cancelIdleCallback(t)});const pp="undefined"!=typeof navigator&&(null===(ip=navigator.scheduling)||void 0===ip?void 0:ip.isInputPending)?()=>navigator.scheduling.isInputPending():null,gp=_h.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(rp.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(rp.state);t.tree==t.context.tree&&t.context.isDone(e.doc.length)||(this.working=fp(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:s}}=this.view,n=i.field(rp.state);if(n.tree==n.context.tree&&n.context.isDone(s+1e5))return;let r=Date.now()+Math.min(this.chunkBudget,100,e&&!pp?Math.max(25,e.timeRemaining()-5):1e9),o=n.context.treeLen<s&&i.doc.length>s+1e3,l=n.context.work(()=>pp&&pp()||Date.now()>r,s+(o?0:1e5));this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(n.context.takeTree(),this.view.dispatch({effects:rp.setState.of(new dp(n.context))})),this.chunkBudget>0&&(!l||o)&&this.scheduleWork(),this.checkAsyncSchedule(n.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(e=>Wh(this.view.state,e)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),mp=Ao.define({combine:e=>e.length?e[0]:null,enables:e=>[rp.state,gp,qu.contentAttributes.compute([e],t=>{let i=t.facet(e);return i&&i.name?{"data-language":i.name}:{}})]}),vp=Ao.define({combine:e=>{if(!e.length)return"  ";let t=e[0];if(!t||/\S/.test(t)||Array.from(t).some(e=>e!=t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return t}});function yp(e){let t=e.facet(vp);return 9==t.charCodeAt(0)?e.tabSize*t.length:t.length}const bp=new Zd;class wp{constructor(e,t){let i;function s(e){let t=Nl.newName();return(i||(i=Object.create(null)))["."+t]=e,t}this.specs=e;const n="string"==typeof t.all?t.all:t.all?s(t.all):void 0,r=t.scope;this.scope=r instanceof rp?e=>e.prop(sp)==r.data:r?e=>e==r:void 0,this.style=If(e.map(e=>({tag:e.tag,class:e.class||s(Object.assign({},e,{tag:null}))})),{all:n}).style,this.module=i?new Nl(i):null,this.themeType=t.themeType}static define(e,t){return new wp(e,t||{})}}const xp=Ao.define(),kp=Ao.define({combine:e=>e.length?[e[0]]:null});function Sp(e){let t=e.facet(xp);return t.length?t:e.facet(kp)}function Cp(e,t){let i,s=[Ap];return e instanceof wp&&(e.module&&s.push(qu.styleModule.of(e.module)),i=e.themeType),i?s.push(xp.computeN([qu.darkTheme],t=>t.facet(qu.darkTheme)==("dark"==i)?[e]:[])):s.push(xp.of(e)),s}class Mp{constructor(e){this.markCache=Object.create(null),this.tree=lp(e.state),this.decorations=this.buildDeco(e,Sp(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=lp(e.state),i=Sp(e.state),s=i!=Sp(e.startState),{viewport:n}=e.view,r=e.changes.mapPos(this.decoratedTo,1);t.length<n.to&&!s&&t.type==this.tree.type&&r>=n.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=r):(t!=this.tree||e.viewportChanged||s)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i),this.decoratedTo=n.to)}buildDeco(e,t){if(!t||!this.tree.length)return Ja.none;let i=new xl;for(let{from:s,to:n}of e.visibleRanges)Hf(this.tree,t,(e,t,s)=>{i.add(e,t,this.markCache[s]||(this.markCache[s]=Ja.mark({class:s})))},s,n);return i.finish()}}const Ap=Fo.high(_h.fromClass(Mp,{decorations:e=>e.decorations})),Op=wp.define([{tag:tp.meta,color:"#404740"},{tag:tp.link,textDecoration:"underline"},{tag:tp.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tp.emphasis,fontStyle:"italic"},{tag:tp.strong,fontWeight:"bold"},{tag:tp.strikethrough,textDecoration:"line-through"},{tag:tp.keyword,color:"#708"},{tag:[tp.atom,tp.bool,tp.url,tp.contentSeparator,tp.labelName],color:"#219"},{tag:[tp.literal,tp.inserted],color:"#164"},{tag:[tp.string,tp.deleted],color:"#a11"},{tag:[tp.regexp,tp.escape,tp.special(tp.string)],color:"#e40"},{tag:tp.definition(tp.variableName),color:"#00f"},{tag:tp.local(tp.variableName),color:"#30a"},{tag:[tp.typeName,tp.namespace],color:"#085"},{tag:tp.className,color:"#167"},{tag:[tp.special(tp.variableName),tp.macroName],color:"#256"},{tag:tp.definition(tp.propertyName),color:"#00c"},{tag:tp.comment,color:"#940"},{tag:tp.invalid,color:"#f00"}]);function Tp(e,t,i,s=0,n=0){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);let r=n;for(let o=s;o<t;o++)9==e.charCodeAt(o)?r+=i-r%i:r++;return r}class Dp{constructor(e,t,i,s){this.string=e,this.tabSize=t,this.indentUnit=i,this.overrideIndent=s,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return 0==this.pos}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t,i=this.string.charAt(this.pos);if(t="string"==typeof e?i==e:i&&(e instanceof RegExp?e.test(i):e(i)),t)return++this.pos,i}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Tp(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var e;return null!==(e=this.overrideIndent)&&void 0!==e?e:Tp(this.string,null,this.tabSize)}match(e,t,i){if("string"==typeof e){let s=e=>i?e.toLowerCase():e;return s(this.string.substr(this.pos,e.length))==s(e)?(!1!==t&&(this.pos+=e.length),!0):null}{let i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&!1!==t&&(this.pos+=i[0].length),i)}}current(){return this.string.slice(this.start,this.pos)}}function Ep(e){if("object"!=typeof e)return e;let t={};for(let i in e){let s=e[i];t[i]=s instanceof Array?s.slice():s}return t}const Rp=new WeakMap;class Lp extends rp{constructor(e){let t=(i=e.languageData,Ao.define({combine:i?e=>e.concat(i):void 0}));var i;let s,n={name:(r=e).name||"",token:r.token,blankLine:r.blankLine||(()=>{}),startState:r.startState||(()=>!0),copyState:r.copyState||Ep,indent:r.indent||(()=>null),languageData:r.languageData||{},tokenTable:r.tokenTable||Ip,mergeTokens:!1!==r.mergeTokens};var r;super(t,new class extends Tf{createParse(e,t,i){return new Np(s,e,t,i)}},[],e.name),this.topNode=function(e,t){let i=sf.define({id:Hp.length,name:"Document",props:[sp.add(()=>e),bp.add(()=>e=>t.getIndent(e))],top:!0});return Hp.push(i),i}(t,this),s=this,this.streamParser=n,this.stateAfter=new Zd({perNode:!0}),this.tokenTable=e.tokenTable?new jp(n.tokenTable):qp}static define(e){return new Lp(e)}getIndent(e){let t,{overrideIndentation:i}=e.options;i&&(t=Rp.get(e.state),null!=t&&t<e.pos-1e4&&(t=void 0));let s,n,r=Bp(this,e.node.tree,e.node.from,e.node.from,null!=t?t:e.pos);if(r?(n=r.state,s=r.pos+1):(n=this.streamParser.startState(e.unit),s=e.node.from),e.pos-s>1e4)return null;for(;s<e.pos;){let t=e.state.doc.lineAt(s),r=Math.min(e.pos,t.to);if(t.length){let s=i?i(t.from):-1,o=new Dp(t.text,e.state.tabSize,e.unit,s<0?void 0:s);for(;o.pos<r-t.from;)Vp(this.streamParser.token,o,n)}else this.streamParser.blankLine(n,e.unit);if(r==e.pos)break;s=t.to+1}let o=e.lineAt(e.pos);return i&&null==t&&Rp.set(e.state,o.from),this.streamParser.indent(n,/^\s*(.*)/.exec(o.text)[1],e)}get allowsNesting(){return!1}}function Bp(e,t,i,s,n){let r=i>=s&&i+t.length<=n&&t.prop(e.stateAfter);if(r)return{state:e.streamParser.copyState(r),pos:i+t.length};for(let o=t.children.length-1;o>=0;o--){let r=t.children[o],l=i+t.positions[o],a=r instanceof hf&&l<n&&Bp(e,r,l,s,n);if(a)return a}return null}function Pp(e,t,i,s,n){if(n&&i<=0&&s>=t.length)return t;n||0!=i||t.type!=e.topNode||(n=!0);for(let r=t.children.length-1;r>=0;r--){let o,l=t.positions[r],a=t.children[r];if(l<s&&a instanceof hf){if(!(o=Pp(e,a,i-l,s-l,n)))break;return n?new hf(t.type,t.children.slice(0,r).concat(o),t.positions.slice(0,r+1),l+o.length):o}}return null}class Np{constructor(e,t,i,s){this.lang=e,this.input=t,this.fragments=i,this.ranges=s,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=s[s.length-1].to;let n=cp.get(),r=s[0].from,{state:o,tree:l}=function(e,t,i,s,n){for(let r of t){let t,n=r.from+(r.openStart?25:0),o=r.to-(r.openEnd?25:0),l=n<=i&&o>i&&Bp(e,r.tree,0-r.offset,i,o);if(l&&l.pos<=s&&(t=Pp(e,r.tree,i+r.offset,l.pos+r.offset,!1)))return{state:l.state,tree:t}}return{state:e.streamParser.startState(n?yp(n):4),tree:hf.empty}}(e,i,r,this.to,null==n?void 0:n.state);this.state=o,this.parsedPos=this.chunkStart=r+l.length;for(let a=0;a<l.children.length;a++)this.chunks.push(l.children[a]),this.chunkPos.push(l.positions[a]);n&&this.parsedPos<n.viewport.from-1e5&&s.some(e=>e.from<=n.viewport.from&&e.to>=n.viewport.from)&&(this.state=this.lang.streamParser.startState(yp(n.state)),n.skipUntilInView(this.parsedPos,n.viewport.from),this.parsedPos=n.viewport.from),this.moveRangeIndex()}advance(){let e=cp.get(),t=null==this.stoppedAt?this.to:Math.min(this.to,this.stoppedAt),i=Math.min(t,this.chunkStart+512);for(e&&(i=Math.min(i,e.viewport.to));this.parsedPos<i;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=t?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,t),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let t=this.input.chunk(e);if(this.input.lineChunks)"\n"==t&&(t="");else{let e=t.indexOf("\n");e>-1&&(t=t.slice(0,e))}return e+t.length<=this.to?t:t.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,t=this.lineAfter(e),i=e+t.length;for(let s=this.rangeIndex;;){let e=this.ranges[s].to;if(e>=i)break;if(t=t.slice(0,e-(i-t.length)),s++,s==this.ranges.length)break;let n=this.ranges[s].from,r=this.lineAfter(n);t+=r,i=n+r.length}return{line:t,end:i}}skipGapsTo(e,t,i){for(;;){let s=this.ranges[this.rangeIndex].to,n=e+t;if(i>0?s>n:s>=n)break;t+=this.ranges[++this.rangeIndex].from-s}return t}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,t,i,s){let n=4;if(this.ranges.length>1){t+=s=this.skipGapsTo(t,s,1);let e=this.chunk.length;i+=s=this.skipGapsTo(i,s,-1),n+=this.chunk.length-e}let r=this.chunk.length-4;return this.lang.streamParser.mergeTokens&&4==n&&r>=0&&this.chunk[r]==e&&this.chunk[r+2]==t?this.chunk[r+2]=i:this.chunk.push(e,t,i,n),s}parseLine(e){let{line:t,end:i}=this.nextLine(),s=0,{streamParser:n}=this.lang,r=new Dp(t,e?e.state.tabSize:4,e?yp(e.state):2);if(r.eol())n.blankLine(this.state,r.indentUnit);else for(;!r.eol();){let e=Vp(n.token,r,this.state);if(e&&(s=this.emitToken(this.lang.tokenTable.resolve(e),this.parsedPos+r.start,this.parsedPos+r.pos,s)),r.start>1e4)break}this.parsedPos=i,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=hf.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:Fp,topID:0,maxBufferLength:512,reused:this.chunkReused});e=new hf(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new hf(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function Vp(e,t,i){t.start=t.pos;for(let s=0;s<10;s++){let s=e(t,i);if(t.pos>t.start)return s}throw new Error("Stream parser failed to advance stream.")}const Ip=Object.create(null),Hp=[sf.none],Fp=new nf(Hp),zp=[],Wp=Object.create(null),$p=Object.create(null);for(let[nM,rM]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])$p[nM]=Kp(Ip,rM);class jp{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),$p)}resolve(e){return e?this.table[e]||(this.table[e]=Kp(this.extra,e)):0}}const qp=new jp(Ip);function _p(e,t){zp.indexOf(e)>-1||(zp.push(e),console.warn(t))}function Kp(e,t){let i=[];for(let l of t.split(" ")){let t=[];for(let i of l.split(".")){let s=e[i]||tp[i];s?"function"==typeof s?t.length?t=t.map(s):_p(i,`Modifier ${i} used at start of tag`):t.length?_p(i,`Tag ${i} used as modifier`):t=Array.isArray(s)?s:[s]:_p(i,`Unknown highlighting tag ${i}`)}for(let e of t)i.push(e)}if(!i.length)return 0;let s=t.replace(/ /g,"_"),n=s+" "+i.map(e=>e.id),r=Wp[n];if(r)return r.id;let o=Wp[n]=sf.define({id:Hp.length,name:s,props:[Pf({[s]:i})]});return Hp.push(o),o.id}lh.RTL,lh.LTR;class Up{constructor(e,t,i,s){this.state=e,this.pos=t,this.explicit=i,this.view=s,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=lp(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),s=t.text.slice(i-t.from,this.pos-t.from),n=s.search(Qp(e,!1));return n<0?null:{from:i+n,to:this.pos,text:s.slice(n)}}get aborted(){return null==this.abortListeners}addEventListener(e,t,i){"abort"==e&&this.abortListeners&&(this.abortListeners.push(t),i&&i.onDocChange&&(this.abortOnDocChange=!0))}}function Gp(e){let t=Object.keys(e).join(""),i=/\w/.test(t);return i&&(t=t.replace(/\w/g,"")),`[${i?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function Jp(e){let t=e.map(e=>"string"==typeof e?{label:e}:e),[i,s]=t.every(e=>/^\w+$/.test(e.label))?[/\w*$/,/\w+$/]:function(e){let t=Object.create(null),i=Object.create(null);for(let{label:n}of e){t[n[0]]=!0;for(let e=1;e<n.length;e++)i[n[e]]=!0}let s=Gp(t)+Gp(i)+"*$";return[new RegExp("^"+s),new RegExp(s)]}(t);return e=>{let n=e.matchBefore(s);return n||e.explicit?{from:n?n.from:e.pos,options:t,validFor:i}:null}}class Yp{constructor(e,t,i,s){this.completion=e,this.source=t,this.match=i,this.score=s}}function Xp(e){return e.selection.main.from}function Qp(e,t){var i;let{source:s}=e,n=t&&"^"!=s[0],r="$"!=s[s.length-1];return n||r?new RegExp(`${n?"^":""}(?:${s})${r?"$":""}`,null!==(i=e.flags)&&void 0!==i?i:e.ignoreCase?"i":""):e}const Zp=Zo.define();function eg(e,t,i,s){let{main:n}=e.selection,r=i-n.from,o=s-n.from;return{...e.changeByRange(l=>{if(l!=n&&i!=s&&e.sliceDoc(l.from+r,l.from+o)!=e.sliceDoc(i,s))return{range:l};let a=e.toText(t);return{changes:{from:l.from+r,to:s==n.from?l.to:l.from+o,insert:a},range:So.cursor(l.from+r+a.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const tg=new WeakMap;function ig(e){if(!Array.isArray(e))return e;let t=tg.get(e);return t||tg.set(e,t=Jp(e)),t}const sg=il.define(),ng=il.define();class rg{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let i=ao(e,t),s=co(i);this.chars.push(i);let n=e.slice(t,t+s),r=n.toUpperCase();this.folded.push(ao(r==n?n.toLowerCase():r,0)),t+=s}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(0==this.pattern.length)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:s,precise:n,byWord:r}=this;if(1==t.length){let s=ao(e,0),n=co(s),r=n==e.length?0:-100;if(s==t[0]);else{if(s!=i[0])return null;r+=-200}return this.ret(r,[0,n])}let o=e.indexOf(this.pattern);if(0==o)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let l=t.length,a=0;if(o<0){for(let n=0,r=Math.min(e.length,200);n<r&&a<l;){let r=ao(e,n);r!=t[a]&&r!=i[a]||(s[a++]=n),n+=co(r)}if(a<l)return null}let h=0,c=0,u=!1,d=0,f=-1,p=-1,g=/[a-z]/.test(e),m=!0;for(let v=0,y=Math.min(e.length,200),b=0;v<y&&c<l;){let s=ao(e,v);o<0&&(h<l&&s==t[h]&&(n[h++]=v),d<l&&(s==t[d]||s==i[d]?(0==d&&(f=v),p=v+1,d++):d=0));let a,y=s<255?s>=48&&s<=57||s>=97&&s<=122?2:s>=65&&s<=90?1:0:(a=ho(s))!=a.toLowerCase()?1:a!=a.toUpperCase()?2:0;(!v||1==y&&g||0==b&&0!=y)&&(t[c]==s||i[c]==s&&(u=!0)?r[c++]=v:r.length&&(m=!1)),b=y,v+=co(s)}return c==l&&0==r[0]&&m?this.result((u?-200:0)-100,r,e):d==l&&0==f?this.ret(-200-e.length+(p==e.length?0:-100),[0,p]):o>-1?this.ret(-700-e.length,[o,o+this.pattern.length]):d==l?this.ret(-900-e.length,[f,p]):c==l?this.result((u?-200:0)-100-700+(m?0:-1100),r,e):2==t.length?null:this.result((s[0]?-700:0)-200-1100,s,e)}result(e,t,i){let s=[],n=0;for(let r of t){let e=r+(this.astral?co(ao(i,r)):1);n&&s[n-1]==r?s[n-1]=e:(s[n++]=r,s[n++]=e)}return this.ret(e-i.length,s)}}class og{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),i=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return null==i?null:(this.matched=[0,t.length],this.score=i+(e.length==this.pattern.length?0:-100),this)}}const lg=Ao.define({combine:e=>gl(e,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:hg,filterStrict:!1,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>i=>ag(e(i),t(i)),optionClass:(e,t)=>i=>ag(e(i),t(i)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})});function ag(e,t){return e?t?e+" "+t:e:t}function hg(e,t,i,s,n,r){let o,l,a=e.textDirection==lh.RTL,h=a,c=!1,u="top",d=t.left-n.left,f=n.right-t.right,p=s.right-s.left,g=s.bottom-s.top;if(h&&d<Math.min(p,f)?h=!1:!h&&f<Math.min(p,d)&&(h=!0),p<=(h?d:f))o=Math.max(n.top,Math.min(i.top,n.bottom-g))-t.top,l=Math.min(400,h?d:f);else{c=!0,l=Math.min(400,(a?t.right:n.right-t.left)-30);let e=n.bottom-t.bottom;e>=g||e>t.top?o=i.bottom-t.top:(u="bottom",o=t.bottom-i.top)}return{style:`${u}: ${o/((t.bottom-t.top)/r.offsetHeight)}px; max-width: ${l/((t.right-t.left)/r.offsetWidth)}px`,class:"cm-completionInfo-"+(c?a?"left-narrow":"right-narrow":h?"left":"right")}}function cg(e,t,i){if(e<=i)return{from:0,to:e};if(t<0&&(t=0),t<=e>>1){let e=Math.floor(t/i);return{from:e*i,to:(e+1)*i}}let s=Math.floor((e-t)/i);return{from:e-(s+1)*i,to:e-s*i}}class ug{constructor(e,t,i){this.view=e,this.stateField=t,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:e=>this.placeInfo(e),key:this},this.space=null,this.currentClass="";let s=e.state.field(t),{options:n,selected:r}=s.open,o=e.state.facet(lg);this.optionContent=function(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(e){let t=document.createElement("div");return t.classList.add("cm-completionIcon"),e.type&&t.classList.add(...e.type.split(/\s+/g).map(e=>"cm-completionIcon-"+e)),t.setAttribute("aria-hidden","true"),t},position:20}),t.push({render(e,t,i,s){let n=document.createElement("span");n.className="cm-completionLabel";let r=e.displayLabel||e.label,o=0;for(let l=0;l<s.length;){let e=s[l++],t=s[l++];e>o&&n.appendChild(document.createTextNode(r.slice(o,e)));let i=n.appendChild(document.createElement("span"));i.appendChild(document.createTextNode(r.slice(e,t))),i.className="cm-completionMatchedText",o=t}return o<r.length&&n.appendChild(document.createTextNode(r.slice(o))),n},position:50},{render(e){if(!e.detail)return null;let t=document.createElement("span");return t.className="cm-completionDetail",t.textContent=e.detail,t},position:80}),t.sort((e,t)=>e.position-t.position).map(e=>e.render)}(o),this.optionClass=o.optionClass,this.tooltipClass=o.tooltipClass,this.range=cg(n.length,r,o.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",i=>{let{options:s}=e.state.field(t).open;for(let t,n=i.target;n&&n!=this.dom;n=n.parentNode)if("LI"==n.nodeName&&(t=/-(\d+)$/.exec(n.id))&&+t[1]<s.length)return this.applyCompletion(e,s[+t[1]]),void i.preventDefault()}),this.dom.addEventListener("focusout",t=>{let i=e.state.field(this.stateField,!1);i&&i.tooltip&&e.state.facet(lg).closeOnBlur&&t.relatedTarget!=e.contentDOM&&e.dispatch({effects:ng.of(null)})}),this.showOptions(n,s.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let i=e.state.field(this.stateField),s=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),i!=s){let{options:n,selected:r,disabled:o}=i.open;s.open&&s.open.options==n||(this.range=cg(n.length,r,e.state.facet(lg).maxRenderedOptions),this.showOptions(n,i.id)),this.updateSel(),o!=(null===(t=s.open)||void 0===t?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!o)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let e of this.currentClass.split(" "))e&&this.dom.classList.remove(e);for(let e of t.split(" "))e&&this.dom.classList.add(e);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=cg(t.options.length,t.selected,this.view.state.facet(lg).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:i}=t.options[t.selected],{info:s}=i;if(!s)return;let n="string"==typeof s?document.createTextNode(s):s(i);if(!n)return;"then"in n?n.then(t=>{t&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(t,i)}).catch(e=>Wh(this.view.state,e,"completion info")):this.addInfoPane(n,i)}}addInfoPane(e,t){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",null!=e.nodeType)i.appendChild(e),this.infoDestroy=null;else{let{dom:t,destroy:s}=e;i.appendChild(t),this.infoDestroy=s||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,s=this.range.from;i;i=i.nextSibling,s++)"LI"==i.nodeName&&i.id?s==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected"):s--;return t&&function(e,t){let i=e.getBoundingClientRect(),s=t.getBoundingClientRect(),n=i.height/e.offsetHeight;s.top<i.top?e.scrollTop-=(i.top-s.top)/n:s.bottom>i.bottom&&(e.scrollTop+=(s.bottom-i.bottom)/n)}(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),s=e.getBoundingClientRect(),n=this.space;if(!n){let e=this.dom.ownerDocument.documentElement;n={left:0,top:0,right:e.clientWidth,bottom:e.clientHeight}}return s.top>Math.min(n.bottom,t.bottom)-10||s.bottom<Math.max(n.top,t.top)+10?null:this.view.state.facet(lg).positionInfo(this.view,t,s,i,n,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,i){const s=document.createElement("ul");s.id=t,s.setAttribute("role","listbox"),s.setAttribute("aria-expanded","true"),s.setAttribute("aria-label",this.view.state.phrase("Completions")),s.addEventListener("mousedown",e=>{e.target==s&&e.preventDefault()});let n=null;for(let r=i.from;r<i.to;r++){let{completion:o,match:l}=e[r],{section:a}=o;if(a){let e="string"==typeof a?a:a.name;if(e!=n&&(r>i.from||0==i.from))if(n=e,"string"!=typeof a&&a.header)s.appendChild(a.header(a));else{s.appendChild(document.createElement("completion-section")).textContent=e}}const h=s.appendChild(document.createElement("li"));h.id=t+"-"+r,h.setAttribute("role","option");let c=this.optionClass(o);c&&(h.className=c);for(let e of this.optionContent){let t=e(o,this.view.state,this.view,l);t&&h.appendChild(t)}}return i.from&&s.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&s.classList.add("cm-completionListIncompleteBottom"),s}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function dg(e,t){return i=>new ug(i,e,t)}function fg(e){return 100*(e.boost||0)+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}class pg{constructor(e,t,i,s,n,r){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=s,this.selected=n,this.disabled=r}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new pg(this.options,yg(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,i,s,n,r){if(s&&!r&&e.some(e=>e.isPending))return s.setDisabled();let o=function(e,t){let i=[],s=null,n=e=>{i.push(e);let{section:t}=e.completion;if(t){s||(s=[]);let e="string"==typeof t?t:t.name;s.some(t=>t.name==e)||s.push("string"==typeof t?{name:e}:t)}},r=t.facet(lg);for(let h of e)if(h.hasResult()){let e=h.result.getMatch;if(!1===h.result.filter)for(let t of h.result.options)n(new Yp(t,h.source,e?e(t):[],1e9-i.length));else{let i,s=t.sliceDoc(h.from,h.to),o=r.filterStrict?new og(s):new rg(s);for(let t of h.result.options)if(i=o.match(t.label)){let s=t.displayLabel?e?e(t,i.matched):[]:i.matched;n(new Yp(t,h.source,s,i.score+(t.boost||0)))}}}if(s){let e=Object.create(null),t=0,n=(e,t)=>{var i,s;return(null!==(i=e.rank)&&void 0!==i?i:1e9)-(null!==(s=t.rank)&&void 0!==s?s:1e9)||(e.name<t.name?-1:1)};for(let i of s.sort(n))t-=1e5,e[i.name]=t;for(let s of i){let{section:t}=s.completion;t&&(s.score+=e["string"==typeof t?t:t.name])}}let o=[],l=null,a=r.compareCompletions;for(let h of i.sort((e,t)=>t.score-e.score||a(e.completion,t.completion))){let e=h.completion;!l||l.label!=e.label||l.detail!=e.detail||null!=l.type&&null!=e.type&&l.type!=e.type||l.apply!=e.apply||l.boost!=e.boost?o.push(h):fg(h.completion)>fg(l)&&(o[o.length-1]=h),l=h.completion}return o}(e,t);if(!o.length)return s&&e.some(e=>e.isPending)?s.setDisabled():null;let l=t.facet(lg).selectOnOpen?0:-1;if(s&&s.selected!=l&&-1!=s.selected){let e=s.options[s.selected].completion;for(let t=0;t<o.length;t++)if(o[t].completion==e){l=t;break}}return new pg(o,yg(i,l),{pos:e.reduce((e,t)=>t.hasResult()?Math.min(e,t.from):e,1e8),create:Og,above:n.aboveCursor},s?s.timestamp:Date.now(),l,!1)}map(e){return new pg(this.options,this.attrs,{...this.tooltip,pos:e.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new pg(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class gg{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new gg(bg,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(e){let{state:t}=e,i=t.facet(lg),s=(i.override||t.languageDataAt("autocomplete",Xp(t)).map(ig)).map(t=>(this.active.find(e=>e.source==t)||new xg(t,this.active.some(e=>0!=e.state)?1:0)).update(e,i));s.length==this.active.length&&s.every((e,t)=>e==this.active[t])&&(s=this.active);let n=this.open,r=e.effects.some(e=>e.is(Sg));n&&e.docChanged&&(n=n.map(e.changes)),e.selection||s.some(t=>t.hasResult()&&e.changes.touchesRange(t.from,t.to))||!function(e,t){if(e==t)return!0;for(let i=0,s=0;;){for(;i<e.length&&!e[i].hasResult();)i++;for(;s<t.length&&!t[s].hasResult();)s++;let n=i==e.length,r=s==t.length;if(n||r)return n==r;if(e[i++].result!=t[s++].result)return!1}}(s,this.active)||r?n=pg.build(s,t,this.id,n,i,r):n&&n.disabled&&!s.some(e=>e.isPending)&&(n=null),!n&&s.every(e=>!e.isPending)&&s.some(e=>e.hasResult())&&(s=s.map(e=>e.hasResult()?new xg(e.source,0):e));for(let o of e.effects)o.is(Cg)&&(n=n&&n.setSelected(o.value,this.id));return s==this.active&&n==this.open?this:new gg(s,this.id,n)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?mg:vg}}const mg={"aria-autocomplete":"list"},vg={};function yg(e,t){let i={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":e};return t>-1&&(i["aria-activedescendant"]=e+"-"+t),i}const bg=[];function wg(e,t){if(e.isUserEvent("input.complete")){let i=e.annotation(Zp);if(i&&t.activateOnCompletion(i))return 12}let i=e.isUserEvent("input.type");return i&&t.activateOnTyping?5:i?1:e.isUserEvent("delete.backward")?2:e.selection?8:e.docChanged?16:0}class xg{constructor(e,t,i=!1){this.source=e,this.state=t,this.explicit=i}hasResult(){return!1}get isPending(){return 1==this.state}update(e,t){let i=wg(e,t),s=this;(8&i||16&i&&this.touches(e))&&(s=new xg(s.source,0)),4&i&&0==s.state&&(s=new xg(this.source,1)),s=s.updateFor(e,i);for(let n of e.effects)if(n.is(sg))s=new xg(s.source,1,n.value);else if(n.is(ng))s=new xg(s.source,0);else if(n.is(Sg))for(let e of n.value)e.source==s.source&&(s=e);return s}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(Xp(e.state))}}class kg extends xg{constructor(e,t,i,s,n,r){super(e,3,t),this.limit=i,this.result=s,this.from=n,this.to=r}hasResult(){return!0}updateFor(e,t){var i;if(!(3&t))return this.map(e.changes);let s=this.result;s.map&&!e.changes.empty&&(s=s.map(s,e.changes));let n=e.changes.mapPos(this.from),r=e.changes.mapPos(this.to,1),o=Xp(e.state);if(o>r||!s||2&t&&(Xp(e.startState)==this.from||o<this.limit))return new xg(this.source,4&t?1:0);let l=e.changes.mapPos(this.limit);return function(e,t,i,s){if(!e)return!1;let n=t.sliceDoc(i,s);return"function"==typeof e?e(n,i,s,t):Qp(e,!0).test(n)}(s.validFor,e.state,n,r)?new kg(this.source,this.explicit,l,s,n,r):s.update&&(s=s.update(s,n,r,new Up(e.state,o,!1)))?new kg(this.source,this.explicit,l,s,s.from,null!==(i=s.to)&&void 0!==i?i:Xp(e.state)):new xg(this.source,1,this.explicit)}map(e){if(e.empty)return this;return(this.result.map?this.result.map(this.result,e):this.result)?new kg(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new xg(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}const Sg=il.define({map:(e,t)=>e.map(e=>e.map(t))}),Cg=il.define(),Mg=Bo.define({create:()=>gg.start(),update:(e,t)=>e.update(t),provide:e=>[Od.from(e,e=>e.tooltip),qu.contentAttributes.from(e,e=>e.attrs)]});function Ag(e,t){const i=t.completion.apply||t.completion.label;let s=e.state.field(Mg).active.find(e=>e.source==t.source);return s instanceof kg&&("string"==typeof i?e.dispatch({...eg(e.state,i,s.from,s.to),annotations:Zp.of(t.completion)}):i(e,t.completion,s.from,s.to),!0)}const Og=dg(Mg,Ag);function Tg(e,t="option"){return i=>{let s=i.state.field(Mg,!1);if(!s||!s.open||s.open.disabled||Date.now()-s.open.timestamp<i.state.facet(lg).interactionDelay)return!1;let n,r=1;"page"==t&&(n=Td(i,s.open.tooltip))&&(r=Math.max(2,Math.floor(n.dom.offsetHeight/n.dom.querySelector("li").offsetHeight)-1));let{length:o}=s.open.options,l=s.open.selected>-1?s.open.selected+r*(e?1:-1):e?0:o-1;return l<0?l="page"==t?0:o-1:l>=o&&(l="page"==t?o-1:0),i.dispatch({effects:Cg.of(l)}),!0}}const Dg=e=>!!e.state.field(Mg,!1)&&(e.dispatch({effects:sg.of(!0)}),!0);class Eg{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const Rg=_h.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of e.state.field(Mg).active)t.isPending&&this.startQuery(t)}update(e){let t=e.state.field(Mg),i=e.state.facet(lg);if(!e.selectionSet&&!e.docChanged&&e.startState.field(Mg)==t)return;let s=e.transactions.some(e=>{let t=wg(e,i);return 8&t||(e.selection||e.docChanged)&&!(3&t)});for(let o=0;o<this.running.length;o++){let t=this.running[o];if(s||t.context.abortOnDocChange&&e.docChanged||t.updates.length+e.transactions.length>50&&Date.now()-t.time>1e3){for(let e of t.context.abortListeners)try{e()}catch(r){Wh(this.view.state,r)}t.context.abortListeners=null,this.running.splice(o--,1)}else t.updates.push(...e.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),e.transactions.some(e=>e.effects.some(e=>e.is(sg)))&&(this.pendingStart=!0);let n=this.pendingStart?50:i.activateOnTypingDelay;if(this.debounceUpdate=t.active.some(e=>e.isPending&&!this.running.some(t=>t.active.source==e.source))?setTimeout(()=>this.startUpdate(),n):-1,0!=this.composing)for(let o of e.transactions)o.isUserEvent("input.type")?this.composing=2:2==this.composing&&o.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:e}=this.view,t=e.field(Mg);for(let i of t.active)i.isPending&&!this.running.some(e=>e.active.source==i.source)&&this.startQuery(i);this.running.length&&t.open&&t.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(lg).updateSyncTime))}startQuery(e){let{state:t}=this.view,i=Xp(t),s=new Up(t,i,e.explicit,this.view),n=new Eg(e,s);this.running.push(n),Promise.resolve(e.source(s)).then(e=>{n.context.aborted||(n.done=e||null,this.scheduleAccept())},e=>{this.view.dispatch({effects:ng.of(null)}),Wh(this.view.state,e)})}scheduleAccept(){this.running.every(e=>void 0!==e.done)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(lg).updateSyncTime))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],i=this.view.state.facet(lg),s=this.view.state.field(Mg);for(let n=0;n<this.running.length;n++){let r=this.running[n];if(void 0===r.done)continue;if(this.running.splice(n--,1),r.done){let s=Xp(r.updates.length?r.updates[0].startState:this.view.state),n=Math.min(s,r.done.from+(r.active.explicit?0:1)),o=new kg(r.active.source,r.active.explicit,n,r.done,r.done.from,null!==(e=r.done.to)&&void 0!==e?e:s);for(let e of r.updates)o=o.update(e,i);if(o.hasResult()){t.push(o);continue}}let o=s.active.find(e=>e.source==r.active.source);if(o&&o.isPending)if(null==r.done){let e=new xg(r.active.source,0);for(let t of r.updates)e=e.update(t,i);e.isPending||t.push(e)}else this.startQuery(o)}(t.length||s.open&&s.open.disabled)&&this.view.dispatch({effects:Sg.of(t)})}},{eventHandlers:{blur(e){let t=this.view.state.field(Mg,!1);if(t&&t.tooltip&&this.view.state.facet(lg).closeOnBlur){let i=t.open&&Td(this.view,t.open.tooltip);i&&i.dom.contains(e.relatedTarget)||setTimeout(()=>this.view.dispatch({effects:ng.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout(()=>this.view.dispatch({effects:sg.of(!1)}),20),this.composing=0}}}),Lg="object"==typeof navigator&&/Win/.test(navigator.platform),Bg=Fo.highest(qu.domEventHandlers({keydown(e,t){let i=t.state.field(Mg,!1);if(!i||!i.open||i.open.disabled||i.open.selected<0||e.key.length>1||e.ctrlKey&&(!Lg||!e.altKey)||e.metaKey)return!1;let s=i.open.options[i.open.selected],n=i.active.find(e=>e.source==s.source),r=s.completion.commitCharacters||n.result.commitCharacters;return r&&r.indexOf(e.key)>-1&&Ag(t,s),!1}})),Pg=qu.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),Ng={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},Vg=il.define({map(e,t){let i=t.mapPos(e,-1,fo.TrackAfter);return null==i?void 0:i}}),Ig=new class extends ml{};Ig.startSide=1,Ig.endSide=-1;const Hg=Bo.define({create:()=>wl.empty,update(e,t){if(e=e.map(t.changes),t.selection){let i=t.state.doc.lineAt(t.selection.main.head);e=e.update({filter:e=>e>=i.from&&e<=i.to})}for(let i of t.effects)i.is(Vg)&&(e=e.update({add:[Ig.range(i.value,i.value+1)]}));return e}});const Fg="()[]{}<>«»»«［］｛｝";function zg(e){for(let t=0;t<16;t+=2)if(Fg.charCodeAt(t)==e)return Fg.charAt(t+1);return ho(e<128?e:e+1)}const Wg="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),$g=qu.inputHandler.of((e,t,i,s)=>{if((Wg?e.composing:e.compositionStarted)||e.state.readOnly)return!1;let n=e.state.selection.main;if(s.length>2||2==s.length&&1==co(ao(s,0))||t!=n.from||i!=n.to)return!1;let r=function(e,t){let i=function(e,t){return e.languageDataAt("closeBrackets",t)[0]||Ng}(e,e.selection.main.head),s=i.brackets||Ng.brackets;for(let n of s){let r=zg(ao(n,0));if(t==n)return r==n?Ug(e,n,s.indexOf(n+n+n)>-1,i):_g(e,n,r,i.before||Ng.before);if(t==r&&jg(e,e.selection.main.from))return Kg(e,n,r)}return null}(e.state,s);return!!r&&(e.dispatch(r),!0)});function jg(e,t){let i=!1;return e.field(Hg).between(0,e.doc.length,e=>{e==t&&(i=!0)}),i}function qg(e,t){let i=e.sliceString(t,t+2);return i.slice(0,co(ao(i,0)))}function _g(e,t,i,s){let n=null,r=e.changeByRange(r=>{if(!r.empty)return{changes:[{insert:t,from:r.from},{insert:i,from:r.to}],effects:Vg.of(r.to+t.length),range:So.range(r.anchor+t.length,r.head+t.length)};let o=qg(e.doc,r.head);return!o||/\s/.test(o)||s.indexOf(o)>-1?{changes:{insert:t+i,from:r.head},effects:Vg.of(r.head+t.length),range:So.cursor(r.head+t.length)}:{range:n=r}});return n?null:e.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function Kg(e,t,i){let s=null,n=e.changeByRange(t=>t.empty&&qg(e.doc,t.head)==i?{changes:{from:t.head,to:t.head+i.length,insert:i},range:So.cursor(t.head+i.length)}:s={range:t});return s?null:e.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function Ug(e,t,i,s){let n=s.stringPrefixes||Ng.stringPrefixes,r=null,o=e.changeByRange(s=>{if(!s.empty)return{changes:[{insert:t,from:s.from},{insert:t,from:s.to}],effects:Vg.of(s.to+t.length),range:So.range(s.anchor+t.length,s.head+t.length)};let o,l=s.head,a=qg(e.doc,l);if(a==t){if(Gg(e,l))return{changes:{insert:t+t,from:l},effects:Vg.of(l+t.length),range:So.cursor(l+t.length)};if(jg(e,l)){let s=i&&e.sliceDoc(l,l+3*t.length)==t+t+t?t+t+t:t;return{changes:{from:l,to:l+s.length,insert:s},range:So.cursor(l+s.length)}}}else{if(i&&e.sliceDoc(l-2*t.length,l)==t+t&&(o=Jg(e,l-2*t.length,n))>-1&&Gg(e,o))return{changes:{insert:t+t+t+t,from:l},effects:Vg.of(l+t.length),range:So.cursor(l+t.length)};if(e.charCategorizer(l)(a)!=cl.Word&&Jg(e,l,n)>-1&&!function(e,t,i,s){let n=lp(e).resolveInner(t,-1),r=s.reduce((e,t)=>Math.max(e,t.length),0);for(let o=0;o<5;o++){let o=e.sliceDoc(n.from,Math.min(n.to,n.from+i.length+r)),l=o.indexOf(i);if(!l||l>-1&&s.indexOf(o.slice(0,l))>-1){let t=n.firstChild;for(;t&&t.from==n.from&&t.to-t.from>i.length+l;){if(e.sliceDoc(t.to-i.length,t.to)==i)return!1;t=t.firstChild}return!0}let a=n.to==t&&n.parent;if(!a)break;n=a}return!1}(e,l,t,n))return{changes:{insert:t+t,from:l},effects:Vg.of(l+t.length),range:So.cursor(l+t.length)}}return{range:r=s}});return r?null:e.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function Gg(e,t){let i=lp(e).resolveInner(t+1);return i.parent&&i.from==t}function Jg(e,t,i){let s=e.charCategorizer(t);if(s(e.sliceDoc(t-1,t))!=cl.Word)return t;for(let n of i){let i=t-n.length;if(e.sliceDoc(i,t)==n&&s(e.sliceDoc(i-1,i))!=cl.Word)return i}return-1}function Yg(e={}){return[Bg,Mg,lg.of(e),Rg,Qg,Pg]}const Xg=[{key:"Ctrl-Space",run:Dg},{mac:"Alt-`",run:Dg},{mac:"Alt-i",run:Dg},{key:"Escape",run:e=>{let t=e.state.field(Mg,!1);return!(!t||!t.active.some(e=>0!=e.state))&&(e.dispatch({effects:ng.of(null)}),!0)}},{key:"ArrowDown",run:Tg(!0)},{key:"ArrowUp",run:Tg(!1)},{key:"PageDown",run:Tg(!0,"page")},{key:"PageUp",run:Tg(!1,"page")},{key:"Enter",run:e=>{let t=e.state.field(Mg,!1);return!(e.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<e.state.facet(lg).interactionDelay)&&Ag(e,t.open.options[t.open.selected])}}],Qg=Fo.highest(Qu.computeN([lg],e=>e.facet(lg).defaultKeymap?[Xg]:[])),Zg=Zo.define(),em=Zo.define(),tm=Ao.define(),im=Ao.define({combine:e=>gl(e,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(i,s)=>e(i,s)||t(i,s)})}),sm=Bo.define({create:()=>wm.empty,update(e,t){let i=t.state.facet(im),s=t.annotation(Zg);if(s){let n=cm.fromTransaction(t,s.selection),r=s.side,o=0==r?e.undone:e.done;return o=n?um(o,o.length,i.minDepth,n):gm(o,t.startState.selection),new wm(0==r?s.rest:o,0==r?o:s.rest)}let n=t.annotation(em);if("full"!=n&&"before"!=n||(e=e.isolate()),!1===t.annotation(sl.addToHistory))return t.changes.empty?e:e.addMapping(t.changes.desc);let r=cm.fromTransaction(t),o=t.annotation(sl.time),l=t.annotation(sl.userEvent);return r?e=e.addChanges(r,o,l,i,t):t.selection&&(e=e.addSelection(t.startState.selection,o,l,i.newGroupDelay)),"full"!=n&&"after"!=n||(e=e.isolate()),e},toJSON:e=>({done:e.done.map(e=>e.toJSON()),undone:e.undone.map(e=>e.toJSON())}),fromJSON:e=>new wm(e.done.map(cm.fromJSON),e.undone.map(cm.fromJSON))});function nm(e={}){return[sm,im.of(e),qu.domEventHandlers({beforeinput(e,t){let i="historyUndo"==e.inputType?om:"historyRedo"==e.inputType?lm:null;return!!i&&(e.preventDefault(),i(t))}})]}function rm(e,t){return function({state:i,dispatch:s}){if(!t&&i.readOnly)return!1;let n=i.field(sm,!1);if(!n)return!1;let r=n.pop(e,i,t);return!!r&&(s(r),!0)}}const om=rm(0,!1),lm=rm(1,!1),am=rm(0,!0),hm=rm(1,!0);class cm{constructor(e,t,i,s,n){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=s,this.selectionsAfter=n}setSelAfter(e){return new cm(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(e=>e.toJSON())}}static fromJSON(e){return new cm(e.changes&&go.fromJSON(e.changes),[],e.mapped&&po.fromJSON(e.mapped),e.startSelection&&So.fromJSON(e.startSelection),e.selectionsAfter.map(So.fromJSON))}static fromTransaction(e,t){let i=fm;for(let s of e.startState.facet(tm)){let t=s(e);t.length&&(i=i.concat(t))}return!i.length&&e.changes.empty?null:new cm(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,fm)}static selection(e){return new cm(void 0,fm,void 0,void 0,e)}}function um(e,t,i,s){let n=t+1>i+20?t-i-1:0,r=e.slice(n,t);return r.push(s),r}function dm(e,t){return e.length?t.length?e.concat(t):e:t}const fm=[],pm=200;function gm(e,t){if(e.length){let i=e[e.length-1],s=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-pm));return s.length&&s[s.length-1].eq(t)?e:(s.push(t),um(e,e.length-1,1e9,i.setSelAfter(s)))}return[cm.selection([t])]}function mm(e){let t=e[e.length-1],i=e.slice();return i[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),i}function vm(e,t){if(!e.length)return e;let i=e.length,s=fm;for(;i;){let n=ym(e[i-1],t,s);if(n.changes&&!n.changes.empty||n.effects.length){let t=e.slice(0,i);return t[i-1]=n,t}t=n.mapped,i--,s=n.selectionsAfter}return s.length?[cm.selection(s)]:fm}function ym(e,t,i){let s=dm(e.selectionsAfter.length?e.selectionsAfter.map(e=>e.map(t)):fm,i);if(!e.changes)return cm.selection(s);let n=e.changes.map(t),r=t.mapDesc(e.changes,!0),o=e.mapped?e.mapped.composeDesc(r):r;return new cm(n,il.mapEffects(e.effects,t),o,e.startSelection.map(r),s)}const bm=/^(input\.type|delete)($|\.)/;class wm{constructor(e,t,i=0,s=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=s}isolate(){return this.prevTime?new wm(this.done,this.undone):this}addChanges(e,t,i,s,n){let r=this.done,o=r[r.length-1];return r=o&&o.changes&&!o.changes.empty&&e.changes&&(!i||bm.test(i))&&(!o.selectionsAfter.length&&t-this.prevTime<s.newGroupDelay&&s.joinToEvent(n,function(e,t){let i=[],s=!1;return e.iterChangedRanges((e,t)=>i.push(e,t)),t.iterChangedRanges((e,t,n,r)=>{for(let o=0;o<i.length;){let e=i[o++],t=i[o++];r>=e&&n<=t&&(s=!0)}}),s}(o.changes,e.changes))||"input.type.compose"==i)?um(r,r.length-1,s.minDepth,new cm(e.changes.compose(o.changes),dm(il.mapEffects(e.effects,o.changes),o.effects),o.mapped,o.startSelection,fm)):um(r,r.length,s.minDepth,e),new wm(r,fm,t,i)}addSelection(e,t,i,s){let n=this.done.length?this.done[this.done.length-1].selectionsAfter:fm;return n.length>0&&t-this.prevTime<s&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&(r=n[n.length-1],o=e,r.ranges.length==o.ranges.length&&0===r.ranges.filter((e,t)=>e.empty!=o.ranges[t].empty).length)?this:new wm(gm(this.done,e),this.undone,t,i);var r,o}addMapping(e){return new wm(vm(this.done,e),vm(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let s=0==e?this.done:this.undone;if(0==s.length)return null;let n=s[s.length-1],r=n.selectionsAfter[0]||t.selection;if(i&&n.selectionsAfter.length)return t.update({selection:n.selectionsAfter[n.selectionsAfter.length-1],annotations:Zg.of({side:e,rest:mm(s),selection:r}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(n.changes){let i=1==s.length?fm:s.slice(0,s.length-1);return n.mapped&&(i=vm(i,n.mapped)),t.update({changes:n.changes,selection:n.startSelection,effects:n.effects,annotations:Zg.of({side:e,rest:i,selection:r}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}wm.empty=new wm(fm,fm);const xm=[{key:"Mod-z",run:om,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:lm,preventDefault:!0},{linux:"Ctrl-Shift-z",run:lm,preventDefault:!0},{key:"Mod-u",run:am,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:hm,preventDefault:!0}];class km{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){let s=[];return this.decompose(0,e,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(t,this.length,s,1),Cm.from(s,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let i=[];return this.decompose(e,t,i,0),Cm.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),s=new Om(this),n=new Om(e);for(let r=t,o=t;;){if(s.next(r),n.next(r),r=0,s.lineBreak!=n.lineBreak||s.done!=n.done||s.value!=n.value)return!1;if(o+=s.value.length,s.done||o>=i)return!0}}iter(e=1){return new Om(this,e)}iterRange(e,t=this.length){return new Tm(this,e,t)}iterLines(e,t){let i;if(null==e)i=this.iter();else{null==t&&(t=this.lines+1);let s=this.line(e).from;i=this.iterRange(s,Math.max(s,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new Dm(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(0==e.length)throw new RangeError("A document must have at least one line");return 1!=e.length||e[0]?e.length<=32?new Sm(e):Cm.from(Sm.split(e,[])):km.empty}}class Sm extends km{constructor(e,t=function(e){let t=-1;for(let i of e)t+=i.length+1;return t}(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,s){for(let n=0;;n++){let r=this.text[n],o=s+r.length;if((t?i:o)>=e)return new Em(s,o,i,r);s=o+1,i++}}decompose(e,t,i,s){let n=e<=0&&t>=this.length?this:new Sm(Am(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(1&s){let e=i.pop(),t=Mm(n.text,e.text.slice(),0,n.length);if(t.length<=32)i.push(new Sm(t,e.length+n.length));else{let e=t.length>>1;i.push(new Sm(t.slice(0,e)),new Sm(t.slice(e)))}}else i.push(n)}replace(e,t,i){if(!(i instanceof Sm))return super.replace(e,t,i);let s=Mm(this.text,Mm(i.text,Am(this.text,0,e)),t),n=this.length+i.length-(t-e);return s.length<=32?new Sm(s,n):Cm.from(Sm.split(s,[]),n)}sliceString(e,t=this.length,i="\n"){let s="";for(let n=0,r=0;n<=t&&r<this.text.length;r++){let o=this.text[r],l=n+o.length;n>e&&r&&(s+=i),e<l&&t>n&&(s+=o.slice(Math.max(0,e-n),t-n)),n=l+1}return s}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],s=-1;for(let n of e)i.push(n),s+=n.length+1,32==i.length&&(t.push(new Sm(i,s)),i=[],s=-1);return s>-1&&t.push(new Sm(i,s)),t}}class Cm extends km{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,s){for(let n=0;;n++){let r=this.children[n],o=s+r.length,l=i+r.lines-1;if((t?l:o)>=e)return r.lineInner(e,t,i,s);s=o+1,i=l+1}}decompose(e,t,i,s){for(let n=0,r=0;r<=t&&n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(e<=l&&t>=r){let n=s&((r<=e?1:0)|(l>=t?2:0));r>=e&&l<=t&&!n?i.push(o):o.decompose(e-r,t-r,i,n)}r=l+1}}replace(e,t,i){if(i.lines<this.lines)for(let s=0,n=0;s<this.children.length;s++){let r=this.children[s],o=n+r.length;if(e>=n&&t<=o){let l=r.replace(e-n,t-n,i),a=this.lines-r.lines+l.lines;if(l.lines<a>>4&&l.lines>a>>6){let n=this.children.slice();return n[s]=l,new Cm(n,this.length-(t-e)+i.length)}return super.replace(n,o,l)}n=o+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i="\n"){let s="";for(let n=0,r=0;n<this.children.length&&r<=t;n++){let o=this.children[n],l=r+o.length;r>e&&n&&(s+=i),e<l&&t>r&&(s+=o.sliceString(e-r,t-r,i)),r=l+1}return s}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Cm))return 0;let i=0,[s,n,r,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;s+=t,n+=t){if(s==r||n==o)return i;let l=this.children[s],a=e.children[n];if(l!=a)return i+l.scanIdentical(a,t);i+=l.length+1}}static from(e,t=e.reduce((e,t)=>e+t.length+1,-1)){let i=0;for(let d of e)i+=d.lines;if(i<32){let i=[];for(let t of e)t.flatten(i);return new Sm(i,t)}let s=Math.max(32,i>>5),n=s<<1,r=s>>1,o=[],l=0,a=-1,h=[];function c(e){let t;if(e.lines>n&&e instanceof Cm)for(let i of e.children)c(i);else e.lines>r&&(l>r||!l)?(u(),o.push(e)):e instanceof Sm&&l&&(t=h[h.length-1])instanceof Sm&&e.lines+t.lines<=32?(l+=e.lines,a+=e.length+1,h[h.length-1]=new Sm(t.text.concat(e.text),t.length+1+e.length)):(l+e.lines>s&&u(),l+=e.lines,a+=e.length+1,h.push(e))}function u(){0!=l&&(o.push(1==h.length?h[0]:Cm.from(h,a)),a=-1,l=h.length=0)}for(let d of e)c(d);return u(),1==o.length?o[0]:new Cm(o,t)}}function Mm(e,t,i=0,s=1e9){for(let n=0,r=0,o=!0;r<e.length&&n<=s;r++){let l=e[r],a=n+l.length;a>=i&&(a>s&&(l=l.slice(0,s-n)),n<i&&(l=l.slice(i-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=a+1}return t}function Am(e,t,i){return Mm(e,[""],t,i)}km.empty=new Sm([""],0);class Om{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Sm?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],n=this.offsets[i],r=n>>1,o=s instanceof Sm?s.text.length:s.children.length;if(r==(t>0?o:0)){if(0==i)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&n)==(t>0?0:1)){if(this.offsets[i]+=t,0==e)return this.lineBreak=!0,this.value="\n",this;e--}else if(s instanceof Sm){let n=s.text[r+(t<0?-1:0)];if(this.offsets[i]+=t,n.length>Math.max(0,e))return this.value=0==e?n:t>0?n.slice(e):n.slice(0,n.length-e),this;e-=n.length}else{let n=s.children[r+(t<0?-1:0)];e>n.length?(e-=n.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(n),this.offsets.push(t>0?1:(n instanceof Sm?n.text.length:n.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class Tm{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new Om(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*t,this.value=s.length<=i?s:t<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class Dm{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:s}=this.inner.next(e);return t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(km.prototype[Symbol.iterator]=function(){return this.iter()},Om.prototype[Symbol.iterator]=Tm.prototype[Symbol.iterator]=Dm.prototype[Symbol.iterator]=function(){return this});class Em{constructor(e,t,i,s){this.from=e,this.to=t,this.number=i,this.text=s}get length(){return this.to-this.from}}let Rm="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let nM=1;nM<Rm.length;nM++)Rm[nM]+=Rm[nM-1];function Lm(e){for(let t=1;t<Rm.length;t+=2)if(Rm[t]>e)return Rm[t-1]<=e;return!1}function Bm(e){return e>=127462&&e<=127487}function Pm(e,t,i=!0,s=!0){return(i?Nm:Vm)(e,t,s)}function Nm(e,t,i){if(t==e.length)return t;t&&Im(e.charCodeAt(t))&&Hm(e.charCodeAt(t-1))&&t--;let s=Fm(e,t);for(t+=Wm(s);t<e.length;){let n=Fm(e,t);if(8205==s||8205==n||i&&Lm(n))t+=Wm(n),s=n;else{if(!Bm(n))break;{let i=0,s=t-2;for(;s>=0&&Bm(Fm(e,s));)i++,s-=2;if(i%2==0)break;t+=2}}}return t}function Vm(e,t,i){for(;t>0;){let s=Nm(e,t-2,i);if(s<t)return s;t--}return 0}function Im(e){return e>=56320&&e<57344}function Hm(e){return e>=55296&&e<56320}function Fm(e,t){let i=e.charCodeAt(t);if(!Hm(i)||t+1==e.length)return i;let s=e.charCodeAt(t+1);return Im(s)?s-56320+(i-55296<<10)+65536:i}function zm(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function Wm(e){return e<65536?1:2}const $m=/\r\n?|\n/;var jm=function(e){return e[e.Simple=0]="Simple",e[e.TrackDel=1]="TrackDel",e[e.TrackBefore=2]="TrackBefore",e[e.TrackAfter=3]="TrackAfter",e}(jm||(jm={}));class qm{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,s=0;t<this.sections.length;){let n=this.sections[t++],r=this.sections[t++];r<0?(e(i,s,n),s+=n):s+=r,i+=n}}iterChangedRanges(e,t=!1){Gm(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],s=this.sections[t++];s<0?e.push(i,s):e.push(s,i)}return new qm(e)}composeDesc(e){return this.empty?e:e.empty?this:Ym(this,e)}mapDesc(e,t=!1){return e.empty?this:Jm(this,e,t)}mapPos(e,t=-1,i=jm.Simple){let s=0,n=0;for(let r=0;r<this.sections.length;){let o=this.sections[r++],l=this.sections[r++],a=s+o;if(l<0){if(a>e)return n+(e-s);n+=o}else{if(i!=jm.Simple&&a>=e&&(i==jm.TrackDel&&s<e&&a>e||i==jm.TrackBefore&&s<e||i==jm.TrackAfter&&a>e))return null;if(a>e||a==e&&t<0&&!o)return e==s||t<0?n:n+l;n+=l}s=a}if(e>s)throw new RangeError(`Position ${e} is out of range for changeset of length ${s}`);return n}touchesRange(e,t=e){for(let i=0,s=0;i<this.sections.length&&s<=t;){let n=s+this.sections[i++];if(this.sections[i++]>=0&&s<=t&&n>=e)return!(s<e&&n>t)||"cover";s=n}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],s=this.sections[t++];e+=(e?" ":"")+i+(s>=0?":"+s:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(e=>"number"!=typeof e))throw new RangeError("Invalid JSON representation of ChangeDesc");return new qm(e)}static create(e){return new qm(e)}}class _m extends qm{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return Gm(this,(t,i,s,n,r)=>e=e.replace(s,s+(i-t),r),!1),e}mapDesc(e,t=!1){return Jm(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let s=0,n=0;s<t.length;s+=2){let r=t[s],o=t[s+1];if(o>=0){t[s]=o,t[s+1]=r;let l=s>>1;for(;i.length<l;)i.push(km.empty);i.push(r?e.slice(n,n+r):km.empty)}n+=r}return new _m(t,i)}compose(e){return this.empty?e:e.empty?this:Ym(this,e,!0)}map(e,t=!1){return e.empty?this:Jm(this,e,t,!0)}iterChanges(e,t=!1){Gm(this,e,t)}get desc(){return qm.create(this.sections)}filter(e){let t=[],i=[],s=[],n=new Xm(this);e:for(let r=0,o=0;;){let l=r==e.length?1e9:e[r++];for(;o<l||o==l&&0==n.len;){if(n.done)break e;let e=Math.min(n.len,l-o);Km(s,e,-1);let r=-1==n.ins?-1:0==n.off?n.ins:0;Km(t,e,r),r>0&&Um(i,t,n.text),n.forward(e),o+=e}let a=e[r++];for(;o<a;){if(n.done)break e;let e=Math.min(n.len,a-o);Km(t,e,-1),Km(s,e,-1==n.ins?-1:0==n.off?n.ins:0),n.forward(e),o+=e}}return{changes:new _m(t,i),filtered:qm.create(s)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],s=this.sections[t+1];s<0?e.push(i):0==s?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let s=[],n=[],r=0,o=null;function l(e=!1){if(!e&&!s.length)return;r<t&&Km(s,t-r,-1);let i=new _m(s,n);o=o?o.compose(i.map(o)):i,s=[],n=[],r=0}return function e(a){if(Array.isArray(a))for(let t of a)e(t);else if(a instanceof _m){if(a.length!=t)throw new RangeError(`Mismatched change set length (got ${a.length}, expected ${t})`);l(),o=o?o.compose(a.map(o)):a}else{let{from:e,to:o=e,insert:h}=a;if(e>o||e<0||o>t)throw new RangeError(`Invalid change range ${e} to ${o} (in doc of length ${t})`);let c=h?"string"==typeof h?km.of(h.split(i||$m)):h:km.empty,u=c.length;if(e==o&&0==u)return;e<r&&l(),e>r&&Km(s,e-r,-1),Km(s,o-e,u),Um(n,s,c),r=o}}(e),l(!o),o}static empty(e){return new _m(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let s=0;s<e.length;s++){let n=e[s];if("number"==typeof n)t.push(n,-1);else{if(!Array.isArray(n)||"number"!=typeof n[0]||n.some((e,t)=>t&&"string"!=typeof e))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==n.length)t.push(n[0],0);else{for(;i.length<s;)i.push(km.empty);i[s]=km.of(n.slice(1)),t.push(n[0],i[s].length)}}}return new _m(t,i)}static createSet(e,t){return new _m(e,t)}}function Km(e,t,i,s=!1){if(0==t&&i<=0)return;let n=e.length-2;n>=0&&i<=0&&i==e[n+1]?e[n]+=t:0==t&&0==e[n]?e[n+1]+=i:s?(e[n]+=t,e[n+1]+=i):e.push(t,i)}function Um(e,t,i){if(0==i.length)return;let s=t.length-2>>1;if(s<e.length)e[e.length-1]=e[e.length-1].append(i);else{for(;e.length<s;)e.push(km.empty);e.push(i)}}function Gm(e,t,i){let s=e.inserted;for(let n=0,r=0,o=0;o<e.sections.length;){let l=e.sections[o++],a=e.sections[o++];if(a<0)n+=l,r+=l;else{let h=n,c=r,u=km.empty;for(;h+=l,c+=a,a&&s&&(u=u.append(s[o-2>>1])),!(i||o==e.sections.length||e.sections[o+1]<0);)l=e.sections[o++],a=e.sections[o++];t(n,h,r,c,u),n=h,r=c}}}function Jm(e,t,i,s=!1){let n=[],r=s?[]:null,o=new Xm(e),l=new Xm(t);for(let a=0,h=0;;)if(-1==o.ins)a+=o.len,o.next();else if(-1==l.ins&&h<a){let e=Math.min(l.len,a-h);l.forward(e),Km(n,e,-1),h+=e}else if(l.ins>=0&&(o.done||h<a||h==a&&(l.len<o.len||l.len==o.len&&!i))){for(Km(n,l.ins,-1);a>h&&!o.done&&a+o.len<h+l.len;)a+=o.len,o.next();h+=l.len,l.next()}else{if(!(o.ins>=0)){if(o.done&&l.done)return r?_m.createSet(n,r):qm.create(n);throw new Error("Mismatched change set lengths")}{let e=0,t=a+o.len;for(;;)if(l.ins>=0&&h>a&&h+l.len<t)e+=l.ins,h+=l.len,l.next();else{if(!(-1==l.ins&&h<t))break;{let i=Math.min(l.len,t-h);e+=i,l.forward(i),h+=i}}Km(n,e,o.ins),r&&Um(r,n,o.text),a=t,o.next()}}}function Ym(e,t,i=!1){let s=[],n=i?[]:null,r=new Xm(e),o=new Xm(t);for(let l=!1;;){if(r.done&&o.done)return n?_m.createSet(s,n):qm.create(s);if(0==r.ins)Km(s,r.len,0,l),r.next();else if(0!=o.len||o.done){if(r.done||o.done)throw new Error("Mismatched change set lengths");{let e=Math.min(r.len2,o.len),t=s.length;if(-1==r.ins){let t=-1==o.ins?-1:o.off?0:o.ins;Km(s,e,t,l),n&&t&&Um(n,s,o.text)}else-1==o.ins?(Km(s,r.off?0:r.len,e,l),n&&Um(n,s,r.textBit(e))):(Km(s,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&Um(n,s,o.text));l=(r.ins>e||o.ins>=0&&o.len>e)&&(l||s.length>t),r.forward2(e),o.forward(e)}}else Km(s,0,o.ins,l),n&&Um(n,s,o.text),o.next()}}class Xm{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?km.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?km.empty:t[i].slice(this.off,null==e?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){-1==this.ins?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class Qm{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){let e=3&this.flags;return 3==e?null:e}get goalColumn(){let e=this.flags>>5;return 33554431==e?void 0:e}map(e,t=-1){let i,s;return this.empty?i=s=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),s=e.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new Qm(i,s,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return Zm.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return Zm.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||"number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid JSON representation for SelectionRange");return Zm.range(e.anchor,e.head)}static create(e,t,i){return new Qm(e,t,i)}}class Zm{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:Zm.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new Zm([this.main],0)}addRange(e,t=!0){return Zm.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,Zm.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||"number"!=typeof e.main||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new Zm(e.ranges.map(e=>Qm.fromJSON(e)),e.main)}static single(e,t=e){return new Zm([Zm.range(e,t)],0)}static create(e,t=0){if(0==e.length)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<e.length;s++){let n=e[s];if(n.empty?n.from<=i:n.from<i)return Zm.normalized(e.slice(),t);i=n.to}return new Zm(e,t)}static cursor(e,t=0,i,s){return Qm.create(e,e,(0==t?0:t<0?4:8)|(null==i?3:Math.min(2,i))|(null!=s?s:33554431)<<5)}static range(e,t,i){let s=(null!=i?i:33554431)<<5;return t<e?Qm.create(t,e,24|s):Qm.create(e,t,s|(t>e?4:0))}static normalized(e,t=0){let i=e[t];e.sort((e,t)=>e.from-t.from),t=e.indexOf(i);for(let s=1;s<e.length;s++){let i=e[s],n=e[s-1];if(i.empty?i.from<=n.to:i.from<n.to){let r=n.from,o=Math.max(i.to,n.to);s<=t&&t--,e.splice(--s,2,i.anchor>i.head?Zm.range(o,r):Zm.range(r,o))}}return new Zm(e,t)}}function ev(e,t){for(let i of e.ranges)if(i.to>t)throw new RangeError("Selection points outside of document")}let tv=0;class iv{constructor(e,t,i,s,n){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=s,this.extensions=n,this.id=tv++,this.default=e([])}static define(e={}){return new iv(e.combine||(e=>e),e.compareInput||((e,t)=>e===t),e.compare||(e.combine?(e,t)=>e===t:sv),!!e.static,e.enables)}of(e){return new nv([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new nv(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new nv(e,this,2,t)}from(e,t){return t||(t=e=>e),this.compute([e],i=>t(i.field(e)))}}function sv(e,t){return e==t||e.length==t.length&&e.every((e,i)=>e===t[i])}class nv{constructor(e,t,i,s){this.dependencies=e,this.facet=t,this.type=i,this.value=s,this.id=tv++}dynamicSlot(e){var t;let i=this.value,s=this.facet.compareInput,n=this.id,r=e[n]>>1,o=2==this.type,l=!1,a=!1,h=[];for(let c of this.dependencies)"doc"==c?l=!0:"selection"==c?a=!0:1&(null!==(t=e[c.id])&&void 0!==t?t:1)||h.push(e[c.id]);return{create:e=>(e.values[r]=i(e),1),update(e,t){if(l&&t.docChanged||a&&(t.docChanged||t.selection)||ov(e,h)){let t=i(e);if(o?!rv(t,e.values[r],s):!s(t,e.values[r]))return e.values[r]=t,1}return 0},reconfigure:(e,t)=>{let l=i(e),a=t.config.address[n];if(null!=a){let i=xv(t,a);if(this.dependencies.every(i=>i instanceof iv?t.facet(i)===e.facet(i):!(i instanceof hv)||t.field(i,!1)==e.field(i,!1))||(o?rv(l,i,s):s(l,i)))return e.values[r]=i,0}return e.values[r]=l,1}}}}function rv(e,t,i){if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],t[s]))return!1;return!0}function ov(e,t){let i=!1;for(let s of t)1&wv(e,s)&&(i=!0);return i}function lv(e,t,i){let s=i.map(t=>e[t.id]),n=i.map(e=>e.type),r=s.filter(e=>!(1&e)),o=e[t.id]>>1;function l(e){let i=[];for(let t=0;t<s.length;t++){let r=xv(e,s[t]);if(2==n[t])for(let e of r)i.push(e);else i.push(r)}return t.combine(i)}return{create(e){for(let t of s)wv(e,t);return e.values[o]=l(e),1},update(e,i){if(!ov(e,r))return 0;let s=l(e);return t.compare(s,e.values[o])?0:(e.values[o]=s,1)},reconfigure(e,n){let r=ov(e,s),a=n.config.facets[t.id],h=n.facet(t);if(a&&!r&&sv(i,a))return e.values[o]=h,0;let c=l(e);return t.compare(c,h)?(e.values[o]=h,0):(e.values[o]=c,1)}}}const av=iv.define({static:!0});class hv{constructor(e,t,i,s,n){this.id=e,this.createF=t,this.updateF=i,this.compareF=s,this.spec=n,this.provides=void 0}static define(e){let t=new hv(tv++,e.create,e.update,e.compare||((e,t)=>e===t),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(av).find(e=>e.field==this);return((null==t?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:e=>(e.values[t]=this.create(e),1),update:(e,i)=>{let s=e.values[t],n=this.updateF(s,i);return this.compareF(s,n)?0:(e.values[t]=n,1)},reconfigure:(e,i)=>null!=i.config.address[this.id]?(e.values[t]=i.field(this),0):(e.values[t]=this.create(e),1)}}init(e){return[this,av.of({field:this,create:e})]}get extension(){return this}}const cv=4,uv=3,dv=2,fv=1;function pv(e){return t=>new mv(t,e)}const gv={highest:pv(0),high:pv(fv),default:pv(dv),low:pv(uv),lowest:pv(cv)};class mv{constructor(e,t){this.inner=e,this.prec=t}}class vv{of(e){return new yv(this,e)}reconfigure(e){return vv.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class yv{constructor(e,t){this.compartment=e,this.inner=t}}class bv{constructor(e,t,i,s,n,r){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=s,this.staticValues=n,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return null==t?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let s=[],n=Object.create(null),r=new Map;for(let u of function(e,t,i){let s=[[],[],[],[],[]],n=new Map;function r(e,o){let l=n.get(e);if(null!=l){if(l<=o)return;let t=s[l].indexOf(e);t>-1&&s[l].splice(t,1),e instanceof yv&&i.delete(e.compartment)}if(n.set(e,o),Array.isArray(e))for(let t of e)r(t,o);else if(e instanceof yv){if(i.has(e.compartment))throw new RangeError("Duplicate use of compartment in extensions");let s=t.get(e.compartment)||e.inner;i.set(e.compartment,s),r(s,o)}else if(e instanceof mv)r(e.inner,e.prec);else if(e instanceof hv)s[o].push(e),e.provides&&r(e.provides,o);else if(e instanceof nv)s[o].push(e),e.facet.extensions&&r(e.facet.extensions,o);else{let t=e.extension;if(!t)throw new Error(`Unrecognized extension value in extension set (${e}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(t,o)}}return r(e,dv),s.reduce((e,t)=>e.concat(t))}(e,t,r))u instanceof hv?s.push(u):(n[u.facet.id]||(n[u.facet.id]=[])).push(u);let o=Object.create(null),l=[],a=[];for(let u of s)o[u.id]=a.length<<1,a.push(e=>u.slot(e));let h=null==i?void 0:i.config.facets;for(let u in n){let e=n[u],t=e[0].facet,s=h&&h[u]||[];if(e.every(e=>0==e.type))if(o[t.id]=l.length<<1|1,sv(s,e))l.push(i.facet(t));else{let s=t.combine(e.map(e=>e.value));l.push(i&&t.compare(s,i.facet(t))?i.facet(t):s)}else{for(let t of e)0==t.type?(o[t.id]=l.length<<1|1,l.push(t.value)):(o[t.id]=a.length<<1,a.push(e=>t.dynamicSlot(e)));o[t.id]=a.length<<1,a.push(i=>lv(i,t,e))}}let c=a.map(e=>e(o));return new bv(e,r,c,o,l,n)}}function wv(e,t){if(1&t)return 2;let i=t>>1,s=e.status[i];if(4==s)throw new Error("Cyclic dependency between fields and/or facets");if(2&s)return s;e.status[i]=4;let n=e.computeSlot(e,e.config.dynamicSlots[i]);return e.status[i]=2|n}function xv(e,t){return 1&t?e.config.staticValues[t>>1]:e.values[t>>1]}const kv=iv.define(),Sv=iv.define({combine:e=>e.some(e=>e),static:!0}),Cv=iv.define({combine:e=>e.length?e[0]:void 0,static:!0}),Mv=iv.define(),Av=iv.define(),Ov=iv.define(),Tv=iv.define({combine:e=>!!e.length&&e[0]});class Dv{constructor(e,t){this.type=e,this.value=t}static define(){return new Ev}}class Ev{of(e){return new Dv(this,e)}}class Rv{constructor(e){this.map=e}of(e){return new Lv(this,e)}}class Lv{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return void 0===t?void 0:t==this.value?this:new Lv(this.type,t)}is(e){return this.type==e}static define(e={}){return new Rv(e.map||(e=>e))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let s of e){let e=s.map(t);e&&i.push(e)}return i}}Lv.reconfigure=Lv.define(),Lv.appendConfig=Lv.define();class Bv{constructor(e,t,i,s,n,r){this.startState=e,this.changes=t,this.selection=i,this.effects=s,this.annotations=n,this.scrollIntoView=r,this._doc=null,this._state=null,i&&ev(i,t.newLength),n.some(e=>e.type==Bv.time)||(this.annotations=n.concat(Bv.time.of(Date.now())))}static create(e,t,i,s,n,r){return new Bv(e,t,i,s,n,r)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Bv.userEvent);return!(!t||!(t==e||t.length>e.length&&t.slice(0,e.length)==e&&"."==t[e.length]))}}function Pv(e,t){let i=[];for(let s=0,n=0;;){let r,o;if(s<e.length&&(n==t.length||t[n]>=e[s]))r=e[s++],o=e[s++];else{if(!(n<t.length))return i;r=t[n++],o=t[n++]}!i.length||i[i.length-1]<r?i.push(r,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function Nv(e,t,i){var s;let n,r,o;return i?(n=t.changes,r=_m.empty(t.changes.length),o=e.changes.compose(t.changes)):(n=t.changes.map(e.changes),r=e.changes.mapDesc(t.changes,!0),o=e.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(r):null===(s=e.selection)||void 0===s?void 0:s.map(n),effects:Lv.mapEffects(e.effects,n).concat(Lv.mapEffects(t.effects,r)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function Vv(e,t,i){let s=t.selection,n=Fv(t.annotations);return t.userEvent&&(n=n.concat(Bv.userEvent.of(t.userEvent))),{changes:t.changes instanceof _m?t.changes:_m.of(t.changes||[],i,e.facet(Cv)),selection:s&&(s instanceof Zm?s:Zm.single(s.anchor,s.head)),effects:Fv(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function Iv(e,t,i){let s=Vv(e,t.length?t[0]:{},e.doc.length);t.length&&!1===t[0].filter&&(i=!1);for(let r=1;r<t.length;r++){!1===t[r].filter&&(i=!1);let n=!!t[r].sequential;s=Nv(s,Vv(e,t[r],n?s.changes.newLength:e.doc.length),n)}let n=Bv.create(e,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function(e){let t=e.startState,i=t.facet(Ov),s=e;for(let n=i.length-1;n>=0;n--){let r=i[n](e);r&&Object.keys(r).length&&(s=Nv(e,Vv(t,r,e.changes.newLength),!0))}return s==e?e:Bv.create(t,e.changes,e.selection,s.effects,s.annotations,s.scrollIntoView)}(i?function(e){let t=e.startState,i=!0;for(let n of t.facet(Mv)){let t=n(e);if(!1===t){i=!1;break}Array.isArray(t)&&(i=!0===i?t:Pv(i,t))}if(!0!==i){let s,n;if(!1===i)n=e.changes.invertedDesc,s=_m.empty(t.doc.length);else{let t=e.changes.filter(i);s=t.changes,n=t.filtered.invertedDesc}e=Bv.create(t,s,e.selection&&e.selection.map(n),Lv.mapEffects(e.effects,n),e.annotations,e.scrollIntoView)}let s=t.facet(Av);for(let n=s.length-1;n>=0;n--){let i=s[n](e);e=i instanceof Bv?i:Array.isArray(i)&&1==i.length&&i[0]instanceof Bv?i[0]:Iv(t,Fv(i),!1)}return e}(n):n)}Bv.time=Dv.define(),Bv.userEvent=Dv.define(),Bv.addToHistory=Dv.define(),Bv.remote=Dv.define();const Hv=[];function Fv(e){return null==e?Hv:Array.isArray(e)?e:[e]}var zv=function(e){return e[e.Word=0]="Word",e[e.Space=1]="Space",e[e.Other=2]="Other",e}(zv||(zv={}));const Wv=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let $v;try{$v=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(sM){}function jv(e){return t=>{if(!/\S/.test(t))return zv.Space;if(function(e){if($v)return $v.test(e);for(let t=0;t<e.length;t++){let i=e[t];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||Wv.test(i)))return!0}return!1}(t))return zv.Word;for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return zv.Word;return zv.Other}}class qv{constructor(e,t,i,s,n,r){this.config=e,this.doc=t,this.selection=i,this.values=s,this.status=e.statusTemplate.slice(),this.computeSlot=n,r&&(r._state=this);for(let o=0;o<this.config.dynamicSlots.length;o++)wv(this,o<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(null!=i)return wv(this,i),xv(this,i);if(t)throw new RangeError("Field is not present in this state")}update(...e){return Iv(this,e,!0)}applyTransaction(e){let t,i=this.config,{base:s,compartments:n}=i;for(let r of e.effects)r.is(vv.reconfigure)?(i&&(n=new Map,i.compartments.forEach((e,t)=>n.set(t,e)),i=null),n.set(r.value.compartment,r.value.extension)):r.is(Lv.reconfigure)?(i=null,s=r.value):r.is(Lv.appendConfig)&&(i=null,s=Fv(s).concat(r.value));if(i)t=e.startState.values.slice();else{i=bv.resolve(s,n,this),t=new qv(i,this.doc,this.selection,i.dynamicSlots.map(()=>null),(e,t)=>t.reconfigure(e,this),null).values}new qv(i,e.newDoc,e.newSelection,t,(t,i)=>i.update(t,e),e)}replaceSelection(e){return"string"==typeof e&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:Zm.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),s=this.changes(i.changes),n=[i.range],r=Fv(i.effects);for(let o=1;o<t.ranges.length;o++){let i=e(t.ranges[o]),l=this.changes(i.changes),a=l.map(s);for(let e=0;e<o;e++)n[e]=n[e].map(a);let h=s.mapDesc(l,!0);n.push(i.range.map(h)),s=s.compose(a),r=Lv.mapEffects(r,a).concat(Lv.mapEffects(Fv(i.effects),h))}return{changes:s,selection:Zm.create(n,t.mainIndex),effects:r}}changes(e=[]){return e instanceof _m?e:_m.of(e,this.doc.length,this.facet(qv.lineSeparator))}toText(e){return km.of(e.split(this.facet(qv.lineSeparator)||$m))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return null==t?e.default:(wv(this,t),xv(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let s=e[i];s instanceof hv&&(t[i]=s.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||"string"!=typeof e.doc)throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i)for(let n in i){let t=i[n],r=e[n];s.push(t.init(e=>t.spec.fromJSON(r,e)))}return qv.create({doc:e.doc,selection:Zm.fromJSON(e.selection),extensions:t.extensions?s.concat([t.extensions]):s})}static create(e={}){let t=bv.resolve(e.extensions||[],new Map),i=e.doc instanceof km?e.doc:km.of((e.doc||"").split(t.staticFacet(qv.lineSeparator)||$m)),s=e.selection?e.selection instanceof Zm?e.selection:Zm.single(e.selection.anchor,e.selection.head):Zm.single(0);return ev(s,i.length),t.staticFacet(Sv)||(s=s.asSingle()),new qv(t,i,s,t.dynamicSlots.map(()=>null),(e,t)=>t.create(e),null)}get tabSize(){return this.facet(qv.tabSize)}get lineBreak(){return this.facet(qv.lineSeparator)||"\n"}get readOnly(){return this.facet(Tv)}phrase(e,...t){for(let i of this.facet(qv.phrases))if(Object.prototype.hasOwnProperty.call(i,e)){e=i[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(e,i)=>{if("$"==i)return"$";let s=+(i||1);return s>t.length?e:t[s-1]})),e}languageDataAt(e,t,i=-1){let s=[];for(let n of this.facet(kv))for(let r of n(this,t,i))Object.prototype.hasOwnProperty.call(r,e)&&s.push(r[e]);return s}charCategorizer(e){return jv(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:s}=this.doc.lineAt(e),n=this.charCategorizer(e),r=e-i,o=e-i;for(;r>0;){let e=Pm(t,r,!1);if(n(t.slice(e,r))!=zv.Word)break;r=e}for(;o<s;){let e=Pm(t,o);if(n(t.slice(o,e))!=zv.Word)break;o=e}return r==o?null:Zm.range(r+i,o+i)}}qv.allowMultipleSelections=Sv,qv.tabSize=iv.define({combine:e=>e.length?e[0]:4}),qv.lineSeparator=Cv,qv.readOnly=Tv,qv.phrases=iv.define({compare(e,t){let i=Object.keys(e),s=Object.keys(t);return i.length==s.length&&i.every(i=>e[i]==t[i])}}),qv.languageData=kv,qv.changeFilter=Mv,qv.transactionFilter=Av,qv.transactionExtender=Ov,vv.reconfigure=Lv.define();class _v{eq(e){return this==e}range(e,t=e){return Kv.create(e,t,this)}}_v.prototype.startSide=_v.prototype.endSide=0,_v.prototype.point=!1,_v.prototype.mapMode=jm.TrackDel;class Kv{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Kv(e,t,i)}}function Uv(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}class Gv{constructor(e,t,i,s){this.from=e,this.to=t,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,s=0){let n=i?this.to:this.from;for(let r=s,o=n.length;;){if(r==o)return r;let s=r+o>>1,l=n[s]-e||(i?this.value[s].endSide:this.value[s].startSide)-t;if(s==r)return l>=0?r:o;l>=0?o=s:r=s+1}}between(e,t,i,s){for(let n=this.findIndex(t,-1e9,!0),r=this.findIndex(i,1e9,!1,n);n<r;n++)if(!1===s(this.from[n]+e,this.to[n]+e,this.value[n]))return!1}map(e,t){let i=[],s=[],n=[],r=-1,o=-1;for(let l=0;l<this.value.length;l++){let a,h,c=this.value[l],u=this.from[l]+e,d=this.to[l]+e;if(u==d){let e=t.mapPos(u,c.startSide,c.mapMode);if(null==e)continue;if(a=h=e,c.startSide!=c.endSide&&(h=t.mapPos(u,c.endSide),h<a))continue}else if(a=t.mapPos(u,c.startSide),h=t.mapPos(d,c.endSide),a>h||a==h&&c.startSide>0&&c.endSide<=0)continue;(h-a||c.endSide-c.startSide)<0||(r<0&&(r=a),c.point&&(o=Math.max(o,h-a)),i.push(c),s.push(a-r),n.push(h-r))}return{mapped:i.length?new Gv(s,n,i,o):null,pos:r}}}class Jv{constructor(e,t,i,s){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=s}static create(e,t,i,s){return new Jv(e,t,i,s)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:s=0,filterTo:n=this.length}=e,r=e.filter;if(0==t.length&&!r)return this;if(i&&(t=t.slice().sort(Uv)),this.isEmpty)return t.length?Jv.of(t):this;let o=new Qv(this,null,-1).goto(0),l=0,a=[],h=new Yv;for(;o.value||l<t.length;)if(l<t.length&&(o.from-t[l].from||o.startSide-t[l].value.startSide)>=0){let e=t[l++];h.addInner(e.from,e.to,e.value)||a.push(e)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(l==t.length||this.chunkEnd(o.chunkIndex)<t[l].from)&&(!r||s>this.chunkEnd(o.chunkIndex)||n<this.chunkPos[o.chunkIndex])&&h.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!r||s>o.to||n<o.from||r(o.from,o.to,o.value))&&(h.addInner(o.from,o.to,o.value)||a.push(Kv.create(o.from,o.to,o.value))),o.next());return h.finishInner(this.nextLayer.isEmpty&&!a.length?Jv.empty:this.nextLayer.update({add:a,filter:r,filterFrom:s,filterTo:n}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],s=-1;for(let r=0;r<this.chunk.length;r++){let n=this.chunkPos[r],o=this.chunk[r],l=e.touchesRange(n,n+o.length);if(!1===l)s=Math.max(s,o.maxPoint),t.push(o),i.push(e.mapPos(n));else if(!0===l){let{mapped:r,pos:l}=o.map(n,e);r&&(s=Math.max(s,r.maxPoint),t.push(r),i.push(l))}}let n=this.nextLayer.map(e);return 0==t.length?n:new Jv(i,t,n||Jv.empty,s)}between(e,t,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],r=this.chunk[s];if(t>=n&&e<=n+r.length&&!1===r.between(n,e-n,t-n,i))return}this.nextLayer.between(e,t,i)}}iter(e=0){return Zv.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Zv.from(e).goto(t)}static compare(e,t,i,s,n=-1){let r=e.filter(e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=n),o=t.filter(e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=n),l=Xv(r,o,i),a=new ty(r,l,n),h=new ty(o,l,n);i.iterGaps((e,t,i)=>iy(a,e,h,t,i,s)),i.empty&&0==i.length&&iy(a,0,h,0,0,s)}static eq(e,t,i=0,s){null==s&&(s=1e9);let n=e.filter(e=>!e.isEmpty&&t.indexOf(e)<0),r=t.filter(t=>!t.isEmpty&&e.indexOf(t)<0);if(n.length!=r.length)return!1;if(!n.length)return!0;let o=Xv(n,r),l=new ty(n,o,0).goto(i),a=new ty(r,o,0).goto(i);for(;;){if(l.to!=a.to||!sy(l.active,a.active)||l.point&&(!a.point||!l.point.eq(a.point)))return!1;if(l.to>s)return!0;l.next(),a.next()}}static spans(e,t,i,s,n=-1){let r=new ty(e,null,n).goto(t),o=t,l=r.openStart;for(;;){let e=Math.min(r.to,i);if(r.point?(s.point(o,e,r.point,r.activeForPoint(r.to),l,r.pointRank),l=r.openEnd(e)+(r.to>e?1:0)):e>o&&(s.span(o,e,r.active,l),l=r.openEnd(e)),r.to>i)break;o=r.to,r.next()}return l}static of(e,t=!1){let i=new Yv;for(let s of e instanceof Kv?[e]:t?function(e){if(e.length>1)for(let t=e[0],i=1;i<e.length;i++){let s=e[i];if(Uv(t,s)>0)return e.slice().sort(Uv);t=s}return e}(e):e)i.add(s.from,s.to,s.value);return i.finish()}}Jv.empty=new Jv([],[],null,-1),Jv.empty.nextLayer=Jv.empty;class Yv{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new Gv(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Yv)).add(e,t,i)}addInner(e,t,i){let s=e-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(s<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(Jv.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return e;let t=Jv.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Xv(e,t,i){let s=new Map;for(let r of e)for(let e=0;e<r.chunk.length;e++)r.chunk[e].maxPoint<=0&&s.set(r.chunk[e],r.chunkPos[e]);let n=new Set;for(let r of t)for(let e=0;e<r.chunk.length;e++){let t=s.get(r.chunk[e]);null==t||(i?i.mapPos(t):t)!=r.chunkPos[e]||(null==i?void 0:i.touchesRange(t,t+r.chunk[e].length))||n.add(r.chunk[e])}return n}class Qv{constructor(e,t,i,s=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let t=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(t)||this.layer.chunkEnd(this.chunkIndex)<e||t.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Zv{constructor(e){this.heap=e}static from(e,t=null,i=-1){let s=[];for(let n=0;n<e.length;n++)for(let r=e[n];!r.isEmpty;r=r.nextLayer)r.maxPoint>=i&&s.push(new Qv(r,t,i,n));return 1==s.length?s[0]:new Zv(s)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)ey(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)ey(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),ey(this.heap,0)}}}function ey(e,t){for(let i=e[t];;){let s=1+(t<<1);if(s>=e.length)break;let n=e[s];if(s+1<e.length&&n.compare(e[s+1])>=0&&(n=e[s+1],s++),i.compare(n)<0)break;e[s]=i,e[t]=n,t=s}}class ty{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Zv.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){ny(this.active,e),ny(this.activeTo,e),ny(this.activeRank,e),this.minActive=oy(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:s,rank:n}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=n;)t++;ry(this.active,t,i),ry(this.activeTo,t,s),ry(this.activeRank,t,n),e&&ry(e,t,this.cursor.from),this.minActive=oy(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null,s=0;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&ny(i,n)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let n=this.cursor.value;if(n.point){if(!(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=n,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=n.endSide,this.cursor.from<e&&(s=1),this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){let t=0;for(;t<i.length&&i[t]<e;)t++;this.openStart=t+s}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function iy(e,t,i,s,n,r){e.goto(t),i.goto(s);let o=s+n,l=s,a=s-t;for(;;){let t=e.to+a-i.to||e.endSide-i.endSide,s=t<0?e.to+a:i.to,n=Math.min(s,o);if(e.point||i.point?e.point&&i.point&&(e.point==i.point||e.point.eq(i.point))&&sy(e.activeForPoint(e.to+a),i.activeForPoint(i.to))||r.comparePoint(l,n,e.point,i.point):n>l&&!sy(e.active,i.active)&&r.compareRange(l,n,e.active,i.active),s>o)break;l=s,t<=0&&e.next(),t>=0&&i.next()}}function sy(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i]&&!e[i].eq(t[i]))return!1;return!0}function ny(e,t){for(let i=t,s=e.length-1;i<s;i++)e[i]=e[i+1];e.pop()}function ry(e,t,i){for(let s=e.length-1;s>=t;s--)e[s+1]=e[s];e[t]=i}function oy(e,t){let i=-1,s=1e9;for(let n=0;n<t.length;n++)(t[n]-s||e[n].endSide-e[i].endSide)<0&&(i=n,s=t[n]);return i}function ly(e){let t;return t=11==e.nodeType?e.getSelection?e:e.ownerDocument:e,t.getSelection()}function ay(e,t){return!!t&&(e==t||e.contains(1!=t.nodeType?t.parentNode:t))}function hy(e,t){if(!t.anchorNode)return!1;try{return ay(e,t.anchorNode)}catch(sM){return!1}}function cy(e){return 3==e.nodeType?ky(e,0,e.nodeValue.length).getClientRects():1==e.nodeType?e.getClientRects():[]}function uy(e,t,i,s){return!!i&&(fy(e,t,i,s,-1)||fy(e,t,i,s,1))}function dy(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t}function fy(e,t,i,s,n){for(;;){if(e==i&&t==s)return!0;if(t==(n<0?0:py(e))){if("DIV"==e.nodeName)return!1;let i=e.parentNode;if(!i||1!=i.nodeType)return!1;t=dy(e)+(n<0?0:1),e=i}else{if(1!=e.nodeType)return!1;if(1==(e=e.childNodes[t+(n<0?-1:0)]).nodeType&&"false"==e.contentEditable)return!1;t=n<0?py(e):0}}}function py(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}const gy={left:0,right:0,top:0,bottom:0};function my(e,t){let i=t?e.left:e.right;return{left:i,right:i,top:e.top,bottom:e.bottom}}function vy(e){return{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}class yy{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,t,i,s){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=s}}let by,wy=null;function xy(e){if(e.setActive)return e.setActive();if(wy)return e.focus(wy);let t=[];for(let i=e;i&&(t.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(e.focus(null==wy?{get preventScroll(){return wy={preventScroll:!0},!0}}:void 0),!wy){wy=!1;for(let e=0;e<t.length;){let i=t[e++],s=t[e++],n=t[e++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function ky(e,t,i=t){let s=by||(by=document.createRange());return s.setEnd(e,i),s.setStart(e,t),s}function Sy(e,t,i){let s={key:t,code:t,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,e.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,e.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function Cy(e){for(;e.attributes.length;)e.removeAttributeNode(e.attributes[0])}class My{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new My(e.parentNode,dy(e),t)}static after(e,t){return new My(e.parentNode,dy(e)+1,t)}}const Ay=[];class Oy{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(2&this.dirty){let t,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(t=s?s.nextSibling:i.firstChild)){let e=Oy.get(t);e&&(e.parent||e.constructor!=n.constructor)||n.reuseDOM(t)}n.sync(e),n.dirty=0}if(t=s?s.nextSibling:i.firstChild,e&&!e.written&&e.node==i&&t!=n.dom&&(e.written=!0),n.dom.parentNode==i)for(;t&&t!=n.dom;)t=Ty(t);else i.insertBefore(n.dom,t);s=n.dom}for(t=s?s.nextSibling:i.firstChild,t&&e&&e.node==i&&(e.written=!0);t;)t=Ty(t)}else if(1&this.dirty)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let s=0==py(e)?0:0==t?-1:1;for(;;){let t=e.parentNode;if(t==this.dom)break;0==s&&t.firstChild!=t.lastChild&&(s=e==t.firstChild?-1:1),e=t}i=s<0?e:e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Oy.get(i);)i=i.nextSibling;if(!i)return this.length;for(let s=0,n=0;;s++){let e=this.children[s];if(e.dom==i)return n;n+=e.length+e.breakAfter}}domBoundsAround(e,t,i=0){let s=-1,n=-1,r=-1,o=-1;for(let l=0,a=i,h=i;l<this.children.length;l++){let i=this.children[l],c=a+i.length;if(a<e&&c>t)return i.domBoundsAround(e,t,a);if(c>=e&&-1==s&&(s=l,n=a),a>t&&i.dom.parentNode==this.dom){r=l,o=h;break}h=c,a=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),1&t.dirty)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=Ay){this.markDirty();for(let s=e;s<t;s++){let e=this.children[s];e.parent==this&&e.destroy()}this.children.splice(e,t-e,...i);for(let s=0;s<i.length;s++)i[s].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new Dy(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==e?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,i,s,n,r){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}}function Ty(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}Oy.prototype.breakAfter=0;class Dy{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Ey(e,t,i,s,n,r,o,l,a){let{children:h}=e,c=h.length?h[t]:null,u=r.length?r[r.length-1]:null,d=u?u.breakAfter:o;if(!(t==s&&c&&!o&&!d&&r.length<2&&c.merge(i,n,r.length?u:null,0==i,l,a))){if(s<h.length){let e=h[s];e&&n<e.length?(t==s&&(e=e.split(n),n=0),!d&&u&&e.merge(0,n,u,!0,0,a)?r[r.length-1]=e:(n&&e.merge(0,n,null,!1,0,a),r.push(e))):(null==e?void 0:e.breakAfter)&&(u?u.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,l,0),t++));t<s&&r.length;)if(h[s-1].become(r[r.length-1]))s--,r.pop(),a=r.length?0:l;else{if(!h[t].become(r[0]))break;t++,r.shift(),l=r.length?0:a}!r.length&&t&&s<h.length&&!h[t-1].breakAfter&&h[s].merge(0,0,h[t-1],!1,l,a)&&t--,(t<s||r.length)&&e.replaceChildren(t,s,r)}}function Ry(e,t,i,s,n,r){let o=e.childCursor(),{i:l,off:a}=o.findPos(i,1),{i:h,off:c}=o.findPos(t,-1),u=t-i;for(let d of s)u+=d.length;e.length+=u,Ey(e,h,c,l,a,s,0,n,r)}let Ly="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},By="undefined"!=typeof document?document:{documentElement:{style:{}}};const Py=/Edge\/(\d+)/.exec(Ly.userAgent),Ny=/MSIE \d/.test(Ly.userAgent),Vy=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ly.userAgent),Iy=!!(Ny||Vy||Py),Hy=!Iy&&/gecko\/(\d+)/i.test(Ly.userAgent),Fy=!Iy&&/Chrome\/(\d+)/.exec(Ly.userAgent),zy="webkitFontSmoothing"in By.documentElement.style,Wy=!Iy&&/Apple Computer/.test(Ly.vendor),$y=Wy&&(/Mobile\/\w+/.test(Ly.userAgent)||Ly.maxTouchPoints>2);var jy={mac:$y||/Mac/.test(Ly.platform),windows:/Win/.test(Ly.platform),linux:/Linux|X11/.test(Ly.platform),ie:Iy,ie_version:Ny?By.documentMode||6:Vy?+Vy[1]:Py?+Py[1]:0,gecko:Hy,gecko_version:Hy?+(/Firefox\/(\d+)/.exec(Ly.userAgent)||[0,0])[1]:0,chrome:!!Fy,chrome_version:Fy?+Fy[1]:0,ios:$y,android:/Android\b/.test(Ly.userAgent),safari:Wy,webkit_version:zy?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=By.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class qy extends Oy{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){3==e.nodeType&&this.createDOM(e)}merge(e,t,i){return(!i||i instanceof qy&&!(this.length-(t-e)+i.length>256))&&(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new qy(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new My(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return Ky(this.dom,e,t)}}class _y extends Oy{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let s of t)s.setParent(this)}setAttrs(e){if(Cy(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,i,s,n,r){return(!i||!(!(i instanceof _y&&i.mark.eq(this.mark))||e&&n<=0||t<this.length&&r<=0))&&(Ry(this,e,t,i?i.children:[],n-1,r-1),this.markDirty(),!0)}split(e){let t=[],i=0,s=-1,n=0;for(let o of this.children){let r=i+o.length;r>e&&t.push(i<e?o.split(e-i):o),s<0&&i>=e&&(s=n),i=r,n++}let r=this.length-e;return this.length=e,s>-1&&(this.children.length=s,this.markDirty()),new _y(this.mark,t,r)}domAtPos(e){return Qy(this.dom,this.children,e)}coordsAt(e,t){return eb(this,e,t)}}function Ky(e,t,i){let s=e.nodeValue.length;t>s&&(t=s);let n=t,r=t,o=0;0==t&&i<0||t==s&&i>=0?jy.chrome||jy.gecko||(t?(n--,o=1):r<s&&(r++,o=-1)):i<0?n--:r<s&&r++;let l=ky(e,n,r).getClientRects();if(!l.length)return gy;let a=l[(o?o<0:i>=0)?0:l.length-1];return jy.safari&&!o&&0==a.width&&(a=Array.prototype.find.call(l,e=>e.width)||a),o?my(a,o<0):a||null}class Uy extends Oy{constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}static create(e,t,i){return new(e.customView||Uy)(e,t,i)}split(e){let t=Uy.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,i,s,n,r){return!(i&&(!(i instanceof Uy&&this.widget.compare(i.widget))||e>0&&n<=0||t<this.length&&r<=0))&&(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof Uy&&e.side==this.side&&this.widget.constructor==e.widget.constructor&&(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(0==this.length)return km.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,i=t&&t.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):km.empty}domAtPos(e){return 0==e?My.before(this.dom):My.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.dom.getClientRects(),s=null;if(!i.length)return gy;for(let n=e>0?i.length-1:0;s=i[n],!(e>0?0==n:n==i.length-1||s.top<s.bottom);n+=e>0?-1:1);return 0==e&&t>0||e==this.length&&t<=0?s:my(s,0==e)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Gy extends Uy{domAtPos(e){let{topView:t,text:i}=this.widget;return t?Jy(e,0,t,i,(e,t)=>e.domAtPos(t),e=>new My(i,Math.min(e,i.nodeValue.length))):new My(i,Math.min(e,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:i,text:s}=this.widget;return i?Yy(e,t,i,s):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:i,text:s}=this.widget;return i?Jy(e,t,i,s,(e,t,i)=>e.coordsAt(t,i),(e,t)=>Ky(s,e,t)):Ky(s,e,t)}destroy(){var e;super.destroy(),null===(e=this.widget.topView)||void 0===e||e.destroy()}get isEditable(){return!0}}function Jy(e,t,i,s,n,r){if(i instanceof _y){for(let o of i.children){let i=ay(o.dom,s),l=i?s.nodeValue.length:o.length;if(e<l||e==l&&o.getSide()<=0)return i?Jy(e,t,o,s,n,r):n(o,e,t);e-=l}return n(i,i.length,-1)}return i.dom==s?r(e,t):n(i,e,t)}function Yy(e,t,i,s){if(i instanceof _y)for(let n of i.children){let i=0,r=ay(n.dom,s);if(ay(n.dom,e))return i+(r?Yy(e,t,n,s):n.localPosFromDOM(e,t));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(t,s.nodeValue.length);return i.localPosFromDOM(e,t)}class Xy extends Oy{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Xy&&e.side==this.side}split(){return new Xy(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return My.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let t=this.dom.getBoundingClientRect(),i=function(e,t){let i=e.parent,s=i?i.children.indexOf(e):-1;for(;i&&s>=0;)if(t<0?s>0:s<i.children.length){let e=i.children[s+t];if(e instanceof qy){let i=e.coordsAt(t<0?e.length:0,t);if(i)return i}s+=t}else{if(!(i instanceof _y&&i.parent)){let e=i.dom.lastChild;if(e&&"BR"==e.nodeName)return e.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(t<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<t.bottom&&i.bottom>t.top?{left:t.left,right:t.right,top:i.top,bottom:i.bottom}:t}get overrideDOMText(){return km.empty}}function Qy(e,t,i){let s=0;for(let n=0;s<t.length;s++){let r=t[s],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(i>n&&i<o&&r.dom.parentNode==e)return r.domAtPos(i-n);if(i<=n)break;n=o}}for(;s>0;s--){let i=t[s-1].dom;if(i.parentNode==e)return My.after(i)}return new My(e,0)}function Zy(e,t,i){let s,{children:n}=e;i>0&&t instanceof _y&&n.length&&(s=n[n.length-1])instanceof _y&&s.mark.eq(t.mark)?Zy(s,t.children[0],i-1):(n.push(t),t.setParent(e)),e.length+=t.length}function eb(e,t,i){for(let r=0,o=0;o<e.children.length;o++){let s,n=e.children[o],l=r+n.length;if((i<=0||l==e.length||n.getSide()>0?l>=t:l>t)&&(t<l||o+1==e.children.length||(s=e.children[o+1]).length||s.getSide()>0)){let e=0;if(l==r){if(n.getSide()<=0)continue;e=i=-n.getSide()}let s=n.coordsAt(Math.max(0,t-r),i);return e&&s?my(s,i<0):s}r=l}let s=e.dom.lastChild;if(!s)return e.dom.getBoundingClientRect();let n=cy(s);return n[n.length-1]||null}function tb(e,t){for(let i in e)"class"==i&&t.class?t.class+=" "+e.class:"style"==i&&t.style?t.style+=";"+e.style:t[i]=e[i];return t}function ib(e,t){if(e==t)return!0;if(!e||!t)return!1;let i=Object.keys(e),s=Object.keys(t);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||e[n]!==t[n])return!1;return!0}function sb(e,t,i){let s=null;if(t)for(let n in t)i&&n in i||e.removeAttribute(s=n);if(i)for(let n in i)t&&t[n]==i[n]||e.setAttribute(s=n,i[n]);return!!s}qy.prototype.children=Uy.prototype.children=Xy.prototype.children=Ay;class nb{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}}var rb=function(e){return e[e.Text=0]="Text",e[e.WidgetBefore=1]="WidgetBefore",e[e.WidgetAfter=2]="WidgetAfter",e[e.WidgetRange=3]="WidgetRange",e}(rb||(rb={}));class ob extends _v{constructor(e,t,i,s){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(e){return new lb(e)}static widget(e){let t=e.side||0,i=!!e.block;return t+=i?t>0?3e8:-4e8:t>0?1e8:-1e8,new hb(e,t,t,i,e.widget||null,!1)}static replace(e){let t,i,s=!!e.block;if(e.isBlockGap)t=-5e8,i=4e8;else{let{start:n,end:r}=cb(e,s);t=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new hb(e,t,i,s,e.widget||null,!0)}static line(e){return new ab(e)}static set(e,t=!1){return Jv.of(e,t)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}ob.none=Jv.empty;class lb extends ob{constructor(e){let{start:t,end:i}=cb(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof lb&&this.tagName==e.tagName&&this.class==e.class&&ib(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}lb.prototype.point=!1;class ab extends ob{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof ab&&ib(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}ab.prototype.mapMode=jm.TrackBefore,ab.prototype.point=!0;class hb extends ob{constructor(e,t,i,s,n,r){super(t,i,n,e),this.block=s,this.isReplace=r,this.mapMode=s?t<=0?jm.TrackBefore:jm.TrackAfter:jm.TrackDel}get type(){return this.startSide<this.endSide?rb.WidgetRange:this.startSide<=0?rb.WidgetBefore:rb.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof hb&&(t=this.widget,i=e.widget,t==i||!!(t&&i&&t.compare(i)))&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide;var t,i}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}function cb(e,t=!1){let{inclusiveStart:i,inclusiveEnd:s}=e;return null==i&&(i=e.inclusive),null==s&&(s=e.inclusive),{start:null!=i?i:t,end:null!=s?s:t}}function ub(e,t,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=e?i[n]=Math.max(i[n],t):i.push(e,t)}hb.prototype.point=!0;class db extends Oy{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,s,n,r){if(i){if(!(i instanceof db))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),Ry(this,e,t,i?i.children:[],n,r),!0}split(e){let t=new db;if(t.breakAfter=this.breakAfter,0==this.length)return t;let{i:i,off:s}=this.childPos(e);s&&(t.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let n=i;n<this.children.length;n++)t.append(this.children[n],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){ib(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Zy(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=tb(t,this.attrs||{})),i&&(this.attrs=tb({class:i},this.attrs||{}))}domAtPos(e){return Qy(this.dom,this.children,e)}reuseDOM(e){"DIV"==e.nodeName&&(this.setDOM(e),this.dirty|=6)}sync(e){var t;this.dom?4&this.dirty&&(Cy(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(sb(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let i=this.dom.lastChild;for(;i&&Oy.get(i)instanceof _y;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(t=Oy.get(i))||void 0===t?void 0:t.isEditable)||jy.ios&&this.children.some(e=>e instanceof qy)))){let e=document.createElement("BR");e.cmIgnore=!0,this.dom.appendChild(e)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof qy))return null;let i=cy(t.dom);if(1!=i.length)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return eb(this,e,t)}become(e){return!1}get type(){return rb.Text}static find(e,t){for(let i=0,s=0;i<e.children.length;i++){let n=e.children[i],r=s+n.length;if(r>=t){if(n instanceof db)return n;if(r>t)break}s=r+n.breakAfter}return null}}class fb extends Oy{constructor(e,t,i){super(),this.widget=e,this.length=t,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,s,n,r){return!(i&&(!(i instanceof fb&&this.widget.compare(i.widget))||e>0&&n<=0||t<this.length&&r<=0))&&(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return 0==e?My.before(this.dom):My.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new fb(this.widget,t,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Ay}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):km.empty}domBoundsAround(){return null}become(e){return e instanceof fb&&e.type==this.type&&e.widget.constructor==this.widget.constructor&&(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class pb{constructor(e,t,i,s){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof fb&&e.type==rb.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new db),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(gb(new Xy(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:t,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}this.text=t,this.textOff=0}let s=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,i)),this.getLine().append(gb(new qy(this.text.slice(this.textOff,this.textOff+s)),t),i),this.atCursorPos=!0,this.textOff+=s,e-=s,i=0}}span(e,t,i,s){this.buildText(t-e,i,s),this.pos=t,this.openStart<0&&(this.openStart=s)}point(e,t,i,s,n,r){if(this.disallowBlockEffectsFor[r]&&i instanceof hb){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=t-e;if(i instanceof hb)if(i.block){let{type:e}=i;e!=rb.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new fb(i.widget||new mb("div"),o,e))}else{let r=Uy.create(i.widget||new mb("span"),o,i.startSide),l=this.atCursorPos&&!r.isEditable&&n<=s.length&&(e<t||i.startSide>0),a=!r.isEditable&&(e<t||i.startSide<=0),h=this.getLine();2!=this.pendingBuffer||l||(this.pendingBuffer=0),this.flushBuffer(s),l&&(h.append(gb(new Xy(1),s),n),n=s.length+Math.max(0,n-s.length)),h.append(gb(r,s),n),this.atCursorPos=a,this.pendingBuffer=a?e<t?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=n)}static build(e,t,i,s,n){let r=new pb(e,t,i,n);return r.openEnd=Jv.spans(s,t,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function gb(e,t){for(let i of t)e=new _y(i,[e],e.length);return e}class mb extends nb{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}}const vb=iv.define(),yb=iv.define(),bb=iv.define(),wb=iv.define(),xb=iv.define(),kb=iv.define(),Sb=iv.define({combine:e=>e.some(e=>e)});class Cb{constructor(e,t="nearest",i="nearest",s=5,n=5){this.range=e,this.y=t,this.x=i,this.yMargin=s,this.xMargin=n}map(e){return e.empty?this:new Cb(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const Mb=Lv.define({map:(e,t)=>e.map(t)});function Ab(e,t,i){let s=e.facet(wb);s.length?s[0](t):window.onerror?window.onerror(String(t),i,void 0,void 0,t):i?console.error(i+":",t):console.error(t)}const Ob=iv.define({combine:e=>!e.length||e[0]});let Tb=0;const Db=iv.define();class Eb{constructor(e,t,i,s){this.id=e,this.create=t,this.domEventHandlers=i,this.extension=s(this)}static define(e,t){const{eventHandlers:i,provide:s,decorations:n}=t||{};return new Eb(Tb++,e,i,e=>{let t=[Db.of(e)];return n&&t.push(Pb.of(t=>{let i=t.plugin(e);return i?n(i):ob.none})),s&&t.push(s(e)),t})}static fromClass(e,t){return Eb.define(t=>new e(t),t)}}class Rb{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(t){if(Ab(e.state,t,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(sM){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Ab(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(null===(t=this.value)||void 0===t?void 0:t.destroy)try{this.value.destroy()}catch(i){Ab(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Lb=iv.define(),Bb=iv.define(),Pb=iv.define(),Nb=iv.define(),Vb=iv.define(),Ib=iv.define();class Hb{constructor(e,t,i,s){this.fromA=e,this.toA=t,this.fromB=i,this.toB=s}join(e){return new Hb(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let s=e[t-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(0==t.length)return e;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let l=s==e.length?null:e[s],a=r-o,h=l?l.fromB:1e9;for(;n<t.length&&t[n]<h;){let e=t[n],s=t[n+1],r=Math.max(o,e),l=Math.min(h,s);if(r<=l&&new Hb(r+a,l+a,r,l).addToSet(i),s>h)break;n+=2}if(!l)return i;new Hb(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),r=l.toA,o=l.toB}}}class Fb{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=_m.empty(this.startState.doc.length);for(let r of i)this.changes=this.changes.compose(r.changes);let s=[];this.changes.iterChangedRanges((e,t,i,n)=>s.push(new Hb(e,t,i,n))),this.changedRanges=s;let n=e.hasFocus;n!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=n,this.flags|=1)}static create(e,t,i){return new Fb(e,t,i)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return 0==this.flags&&0==this.transactions.length}}var zb=function(e){return e[e.LTR=0]="LTR",e[e.RTL=1]="RTL",e}(zb||(zb={}));const Wb=zb.LTR,$b=zb.RTL;function jb(e){let t=[];for(let i=0;i<e.length;i++)t.push(1<<+e[i]);return t}const qb=jb("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),_b=jb("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Kb=Object.create(null),Ub=[];for(let nM of["()","[]","{}"]){let e=nM.charCodeAt(0),t=nM.charCodeAt(1);Kb[e]=t,Kb[t]=-e}function Gb(e){return e<=247?qb[e]:1424<=e&&e<=1524?2:1536<=e&&e<=1785?_b[e-1536]:1774<=e&&e<=2220?4:8192<=e&&e<=8203||8204==e?256:1}const Jb=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Yb{constructor(e,t,i){this.from=e,this.to=t,this.level=i}get dir(){return this.level%2?$b:Wb}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,i,s){let n=-1;for(let r=0;r<e.length;r++){let o=e[r];if(o.from<=t&&o.to>=t){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<t:o.to>t:e[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const Xb=[];function Qb(e){return[new Yb(0,e,0)]}let Zb="";function ew(e,t,i,s,n){var r;let o=s.head-e.from,l=-1;if(0==o){if(!n||!e.length)return null;t[0].level!=i&&(o=t[0].side(!1,i),l=0)}else if(o==e.length){if(n)return null;let e=t[t.length-1];e.level!=i&&(o=e.side(!0,i),l=t.length-1)}l<0&&(l=Yb.find(t,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let a=t[l];o==a.side(n,i)&&(a=t[l+=n?1:-1],o=a.side(!n,i));let h=n==(a.dir==i),c=Pm(e.text,o,h);if(Zb=e.text.slice(Math.min(o,c),Math.max(o,c)),c!=a.side(n,i))return Zm.cursor(c+e.from,h?-1:1,a.level);let u=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return u||a.level==i?u&&u.level<a.level?Zm.cursor(u.side(!n,i)+e.from,n?1:-1,u.level):Zm.cursor(c+e.from,n?-1:1,a.level):Zm.cursor(n?e.to:e.from,n?-1:1,i)}const tw="￿";class iw{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(qv.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=tw}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let s=e;;){this.findPointBefore(i,s),this.readNode(s);let e=s.nextSibling;if(e==t)break;let n=Oy.get(s),r=Oy.get(e);(n&&r?n.breakAfter:(n?n.breakAfter:sw(s))||sw(e)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=e}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(t))&&(r=n.index,o=n[0].length),this.append(t.slice(i,r<0?t.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let t of this.points)t.node==e&&t.pos>this.text.length&&(t.pos-=o-1);i=r+o}}readNode(e){if(e.cmIgnore)return;let t=Oy.get(e),i=t&&t.overrideDOMText;if(null!=i){this.findPointInside(e,i.length);for(let e=i.iter();!e.next().done;)e.lineBreak?this.lineBreak():this.append(e.value)}else 3==e.nodeType?this.readTextNode(e):"BR"==e.nodeName?e.nextSibling&&this.lineBreak():1==e.nodeType&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(3==e.nodeType?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+Math.min(t,i.offset))}}function sw(e){return 1==e.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}class nw{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class rw extends Oy{constructor(e){super(),this.view=e,this.compositionDeco=ob.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new db],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Hb(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every(({fromA:e,toA:t})=>t<this.minWidthFrom||e>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=ob.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=function(e,t){let i=lw(e);if(!i)return ob.none;let{from:s,to:n,node:r,text:o}=i,l=t.mapPos(s,1),a=Math.max(l,t.mapPos(n,-1)),{state:h}=e,c=3==r.nodeType?r.nodeValue:new iw([],h).readRange(r.firstChild,null).text;if(a-l<c.length)if(h.doc.sliceString(l,Math.min(h.doc.length,l+c.length),tw)==c)a=l+c.length;else{if(h.doc.sliceString(Math.max(0,a-c.length),a,tw)!=c)return ob.none;l=a-c.length}else if(h.doc.sliceString(l,a,tw)!=c)return ob.none;let u=Oy.get(r);u instanceof Gy?u=u.widget.topView:u&&(u.parent=null);return ob.set(ob.replace({widget:new aw(r,o,u),inclusive:!0}).range(l,a))}(this.view,e.changes)),(jy.ie||jy.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let i=function(e,t,i){let s=new cw;return Jv.compare(e,t,i,s),s.changes}(this.decorations,this.updateDeco(),e.changes);return t=Hb.extendWithRanges(t,i),(0!=this.dirty||0!=t.length)&&(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let e=jy.chrome||jy.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(e),this.dirty=0,e&&(e.written||i.selectionRange.focusNode!=e.node)&&(this.forceSelection=!0),this.dom.style.height=""});let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let n of this.children)n instanceof fb&&n.widget instanceof ow&&s.push(n.dom);i.updateGaps(s)}updateChildren(e,t){let i=this.childCursor(t);for(let s=e.length-1;;s--){let t=s>=0?e[s]:null;if(!t)break;let{fromA:n,toA:r,fromB:o,toB:l}=t,{content:a,breakAtStart:h,openStart:c,openEnd:u}=pb.build(this.view.state.doc,o,l,this.decorations,this.dynamicDecorationMap),{i:d,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(n,-1);Ey(this,p,g,d,f,a,h,c,u)}}updateSelection(e=!1,t=!1){if(e&&this.view.observer.readSelectionRange(),!t&&!this.mayControlSelection()||jy.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(jy.gecko&&s.empty&&(1==(o=n).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let e=document.createTextNode("");this.view.observer.ignore(()=>n.node.insertBefore(e,n.node.childNodes[n.offset]||null)),n=r=new My(e,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&uy(n.node,n.offset,l.anchorNode,l.anchorOffset)&&uy(r.node,r.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore(()=>{jy.android&&jy.chrome&&this.dom.contains(l.focusNode)&&function(e,t){for(let i=e;i&&i!=t;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let e=ly(this.root);if(s.empty){if(jy.gecko){let e=(t=n.node,i=n.offset,1!=t.nodeType?0:(i&&"false"==t.childNodes[i-1].contentEditable?1:0)|(i<t.childNodes.length&&"false"==t.childNodes[i].contentEditable?2:0));if(e&&3!=e){let t=hw(n.node,n.offset,1==e?1:-1);t&&(n=new My(t,1==e?0:t.nodeValue.length))}}e.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=s.bidiLevel)}else if(e.extend)e.collapse(n.node,n.offset),e.extend(r.node,r.offset);else{let t=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),t.setEnd(r.node,r.offset),t.setStart(n.node,n.offset),e.removeAllRanges(),e.addRange(t)}var t,i}),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new My(l.anchorNode,l.anchorOffset),this.impreciseHead=r.precise?null:new My(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,t=ly(this.root);if(!e.empty||!e.assoc||!t.modify)return;let i=db.find(this,e.head);if(!i)return;let s=i.posAtStart;if(e.head==s||e.head==s+i.length)return;let n=this.coordsAt(e.head,-1),r=this.coordsAt(e.head,1);if(!n||!r||n.bottom>r.top)return;let o=this.domAtPos(e.head+e.assoc);t.collapse(o.node,o.offset),t.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Ob)?this.root.activeElement==this.dom:hy(this.dom,this.view.observer.selectionRange)}nearest(e){for(let t=e;t;){let e=Oy.get(t);if(e&&e.rootView==this)return e;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let e=this.children[t];if(i<e.length||e instanceof db)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(e>r||e==r&&n.type!=rb.WidgetBefore&&n.type!=rb.WidgetAfter&&(!s||2==t||this.children[s-1].breakAfter||this.children[s-1].type==rb.WidgetBefore&&t>-2))return n.coordsAt(e-r,t);i=r}}measureVisibleLineHeights(e){let t=[],{from:i,to:s}=e,n=this.view.contentDOM.clientWidth,r=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,l=this.view.textDirection==zb.LTR;for(let a=0,h=0;h<this.children.length;h++){let e=this.children[h],c=a+e.length;if(c>s)break;if(a>=i){let i=e.dom.getBoundingClientRect();if(t.push(i.height),r){let t=e.dom.lastChild,s=t?cy(t):[];if(s.length){let e=s[s.length-1],t=l?e.right-i.left:i.right-e.left;t>o&&(o=t,this.minWidth=n,this.minWidthFrom=a,this.minWidthTo=c)}}}a=c+e.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return"rtl"==getComputedStyle(this.children[t].dom).direction?zb.RTL:zb.LTR}measureTextSize(){for(let s of this.children)if(s instanceof db){let e=s.measureTextSize();if(e)return e}let e,t,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(i);let s=cy(i.firstChild)[0];e=i.getBoundingClientRect().height,t=s?s.width/27:7,i.remove()}),{lineHeight:e,charWidth:t}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new Dy(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,s=0;;s++){let n=s==t.viewports.length?null:t.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=t.lineBlockAt(r).bottom-t.lineBlockAt(i).top;e.push(ob.replace({widget:new ow(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return ob.set(e)}updateDeco(){let e=this.view.state.facet(Pb).map((e,t)=>(this.dynamicDecorationMap[t]="function"==typeof e)?e(this.view):e);for(let t=e.length;t<e.length+3;t++)this.dynamicDecorationMap[t]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let t,{range:i}=e,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(t=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,t.left),top:Math.min(s.top,t.top),right:Math.max(s.right,t.right),bottom:Math.max(s.bottom,t.bottom)});let n=0,r=0,o=0,l=0;for(let h of this.view.state.facet(Vb).map(e=>e(this.view)))if(h){let{left:e,right:t,top:i,bottom:s}=h;null!=e&&(n=Math.max(n,e)),null!=t&&(r=Math.max(r,t)),null!=i&&(o=Math.max(o,i)),null!=s&&(l=Math.max(l,s))}let a={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+l};!function(e,t,i,s,n,r,o,l){let a=e.ownerDocument,h=a.defaultView;for(let c=e;c;)if(1==c.nodeType){let e,u=c==a.body;if(u)e=vy(h);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let t=c.getBoundingClientRect();e={left:t.left,right:t.left+c.clientWidth,top:t.top,bottom:t.top+c.clientHeight}}let d=0,f=0;if("nearest"==n)t.top<e.top?(f=-(e.top-t.top+o),i>0&&t.bottom>e.bottom+f&&(f=t.bottom-e.bottom+f+o)):t.bottom>e.bottom&&(f=t.bottom-e.bottom+o,i<0&&t.top-f<e.top&&(f=-(e.top+f-t.top+o)));else{let s=t.bottom-t.top,r=e.bottom-e.top;f=("center"==n&&s<=r?t.top+s/2-r/2:"start"==n||"center"==n&&i<0?t.top-o:t.bottom-r+o)-e.top}if("nearest"==s?t.left<e.left?(d=-(e.left-t.left+r),i>0&&t.right>e.right+d&&(d=t.right-e.right+d+r)):t.right>e.right&&(d=t.right-e.right+r,i<0&&t.left<e.left+d&&(d=-(e.left+d-t.left+r))):d=("center"==s?t.left+(t.right-t.left)/2-(e.right-e.left)/2:"start"==s==l?t.left-r:t.right-(e.right-e.left)+r)-e.left,d||f)if(u)h.scrollBy(d,f);else{if(f){let e=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-e}if(d){let e=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-e}t={left:t.left-d,top:t.top-f,right:t.right-d,bottom:t.bottom-f}}if(u)break;c=c.assignedSlot||c.parentNode,s=n="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,a,i.head<i.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==zb.LTR)}}class ow extends nb{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function lw(e){let t=e.observer.selectionRange,i=t.focusNode&&hw(t.focusNode,t.focusOffset,0);if(!i)return null;let s=e.docView.nearest(i);if(!s)return null;if(s instanceof db){let e=i;for(;e.parentNode!=s.dom;)e=e.parentNode;let t=e.previousSibling;for(;t&&!Oy.get(t);)t=t.previousSibling;let n=t?Oy.get(t).posAtEnd:s.posAtStart;return{from:n,to:n,node:e,text:i}}{for(;;){let{parent:e}=s;if(!e)return null;if(e instanceof db)break;s=e}let e=s.posAtStart;return{from:e,to:e+s.length,node:s.dom,text:i}}}class aw extends nb{constructor(e,t,i){super(),this.top=e,this.text=t,this.topView=i}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Gy}}function hw(e,t,i){for(;;){if(3==e.nodeType)return e;if(1==e.nodeType&&t>0&&i<=0)t=py(e=e.childNodes[t-1]);else{if(!(1==e.nodeType&&t<e.childNodes.length&&i>=0))return null;e=e.childNodes[t],t=0}}}class cw{constructor(){this.changes=[]}compareRange(e,t){ub(e,t,this.changes)}comparePoint(e,t){ub(e,t,this.changes)}}function uw(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function dw(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function fw(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function pw(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function gw(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function mw(e,t,i){let s,n,r,o,l,a,h,c;for(let d=e.firstChild;d;d=d.nextSibling){let e=cy(d);for(let u=0;u<e.length;u++){let f=e[u];n&&fw(n,f)&&(f=pw(gw(f,n.bottom),n.top));let p=uw(t,f),g=dw(i,f);if(0==p&&0==g)return 3==d.nodeType?vw(d,t,i):mw(d,t,i);(!s||o>g||o==g&&r>p)&&(s=d,n=f,r=p,o=g),0==p?i>f.bottom&&(!h||h.bottom<f.bottom)?(l=d,h=f):i<f.top&&(!c||c.top>f.top)&&(a=d,c=f):h&&fw(h,f)?h=gw(h,f.bottom):c&&fw(c,f)&&(c=pw(c,f.top))}}if(h&&h.bottom>=i?(s=l,n=h):c&&c.top<=i&&(s=a,n=c),!s)return{node:e,offset:0};let u=Math.max(n.left,Math.min(n.right,t));return 3==s.nodeType?vw(s,u,i):r||"true"!=s.contentEditable?{node:e,offset:Array.prototype.indexOf.call(e.childNodes,s)+(t>=(n.left+n.right)/2?1:0)}:mw(s,u,i)}function vw(e,t,i){let s=e.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<s;l++){let s=ky(e,l,l+1).getClientRects();for(let a=0;a<s.length;a++){let h=s[a];if(h.top==h.bottom)continue;o||(o=t-h.left);let c=(h.top>i?h.top-i:i-h.bottom)-1;if(h.left-1<=t&&h.right+1>=t&&c<r){let i=t>=(h.left+h.right)/2,s=i;if(jy.chrome||jy.gecko){ky(e,l).getBoundingClientRect().left==h.right&&(s=!i)}if(c<=0)return{node:e,offset:l+(s?1:0)};n=l+(s?1:0),r=c}}}return{node:e,offset:n>-1?n:o>0?e.nodeValue.length:0}}function yw(e,{x:t,y:i},s,n=-1){var r;let o,l=e.contentDOM.getBoundingClientRect(),a=l.top+e.viewState.paddingTop,{docHeight:h}=e.viewState,c=i-a;if(c<0)return 0;if(c>h)return e.state.doc.length;for(let v=e.defaultLineHeight/2,y=!1;o=e.elementAtHeight(c),o.type!=rb.Text;)for(;c=n>0?o.bottom+v:o.top-v,!(c>=0&&c<=h);){if(y)return s?null:0;y=!0,n=-n}i=a+c;let u=o.from;if(u<e.viewport.from)return 0==e.viewport.from?0:s?null:bw(e,l,o,t,i);if(u>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:s?null:bw(e,l,o,t,i);let d=e.dom.ownerDocument,f=e.root.elementFromPoint?e.root:d,p=f.elementFromPoint(t,i);p&&!e.contentDOM.contains(p)&&(p=null),p||(t=Math.max(l.left+1,Math.min(l.right-1,t)),p=f.elementFromPoint(t,i),p&&!e.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=e.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(d.caretPositionFromPoint){let e=d.caretPositionFromPoint(t,i);e&&({offsetNode:g,offset:m}=e)}else if(d.caretRangeFromPoint){let e=d.caretRangeFromPoint(t,i);e&&(({startContainer:g,startOffset:m}=e),jy.safari&&function(e,t,i){let s;if(3!=e.nodeType||t!=(s=e.nodeValue.length))return!1;for(let n=e.nextSibling;n;n=n.nextSibling)if(1!=n.nodeType||"BR"!=n.nodeName)return!1;return ky(e,s-1,s).getBoundingClientRect().left>i}(g,m,t)&&(g=void 0))}if(!g||!e.docView.dom.contains(g)){let s=db.find(e.docView,u);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=mw(s.dom,t,i))}return e.docView.posFromDOM(g,m)}function bw(e,t,i,s,n){let r=Math.round((s-t.left)*e.defaultCharacterWidth);if(e.lineWrapping&&i.height>1.5*e.defaultLineHeight){r+=Math.floor((n-i.top)/e.defaultLineHeight)*e.viewState.heightOracle.lineLength}let o=e.state.sliceDoc(i.from,i.to);return i.from+function(e,t,i){for(let s=0,n=0;;){if(n>=t)return s;if(s==e.length)break;n+=9==e.charCodeAt(s)?i-n%i:1,s=Pm(e,s)}return e.length}(o,r,e.state.tabSize)}function ww(e,t,i,s){let n=e.state.doc.lineAt(t.head),r=e.bidiSpans(n),o=e.textDirectionAt(n.from);for(let l=t,a=null;;){let t=ew(n,r,o,l,i),h=Zb;if(!t){if(n.number==(i?e.state.doc.lines:1))return l;h="\n",n=e.state.doc.line(n.number+(i?1:-1)),r=e.bidiSpans(n),t=Zm.cursor(i?n.from:n.to)}if(a){if(!a(h))return l}else{if(!s)return t;a=s(h)}l=t}}function xw(e,t,i){let s=e.state.facet(Nb).map(t=>t(e));for(;;){let e=!1;for(let n of s)n.between(i.from-1,i.from+1,(s,n,r)=>{i.from>s&&i.from<n&&(i=t.from>i.from?Zm.cursor(s,1):Zm.cursor(n,-1),e=!0)});if(!e)return i}}class kw{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let t in Ow){let i=Ow[t];e.contentDOM.addEventListener(t,s=>{Aw(e,s)&&!this.ignoreDuringComposition(s)&&("keydown"==t&&this.keydown(e,s)||(this.mustFlushObserver(s)&&e.observer.forceFlush(),this.runCustomHandlers(t,e,s)?s.preventDefault():i(e,s)))}),this.registeredEvents.push(t)}jy.chrome&&jy.chrome_version>=102&&e.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=e.hasFocus,jy.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,t){var i;let s;this.customHandlers=[];for(let n of t)if(s=null===(i=n.update(e).spec)||void 0===i?void 0:i.domEventHandlers){this.customHandlers.push({plugin:n.value,handlers:s});for(let t in s)this.registeredEvents.indexOf(t)<0&&"scroll"!=t&&(this.registeredEvents.push(t),e.contentDOM.addEventListener(t,i=>{Aw(e,i)&&this.runCustomHandlers(t,e,i)&&i.preventDefault()}))}}runCustomHandlers(e,t,i){for(let n of this.customHandlers){let r=n.handlers[e];if(r)try{if(r.call(n.plugin,i,t)||i.defaultPrevented)return!0}catch(s){Ab(t.state,s)}}return!1}runScrollHandlers(e,t){for(let s of this.customHandlers){let n=s.handlers.scroll;if(n)try{n.call(s.plugin,t,e)}catch(i){Ab(e.state,i)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),9==t.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(jy.android&&jy.chrome&&!t.synthetic&&(13==t.keyCode||8==t.keyCode))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let i;return!(!jy.ios||!(i=Sw.find(e=>e.keyCode==t.keyCode))||t.ctrlKey||t.altKey||t.metaKey||t.synthetic)&&(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(e),250),!0)}flushIOSKey(e){let t=this.pendingIOSKey;return!!t&&(this.pendingIOSKey=void 0,Sy(e.contentDOM,t.key,t.keyCode))}ignoreDuringComposition(e){return!!/^key/.test(e.type)&&(this.composing>0||!!(jy.safari&&Date.now()-this.compositionEndedAt<100)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(e){return"keydown"==e.type&&229!=e.keyCode||"compositionend"==e.type&&!jy.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Sw=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Cw=[16,17,18,20,91,92,224,225];class Mw{constructor(e,t,i,s){this.view=e,this.style=i,this.mustSelect=s,this.lastEvent=t;let n=e.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(qv.allowMultipleSelections)&&function(e,t){let i=e.state.facet(vb);return i.length?i[0](t):jy.mac?t.metaKey:t.ctrlKey}(e,t),this.dragMove=function(e,t){let i=e.state.facet(yb);return i.length?i[0](t):jy.mac?!t.altKey:!t.ctrlKey}(e,t),this.dragging=!(!function(e,t){let{main:i}=e.state.selection;if(i.empty)return!1;let s=ly(e.root);if(0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let e=n[r];if(e.left<=t.clientX&&e.right>=t.clientX&&e.top<=t.clientY&&e.bottom>=t.clientY)return!0}return!1}(e,t)||1!=zw(t))&&null,!1===this.dragging&&(t.preventDefault(),this.select(t))}move(e){if(0==e.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=e)}up(e){null==this.dragging&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let t=this.style.get(e,this.extend,this.multiple);!this.mustSelect&&t.eq(this.view.state.selection)&&t.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function Aw(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let i,s=t.target;s!=e.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=Oy.get(s))&&i.ignoreEvent(t))return!1;return!0}const Ow=Object.create(null),Tw=jy.ie&&jy.ie_version<15||jy.ios&&jy.webkit_version<604;function Dw(e,t){let i,{state:s}=e,n=1,r=s.toText(t),o=r.lines==s.selection.ranges.length;if(null!=$w&&s.selection.ranges.every(e=>e.empty)&&$w==r.toString()){let e=-1;i=s.changeByRange(i=>{let l=s.doc.lineAt(i.from);if(l.from==e)return{range:i};e=l.from;let a=s.toText((o?r.line(n++).text:t)+s.lineBreak);return{changes:{from:l.from,insert:a},range:Zm.cursor(i.from+a.length)}})}else i=o?s.changeByRange(e=>{let t=r.line(n++);return{changes:{from:e.from,to:e.to,insert:t.text},range:Zm.cursor(e.from+t.length)}}):s.replaceSelection(r);e.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Ow.keydown=(e,t)=>{e.inputState.setSelectionOrigin("select"),27==t.keyCode?e.inputState.lastEscPress=Date.now():Cw.indexOf(t.keyCode)<0&&(e.inputState.lastEscPress=0)};let Ew=0;function Rw(e,t,i,s){if(1==s)return Zm.cursor(t,i);if(2==s)return function(e,t,i=1){let s=e.charCategorizer(t),n=e.doc.lineAt(t),r=t-n.from;if(0==n.length)return Zm.cursor(t);0==r?i=1:r==n.length&&(i=-1);let o=r,l=r;i<0?o=Pm(n.text,r,!1):l=Pm(n.text,r);let a=s(n.text.slice(o,l));for(;o>0;){let e=Pm(n.text,o,!1);if(s(n.text.slice(e,o))!=a)break;o=e}for(;l<n.length;){let e=Pm(n.text,l);if(s(n.text.slice(l,e))!=a)break;l=e}return Zm.range(o+n.from,l+n.from)}(e.state,t,i);{let i=db.find(e.docView,t),s=e.state.doc.lineAt(i?i.posAtEnd:t),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<e.state.doc.length&&r==s.to&&r++,Zm.range(n,r)}}Ow.touchstart=(e,t)=>{Ew=Date.now(),e.inputState.setSelectionOrigin("select.pointer")},Ow.touchmove=e=>{e.inputState.setSelectionOrigin("select.pointer")},Ow.mousedown=(e,t)=>{if(e.observer.flush(),Ew>Date.now()-2e3&&1==zw(t))return;let i=null;for(let s of e.state.facet(bb))if(i=s(e,t),i)break;if(i||0!=t.button||(i=function(e,t){let i=Nw(e,t),s=zw(t),n=e.state.selection,r=i,o=t;return{update(e){e.docChanged&&(i&&(i.pos=e.changes.mapPos(i.pos)),n=n.map(e.changes),o=null)},get(t,l,a){let h;if(o&&t.clientX==o.clientX&&t.clientY==o.clientY?h=r:(h=r=Nw(e,t),o=t),!h||!i)return n;let c=Rw(e,h.pos,h.bias,s);if(i.pos!=h.pos&&!l){let t=Rw(e,i.pos,i.bias,s),n=Math.min(t.from,c.from),r=Math.max(t.to,c.to);c=n<c.from?Zm.range(n,r):Zm.range(r,n)}return l?n.replaceRange(n.main.extend(c.from,c.to)):a?n.addRange(c):Zm.create([c])}}}(e,t)),i){let s=e.root.activeElement!=e.contentDOM;s&&e.observer.ignore(()=>xy(e.contentDOM)),e.inputState.startMouseSelection(new Mw(e,t,i,s))}};let Lw=(e,t)=>e>=t.top&&e<=t.bottom,Bw=(e,t,i)=>Lw(t,i)&&e>=i.left&&e<=i.right;function Pw(e,t,i,s){let n=db.find(e.docView,t);if(!n)return 1;let r=t-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&Bw(i,s,o))return-1;let l=n.coordsAt(r,1);return l&&Bw(i,s,l)?1:o&&Lw(s,o)?-1:1}function Nw(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:i,bias:Pw(e,i,t.clientX,t.clientY)}}const Vw=jy.ie&&jy.ie_version<=11;let Iw=null,Hw=0,Fw=0;function zw(e){if(!Vw)return e.detail;let t=Iw,i=Fw;return Iw=e,Fw=Date.now(),Hw=!t||i>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(Hw+1)%3:1}function Ww(e,t,i,s){if(!i)return;let n=e.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:r}=e.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:n,insert:i},a=e.state.changes(o?[o,l]:l);e.focus(),e.dispatch({changes:a,selection:{anchor:a.mapPos(n,-1),head:a.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}Ow.dragstart=(e,t)=>{let{selection:{main:i}}=e.state,{mouseSelection:s}=e.inputState;s&&(s.dragging=i),t.dataTransfer&&(t.dataTransfer.setData("Text",e.state.sliceDoc(i.from,i.to)),t.dataTransfer.effectAllowed="copyMove")},Ow.drop=(e,t)=>{if(!t.dataTransfer)return;if(e.state.readOnly)return t.preventDefault();let i=t.dataTransfer.files;if(i&&i.length){t.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&Ww(e,t,s.filter(e=>null!=e).join(e.state.lineBreak),!1)};for(let e=0;e<i.length;e++){let t=new FileReader;t.onerror=r,t.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(t.result)||(s[e]=t.result),r()},t.readAsText(i[e])}}else Ww(e,t,t.dataTransfer.getData("Text"),!0)},Ow.paste=(e,t)=>{if(e.state.readOnly)return t.preventDefault();e.observer.flush();let i=Tw?null:t.clipboardData;i?(Dw(e,i.getData("text/plain")),t.preventDefault()):function(e){let t=e.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout(()=>{e.focus(),i.remove(),Dw(e,i.value)},50)}(e)};let $w=null;function jw(e){setTimeout(()=>{e.hasFocus!=e.inputState.notifiedFocused&&e.update([])},10)}function qw(e,t){if(e.docView.compositionDeco.size){e.inputState.rapidCompositionStart=t;try{e.update([])}finally{e.inputState.rapidCompositionStart=!1}}}Ow.copy=Ow.cut=(e,t)=>{let{text:i,ranges:s,linewise:n}=function(e){let t=[],i=[],s=!1;for(let n of e.selection.ranges)n.empty||(t.push(e.sliceDoc(n.from,n.to)),i.push(n));if(!t.length){let n=-1;for(let{from:s}of e.selection.ranges){let r=e.doc.lineAt(s);r.number>n&&(t.push(r.text),i.push({from:r.from,to:Math.min(e.doc.length,r.to+1)})),n=r.number}s=!0}return{text:t.join(e.lineBreak),ranges:i,linewise:s}}(e.state);if(!i&&!n)return;$w=n?i:null;let r=Tw?null:t.clipboardData;r?(t.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(e,t){let i=e.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=t,s.focus(),s.selectionEnd=t.length,s.selectionStart=0,setTimeout(()=>{s.remove(),e.focus()},50)}(e,i),"cut"!=t.type||e.state.readOnly||e.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},Ow.focus=jw,Ow.blur=e=>{e.observer.clearSelectionRange(),jw(e)},Ow.compositionstart=Ow.compositionupdate=e=>{null==e.inputState.compositionFirstChange&&(e.inputState.compositionFirstChange=!0),e.inputState.composing<0&&(e.inputState.composing=0,e.docView.compositionDeco.size&&(e.observer.flush(),qw(e,!0)))},Ow.compositionend=e=>{e.inputState.composing=-1,e.inputState.compositionEndedAt=Date.now(),e.inputState.compositionFirstChange=null,setTimeout(()=>{e.inputState.composing<0&&qw(e,!1)},50)},Ow.contextmenu=e=>{e.inputState.lastContextMenu=Date.now()},Ow.beforeinput=(e,t)=>{var i;let s;if(jy.chrome&&jy.android&&(s=Sw.find(e=>e.inputType==t.inputType))&&(e.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let t=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout(()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>t+10&&e.hasFocus&&(e.contentDOM.blur(),e.focus())},100)}};const _w=["pre-wrap","normal","pre-line","break-spaces"];class Kw{constructor(){this.doc=km.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(e){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return _w.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let s=e[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(t=!0,this.heightSamples[Math.floor(10*s)]=!0)}return t}refresh(e,t,i,s,n){let r=_w.indexOf(e)>-1,o=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=r;if(this.lineWrapping=r,this.lineHeight=t,this.charWidth=i,this.lineLength=s,o){this.heightSamples={};for(let e=0;e<n.length;e++){let t=n[e];t<0?e++:this.heightSamples[Math.floor(10*t)]=!0}}return o}}class Uw{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Gw{constructor(e,t,i,s,n){this.from=e,this.length=t,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new Gw(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var Jw=function(e){return e[e.ByPos=0]="ByPos",e[e.ByHeight=1]="ByHeight",e[e.ByPosNoHeight=2]="ByPosNoHeight",e}(Jw||(Jw={}));const Yw=.001;class Xw{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(e){this.flags=(e?2:0)|-3&this.flags}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>Yw&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return Xw.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:l,fromB:a,toB:h}=s[r],c=n.lineAt(o,Jw.ByPosNoHeight,t,0,0),u=c.to>=l?c:n.lineAt(l,Jw.ByPosNoHeight,t,0,0);for(h+=u.to-l,l=u.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,a=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,Jw.ByPosNoHeight,t,0,0));a+=c.from-o,o=c.from;let d=sx.build(i,e,a,h);n=n.replace(o,l,d)}return n.updateHeight(i,0)}static empty(){return new Zw(0,0)}static of(e){if(1==e.length)return e[0];let t=0,i=e.length,s=0,n=0;for(;;)if(t==i)if(s>2*n){let n=e[t-1];n.break?e.splice(--t,1,n.left,null,n.right):e.splice(--t,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let t=e[i];t.break?e.splice(i,1,t.left,null,t.right):e.splice(i,1,t.left,t.right),i+=2+t.break,n-=t.size}}else if(s<n){let i=e[t++];i&&(s+=i.size)}else{let t=e[--i];t&&(n+=t.size)}let r=0;return null==e[t-1]?(r=1,t--):null==e[t]&&(r=1,i++),new tx(Xw.of(e.slice(0,t)),r,Xw.of(e.slice(i)))}}Xw.prototype.size=1;class Qw extends Xw{constructor(e,t,i){super(e,t),this.type=i}blockAt(e,t,i,s){return new Gw(s,this.length,i,this.height,this.type)}lineAt(e,t,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(e,t,i,s,n,r){e<=n+this.length&&t>=n&&r(this.blockAt(0,i,s,n))}updateHeight(e,t=0,i=!1,s){return s&&s.from<=t&&s.more&&this.setHeight(e,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Zw extends Qw{constructor(e,t){super(e,t,rb.Text),this.collapsed=0,this.widgetHeight=0}replace(e,t,i){let s=i[0];return 1==i.length&&(s instanceof Zw||s instanceof ex&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof ex?s=new Zw(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):Xw.of(i)}updateHeight(e,t=0,i=!1,s){return s&&s.from<=t&&s.more?this.setHeight(e,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ex extends Xw{constructor(e){super(e,0)}lines(e,t){let i=e.lineAt(t).number,s=e.lineAt(t+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(e,t,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(t,s),l=Math.max(0,Math.min(r-n,Math.floor((e-i)/o))),{from:a,length:h}=t.line(n+l);return new Gw(a,h,i+o*l,o,rb.Text)}lineAt(e,t,i,s,n){if(t==Jw.ByHeight)return this.blockAt(e,i,s,n);if(t==Jw.ByPosNoHeight){let{from:t,to:s}=i.lineAt(e);return new Gw(t,s-t,0,0,rb.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:l,length:a,number:h}=i.lineAt(e);return new Gw(l,a,s+o*(h-r),o,rb.Text)}forEachLine(e,t,i,s,n,r){let{firstLine:o,lineHeight:l}=this.lines(i,n);for(let a=Math.max(e,n),h=Math.min(n+this.length,t);a<=h;){let t=i.lineAt(a);a==e&&(s+=l*(t.number-o)),r(new Gw(t.from,t.length,s,l,rb.Text)),s+=l,a=t.to+1}}replace(e,t,i){let s=this.length-t;if(s>0){let e=i[i.length-1];e instanceof ex?i[i.length-1]=new ex(e.length+s):i.push(null,new ex(s-1))}if(e>0){let t=i[0];t instanceof ex?i[0]=new ex(e+t.length):i.unshift(new ex(e-1),null)}return Xw.of(i)}decomposeLeft(e,t){t.push(new ex(e-1),null)}decomposeRight(e,t){t.push(null,new ex(this.length-e-1))}updateHeight(e,t=0,i=!1,s){let n=t+this.length;if(s&&s.from<=t+this.length&&s.more){let i=[],r=Math.max(t,s.from),o=-1,l=e.heightChanged;for(s.from>t&&i.push(new ex(s.from-t-1).updateHeight(e,t));r<=n&&s.more;){let t=e.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=Yw&&(o=-2);let l=new Zw(t,n);l.outdated=!1,i.push(l),r+=t+1}r<=n&&i.push(null,new ex(n-r).updateHeight(e,r));let a=Xw.of(i);return e.heightChanged=l||o<0||Math.abs(a.height-this.height)>=Yw||Math.abs(o-this.lines(e.doc,t).lineHeight)>=Yw,a}return(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class tx extends Xw{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return 1&this.flags}blockAt(e,t,i,s){let n=i+this.left.height;return e<n?this.left.blockAt(e,t,i,s):this.right.blockAt(e,t,n,s+this.left.length+this.break)}lineAt(e,t,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,l=t==Jw.ByHeight?e<r:e<o,a=l?this.left.lineAt(e,t,i,s,n):this.right.lineAt(e,t,i,r,o);if(this.break||(l?a.to<o:a.from>o))return a;let h=t==Jw.ByPosNoHeight?Jw.ByPosNoHeight:Jw.ByPos;return l?a.join(this.right.lineAt(o,h,i,r,o)):this.left.lineAt(o,h,i,s,n).join(a)}forEachLine(e,t,i,s,n,r){let o=s+this.left.height,l=n+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,t,i,s,n,r),t>=l&&this.right.forEachLine(e,t,i,o,l,r);else{let a=this.lineAt(l,Jw.ByPos,i,s,n);e<a.from&&this.left.forEachLine(e,a.from-1,i,s,n,r),a.to>=e&&a.from<=t&&r(a),t>a.to&&this.right.forEachLine(a.to+1,t,i,o,l,r)}}replace(e,t,i){let s=this.left.length+this.break;if(t<s)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,t-s,i));let n=[];e>0&&this.decomposeLeft(e,n);let r=n.length;for(let o of i)n.push(o);if(e>0&&ix(n,r-1),t<this.length){let e=n.length;this.decomposeRight(t,n),ix(n,e)}return Xw.of(n)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,s=i+this.break;if(e>=s)return this.right.decomposeRight(e-s,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<s&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Xw.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,s){let{left:n,right:r}=this,o=t+n.length+this.break,l=null;return s&&s.from<=t+n.length&&s.more?l=n=n.updateHeight(e,t,i,s):n.updateHeight(e,t,i),s&&s.from<=o+r.length&&s.more?l=r=r.updateHeight(e,o,i,s):r.updateHeight(e,o,i),l?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function ix(e,t){let i,s;null==e[t]&&(i=e[t-1])instanceof ex&&(s=e[t+1])instanceof ex&&e.splice(t-1,3,new ex(i.length+1+s.length))}class sx{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let e=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof Zw?i.length+=e-this.pos:(e>this.pos||!this.isCovered)&&this.nodes.push(new Zw(e-this.pos,-1)),this.writtenTo=e,t>e&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=t-e;i.block?this.addBlock(new Qw(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Zw(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new ex(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Zw)return e;let t=new Zw(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine(),e.type!=rb.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=rb.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let i=this.ensureLine();i.length+=t,i.collapsed+=t,i.widgetHeight=Math.max(i.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||t instanceof Zw||this.isCovered?(this.writtenTo<this.pos||null==t)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new Zw(0,-1));let i=e;for(let s of this.nodes)s instanceof Zw&&s.updateHeight(this.oracle,i),i+=s?s.length:1;return this.nodes}static build(e,t,i,s){let n=new sx(i,e);return Jv.spans(t,i,s,n,0),n.finish(i)}}class nx{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,s){(e<t||i&&i.heightRelevant||s&&s.heightRelevant)&&ub(e,t,this.changes,5)}}function rx(e,t){let i=e.getBoundingClientRect(),s=Math.max(0,i.left),n=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),l=e.ownerDocument.body;for(let a=e.parentNode;a&&a!=l;)if(1==a.nodeType){let e=a,t=window.getComputedStyle(e);if((e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)&&"visible"!=t.overflow){let t=e.getBoundingClientRect();s=Math.max(s,t.left),n=Math.min(n,t.right),r=Math.max(r,t.top),o=Math.min(o,t.bottom)}a="absolute"==t.position||"fixed"==t.position?e.offsetParent:e.parentNode}else{if(11!=a.nodeType)break;a=a.host}return{left:s-i.left,right:Math.max(s,n)-i.left,top:r-(i.top+t),bottom:Math.max(r,o)-(i.top+t)}}function ox(e,t){let i=e.getBoundingClientRect();return{left:0,right:i.right-i.left,top:t,bottom:i.bottom-(i.top+t)}}class lx{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let s=e[i],n=t[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(e){return ob.replace({widget:new ax(this.size,e)}).range(this.from,this.to)}}class ax extends nb{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class hx{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Kw,this.scaler=mx,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=zb.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=e.facet(Pb).filter(e=>"function"!=typeof e),this.heightMap=Xw.empty().applyChanges(this.stateDeco,km.empty,this.heightOracle.setDoc(e.doc),[new Hb(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ob.set(this.lineGaps.map(e=>e.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let s=i?t.head:t.anchor;if(!e.some(({from:e,to:t})=>s>=e&&s<=t)){let{from:t,to:i}=this.lineBlockAt(s);e.push(new cx(t,i))}}this.viewports=e.sort((e,t)=>e.from-t.from),this.scaler=this.heightMap.height<=7e6?mx:new vx(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(1==this.scaler.scale?e:yx(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Pb).filter(e=>"function"!=typeof e);let s=e.changedRanges,n=Hb.extendWithRanges(s,function(e,t,i){let s=new nx;return Jv.compare(e,t,i,s,0),s.changes}(i,this.stateDeco,e?e.changes:_m.empty(this.state.doc.length))),r=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),n),this.heightMap.height!=r&&(e.flags|=2);let o=n.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<o.from||t.range.head>o.to)||!this.viewportIsAppropriate(o))&&(o=this.getViewport(0,t));let l=!e.changes.empty||2&e.flags||o.from!=this.viewport.from||o.to!=this.viewport.to;this.viewport=o,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),s=this.heightOracle,n=i.whiteSpace;this.defaultTextDirection="rtl"==i.direction?zb.RTL:zb.LTR;let r=this.heightOracle.mustRefreshForWrapping(n),o=r||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight;this.contentDOMHeight=t.clientHeight,this.mustMeasureContent=!1;let l=0,a=0,h=parseInt(i.paddingTop)||0,c=parseInt(i.paddingBottom)||0;this.paddingTop==h&&this.paddingBottom==c||(this.paddingTop=h,this.paddingBottom=c,l|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(o=!0),this.editorWidth=e.scrollDOM.clientWidth,l|=8);let u=(this.printing?ox:rx)(t,this.paddingTop),d=u.top-this.pixelViewport.top,f=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let p=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(p!=this.inView&&(this.inView=p,p&&(o=!0)),!this.inView)return 0;let g=t.clientWidth;if(this.contentDOMWidth==g&&this.editorHeight==e.scrollDOM.clientHeight||(this.contentDOMWidth=g,this.editorHeight=e.scrollDOM.clientHeight,l|=8),o){let t=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(t)&&(r=!0),r||s.lineWrapping&&Math.abs(g-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:o}=e.docView.measureTextSize();r=s.refresh(n,i,o,g/o,t),r&&(e.docView.minWidth=0,l|=8)}d>0&&f>0?a=Math.max(d,f):d<0&&f<0&&(a=Math.min(d,f)),s.heightChanged=!1;for(let i of this.viewports){let n=i.from==this.viewport.from?t:e.docView.measureVisibleLineHeights(i);this.heightMap=this.heightMap.updateHeight(s,0,r,new Uw(i.from,n))}s.heightChanged&&(l|=2)}let m=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return m&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(2&l||m)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(r?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,l=new cx(s.lineAt(r-1e3*i,Jw.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),Jw.ByHeight,n,0,0).to);if(t){let{head:e}=t.range;if(e<l.from||e>l.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(e,Jw.ByPos,n,0,0);i="center"==t.y?(o.top+o.bottom)/2-r/2:"start"==t.y||"nearest"==t.y&&e<l.from?o.top:o.bottom-r,l=new cx(s.lineAt(i-500,Jw.ByHeight,n,0,0).from,s.lineAt(i+r+500,Jw.ByHeight,n,0,0).to)}}return l}mapViewport(e,t){let i=t.mapPos(e.from,-1),s=t.mapPos(e.to,1);return new cx(this.heightMap.lineAt(i,Jw.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,Jw.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,Jw.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(t,Jw.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==e||s<=r-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let s of e)t.touchesRange(s.from,s.to)||i.push(new lx(t.mapPos(s.from),t.mapPos(s.to),s.size));return i}ensureLineGaps(e){let t=[];if(this.defaultTextDirection!=zb.LTR)return t;for(let i of this.viewportLines){if(i.length<4e3)continue;let s,n,r=ux(i.from,i.to,this.stateDeco);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let e=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=dx(r,(this.visibleTop-i.top-e)/i.height),n=dx(r,(this.visibleBottom-i.top+e)/i.height)}else{let e=r.total*this.heightOracle.charWidth,t=2e3*this.heightOracle.charWidth;s=dx(r,(this.pixelViewport.left-t)/e),n=dx(r,(this.pixelViewport.right+t)/e)}let o=[];s>i.from&&o.push({from:i.from,to:s}),n<i.to&&o.push({from:n,to:i.to});let l=this.state.selection.main;l.from>=i.from&&l.from<=i.to&&px(o,l.from-10,l.from+10),!l.empty&&l.to>=i.from&&l.to<=i.to&&px(o,l.to-10,l.to+10);for(let{from:a,to:h}of o)h-a>1e3&&t.push(gx(e,e=>e.from>=i.from&&e.to<=i.to&&Math.abs(e.from-a)<1e3&&Math.abs(e.to-h)<1e3)||new lx(a,h,this.gapSize(i,a,h,r)))}return t}gapSize(e,t,i,s){let n=fx(s,i)-fx(s,t);return this.heightOracle.lineWrapping?e.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(e){lx.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ob.set(e.map(e=>e.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];Jv.spans(e,this.viewport.from,this.viewport.to,{span(e,i){t.push({from:e,to:i})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some((e,i)=>e.from!=t[i].from||e.to!=t[i].to);return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||yx(this.heightMap.lineAt(e,Jw.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return yx(this.heightMap.lineAt(this.scaler.fromDOM(e),Jw.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return yx(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class cx{constructor(e,t){this.from=e,this.to=t}}function ux(e,t,i){let s=[],n=e,r=0;return Jv.spans(i,e,t,{span(){},point(e,t){e>n&&(s.push({from:n,to:e}),r+=e-n),n=t}},20),n<t&&(s.push({from:n,to:t}),r+=t-n),{total:r,ranges:s}}function dx({total:e,ranges:t},i){if(i<=0)return t[0].from;if(i>=1)return t[t.length-1].to;let s=Math.floor(e*i);for(let n=0;;n++){let{from:e,to:i}=t[n],r=i-e;if(s<=r)return e+s;s-=r}}function fx(e,t){let i=0;for(let{from:s,to:n}of e.ranges){if(t<=n){i+=t-s;break}i+=n-s}return i/e.total}function px(e,t,i){for(let s=0;s<e.length;s++){let n=e[s];if(n.from<i&&n.to>t){let r=[];n.from<t&&r.push({from:n.from,to:t}),n.to>i&&r.push({from:i,to:n.to}),e.splice(s,1,...r),s+=r.length-1}}}function gx(e,t){for(let i of e)if(t(i))return i}const mx={toDOM:e=>e,fromDOM:e=>e,scale:1};class vx{constructor(e,t,i){let s=0,n=0,r=0;this.viewports=i.map(({from:i,to:n})=>{let r=t.lineAt(i,Jw.ByPos,e,0,0).top,o=t.lineAt(n,Jw.ByPos,e,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(t.height-s);for(let o of this.viewports)o.domTop=r+(o.top-n)*this.scale,r=o.domBottom=o.domTop+(o.bottom-o.top),n=o.bottom}toDOM(e){for(let t=0,i=0,s=0;;t++){let n=t<this.viewports.length?this.viewports[t]:null;if(!n||e<n.top)return s+(e-i)*this.scale;if(e<=n.bottom)return n.domTop+(e-n.top);i=n.bottom,s=n.domBottom}}fromDOM(e){for(let t=0,i=0,s=0;;t++){let n=t<this.viewports.length?this.viewports[t]:null;if(!n||e<n.domTop)return i+(e-s)/this.scale;if(e<=n.domBottom)return n.top+(e-n.domTop);i=n.bottom,s=n.domBottom}}}function yx(e,t){if(1==t.scale)return e;let i=t.toDOM(e.top),s=t.toDOM(e.bottom);return new Gw(e.from,e.length,i,s-i,Array.isArray(e.type)?e.type.map(e=>yx(e,t)):e.type)}const bx=iv.define({combine:e=>e.join(" ")}),wx=iv.define({combine:e=>e.indexOf(!0)>-1}),xx=Nl.newName(),kx=Nl.newName(),Sx=Nl.newName(),Cx={"&light":"."+kx,"&dark":"."+Sx};function Mx(e,t,i){return new Nl(t,{finish:t=>/&/.test(t)?t.replace(/&\w*/,t=>{if("&"==t)return e;if(!i||!i[t])throw new RangeError(`Unsupported selector: ${t}`);return i[t]}):e+" "+t})}const Ax=Mx("."+xx,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Cx),Ox={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Tx=jy.ie&&jy.ie_version<=11;class Dx{constructor(e,t,i){this.view=e,this.onChange=t,this.onScrollChanged=i,this.active=!1,this.selectionRange=new yy,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let e of t)this.queue.push(e);(jy.ie&&jy.ie_version<=11||jy.ios&&e.composing)&&t.some(e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length)?this.flushSoon():this.flush()}),Tx&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(e.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver(e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:t}=this,i=this.selectionRange;if(t.state.facet(Ob)?t.root.activeElement!=this.dom:!hy(t.dom,i))return;let s=i.anchorNode&&t.docView.nearest(i.anchorNode);s&&s.ignoreEvent(e)||((jy.ie&&jy.ie_version<=11||jy.android&&jy.chrome)&&!t.state.selection.main.empty&&i.focusNode&&uy(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,t=ly(e),i=jy.safari&&11==e.nodeType&&function(){let e=document.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}()==this.view.contentDOM&&function(e){let t=null;function i(e){e.preventDefault(),e.stopImmediatePropagation(),t=e.getTargetRanges()[0]}if(e.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),e.contentDOM.removeEventListener("beforeinput",i,!0),!t)return null;let s=t.startContainer,n=t.startOffset,r=t.endContainer,o=t.endOffset,l=e.docView.domAtPos(e.state.selection.main.anchor);uy(l.node,l.offset,r,o)&&([s,n,r,o]=[r,o,s,n]);return{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||t;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(1==i.nodeType)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);for(let e of this.scrollTargets=t)e.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Ox),Tx&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Tx&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){this.delayedAndroidKey||requestAnimationFrame(()=>{let e=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||Sy(this.view.contentDOM,e.key,e.keyCode)}),this.delayedAndroidKey&&"Enter"!=e||(this.delayedAndroidKey={key:e,keyCode:t})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let n of this.observer.takeRecords())e.push(n);e.length&&(this.queue=[]);let t=-1,i=-1,s=!1;for(let n of e){let e=this.readMutation(n);e&&(e.typeOver&&(s=!0),-1==t?({from:t,to:i}=e):(t=Math.min(e.from,t),i=Math.max(e.to,i)))}return{from:t,to:i,typeOver:s}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:t,to:i,typeOver:s}=this.processRecords(),n=this.selectionChanged&&hy(this.dom,this.selectionRange);if(t<0&&!n)return;this.selectionChanged=!1;let r=this.view.state,o=this.onChange(t,i,s);return this.view.state==r&&this.view.update([]),o}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty("attributes"==e.type),"attributes"==e.type&&(t.dirty|=4),"childList"==e.type){let i=Ex(t,e.previousSibling||e.target.previousSibling,-1),s=Ex(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:s?t.posBefore(s):t.posAtEnd,typeOver:!1}}return"characterData"==e.type?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,t,i;this.stop(),null===(e=this.intersection)||void 0===e||e.disconnect(),null===(t=this.gapIntersection)||void 0===t||t.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Ex(e,t,i){for(;t;){let s=Oy.get(t);if(s&&s.parent==e)return s;let n=t.parentNode;t=n!=e.dom?n:i>0?t.nextSibling:t.previousSibling}return null}function Rx(e,t,i,s){let n,r,o=e.state.selection.main;if(t>-1){let s=e.docView.domBoundsAround(t,i,0);if(!s||e.state.readOnly)return!1;let{from:l,to:a}=s,h=e.docView.impreciseHead||e.docView.impreciseAnchor?[]:function(e){let t=[];if(e.root.activeElement!=e.contentDOM)return t;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=e.observer.selectionRange;i&&(t.push(new nw(i,s)),n==i&&r==s||t.push(new nw(n,r)));return t}(e),c=new iw(h,e.state);c.readRange(s.startDOM,s.endDOM);let u=o.from,d=null;(8===e.inputState.lastKeyCode&&e.inputState.lastKeyTime>Date.now()-100||jy.android&&c.text.length<a-l)&&(u=o.to,d="end");let f=function(e,t,i,s){let n=Math.min(e.length,t.length),r=0;for(;r<n&&e.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==n&&e.length==t.length)return null;let o=e.length,l=t.length;for(;o>0&&l>0&&e.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if("end"==s){i-=o+Math.max(0,r-Math.min(o,l))-r}if(o<r&&e.length<t.length){r-=i<=r&&i>=o?r-i:0,l=r+(l-o),o=r}else if(l<r){r-=i<=r&&i>=l?r-i:0,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}(e.state.doc.sliceString(l,a,tw),c.text,u-l,d);f&&(jy.chrome&&13==e.inputState.lastKeyCode&&f.toB==f.from+2&&c.text.slice(f.from,f.toB)==tw+tw&&f.toB--,n={from:l+f.from,to:l+f.toA,insert:km.of(c.text.slice(f.from,f.toB).split(tw))}),r=function(e,t){if(0==e.length)return null;let i=e[0].pos,s=2==e.length?e[1].pos:i;return i>-1&&s>-1?Zm.single(i+t,s+t):null}(h,l)}else if(e.hasFocus||!e.state.facet(Ob)){let t=e.observer.selectionRange,{impreciseHead:i,impreciseAnchor:s}=e.docView,n=i&&i.node==t.focusNode&&i.offset==t.focusOffset||!ay(e.contentDOM,t.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(t.focusNode,t.focusOffset),l=s&&s.node==t.anchorNode&&s.offset==t.anchorOffset||!ay(e.contentDOM,t.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(t.anchorNode,t.anchorOffset);n==o.head&&l==o.anchor||(r=Zm.single(l,n))}if(!n&&!r)return!1;if(!n&&s&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:e.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4?n={from:o.from,to:o.to,insert:e.state.doc.slice(o.from,n.from).append(n.insert).append(e.state.doc.slice(n.to,o.to))}:(jy.mac||jy.android)&&n&&n.from==n.to&&n.from==o.head-1&&"."==n.insert.toString()&&(n={from:o.from,to:o.to,insert:km.of([" "])}),n){let t=e.state;if(jy.ios&&e.inputState.flushIOSKey(e))return!0;if(jy.android&&(n.from==o.from&&n.to==o.to&&1==n.insert.length&&2==n.insert.lines&&Sy(e.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&0==n.insert.length&&Sy(e.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&0==n.insert.length&&Sy(e.contentDOM,"Delete",46)))return!0;let i,s=n.insert.toString();if(e.state.facet(kb).some(t=>t(e,n.from,n.to,s)))return!0;if(e.inputState.composing>=0&&e.inputState.composing++,n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&e.inputState.composing<0){let s=o.from<n.from?t.sliceDoc(o.from,n.from):"",r=o.to>n.to?t.sliceDoc(n.to,o.to):"";i=t.replaceSelection(e.state.toText(s+n.insert.sliceString(0,void 0,e.state.lineBreak)+r))}else{let s=t.changes(n),l=r&&!t.selection.main.eq(r.main)&&r.main.to<=s.newLength?r.main:void 0;if(t.selection.ranges.length>1&&e.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let r=e.state.sliceDoc(n.from,n.to),a=lw(e)||e.state.doc.lineAt(o.head),h=o.to-n.to,c=o.to-o.from;i=t.changeByRange(i=>{if(i.from==o.from&&i.to==o.to)return{changes:s,range:l||i.map(s)};let u=i.to-h,d=u-r.length;if(i.to-i.from!=c||e.state.sliceDoc(d,u)!=r||a&&i.to>=a.from&&i.from<=a.to)return{range:i};let f=t.changes({from:d,to:u,insert:n.insert}),p=i.to-o.to;return{changes:f,range:l?Zm.range(Math.max(0,l.anchor+p),Math.max(0,l.head+p)):i.map(f)}})}else i={changes:s,selection:l&&t.selection.replaceRange(l)}}let l="input.type";return e.composing&&(l+=".compose",e.inputState.compositionFirstChange&&(l+=".start",e.inputState.compositionFirstChange=!1)),e.dispatch(i,{scrollIntoView:!0,userEvent:l}),!0}if(r&&!r.main.eq(o)){let t=!1,i="select";return e.inputState.lastSelectionTime>Date.now()-50&&("select"==e.inputState.lastSelectionOrigin&&(t=!0),i=e.inputState.lastSelectionOrigin),e.dispatch({selection:r,scrollIntoView:t,userEvent:i}),!0}return!1}class Lx{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=e.root||function(e){for(;e;){if(e&&(9==e.nodeType||11==e.nodeType&&e.host))return e;e=e.assignedSlot||e.parentNode}return null}(e.parent)||document,this.viewState=new hx(e.state||qv.create()),this.plugins=this.state.facet(Db).map(e=>new Rb(e));for(let t of this.plugins)t.update(this);this.observer=new Dx(this,(e,t,i)=>Rx(this,e,t,i),e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()}),this.inputState=new kw(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new rw(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(1==e.length&&e[0]instanceof Bv?e[0]:this.state.update(...e))}update(e){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t,i=!1,s=!1,n=this.state;for(let o of e){if(o.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=o.state}if(this.destroyed)return void(this.viewState.state=n);if(this.observer.clear(),n.facet(qv.phrases)!=this.state.facet(qv.phrases))return this.setState(n);t=Fb.create(this,n,e);let r=this.viewState.scrollTarget;try{this.updateState=2;for(let t of e){if(r&&(r=r.map(t.changes)),t.scrollIntoView){let{main:e}=t.state.selection;r=new Cb(e.empty?e:Zm.cursor(e.head,e.head>e.anchor?-1:1))}for(let e of t.effects)e.is(Mb)&&(r=e.value)}this.viewState.update(t,r),this.bidiCache=Nx.update(this.bidiCache,t.changes),t.empty||(this.updatePlugins(t),this.inputState.update(t)),i=this.docView.update(t),this.state.facet(Ib)!=this.styleModules&&this.mountStyles(),s=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some(e=>e.isUserEvent("select.pointer")))}finally{this.updateState=0}if(t.startState.facet(bx)!=t.state.facet(bx)&&(this.viewState.mustMeasureContent=!0),(i||s||r||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!t.empty)for(let o of this.state.facet(xb))o(t)}setState(e){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=e);this.updateState=2;let t=this.hasFocus;try{for(let e of this.plugins)e.destroy(this);this.viewState=new hx(e),this.plugins=e.facet(Db).map(e=>new Rb(e)),this.pluginMap.clear();for(let e of this.plugins)e.update(this);this.docView=new rw(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Db),i=e.state.facet(Db);if(t!=i){let s=[];for(let n of i){let i=t.indexOf(n);if(i<0)s.push(new Rb(n));else{let t=this.plugins[i];t.mustUpdate=e,s.push(t)}}for(let t of this.plugins)t.mustUpdate!=e&&t.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let s of this.plugins)s.mustUpdate=e;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let t=null;try{for(let e=0;;e++){this.updateState=1;let s=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(e>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let r=[];4&n||([this.measureRequests,r]=[r,this.measureRequests]);let o=r.map(e=>{try{return e.read(this)}catch(t){return Ab(this.state,t),Px}}),l=Fb.create(this,this.state,[]),a=!1,h=!1;l.flags|=n,t?t.flags|=n:t=l,this.updateState=2,l.empty||(this.updatePlugins(l),this.inputState.update(l),this.updateAttrs(),a=this.docView.update(l));for(let e=0;e<r.length;e++)if(o[e]!=Px)try{let t=r[e];t.write&&t.write(o[e],this)}catch(i){Ab(this.state,i)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),a&&this.docView.updateSelection(!0),this.viewport.from==s.from&&this.viewport.to==s.to&&!h&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let s of this.state.facet(xb))s(t)}get themeClasses(){return xx+" "+(this.state.facet(wx)?Sx:kx)+" "+this.state.facet(bx)}updateAttrs(){let e=Vx(this,Lb,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Ob)?"true":"false",class:"cm-content",style:`${jy.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),Vx(this,Bb,t);let i=this.observer.ignore(()=>{let i=sb(this.contentDOM,this.contentAttrs,t),s=sb(this.dom,this.editorAttrs,e);return i||s});return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let e of i.effects)if(e.is(Lx.announce)){t&&(this.announceDOM.textContent=""),t=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=e.value}}mountStyles(){this.styleModules=this.state.facet(Ib),Nl.mount(this.root,this.styleModules.concat(Ax).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),e){if(null!=e.key)for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key)return void(this.measureRequests[t]=e);this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(void 0===t||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(t=>t.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return xw(this,e,ww(this,e,t,i))}moveByGroup(e,t){return xw(this,e,ww(this,e,t,t=>function(e,t,i){let s=e.state.charCategorizer(t),n=s(i);return e=>{let t=s(e);return n==zv.Space&&(n=t),n==t}}(this,e.head,t)))}moveToLineBoundary(e,t,i=!0){return function(e,t,i,s){let n=e.state.doc.lineAt(t.head),r=s&&e.lineWrapping?e.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head):null;if(r){let t=e.dom.getBoundingClientRect(),s=e.textDirectionAt(n.from),o=e.posAtCoords({x:i==(s==zb.LTR)?t.right-1:t.left+1,y:(r.top+r.bottom)/2});if(null!=o)return Zm.cursor(o,i?-1:1)}let o=db.find(e.docView,t.head),l=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Zm.cursor(l,i?-1:1)}(this,e,t,i)}moveVertically(e,t,i){return xw(this,e,function(e,t,i,s){let n=t.head,r=i?1:-1;if(n==(i?e.state.doc.length:0))return Zm.cursor(n,t.assoc);let o,l=t.goalColumn,a=e.contentDOM.getBoundingClientRect(),h=e.coordsAtPos(n),c=e.documentTop;if(h)null==l&&(l=h.left-a.left),o=r<0?h.top:h.bottom;else{let t=e.viewState.lineBlockAt(n);null==l&&(l=Math.min(a.right-a.left,e.defaultCharacterWidth*(n-t.from))),o=(r<0?t.top:t.bottom)+c}let u=a.left+l,d=null!=s?s:e.defaultLineHeight>>1;for(let f=0;;f+=10){let i=o+(d+f)*r,s=yw(e,{x:u,y:i},!1,r);if(i<a.top||i>a.bottom||(r<0?s<n:s>n))return Zm.cursor(s,t.assoc,void 0,l)}}(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),yw(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(e),n=this.bidiSpans(s);return my(i,n[Yb.find(n,e-s.from,-1,t)].dir==zb.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(Sb)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>Bx)return Qb(e.length);let t=this.textDirectionAt(e.from);for(let s of this.bidiCache)if(s.from==e.from&&s.dir==t)return s.order;let i=function(e,t){let i=e.length,s=t==Wb?1:2,n=t==Wb?2:1;if(!e||1==s&&!Jb.test(e))return Qb(i);for(let o=0,l=s,a=s;o<i;o++){let t=Gb(e.charCodeAt(o));512==t?t=l:8==t&&4==a&&(t=16),Xb[o]=4==t?2:t,7&t&&(a=t),l=t}for(let o=0,l=s,a=s;o<i;o++){let e=Xb[o];if(128==e)o<i-1&&l==Xb[o+1]&&24&l?e=Xb[o]=l:Xb[o]=256;else if(64==e){let e=o+1;for(;e<i&&64==Xb[e];)e++;let t=o&&8==l||e<i&&8==Xb[e]?1==a?1:8:256;for(let i=o;i<e;i++)Xb[i]=t;o=e-1}else 8==e&&1==a&&(Xb[o]=1);l=e,7&e&&(a=e)}for(let o,l,a,h=0,c=0,u=0;h<i;h++)if(l=Kb[o=e.charCodeAt(h)])if(l<0){for(let e=c-3;e>=0;e-=3)if(Ub[e+1]==-l){let t=Ub[e+2],i=2&t?s:4&t?1&t?n:s:0;i&&(Xb[h]=Xb[Ub[e]]=i),c=e;break}}else{if(189==Ub.length)break;Ub[c++]=h,Ub[c++]=o,Ub[c++]=u}else if(2==(a=Xb[h])||1==a){let e=a==s;u=e?0:1;for(let t=c-3;t>=0;t-=3){let i=Ub[t+2];if(2&i)break;if(e)Ub[t+2]|=2;else{if(4&i)break;Ub[t+2]|=4}}}for(let o=0;o<i;o++)if(256==Xb[o]){let e=o+1;for(;e<i&&256==Xb[e];)e++;let t=1==(o?Xb[o-1]:s),n=t==(1==(e<i?Xb[e]:s))?t?1:2:s;for(let i=o;i<e;i++)Xb[i]=n;o=e-1}let r=[];if(1==s)for(let o=0;o<i;){let e=o,t=1!=Xb[o++];for(;o<i&&t==(1!=Xb[o]);)o++;if(t)for(let i=o;i>e;){let t=i,s=2!=Xb[--i];for(;i>e&&s==(2!=Xb[i-1]);)i--;r.push(new Yb(i,t,s?2:1))}else r.push(new Yb(e,o,0))}else for(let o=0;o<i;){let e=o,t=2==Xb[o++];for(;o<i&&t==(2==Xb[o]);)o++;r.push(new Yb(e,o,t?1:2))}return r}(e.text,t);return this.bidiCache.push(new Nx(e.from,e.to,t,i)),i}get hasFocus(){var e;return(document.hasFocus()||jy.safari&&(null===(e=this.inputState)||void 0===e?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{xy(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Mb.of(new Cb("number"==typeof e?Zm.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Eb.define(()=>({}),{eventHandlers:e})}static theme(e,t){let i=Nl.newName(),s=[bx.of(i),Ib.of(Mx(`.${i}`,e))];return t&&t.dark&&s.push(wx.of(!0)),s}static baseTheme(e){return gv.lowest(Ib.of(Mx("."+xx,e,Cx)))}}Lx.styleModule=Ib,Lx.inputHandler=kb,Lx.perLineTextDirection=Sb,Lx.exceptionSink=wb,Lx.updateListener=xb,Lx.editable=Ob,Lx.mouseSelectionStyle=bb,Lx.dragMovesSelection=yb,Lx.clickAddsSelectionRange=vb,Lx.decorations=Pb,Lx.atomicRanges=Nb,Lx.scrollMargins=Vb,Lx.darkTheme=wx,Lx.contentAttributes=Bb,Lx.editorAttributes=Lb,Lx.lineWrapping=Lx.contentAttributes.of({class:"cm-lineWrapping"}),Lx.announce=Lv.define();const Bx=4096,Px={};class Nx{constructor(e,t,i,s){this.from=e,this.to=t,this.dir=i,this.order=s}static update(e,t){if(t.empty)return e;let i=[],s=e.length?e[e.length-1].dir:zb.LTR;for(let n=Math.max(0,e.length-10);n<e.length;n++){let r=e[n];r.dir!=s||t.touchesRange(r.from,r.to)||i.push(new Nx(t.mapPos(r.from,1),t.mapPos(r.to,-1),r.dir,r.order))}return i}}function Vx(e,t,i){for(let s=e.state.facet(t),n=s.length-1;n>=0;n--){let t=s[n],r="function"==typeof t?t(e):t;r&&tb(r,i)}return i}const Ix=jy.mac?"mac":jy.windows?"win":jy.linux?"linux":"key";function Hx(e,t,i){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==i&&t.shiftKey&&(e="Shift-"+e),e}const Fx=iv.define({enables:Lx.domEventHandlers({keydown:(e,t)=>qx(Wx(t.state),e,t,"editor")})}),zx=new WeakMap;function Wx(e){let t=e.facet(Fx),i=zx.get(t);return i||zx.set(t,i=function(e,t=Ix){let i=Object.create(null),s=Object.create(null),n=(e,t)=>{let i=s[e];if(null==i)s[e]=t;else if(i!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")},r=(e,s,r,o)=>{let l=i[e]||(i[e]=Object.create(null)),a=s.split(/ (?!$)/).map(e=>function(e,t){const i=e.split(/-(?!$)/);let s,n,r,o,l=i[i.length-1];"Space"==l&&(l=" ");for(let a=0;a<i.length-1;++a){const e=i[a];if(/^(cmd|meta|m)$/i.test(e))o=!0;else if(/^a(lt)?$/i.test(e))s=!0;else if(/^(c|ctrl|control)$/i.test(e))n=!0;else if(/^s(hift)?$/i.test(e))r=!0;else{if(!/^mod$/i.test(e))throw new Error("Unrecognized modifier name: "+e);"mac"==t?o=!0:n=!0}}return s&&(l="Alt-"+l),n&&(l="Ctrl-"+l),o&&(l="Meta-"+l),r&&(l="Shift-"+l),l}(e,t));for(let t=1;t<a.length;t++){let i=a.slice(0,t).join(" ");n(i,!0),l[i]||(l[i]={preventDefault:!0,commands:[t=>{let s=$x={view:t,prefix:i,scope:e};return setTimeout(()=>{$x==s&&($x=null)},jx),!0}]})}let h=a.join(" ");n(h,!1);let c=l[h]||(l[h]={preventDefault:!1,commands:[]});c.commands.push(r),o&&(c.preventDefault=!0)};for(let o of e){let e=o[t]||o.key;if(e)for(let t of o.scope?o.scope.split(" "):["editor"])r(t,e,o.run,o.preventDefault),o.shift&&r(t,"Shift-"+e,o.shift,o.preventDefault)}return i}(t.reduce((e,t)=>e.concat(t),[]))),i}let $x=null;const jx=4e3;function qx(e,t,i,s){let n=ql(t),r=1==n.length&&" "!=n,o="",l=!1;$x&&$x.view==i&&$x.scope==s&&(o=$x.prefix+" ",(l=Cw.indexOf(t.keyCode)<0)&&($x=null));let a,h=e=>{if(e){for(let t of e.commands)if(t(i))return!0;e.preventDefault&&(l=!0)}return!1},c=e[s];if(c){if(h(c[o+Hx(n,t,!r)]))return!0;if(r&&(t.shiftKey||t.altKey||t.metaKey)&&(a=Hl[t.keyCode])&&a!=n){if(h(c[o+Hx(a,t,!0)]))return!0}else if(r&&t.shiftKey&&h(c[o+Hx(n,t,!0)]))return!0}return l}const _x=iv.define({combine(e){let t,i;for(let s of e)t=t||s.topContainer,i=i||s.bottomContainer;return{topContainer:t,bottomContainer:i}}});function Kx(e,t){let i=e.plugin(Ux),s=i?i.specs.indexOf(t):-1;return s>-1?i.panels[s]:null}const Ux=Eb.fromClass(class{constructor(e){this.input=e.state.facet(Yx),this.specs=this.input.filter(e=>e),this.panels=this.specs.map(t=>t(e));let t=e.state.facet(_x);this.top=new Gx(e,!0,t.topContainer),this.bottom=new Gx(e,!1,t.bottomContainer),this.top.sync(this.panels.filter(e=>e.top)),this.bottom.sync(this.panels.filter(e=>!e.top));for(let i of this.panels)i.dom.classList.add("cm-panel"),i.mount&&i.mount()}update(e){let t=e.state.facet(_x);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new Gx(e.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new Gx(e.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=e.state.facet(Yx);if(i!=this.input){let t=i.filter(e=>e),s=[],n=[],r=[],o=[];for(let i of t){let t,l=this.specs.indexOf(i);l<0?(t=i(e.view),o.push(t)):(t=this.panels[l],t.update&&t.update(e)),s.push(t),(t.top?n:r).push(t)}this.specs=t,this.panels=s,this.top.sync(n),this.bottom.sync(r);for(let e of o)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}else for(let s of this.panels)s.update&&s.update(e)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:e=>Lx.scrollMargins.of(t=>{let i=t.plugin(e);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}})});class Gx{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=Jx(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=Jx(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Jx(e){let t=e.nextSibling;return e.remove(),t}const Yx=iv.define({enables:Ux});class Xx extends _v{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Xx.prototype.elementClass="",Xx.prototype.toDOM=void 0,Xx.prototype.mapMode=jm.TrackBefore,Xx.prototype.startSide=Xx.prototype.endSide=-1,Xx.prototype.point=!0;const Qx="function"==typeof String.prototype.normalize?e=>e.normalize("NFKD"):e=>e;class Zx{constructor(e,t,i=0,s=e.length,n){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,s),this.bufferStart=i,this.normalize=n?e=>n(Qx(e)):Qx,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Fm(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=zm(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=Wm(e);let s=this.normalize(t);for(let n=0,r=i;;n++){let e=s.charCodeAt(n),o=this.match(e,r);if(o)return this.value=o,this;if(n==s.length-1)break;r==i&&n<t.length&&t.charCodeAt(n)==e&&r++}}}match(e,t){let i=null;for(let s=0;s<this.matches.length;s+=2){let n=this.matches[s],r=!1;this.query.charCodeAt(n)==e&&(n==this.query.length-1?i={from:this.matches[s+1],to:t+1}:(this.matches[s]++,r=!0)),r||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(1==this.query.length?i={from:t,to:t+1}:this.matches.push(1,t)),i}}"undefined"!=typeof Symbol&&(Zx.prototype[Symbol.iterator]=function(){return this});const ek={from:-1,to:-1,match:/.*/.exec("")},tk="gm"+(null==/x/.unicode?"":"u");class ik{constructor(e,t,i,s=0,n=e.length){if(this.to=n,this.curLine="",this.done=!1,this.value=ek,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new rk(e,t,i,s,n);this.re=new RegExp(t,tk+((null==i?void 0:i.ignoreCase)?"i":"")),this.iter=e.iter();let r=e.lineAt(s);this.curLineStart=r.from,this.matchPos=s,this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,s=i+t[0].length;if(this.matchPos=s+(i==s?1:0),i==this.curLine.length&&this.nextLine(),i<s||i>this.value.to)return this.value={from:i,to:s,match:t},this;e=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),e=0}}}}const sk=new WeakMap;class nk{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let s=sk.get(e);if(!s||s.from>=i||s.to<=t){let s=new nk(t,e.sliceString(t,i));return sk.set(e,s),s}if(s.from==t&&s.to==i)return s;let{text:n,from:r}=s;return r>t&&(n=e.sliceString(t,r)+n,r=t),s.to<i&&(n+=e.sliceString(s.to,i)),sk.set(e,new nk(r,n)),new nk(t,n.slice(t-r,i-r))}}class rk{constructor(e,t,i,s,n){this.text=e,this.to=n,this.done=!1,this.value=ek,this.matchPos=s,this.re=new RegExp(t,tk+((null==i?void 0:i.ignoreCase)?"i":"")),this.flat=nk.get(e,s,this.chunkEnd(s+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t&&this.flat.to<this.to&&t.index+t[0].length>this.flat.text.length-10&&(t=null),t){let e=this.flat.from+t.index,i=e+t[0].length;return this.value={from:e,to:i,match:t},this.matchPos=i+(e==i?1:0),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=nk.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function ok(e){let t=_l("input",{class:"cm-textfield",name:"line"});function i(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!i)return;let{state:s}=e,n=s.doc.lineAt(s.selection.main.head),[,r,o,l,a]=i,h=l?+l.slice(1):0,c=o?+o:n.number;if(o&&a){let e=c/100;r&&(e=e*("-"==r?-1:1)+n.number/s.doc.lines),c=Math.round(s.doc.lines*e)}else o&&r&&(c=c*("-"==r?-1:1)+n.number);let u=s.doc.line(Math.max(1,Math.min(s.doc.lines,c)));e.dispatch({effects:lk.of(!1),selection:Zm.cursor(u.from+Math.max(0,Math.min(h,u.length))),scrollIntoView:!0}),e.focus()}return{dom:_l("form",{class:"cm-gotoLine",onkeydown:t=>{27==t.keyCode?(t.preventDefault(),e.dispatch({effects:lk.of(!1)}),e.focus()):13==t.keyCode&&(t.preventDefault(),i())},onsubmit:e=>{e.preventDefault(),i()}},_l("label",e.state.phrase("Go to line"),": ",t)," ",_l("button",{class:"cm-button",type:"submit"},e.state.phrase("go")))}}"undefined"!=typeof Symbol&&(ik.prototype[Symbol.iterator]=rk.prototype[Symbol.iterator]=function(){return this});const lk=Lv.define(),ak=hv.define({create:()=>!0,update(e,t){for(let i of t.effects)i.is(lk)&&(e=i.value);return e},provide:e=>Yx.from(e,e=>e?ok:null)}),hk=Lx.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}});const ck=iv.define({combine(e){var t;return{top:e.reduce((e,t)=>null!=e?e:t.top,void 0)||!1,caseSensitive:e.reduce((e,t)=>null!=e?e:t.caseSensitive,void 0)||!1,createPanel:(null===(t=e.find(e=>e.createPanel))||void 0===t?void 0:t.createPanel)||(e=>new Nk(e))}}});class uk{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||function(e){try{return new RegExp(e,tk),!0}catch(t){return!1}}(this.search)),this.unquoted=e.literal?this.search:this.search.replace(/\\([nrt\\])/g,(e,t)=>"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp}create(){return this.regexp?new mk(this):new pk(this)}getCursor(e,t=0,i=e.length){return this.regexp?gk(this,e,t,i):fk(this,e,t,i)}}class dk{constructor(e){this.spec=e}}function fk(e,t,i,s){return new Zx(t,e.unquoted,i,s,e.caseSensitive?void 0:e=>e.toLowerCase())}class pk extends dk{constructor(e){super(e)}nextMatch(e,t,i){let s=fk(this.spec,e,i,e.length).nextOverlapping();return s.done&&(s=fk(this.spec,e,0,t).nextOverlapping()),s.done?null:s.value}prevMatchInRange(e,t,i){for(let s=i;;){let i=Math.max(t,s-1e4-this.spec.unquoted.length),n=fk(this.spec,e,i,s),r=null;for(;!n.nextOverlapping().done;)r=n.value;if(r)return r;if(i==t)return null;s-=1e4}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace}matchAll(e,t){let i=fk(this.spec,e,0,e.length),s=[];for(;!i.next().done;){if(s.length>=t)return null;s.push(i.value)}return s}highlight(e,t,i,s){let n=fk(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.length));for(;!n.next().done;)s(n.value.from,n.value.to)}}function gk(e,t,i,s){return new ik(t,e.search,e.caseSensitive?void 0:{ignoreCase:!0},i,s)}class mk extends dk{nextMatch(e,t,i){let s=gk(this.spec,e,i,e.length).next();return s.done&&(s=gk(this.spec,e,0,t).next()),s.done?null:s.value}prevMatchInRange(e,t,i){for(let s=1;;s++){let n=Math.max(t,i-1e4*s),r=gk(this.spec,e,n,i),o=null;for(;!r.next().done;)o=r.value;if(o&&(n==t||o.from>n+10))return o;if(n==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace.replace(/\$([$&\d+])/g,(t,i)=>"$"==i?"$":"&"==i?e.match[0]:"0"!=i&&+i<e.match.length?e.match[i]:t)}matchAll(e,t){let i=gk(this.spec,e,0,e.length),s=[];for(;!i.next().done;){if(s.length>=t)return null;s.push(i.value)}return s}highlight(e,t,i,s){let n=gk(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.length));for(;!n.next().done;)s(n.value.from,n.value.to)}}const vk=Lv.define(),yk=Lv.define(),bk=hv.define({create:e=>new wk(Rk(e).create(),null),update(e,t){for(let i of t.effects)i.is(vk)?e=new wk(i.value.create(),e.panel):i.is(yk)&&(e=new wk(e.query,i.value?Ek:null));return e},provide:e=>Yx.from(e,e=>e.panel)});class wk{constructor(e,t){this.query=e,this.panel=t}}const xk=ob.mark({class:"cm-searchMatch"}),kk=ob.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Sk=Eb.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(bk))}update(e){let t=e.state.field(bk);(t!=e.startState.field(bk)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return ob.none;let{view:i}=this,s=new Yv;for(let n=0,r=i.visibleRanges,o=r.length;n<o;n++){let{from:t,to:l}=r[n];for(;n<o-1&&l>r[n+1].from-500;)l=r[++n].to;e.highlight(i.state.doc,t,l,(e,t)=>{let n=i.state.selection.ranges.some(i=>i.from==e&&i.to==t);s.add(e,t,n?kk:xk)})}return s.finish()}},{decorations:e=>e.decorations});function Ck(e){return t=>{let i=t.state.field(bk,!1);return i&&i.query.spec.valid?e(t,i):Lk(t)}}const Mk=Ck((e,{query:t})=>{let{from:i,to:s}=e.state.selection.main,n=t.nextMatch(e.state.doc,i,s);return!(!n||n.from==i&&n.to==s)&&(e.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:Fk(e,n),userEvent:"select.search"}),!0)}),Ak=Ck((e,{query:t})=>{let{state:i}=e,{from:s,to:n}=i.selection.main,r=t.prevMatch(i.doc,s,n);return!!r&&(e.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:Fk(e,r),userEvent:"select.search"}),!0)}),Ok=Ck((e,{query:t})=>{let i=t.matchAll(e.state.doc,1e3);return!(!i||!i.length)&&(e.dispatch({selection:Zm.create(i.map(e=>Zm.range(e.from,e.to))),userEvent:"select.search.matches"}),!0)}),Tk=Ck((e,{query:t})=>{let{state:i}=e,{from:s,to:n}=i.selection.main;if(i.readOnly)return!1;let r=t.nextMatch(i.doc,s,s);if(!r)return!1;let o,l,a=[];if(r.from==s&&r.to==n&&(l=i.toText(t.getReplacement(r)),a.push({from:r.from,to:r.to,insert:l}),r=t.nextMatch(i.doc,r.from,r.to)),r){let e=0==a.length||a[0].from>=r.to?0:r.to-r.from-l.length;o={anchor:r.from-e,head:r.to-e}}return e.dispatch({changes:a,selection:o,scrollIntoView:!!o,effects:r?Fk(e,r):void 0,userEvent:"input.replace"}),!0}),Dk=Ck((e,{query:t})=>{if(e.state.readOnly)return!1;let i=t.matchAll(e.state.doc,1e9).map(e=>{let{from:i,to:s}=e;return{from:i,to:s,insert:t.getReplacement(e)}});return!!i.length&&(e.dispatch({changes:i,userEvent:"input.replace.all"}),!0)});function Ek(e){return e.state.facet(ck).createPanel(e)}function Rk(e,t){var i;let s=e.selection.main,n=s.empty||s.to>s.from+100?"":e.sliceDoc(s.from,s.to),r=null!==(i=null==t?void 0:t.caseSensitive)&&void 0!==i?i:e.facet(ck).caseSensitive;return t&&!n?t:new uk({search:n.replace(/\n/g,"\\n"),caseSensitive:r})}const Lk=e=>{let t=e.state.field(bk,!1);if(t&&t.panel){let i=Kx(e,Ek);if(!i)return!1;let s=i.dom.querySelector("[name=search]");if(s!=e.root.activeElement){let i=Rk(e.state,t.query.spec);i.valid&&e.dispatch({effects:vk.of(i)}),s.focus(),s.select()}}else e.dispatch({effects:[yk.of(!0),t?vk.of(Rk(e.state,t.query.spec)):Lv.appendConfig.of(Wk)]});return!0},Bk=e=>{let t=e.state.field(bk,!1);if(!t||!t.panel)return!1;let i=Kx(e,Ek);return i&&i.dom.contains(e.root.activeElement)&&e.focus(),e.dispatch({effects:yk.of(!1)}),!0},Pk=[{key:"Mod-f",run:Lk,scope:"editor search-panel"},{key:"F3",run:Mk,shift:Ak,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Mk,shift:Ak,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Bk,scope:"editor search-panel"},{key:"Mod-Shift-l",run:({state:e,dispatch:t})=>{let i=e.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:s,to:n}=i.main,r=[],o=0;for(let l=new Zx(e.doc,e.sliceDoc(s,n));!l.next().done;){if(r.length>1e3)return!1;l.value.from==s&&(o=r.length),r.push(Zm.range(l.value.from,l.value.to))}return t(e.update({selection:Zm.create(r,o),userEvent:"select.search.matches"})),!0}},{key:"Alt-g",run:e=>{let t=Kx(e,ok);if(!t){let i=[lk.of(!0)];null==e.state.field(ak,!1)&&i.push(Lv.appendConfig.of([ak,hk])),e.dispatch({effects:i}),t=Kx(e,ok)}return t&&t.dom.querySelector("input").focus(),!0}},{key:"Mod-d",run:({state:e,dispatch:t})=>{let{ranges:i}=e.selection;if(i.some(e=>e.from===e.to))return(({state:e,dispatch:t})=>{let{selection:i}=e,s=Zm.create(i.ranges.map(t=>e.wordAt(t.head)||Zm.cursor(t.head)),i.mainIndex);return!s.eq(i)&&(t(e.update({selection:s})),!0)})({state:e,dispatch:t});let s=e.sliceDoc(i[0].from,i[0].to);if(e.selection.ranges.some(t=>e.sliceDoc(t.from,t.to)!=s))return!1;let n=function(e,t){let{main:i,ranges:s}=e.selection,n=e.wordAt(i.head),r=n&&n.from==i.from&&n.to==i.to;for(let o=!1,l=new Zx(e.doc,t,s[s.length-1].to);;){if(l.next(),!l.done){if(o&&s.some(e=>e.from==l.value.from))continue;if(r){let t=e.wordAt(l.value.from);if(!t||t.from!=l.value.from||t.to!=l.value.to)continue}return l.value}if(o)return null;l=new Zx(e.doc,t,0,Math.max(0,s[s.length-1].from-1)),o=!0}}(e,s);return!!n&&(t(e.update({selection:e.selection.addRange(Zm.range(n.from,n.to),!1),effects:Lx.scrollIntoView(n.to)})),!0)},preventDefault:!0}];class Nk{constructor(e){this.view=e;let t=this.query=e.state.field(bk).query.spec;function i(e,t,i){return _l("button",{class:"cm-button",name:e,onclick:t,type:"button"},i)}this.commit=this.commit.bind(this),this.searchField=_l("input",{value:t.search,placeholder:Vk(e,"Find"),"aria-label":Vk(e,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=_l("input",{value:t.replace,placeholder:Vk(e,"Replace"),"aria-label":Vk(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=_l("input",{type:"checkbox",name:"case",checked:t.caseSensitive,onchange:this.commit}),this.reField=_l("input",{type:"checkbox",name:"re",checked:t.regexp,onchange:this.commit}),this.dom=_l("div",{onkeydown:e=>this.keydown(e),class:"cm-search"},[this.searchField,i("next",()=>Mk(e),[Vk(e,"next")]),i("prev",()=>Ak(e),[Vk(e,"previous")]),i("select",()=>Ok(e),[Vk(e,"all")]),_l("label",null,[this.caseField,Vk(e,"match case")]),_l("label",null,[this.reField,Vk(e,"regexp")]),...e.state.readOnly?[]:[_l("br"),this.replaceField,i("replace",()=>Tk(e),[Vk(e,"replace")]),i("replaceAll",()=>Dk(e),[Vk(e,"replace all")]),_l("button",{name:"close",onclick:()=>Bk(e),"aria-label":Vk(e,"close"),type:"button"},["×"])]])}commit(){let e=new uk({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:vk.of(e)}))}keydown(e){var t,i,s;t=this.view,i=e,s="search-panel",qx(Wx(t.state),i,t,s)?e.preventDefault():13==e.keyCode&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Ak:Mk)(this.view)):13==e.keyCode&&e.target==this.replaceField&&(e.preventDefault(),Tk(this.view))}update(e){for(let t of e.transactions)for(let e of t.effects)e.is(vk)&&!e.value.eq(this.query)&&this.setQuery(e.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(ck).top}}function Vk(e,t){return e.state.phrase(t)}const Ik=30,Hk=/[\s\.,:;?!]/;function Fk(e,{from:t,to:i}){let s=e.state.doc.lineAt(t).from,n=e.state.doc.lineAt(i).to,r=Math.max(s,t-Ik),o=Math.min(n,i+Ik),l=e.state.sliceDoc(r,o);if(r!=s)for(let a=0;a<Ik;a++)if(!Hk.test(l[a+1])&&Hk.test(l[a])){l=l.slice(a);break}if(o!=n)for(let a=l.length-1;a>l.length-Ik;a--)if(!Hk.test(l[a-1])&&Hk.test(l[a])){l=l.slice(0,a);break}return Lx.announce.of(`${e.state.phrase("current match")}. ${l} ${e.state.phrase("on line")} ${e.state.doc.lineAt(t).number}`)}const zk=Lx.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Wk=[bk,gv.lowest(Sk),zk],$k=_({__name:"TemplateCodeEditor",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},stage:{type:String,default:""}},emits:["update:modelValue"],setup(e,{expose:s,emit:n}){const r=e,o=n,l=g(null);let a=null;const h=Lp.define({token:(e,t)=>e.match(/^\s*#.*/)?"comment":e.match(/\{[^}]+\}/)?"string":e.match(/^[A-Z_][A-Z0-9_]*(?==)/)?"variableName":e.match(/=/)?"operator":e.match(/[^\n]*/)?"string":(e.next(),null)}),c=g([]);function u(e){let t=e.matchBefore(/\{[^}]*/);if(!t&&(t=e.matchBefore(/\{/),!t))return null;const i=t.text.slice(1);console.log("Autocomplete for:",i,"Secrets available:",c.value.length);const s=[],n={};for(const r of c.value)n[r.vault]||(n[r.vault]=[]),n[r.vault].push(r);if(i.includes(":")){const[e,t=""]=i.split(":"),r=n[e]||[];for(const i of r)t&&!i.key.toLowerCase().includes(t.toLowerCase())||s.push({label:i.key,apply:`{${e}:${i.key}`,type:"variable",detail:i.description||""})}else for(const[r,o]of Object.entries(n))for(const e of o){e.key;const t=`${r}:${e.key}`.toLowerCase();i&&!t.includes(i.toLowerCase())||s.push({label:`${r}:${e.key}`,apply:`{${r}:${e.key}`,type:"variable",detail:e.description||r})}return 0===s.length&&0===c.value.length&&s.push({label:"No secrets loaded",apply:"",type:"text",detail:"Loading..."}),console.log("Returning",s.length,"completion options"),{from:t.from,options:s,filter:!1}}const d=qu.theme({"&":{fontSize:"14px",backgroundColor:"hsl(var(--muted) / 0.3)",color:"hsl(var(--foreground))",height:"384px"},".cm-content":{padding:"12px 16px",fontFamily:"ui-monospace, SFMono-Regular, SF Mono, Consolas, Liberation Mono, Menlo, monospace",caretColor:"#ffffff !important"},".cm-line":{padding:"0",lineHeight:"1.5"},".cm-activeLine":{backgroundColor:"hsl(var(--muted))"},"&.cm-focused":{outline:"2px solid hsl(var(--ring))",outlineOffset:"0"},"&.cm-focused .cm-cursor, &.cm-focused .cm-cursor-primary":{borderLeftColor:"#ffffff !important"},".cm-cursor, .cm-cursor-primary":{borderLeftColor:"#ffffff !important",borderLeftWidth:"2px !important"},".cm-placeholder":{color:"hsl(var(--muted-foreground))",fontStyle:"normal"},".cm-gutters":{backgroundColor:"hsl(var(--muted) / 0.5)",borderRight:"1px solid hsl(var(--border))",color:"hsl(var(--muted-foreground))"},".cm-activeLineGutter":{backgroundColor:"hsl(var(--muted) / 0.7)"}}),f=qu.theme({".tok-comment":{color:"#94a3b8",fontStyle:"italic"},".tok-variableName":{color:"#7dd3fc"},".tok-string":{color:"#86efac"},".tok-operator":{color:"hsl(var(--muted-foreground))"},".ͼm":{color:"#7b7b7b"},".ͼe":{color:"#fbbf24"},".ͼd":{color:"#f87171"},".ͼ2":{color:"#fb923c"},".ͼ4":{color:"#fbbf24"},".ͼ6":{color:"#a3e635"}});return m(()=>{console.log("TemplateCodeEditor mounted");const e=pl.create({doc:r.modelValue,extensions:[Kd(),vd,Jd,cd(),nm(),[$g,Hg],h,Cp(Op),d,f,qu.lineWrapping,qu.updateListener.of(e=>{if(e.docChanged){const t=e.state.doc.toString();o("update:modelValue",t)}}),Yg({override:[u],tooltipClass:()=>"cm-autocomplete-tooltip"}),Qu.of([...Xg,...xm,...Pk,{key:"Ctrl-Space",run:Dg}]),qu.domEventHandlers({blur:()=>{a&&o("update:modelValue",a.state.doc.toString())},keydown:e=>{"{"===e.key&&setTimeout(()=>{Dg(a)},10)}})]});a=new qu({state:e,parent:l.value}),r.placeholder&&a.contentDOM.setAttribute("data-placeholder",r.placeholder)}),v(()=>{a&&a.destroy()}),w(()=>r.modelValue,e=>{a&&e!==a.state.doc.toString()&&a.dispatch({changes:{from:0,to:a.state.doc.length,insert:e}})}),s({focus(){null==a||a.focus()},getSelection(){if(!a)return{start:0,end:0};const{from:e,to:t}=a.state.selection.main;return{start:e,end:t}},setSelection(e,t){a&&a.dispatch({selection:{anchor:e,head:t}})},insertText(e){if(!a)return;const{from:t,to:i}=a.state.selection.main;a.dispatch({changes:{from:t,to:i,insert:e}})},updateSecrets:function(e){c.value=e||[],console.log("Editor: Updated secrets list with",c.value.length,"secrets"),c.value.length>0&&console.log("Sample secret:",c.value[0])}}),(e,s)=>(i(),t("div",{ref_key:"editorContainer",ref:l,class:"template-code-editor"},null,512))}},[["__scopeId","data-v-a3466855"]]),jk={class:"fixed inset-0 z-50 overflow-y-auto"},qk={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-40 text-center sm:p-0"},_k={class:"relative inline-block w-full max-w-4xl px-6 py-5 overflow-visible text-left align-middle transition-all transform bg-background rounded-lg shadow-xl"},Kk={class:"flex items-center justify-between mb-4"},Uk={class:"text-sm text-muted-foreground"},Gk={key:0,class:"flex justify-center py-12"},Jk={key:1,class:"space-y-4"},Yk={class:"flex items-center justify-between bg-muted/50 rounded-md p-2"},Xk={class:"flex items-center gap-2"},Qk={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary"},Zk={class:"relative mb-8",style:{overflow:"visible"}},eS={key:0,class:"bg-destructive/10 border border-destructive/20 rounded-md p-3"},tS={class:"space-y-1"},iS={key:1,class:"flex items-center gap-2 text-sm text-warning"},sS={class:"flex justify-between items-center mt-6"},nS={class:"flex items-center gap-3"},rS=["disabled"],oS={key:0,class:"flex items-center gap-2"},lS={key:0,class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},aS={key:1,class:"w-4 h-4 text-destructive",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},hS={key:2,class:"w-4 h-4 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},cS={class:"flex gap-3"},uS=["disabled"],dS=_({__name:"TemplateEditorModal",props:{template:{type:Object,required:!0}},emits:["close","saved"],setup(r,{emit:o}){const c=r,f=o,{showToast:p}=V(),v=g(null),y=g(!0),b=g(!1),x=g(!1),k=g(""),S=g(""),M=g({}),A=g([]),O=g([]),T=g(""),D=g(""),E=g([]),R=e(()=>k.value!==S.value);async function B(){if(R.value){b.value=!0,O.value=[];try{await window.$api.put(`/templates/${encodeURIComponent(c.template.filename)}`,{content:k.value}),S.value=k.value,p("Template saved successfully","success"),f("saved")}catch(e){p("Failed to save template","error"),console.error("Failed to save template:",e)}finally{b.value=!1}}}async function P(){x.value=!0,O.value=[],T.value="",D.value="";try{const e=await window.$api.post("/templates/validate",{content:k.value,stage:M.value.stage});if(e.valid)if(O.value=[],e.warnings&&e.warnings.length>0){const t=e.warnings.filter(e=>"unused"===e.type).length;t>0?(T.value="warning",D.value=`Valid with ${t} unused secret${1!==t?"s":""}`):(T.value="valid",D.value="Template is valid")}else T.value="valid",D.value="Template is valid";else O.value=e.errors.map(e=>`Line ${e.line}: ${e.key} - ${e.error}`),T.value="invalid",D.value=`${e.errors.length} error${1!==e.errors.length?"s":""} found`}catch(e){T.value="invalid",D.value="Validation failed",console.error("Failed to validate template:",e)}finally{x.value=!1,"valid"===T.value&&setTimeout(()=>{T.value="",D.value=""},5e3)}}function N(){const e=k.value.split("\n"),t=[];let i=!1;for(const s of e){const e=s.trim();if(""!==e)if(i=!1,e.startsWith("#"))t.push(s);else if(e.includes("=")){const[i,...s]=e.split("="),n=s.join("=");t.push(`${i.trim()}=${n.trim()}`)}else t.push(s);else i||(t.push(""),i=!0)}k.value=t.join("\n").trim()+"\n",p("Template formatted","success")}return m(async()=>{console.log("TemplateEditorModal mounted, template:",c.template),await async function(){console.log("loadTemplate() called"),y.value=!0;try{const e=await window.$api.get(`/templates/${encodeURIComponent(c.template.filename)}`);console.log("Template loaded:",e),M.value=e,k.value=e.content||"",S.value=e.content||"",A.value=e.placeholders||[],console.log("About to call loadSecrets()"),await async function(){var e,t;try{const s=(null==(e=M.value)?void 0:e.stage)||(null==(t=c.template)?void 0:t.stage);if(console.log("Loading secrets for stage:",s),!s)return void console.warn("No stage available for loading secrets");console.log("Loading vaults...");const n=await window.$api.listVaults();console.log("Vaults response:",n);const r=n.vaults||n||[];console.log("Found vaults:",r);const o=[];if(!Array.isArray(r))return void console.error("Vaults is not an array:",r);for(const e of r)try{const t=e.slug||e.name||e;console.log(`Loading secrets from vault ${t} for stage ${s}...`);const i=await window.$api.listSecrets(t,s,!1);console.log(`Response from ${t}:`,i);const n=i.secrets||i||[],r=Array.isArray(n)?n.length:0;if(console.log(`Found ${r} secrets in ${t}`),Array.isArray(n))for(const e of n)o.push({vault:t,key:e.key||e,description:e.description||""})}catch(i){console.error(`Failed to load secrets from vault ${e.slug||e}:`,i)}console.log(`Total: Loaded ${o.length} secrets across ${r.length} vaults for stage ${s}`),console.log("Sample secrets:",o.slice(0,3)),E.value=o,await L(),v.value?(console.log("Editor is ready, updating secrets immediately"),v.value.updateSecrets(o)):console.log("Editor not ready yet, will update via watcher")}catch(i){console.error("Failed to load secrets for autocomplete:",i)}}()}catch(e){console.error("Error in loadTemplate:",e)}finally{y.value=!1}}()}),w(k,()=>{!function(){const e=/\{([^:}]+):([^}]+)\}/g,t=new Set;let i;for(;null!==(i=e.exec(k.value));)t.add(i[0]);A.value=Array.from(t).sort()}(),T.value&&(T.value="",D.value="",O.value=[])}),w(v,e=>{e&&E.value.length>0&&(console.log("Editor became available, updating with",E.value.length,"secrets"),e.updateSecrets(E.value))}),(e,o)=>(i(),t("div",jk,[s("div",qk,[o[12]||(o[12]=s("div",{class:"fixed inset-0 transition-opacity"},[s("div",{class:"absolute inset-0 bg-black opacity-75"})],-1)),s("div",_k,[s("div",Kk,[s("div",null,[o[3]||(o[3]=s("h2",{class:"text-xl font-semibold"},"Edit Template",-1)),s("p",Uk,l(r.template.filename),1)]),s("button",{onClick:o[0]||(o[0]=t=>e.$emit("close")),class:"p-1 rounded hover:bg-muted transition-colors"},[...o[4]||(o[4]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),y.value?(i(),t("div",Gk,[...o[5]||(o[5]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)])])):(i(),t("div",Jk,[s("div",Yk,[s("div",Xk,[s("span",Qk," Stage: "+l(M.value.stage),1)]),s("div",{class:"flex items-center gap-2"},[s("button",{onClick:N,class:"px-3 py-1 text-xs bg-background border border-border rounded hover:bg-muted transition-colors"}," Format ")])]),s("div",Zk,[h($k,{ref_key:"editorRef",ref:v,modelValue:k.value,"onUpdate:modelValue":o[1]||(o[1]=e=>k.value=e),stage:M.value.stage,placeholder:"# Enter your template content here...\n# Use {vault:key} syntax for placeholders"},null,8,["modelValue","stage"])]),O.value.length>0?(i(),t("div",eS,[o[7]||(o[7]=s("h3",{class:"text-sm font-medium mb-2 text-destructive"},"Validation Errors",-1)),s("ul",tS,[(i(!0),t(u,null,d(O.value,e=>(i(),t("li",{key:e,class:"text-sm text-destructive flex items-start gap-2"},[o[6]||(o[6]=s("svg",{class:"w-4 h-4 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),C(" "+l(e),1)]))),128))])])):n("",!0),R.value?(i(),t("div",iS,[...o[8]||(o[8]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),C(" Unsaved changes ",-1)])])):n("",!0)])),s("div",sS,[s("div",nS,[s("button",{onClick:P,disabled:x.value,class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors disabled:opacity-50"},l(x.value?"Validating...":"Validate"),9,rS),T.value?(i(),t("div",oS,["valid"===T.value?(i(),t("svg",lS,[...o[9]||(o[9]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):"invalid"===T.value?(i(),t("svg",aS,[...o[10]||(o[10]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):"warning"===T.value?(i(),t("svg",hS,[...o[11]||(o[11]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)])])):n("",!0),s("span",{class:a(["text-sm","valid"===T.value?"text-green-600":"invalid"===T.value?"text-destructive":"text-warning"])},l(D.value),3)])):n("",!0)]),s("div",cS,[s("button",{onClick:o[2]||(o[2]=t=>e.$emit("close")),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),s("button",{onClick:B,disabled:b.value||!R.value,class:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50"},l(b.value?"Saving...":"Save Template"),9,uS)])])])])]))}},[["__scopeId","data-v-4164dbb0"]]),fS={class:"fixed inset-0 z-50 overflow-y-auto"},pS={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0"},gS={class:"relative inline-block w-full max-w-3xl px-6 py-5 overflow-hidden text-left align-middle transition-all transform bg-background rounded-lg shadow-xl"},mS={class:"flex items-center justify-between mb-4"},vS={class:"text-sm text-muted-foreground"},yS={key:0,class:"space-y-4 mb-6"},bS=["value"],wS=["value"],xS={key:1,class:"space-y-6"},kS={class:"flex items-center gap-3"},SS={key:0,class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},CS={key:1,class:"w-6 h-6 text-destructive",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},MS={class:"font-semibold"},AS={class:"text-sm text-muted-foreground"},OS={key:0,class:"space-y-4"},TS={class:"font-medium text-destructive"},DS={class:"space-y-2"},ES={class:"flex items-start gap-2"},RS={class:"flex-1"},LS={class:"text-sm font-medium"},BS={class:"font-mono"},PS={class:"text-sm text-muted-foreground mt-1"},NS={class:"text-xs text-muted-foreground mt-1"},VS={key:1,class:"space-y-4"},IS={class:"font-medium text-warning"},HS={class:"space-y-2"},FS={class:"flex items-start gap-2"},zS={class:"flex-1"},WS={class:"text-sm font-medium"},$S={class:"text-sm text-muted-foreground mt-1"},jS={class:"font-mono"},qS={key:2,class:"space-y-4"},_S={class:"font-medium"},KS={class:"bg-muted/30 rounded-md p-3"},US={class:"flex flex-wrap gap-2"},GS={key:3,class:"text-center py-4"},JS={class:"text-sm text-muted-foreground mt-1"},YS={class:"flex justify-end mt-6 gap-3"},XS={class:"flex gap-3"},QS=["disabled"],ZS={__name:"TemplateTesterModal",props:{template:{type:Object,required:!0}},emits:["close"],setup(r,{emit:o}){const h=r,{showToast:c}=V(),f=g(!1),p=g(!1),v=g(""),y=g([]),b=g({valid:!1,errors:[],warnings:[],unusedSecrets:[],placeholderCount:0}),w=e(()=>y.value.filter(e=>e!==h.template.stage));async function x(){if(v.value){f.value=!0;try{const e=await window.$api.post("/templates/validate",{filename:h.template.filename,stage:v.value});b.value=e,p.value=!0,e.valid?e.warnings&&e.warnings.length>0?c("Template is valid with warnings","warning"):c("Template is fully valid!","success"):c(`Found ${e.errors.length} error${1!==e.errors.length?"s":""}`,"error")}catch(e){c("Failed to validate template","error"),console.error("Failed to validate template:",e)}finally{f.value=!1}}else c("Please select a stage","warning")}function S(){p.value=!1,b.value={valid:!1,errors:[],warnings:[],unusedSecrets:[],placeholderCount:0}}return m(async()=>{v.value=h.template.stage,await async function(){try{const e=await window.$api.getSettings();y.value=e.stages||[]}catch(e){console.error("Failed to load stages:",e)}}()}),(e,o)=>(i(),t("div",fS,[s("div",pS,[o[13]||(o[13]=s("div",{class:"fixed inset-0 transition-opacity"},[s("div",{class:"absolute inset-0 bg-black opacity-75"})],-1)),s("div",gS,[s("div",mS,[s("div",null,[o[3]||(o[3]=s("h2",{class:"text-xl font-semibold"},"Test Template",-1)),s("p",vS,l(r.template.filename),1)]),s("button",{onClick:o[0]||(o[0]=t=>e.$emit("close")),class:"p-1 rounded hover:bg-muted transition-colors"},[...o[4]||(o[4]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),p.value?n("",!0):(i(),t("div",yS,[s("div",null,[o[5]||(o[5]=s("label",{class:"block text-sm font-medium mb-2"},"Test Against Stage",-1)),k(s("select",{"onUpdate:modelValue":o[1]||(o[1]=e=>v.value=e),class:"w-full px-3 py-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-primary focus:border-transparent"},[s("option",{value:r.template.stage},l(r.template.stage)+" (template stage)",9,bS),(i(!0),t(u,null,d(w.value,e=>(i(),t("option",{key:e,value:e},l(e),9,wS))),128))],512),[[A,v.value]])])])),p.value?(i(),t("div",xS,[s("div",{class:a(["rounded-lg p-4 border",b.value.valid?"bg-green-500/10 border-green-500/20":"bg-destructive/10 border-destructive/20"])},[s("div",kS,[b.value.valid?(i(),t("svg",SS,[...o[6]||(o[6]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(i(),t("svg",CS,[...o[7]||(o[7]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])),s("div",null,[s("h3",MS,l(b.value.valid?"Template is Valid":"Template Has Issues"),1),s("p",AS,l(b.value.placeholderCount)+" placeholder"+l(1!==b.value.placeholderCount?"s":"")+" checked ",1)])])],2),b.value.errors&&b.value.errors.length>0?(i(),t("div",OS,[s("h3",TS,"Errors ("+l(b.value.errors.length)+")",1),s("div",DS,[(i(!0),t(u,null,d(b.value.errors,e=>(i(),t("div",{key:`${e.line}-${e.key}`,class:"bg-destructive/5 border border-destructive/20 rounded-md p-3"},[s("div",ES,[o[8]||(o[8]=s("svg",{class:"w-4 h-4 mt-0.5 text-destructive flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s("div",RS,[s("p",LS,[C(" Line "+l(e.line)+": ",1),s("span",BS,l(e.key),1)]),s("p",PS,l(e.error),1),s("p",NS," Vault: "+l(e.vault||"Unknown"),1)])])]))),128))])])):n("",!0),b.value.warnings&&b.value.warnings.length>0?(i(),t("div",VS,[s("h3",IS,"Warnings ("+l(b.value.warnings.length)+")",1),s("div",HS,[(i(!0),t(u,null,d(b.value.warnings,e=>(i(),t("div",{key:`${e.vault}-${e.key}`,class:"bg-warning/5 border border-warning/20 rounded-md p-3"},[s("div",FS,[o[9]||(o[9]=s("svg",{class:"w-4 h-4 mt-0.5 text-warning flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),s("div",zS,[s("p",WS,l(e.message),1),s("p",$S,[s("span",jS,l(e.vault)+":"+l(e.key),1)])])])]))),128))])])):n("",!0),b.value.unusedSecrets&&b.value.unusedSecrets.length>0?(i(),t("div",qS,[s("h3",_S,"Unused Secrets ("+l(b.value.unusedSecrets.length)+")",1),s("div",KS,[o[10]||(o[10]=s("p",{class:"text-sm text-muted-foreground mb-3"}," These secrets exist in the vaults but are not referenced in the template: ",-1)),s("div",US,[(i(!0),t(u,null,d(b.value.unusedSecrets,e=>(i(),t("span",{key:`${e.vault}-${e.key}`,class:"inline-flex items-center px-2 py-1 text-xs font-mono bg-background border border-border rounded"},l(e.vault)+":"+l(e.key),1))),128))])])])):n("",!0),!b.value.valid||b.value.warnings&&0!==b.value.warnings.length?n("",!0):(i(),t("div",GS,[o[11]||(o[11]=s("svg",{class:"w-12 h-12 mx-auto text-green-600 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o[12]||(o[12]=s("p",{class:"text-green-600 font-medium"},"All placeholders are valid!",-1)),s("p",JS," The template can be successfully processed for the "+l(v.value)+" stage. ",1)]))])):n("",!0),s("div",YS,[s("button",{onClick:o[2]||(o[2]=t=>e.$emit("close")),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),s("div",XS,[p.value?(i(),t("button",{key:0,onClick:S,class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Test Again ")):n("",!0),p.value?n("",!0):(i(),t("button",{key:1,onClick:x,disabled:f.value||!v.value,class:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50"},l(f.value?"Validating...":"Run Validation"),9,QS))])])])])]))}},eC={class:"fixed inset-0 z-50 overflow-y-auto"},tC={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0"},iC={class:"relative inline-block w-full max-w-4xl px-6 py-5 overflow-hidden text-left align-middle transition-all transform bg-background rounded-lg shadow-xl"},sC={class:"flex items-center justify-between mb-4"},nC={class:"text-sm text-muted-foreground"},rC={key:0,class:"space-y-4 mb-6"},oC={class:"grid grid-cols-2 gap-4"},lC=["value"],aC=["value"],hC={key:1,class:"space-y-4"},cC={key:0,class:"bg-destructive/10 border border-destructive/20 rounded-md p-3"},uC={class:"flex items-center gap-2"},dC={class:"text-sm"},fC={class:"flex items-center justify-between mb-2"},pC={class:"flex items-center gap-2"},gC={class:"relative"},mC={class:"bg-muted/50 rounded-md p-4 text-sm font-mono overflow-x-auto max-h-96 overflow-y-auto"},vC={class:"grid grid-cols-3 gap-4"},yC={class:"bg-muted/30 rounded-md p-3 text-center"},bC={class:"text-2xl font-semibold"},wC={class:"bg-muted/30 rounded-md p-3 text-center"},xC={class:"text-2xl font-semibold text-green-600"},kC={class:"bg-muted/30 rounded-md p-3 text-center"},SC={class:"text-2xl font-semibold text-warning"},CC={key:2,class:"bg-destructive/10 border border-destructive/20 rounded-md p-3"},MC={class:"flex items-center gap-2"},AC={class:"text-sm"},OC={class:"flex justify-end mt-6 gap-3"},TC={class:"flex gap-3"},DC=["disabled"],EC={__name:"TemplateProcessorModal",props:{template:{type:Object,required:!0}},emits:["close"],setup(r,{emit:o}){const a=r,{showToast:h}=V(),c=g(!1),f=g(!1),p=g(""),v=g("skip"),y=g([]),b=g({}),w=g(""),x=g(!1),S=e(()=>y.value.filter(e=>e!==a.template.stage)),M=e(()=>{if(!b.value.output||!b.value.placeholders)return 0;let e=0;for(const t of b.value.placeholders)b.value.output.includes(t)||e++;return e}),O=e(()=>b.value.placeholders?b.value.placeholders.length-M.value:0);async function T(){if(p.value){c.value=!0,w.value="";try{const e=await window.$api.post("/templates/process",{filename:a.template.filename,stage:p.value,strategy:v.value});b.value=e,f.value=!0,e.validation&&!e.validation.valid?h("Template processed with validation errors","warning"):h("Template processed successfully","success")}catch(e){w.value=e.message||"Failed to process template",h("Failed to process template","error")}finally{c.value=!1}}else h("Please select a stage","warning")}function D(){f.value=!1,b.value={},w.value="",x.value=!1}async function E(){try{await navigator.clipboard.writeText(b.value.output),x.value=!0,h("Copied to clipboard","success"),setTimeout(()=>{x.value=!1},2e3)}catch(e){h("Failed to copy to clipboard","error")}}function R(){const e=new Blob([b.value.output],{type:"text/plain"}),t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=`${p.value}.env`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t),h("Downloaded .env file","success")}return m(async()=>{p.value=a.template.stage,await async function(){try{const e=await window.$api.getSettings();y.value=e.stages||[]}catch(e){console.error("Failed to load stages:",e)}}()}),(e,o)=>{var a;return i(),t("div",eC,[s("div",tC,[o[16]||(o[16]=s("div",{class:"fixed inset-0 transition-opacity"},[s("div",{class:"absolute inset-0 bg-black opacity-75"})],-1)),s("div",iC,[s("div",sC,[s("div",null,[o[4]||(o[4]=s("h2",{class:"text-xl font-semibold"},"Process Template",-1)),s("p",nC,l(r.template.filename),1)]),s("button",{onClick:o[0]||(o[0]=t=>e.$emit("close")),class:"p-1 rounded hover:bg-muted transition-colors"},[...o[5]||(o[5]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),f.value?n("",!0):(i(),t("div",rC,[s("div",oC,[s("div",null,[o[6]||(o[6]=s("label",{class:"block text-sm font-medium mb-2"},"Stage",-1)),k(s("select",{"onUpdate:modelValue":o[1]||(o[1]=e=>p.value=e),class:"w-full px-3 py-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-primary focus:border-transparent"},[s("option",{value:r.template.stage},l(r.template.stage)+" (template stage)",9,lC),(i(!0),t(u,null,d(S.value,e=>(i(),t("option",{key:e,value:e},l(e),9,aC))),128))],512),[[A,p.value]])]),s("div",null,[o[8]||(o[8]=s("label",{class:"block text-sm font-medium mb-2"},"Missing Secret Strategy",-1)),k(s("select",{"onUpdate:modelValue":o[2]||(o[2]=e=>v.value=e),class:"w-full px-3 py-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-primary focus:border-transparent"},[...o[7]||(o[7]=[s("option",{value:"skip"},"Skip (leave placeholder)",-1),s("option",{value:"empty"},"Empty string",-1),s("option",{value:"error"},"Error",-1)])],512),[[A,v.value]])])]),o[9]||(o[9]=s("div",{class:"bg-muted/30 rounded-md p-3"},[s("p",{class:"text-sm text-muted-foreground"},[s("strong",null,"Skip:"),C(" Leaves placeholders as-is for missing secrets"),s("br"),s("strong",null,"Empty:"),C(" Replaces missing secrets with empty strings"),s("br"),s("strong",null,"Error:"),C(" Stops processing if any secret is missing ")])],-1))])),f.value?(i(),t("div",hC,[b.value.validation.valid?n("",!0):(i(),t("div",cC,[s("div",uC,[o[10]||(o[10]=s("svg",{class:"w-5 h-5 text-destructive flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),s("p",dC," Template has "+l(b.value.validation.errorCount)+" validation error"+l(1!==b.value.validation.errorCount?"s":"")+". Output may be incomplete. ",1)])])),s("div",null,[s("div",fC,[o[11]||(o[11]=s("label",{class:"block text-sm font-medium"},"Processed Output",-1)),s("div",pC,[s("button",{onClick:R,class:"px-3 py-1 text-xs bg-background border border-border rounded hover:bg-muted transition-colors"}," Download .env "),s("button",{onClick:E,class:"px-3 py-1 text-xs bg-background border border-border rounded hover:bg-muted transition-colors"},l(x.value?"Copied!":"Copy"),1)])]),s("div",gC,[s("pre",mC,l(b.value.output),1)])]),s("div",vC,[s("div",yC,[s("p",bC,l((null==(a=b.value.placeholders)?void 0:a.length)||0),1),o[12]||(o[12]=s("p",{class:"text-xs text-muted-foreground"},"Total Placeholders",-1))]),s("div",wC,[s("p",xC,l(M.value),1),o[13]||(o[13]=s("p",{class:"text-xs text-muted-foreground"},"Processed",-1))]),s("div",kC,[s("p",SC,l(O.value),1),o[14]||(o[14]=s("p",{class:"text-xs text-muted-foreground"},"Skipped",-1))])])])):n("",!0),w.value?(i(),t("div",CC,[s("div",MC,[o[15]||(o[15]=s("svg",{class:"w-5 h-5 text-destructive flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s("p",AC,l(w.value),1)])])):n("",!0),s("div",OC,[s("button",{onClick:o[3]||(o[3]=t=>e.$emit("close")),class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Cancel "),s("div",TC,[f.value?(i(),t("button",{key:0,onClick:D,class:"px-4 py-2 text-sm border border-border rounded-md hover:bg-muted transition-colors"}," Process Again ")):n("",!0),f.value?n("",!0):(i(),t("button",{key:1,onClick:T,disabled:c.value||!p.value,class:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50"},l(c.value?"Processing...":"Process Template"),9,DC))])])])])])}}},RC={class:"space-y-6"},LC={class:"flex justify-between items-center"},BC={class:"bg-muted/50 rounded-lg p-4"},PC={class:"flex items-center gap-2"},NC={class:"text-sm font-mono"},VC={key:0,class:"flex justify-center py-12"},IC={key:1,class:"text-center py-12 bg-muted/30 rounded-lg"},HC={key:2,class:"bg-background border border-border rounded-lg overflow-hidden"},FC={class:"w-full"},zC={class:"divide-y divide-border"},WC={class:"px-4 py-3"},$C={class:"flex items-center gap-2"},jC={class:"font-mono text-sm"},qC={class:"px-4 py-3"},_C={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary"},KC={class:"px-4 py-3 text-sm text-muted-foreground"},UC={class:"px-4 py-3 text-sm text-muted-foreground"},GC={class:"px-4 py-3"},JC={class:"flex items-center justify-end gap-2"},YC=["onClick"],XC=["onClick"],QC=["onClick"],ZC=["onClick"],eM={__name:"TemplatesView",setup(e){const{showToast:o}=V(),a=g(!1),c=g([]),f=g(""),p=g(!1),v=g(!1),y=g(!1),b=g(!1),w=g(null),x=g(null),k=g(null);async function S(){a.value=!0;try{const e=await window.$api.get("/templates");c.value=e.templates||[]}catch(e){o("Failed to load templates","error"),console.error("Failed to load templates:",e)}finally{a.value=!1}}async function C(){if(x.value)try{await window.$api.delete(`/templates/${encodeURIComponent(x.value.filename)}`),o("Template deleted successfully","success"),await S()}catch(e){o("Failed to delete template","error"),console.error("Failed to delete template:",e)}finally{x.value=null}}function M(){p.value=!1,S()}function A(){v.value=!1,S()}function O(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*10)/10+" "+["B","KB","MB"][t]}function T(e){if(!e)return"Unknown";const t=new Date(1e3*e),i=new Date-t;if(i<6e4)return"Just now";if(i<36e5){const e=Math.floor(i/6e4);return`${e} minute${1===e?"":"s"} ago`}if(i<864e5){const e=Math.floor(i/36e5);return`${e} hour${1===e?"":"s"} ago`}if(i<6048e5){const e=Math.floor(i/864e5);return`${e} day${1===e?"":"s"} ago`}return t.toLocaleDateString()}return m(async()=>{await async function(){try{const e=await window.$api.getSettings();f.value=e.template_path||"env"}catch(e){console.error("Failed to load settings:",e),f.value="env"}}(),S()}),(e,o)=>{var g;return i(),t("div",RC,[s("div",LC,[o[6]||(o[6]=s("div",null,[s("h1",{class:"text-2xl font-bold"},"Environment Templates"),s("p",{class:"text-muted-foreground mt-1"}," Manage .env templates for different stages ")],-1)),s("button",{onClick:o[0]||(o[0]=e=>p.value=!0),class:"flex items-center space-x-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm font-medium"},[...o[5]||(o[5]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),s("span",null,"Add Template",-1)])])]),s("div",BC,[s("div",PC,[o[7]||(o[7]=s("svg",{class:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),o[8]||(o[8]=s("span",{class:"text-sm text-muted-foreground"},"Template Directory:",-1)),s("span",NC,l(f.value),1)])]),a.value?(i(),t("div",VC,[...o[9]||(o[9]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)])])):0===c.value.length?(i(),t("div",IC,[...o[10]||(o[10]=[s("svg",{class:"w-12 h-12 mx-auto text-muted-foreground mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),s("p",{class:"text-muted-foreground mb-2"},"No templates found",-1),s("p",{class:"text-sm text-muted-foreground"},"Create your first template to get started",-1)])])):(i(),t("div",HC,[s("table",FC,[o[16]||(o[16]=s("thead",{class:"bg-muted/50"},[s("tr",null,[s("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Template"),s("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Stage"),s("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Size"),s("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Last Modified"),s("th",{class:"px-4 py-3 text-right text-sm font-medium text-muted-foreground"},"Actions")])],-1)),s("tbody",zC,[(i(!0),t(u,null,d(c.value,e=>(i(),t("tr",{key:e.filename,class:"hover:bg-muted/30 transition-colors"},[s("td",WC,[s("div",$C,[o[11]||(o[11]=s("svg",{class:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),s("span",jC,l(e.filename),1)])]),s("td",qC,[s("span",_C,l(e.stageDisplay||e.stage),1)]),s("td",KC,l(O(e.size)),1),s("td",UC,l(T(e.lastModified)),1),s("td",GC,[s("div",JC,[s("button",{onClick:t=>function(e){console.log("Editing template:",e),w.value={...e},v.value=!0}(e),class:"p-1.5 text-muted-foreground hover:text-foreground hover:bg-muted rounded transition-colors",title:"Edit Template"},[...o[12]||(o[12]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,YC),s("button",{onClick:t=>function(e){w.value={...e},y.value=!0}(e),class:"p-1.5 text-muted-foreground hover:text-foreground hover:bg-muted rounded transition-colors",title:"Test Template"},[...o[13]||(o[13]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,XC),s("button",{onClick:t=>function(e){w.value={...e},b.value=!0}(e),class:"p-1.5 text-muted-foreground hover:text-foreground hover:bg-muted rounded transition-colors",title:"Process Template"},[...o[14]||(o[14]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,QC),s("button",{onClick:t=>function(e){x.value=e,k.value.open()}(e),class:"p-1.5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 rounded transition-colors",title:"Delete Template"},[...o[15]||(o[15]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ZC)])])]))),128))])])])),p.value?(i(),r(Fr,{key:3,onClose:o[1]||(o[1]=e=>p.value=!1),onCreated:M})):n("",!0),v.value?(i(),r(dS,{key:4,template:w.value,onClose:o[2]||(o[2]=e=>v.value=!1),onSaved:A},null,8,["template"])):n("",!0),y.value?(i(),r(ZS,{key:5,template:w.value,onClose:o[3]||(o[3]=e=>y.value=!1)},null,8,["template"])):n("",!0),b.value?(i(),r(EC,{key:6,template:w.value,onClose:o[4]||(o[4]=e=>b.value=!1)},null,8,["template"])):n("",!0),h(cn,{ref_key:"deleteTemplateModal",ref:k,title:"Delete Template",message:`Are you sure you want to delete '${null==(g=x.value)?void 0:g.filename}'? This action cannot be undone.`,confirmText:"Delete Template",onConfirm:C},null,8,["message"])])}}},tM=[{path:"/",redirect:"/secrets"},{path:"/secrets",name:"secrets",component:vs},{path:"/templates",name:"templates",component:eM},{path:"/diff",name:"diff",component:sn},{path:"/settings",name:"settings",component:yr}],iM=B({history:P(),routes:tM});window.$api=Ce,N(le).use(iM).mount("#app");
//# sourceMappingURL=app.BC62CwPM.js.map
